{"ast":null,"code":"import _objectSpread from\"C:/Users/skank/Videos/Cards/Milchcards/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useRef,useEffect,useCallback}from'react';import{useVisualEffectsSafe}from'../context/VisualEffectsContext';import{LAYOUT,getZone,computeSlotRects,getUiTransform,getLaneCapacity,getPublicRects,getGovernmentRects,getSofortRect}from'../ui/layout';import{sortHandCards}from'../utils/gameUtils';import{getCardImagePath}from'../data/gameData';import influenceIconUrl from'../assets/icons/influence.svg';import publicSymbolUrl from'../assets/icons/public_symbol.png';import sofortSymbolUrl from'../assets/icons/sofort_initiative_symbol.png';import dauerhaftSymbolUrl from'../assets/icons/dauerhaft_initative.png';import governmentSymbolUrl from'../assets/icons/government_symbol.png';import interventionSymbolUrl from'../assets/icons/intervention_symbol.png';import govPlaceGifUrl from'../assets/effect_gif/place_card_gov_256x256.gif';import govPlaceSpritesheetUrl from'../ui/sprites/playcard_gov_256x256_14.png';import instantSpritesheetUrl from'../ui/sprites/activate_trap_hit_target_256x256_16x2.png';import hitSpritesheetUrl from'../ui/sprites/activate_inititive_hit_target_256x256_16_2rows.png';import{jsx as _jsx}from\"react/jsx-runtime\";// Helper: is corruption target selection active\nfunction isCorruptionSelection(state,player){const sel=state.pendingAbilitySelect;return sel&&sel.type==='corruption_steal'&&sel.actorPlayer===player;}// Helper: is maulwurf corruption active\nfunction isMaulwurfCorruption(state,player){const sel=state.pendingAbilitySelect;return sel&&sel.type==='maulwurf_steal'&&sel.actorPlayer===player;}// Helper: is tunnelvision probe active\nfunction isTunnelvisionProbe(state,player){const sel=state.pendingAbilitySelect;return sel&&sel.type==='tunnelvision_probe'&&sel.actorPlayer===player;}export const GameCanvas=_ref=>{let{gameState,selectedHandIndex,onCardClick,onCardHover,devMode=false}=_ref;// listen for dice roll requests from resolver and trigger Dice3D\nuseEffect(()=>{const handler=ev=>{try{var _ev$detail;const player=(_ev$detail=ev.detail)===null||_ev$detail===void 0?void 0:_ev$detail.player;// find Dice3D canvas on page and trigger click (it rolls on click)\nconst dice=document.querySelector('canvas');// better: dispatch global event so App-level Dice3D component can roll programmatically\nwindow.dispatchEvent(new CustomEvent('pc:ui_request_dice_roll',{detail:{player}}));}catch(e){}};window.addEventListener('pc:request_dice_roll',handler);return()=>window.removeEventListener('pc:request_dice_roll',handler);},[]);const canvasRef=useRef(null);const visualEffects=useVisualEffectsSafe();const clickZonesRef=useRef([]);// Smooth vertical scroll for P1 hand when it has more than visible slots\nconst handScrollTargetRef=useRef(0);const handScrollCurrentRef=useRef(0);const handScrollEnabledRef=useRef(true);// Touch handling refs\nconst touchStartYRef=useRef(null);const lastTouchYRef=useRef(null);const isTouchingRef=useRef(false);const backgroundImageRef=useRef(null);const imageCacheRef=useRef(new Map());const influenceImgRef=useRef(null);// Animation state for visual influence changes: Map<uid, Array<Anim>>\nconst influenceAnimRef=useRef(new Map());// Previous per-card influence snapshot to detect increases\nconst prevInfluencesRef=useRef({});// Slot symbol images\nconst slotSymbolImgsRef=useRef(new Map());// Map of canonical slot positions for animations: key -> {x,y,w,h,cx,cy}\nconst slotPositionsRef=useRef({});// Mapping between animation UIDs and slot keys to ensure one-shot playback\nconst uidToKeyRef=useRef({});const keyToUidRef=useRef({});// Temporary test GIF for government slots\nconst govGifRef=useRef(null);const govSpritesRef=useRef(null);// hit (target) spritesheet (25 frames)\nconst hitSpritesRef=useRef(null);// sprite animation state keyed by slot-key (player.lane.index)\nconst govSpriteStateRef=useRef({});const instantSpritesRef=useRef(null);const instantSpriteStateRef=useRef({});const hitSpriteStateRef=useRef({});// Corruption (Bestechungsskandal) target selection mode\nconst corruptionSelectActorRef=useRef(null);const gameStateRef=useRef(gameState);useEffect(()=>{gameStateRef.current=gameState;},[gameState]);useEffect(()=>{const onEnterCorruptionSelect=ev=>{try{var _ev$detail2;const actor=(_ev$detail2=ev.detail)===null||_ev$detail2===void 0?void 0:_ev$detail2.player;console.log('🔥 GAMECANVAS RECEIVED pc:corruption_select_target - Actor:',actor);corruptionSelectActorRef.current=actor!==null&&actor!==void 0?actor:null;console.log('🔥 SET corruptionSelectActorRef.current:',corruptionSelectActorRef.current);}catch(e){console.error('🔥 ERROR in corruption select handler:',e);}};window.addEventListener('pc:corruption_select_target',onEnterCorruptionSelect);// Keyboard hotkeys 1-5 to choose opponent government slot when corruption select is active\nconst onKeyDown=ev=>{try{var _gs$board,_gs$board$victim,_gs$board$victim$auss,_card$uid;const k=ev.key;if(!['1','2','3','4','5'].includes(k))return;const actor=corruptionSelectActorRef.current;if(!actor)return;const victim=actor===1?2:1;const idx=Number(k)-1;// map '1' -> slot 0\nconst gs=gameStateRef.current;const card=gs===null||gs===void 0?void 0:(_gs$board=gs.board)===null||_gs$board===void 0?void 0:(_gs$board$victim=_gs$board[victim])===null||_gs$board$victim===void 0?void 0:(_gs$board$victim$auss=_gs$board$victim.aussen)===null||_gs$board$victim$auss===void 0?void 0:_gs$board$victim$auss[idx];console.debug('[CORR][KEY] pressed',k,'actor',actor,'victim',victim,'idx',idx,'card',card);if(!card)return;const uid=(_card$uid=card.uid)!==null&&_card$uid!==void 0?_card$uid:card.id;if(!uid)return;console.debug('[CORR][KEY] dispatching pick_target for uid',uid);window.dispatchEvent(new CustomEvent('pc:corruption_pick_target',{detail:{player:actor,targetUid:uid}}));try{console.debug('[CORR][KEY] dispatching target_selected for uid',uid);window.dispatchEvent(new CustomEvent('pc:corruption_target_selected',{detail:{player:actor,targetUid:uid}}));}catch(e){console.debug('[CORR][KEY] target_selected dispatch error',e);}ev.preventDefault();}catch(e){}};window.addEventListener('keydown',onKeyDown);return()=>{window.removeEventListener('pc:corruption_select_target',onEnterCorruptionSelect);window.removeEventListener('keydown',onKeyDown);};},[]);// Maulwurf corruption target selection mode\nconst maulwurfSelectActorRef=useRef(null);useEffect(()=>{const onEnterMaulwurfSelect=ev=>{try{var _ev$detail3,_ev$detail4,_ev$detail5,_ev$detail6;const actor=(_ev$detail3=ev.detail)===null||_ev$detail3===void 0?void 0:_ev$detail3.player;const targetUid=(_ev$detail4=ev.detail)===null||_ev$detail4===void 0?void 0:_ev$detail4.targetUid;const requiredRoll=(_ev$detail5=ev.detail)===null||_ev$detail5===void 0?void 0:_ev$detail5.requiredRoll;const targetName=(_ev$detail6=ev.detail)===null||_ev$detail6===void 0?void 0:_ev$detail6.targetName;console.log('🔥 GAMECANVAS RECEIVED pc:maulwurf_select_target - Actor:',actor,'Target:',targetName,'Required:',requiredRoll);maulwurfSelectActorRef.current=actor!==null&&actor!==void 0?actor:null;// Show modal for dice roll\nconst el=document.createElement('div');el.id='pc-maulwurf-modal';el.style.cssText='position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:10000;';el.style.fontSize='14px';document.body.appendChild(el);el.innerHTML=\"<div style=\\\"display:flex;flex-direction:column;gap:8px;min-width:260px;\\\">\\n          <div style=\\\"font-weight:700\\\">Maulwurf \\u2014 Ziel automatisch gew\\xE4hlt</div>\\n          <div>Gew\\xE4hltes Ziel: <b>\".concat(targetName||'Unbekannt',\"</b></div>\\n          <div>Probe: W6 \\u2265 \").concat(requiredRoll||2,\" (2 + Anzahl Regierungskarten)</div>\\n          <div style=\\\"display:flex;gap:8px;justify-content:flex-end;\\\">\\n            <button id=\\\"pc-maulwurf-roll\\\" style=\\\"background:#2563eb;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\\\">W\\xFCrfeln</button>\\n            <button id=\\\"pc-maulwurf-cancel\\\" style=\\\"background:#374151;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\\\">Abbrechen</button>\\n          </div>\\n        </div>\");// Event listeners for buttons\nconst rollBtn=el.querySelector('#pc-maulwurf-roll');const cancelBtn=el.querySelector('#pc-maulwurf-cancel');if(rollBtn){rollBtn.addEventListener('click',()=>{try{window.dispatchEvent(new CustomEvent('pc:maulwurf_request_roll',{detail:{player:actor,targetUid}}));document.body.removeChild(el);}catch(e){console.error('Maulwurf roll button error:',e);}});}if(cancelBtn){cancelBtn.addEventListener('click',()=>{try{document.body.removeChild(el);// Clear pending selection\nif(typeof window!=='undefined'){window.dispatchEvent(new CustomEvent('pc:clear_pending_selection'));}}catch(e){console.error('Maulwurf cancel button error:',e);}});}}catch(e){console.error('🔥 ERROR in maulwurf select handler:',e);}};window.addEventListener('pc:maulwurf_select_target',onEnterMaulwurfSelect);return()=>{window.removeEventListener('pc:maulwurf_select_target',onEnterMaulwurfSelect);};},[]);// Tunnelvision probe mode\nconst tunnelvisionProbeActorRef=useRef(null);useEffect(()=>{const onEnterTunnelvisionProbe=ev=>{try{var _ev$detail7,_ev$detail8,_ev$detail9,_ev$detail0;const actor=(_ev$detail7=ev.detail)===null||_ev$detail7===void 0?void 0:_ev$detail7.player;const targetUid=(_ev$detail8=ev.detail)===null||_ev$detail8===void 0?void 0:_ev$detail8.targetUid;const requiredRoll=(_ev$detail9=ev.detail)===null||_ev$detail9===void 0?void 0:_ev$detail9.requiredRoll;const influence=(_ev$detail0=ev.detail)===null||_ev$detail0===void 0?void 0:_ev$detail0.influence;console.log('🔥 GAMECANVAS RECEIVED pc:tunnelvision_probe_start - Actor:',actor,'Target:',targetUid,'Required:',requiredRoll,'Influence:',influence);tunnelvisionProbeActorRef.current=actor!==null&&actor!==void 0?actor:null;console.log('🔥 SET tunnelvisionProbeActorRef.current:',tunnelvisionProbeActorRef.current);// Create modal for tunnelvision probe\nconst el=document.getElementById('pc-modal-root');if(!el)return;el.innerHTML=\"<div style=\\\"display:flex;flex-direction:column;gap:8px;min-width:280px;\\\">\\n          <div style=\\\"font-weight:700\\\">Tunnelvision \\u2014 Regierungskarte Probe</div>\\n          <div>Einfluss: <b>\".concat(influence||'Unbekannt',\"</b></div>\\n          <div>Probe: W6 \\u2265 \").concat(requiredRoll||4,\" \").concat((influence||0)>=9?'(Einfluss 9+)':'(Standard)',\"</div>\\n          <div style=\\\"font-size:12px;color:#666;\\\">Bei Misserfolg: 2-3 Karte bleibt in Hand, 1 kritischer Misserfolg entfernt Karte dauerhaft</div>\\n          <div style=\\\"display:flex;gap:8px;justify-content:flex-end;\\\">\\n            <button id=\\\"pc-tunnelvision-roll\\\" style=\\\"background:#2563eb;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\\\">W\\xFCrfeln</button>\\n            <button id=\\\"pc-tunnelvision-cancel\\\" style=\\\"background:#374151;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\\\">Abbrechen</button>\\n          </div>\\n        </div>\");// Add event listeners for buttons\nconst rollBtn=document.getElementById('pc-tunnelvision-roll');const cancelBtn=document.getElementById('pc-tunnelvision-cancel');if(rollBtn){rollBtn.onclick=()=>{try{window.dispatchEvent(new CustomEvent('pc:tunnelvision_request_roll',{detail:{player:actor,targetUid,requiredRoll,influence}}));el.innerHTML='';}catch(e){console.error('Error dispatching tunnelvision request roll:',e);}};}if(cancelBtn){cancelBtn.onclick=()=>{el.innerHTML='';// Cancel the probe - card stays in hand\ntry{window.dispatchEvent(new CustomEvent('pc:tunnelvision_request_roll',{detail:{player:actor,targetUid,requiredRoll,influence,cancel:true}}));}catch(e){console.error('Error canceling tunnelvision probe:',e);}};}}catch(e){console.error('🔥 ERROR in tunnelvision probe handler:',e);}};window.addEventListener('pc:tunnelvision_probe_start',onEnterTunnelvisionProbe);return()=>{window.removeEventListener('pc:tunnelvision_probe_start',onEnterTunnelvisionProbe);};},[]);// Helper: draw slot icons with uniform pulsing opacity and a light reflection\nconst drawSlotIconWithPulse=useCallback(function(ctx,img,x,y,w,h){let phase=arguments.length>6&&arguments[6]!==undefined?arguments[6]:0;if(!img||!img.complete)return;try{const now=performance.now();const base=0.10;// base opacity\nconst pulseRange=0.08;// pulse amplitude (-> up to base + pulseRange)\nconst period=700;// ms\nconst pulse=base+pulseRange*(0.5+0.5*Math.sin(now/period+phase));// draw icon with pulsing alpha\nctx.save();ctx.globalAlpha=pulse;ctx.drawImage(img,x,y,w,h);// subtle reflection: gradient overlay on top half\nconst grad=ctx.createLinearGradient(x,y,x,y+h*0.5);grad.addColorStop(0,\"rgba(255,255,255,\".concat(0.18*pulse,\")\"));grad.addColorStop(1,\"rgba(255,255,255,0)\");ctx.globalCompositeOperation='lighter';ctx.fillStyle=grad;ctx.fillRect(x,y,w,h*0.5);ctx.restore();}catch(e){// silent fallback\n}},[]);// Load influence icon once\nuseEffect(()=>{const img=new Image();img.src=influenceIconUrl;influenceImgRef.current=img;},[]);const drawCardAt=useCallback(function(ctx,card,x,y,size){var _shield;let selected=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;let showAPCost=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;let player=arguments.length>7?arguments[7]:undefined;// Apply per-card fade-in if a play animation is active for this uid\nlet extraAlpha=1;try{var _uid;const uid=(_uid=card.uid)!==null&&_uid!==void 0?_uid:card.id;const list=visualEffects&&visualEffects.playAnimsRef&&visualEffects.playAnimsRef.current||window.__pc_play_anims||[];const anim=list.find(a=>a.uid===uid);if(anim){const p=Math.min(1,Math.max(0,(performance.now()-anim.started)/anim.duration));// ease-out\nextraAlpha=Math.pow(p,2);}}catch(e){}let dx=x,dy=y,s=size;if(selected){s=Math.floor(size*1.05);dx=x-Math.floor((s-size)/2);dy=y-Math.floor((s-size)/2);}// Note: pulse overlay is drawn at top layer after all cards are rendered\n// Draw card image with caching to prevent flicker in continuous loop\nconst src=getCardImagePath(card,'ui');const cached=imageCacheRef.current.get(src);ctx.save();ctx.globalAlpha=extraAlpha;if(cached&&cached.complete&&cached.naturalWidth>0){ctx.drawImage(cached,dx,dy,s,s);}else{const img=new Image();img.onload=()=>{imageCacheRef.current.set(src,img);// Note: onload happens async; draw will occur on next frame\n// don't draw here into stale ctx\n};img.src=src;imageCacheRef.current.set(src,img);}ctx.restore();// Status-Indikatoren (für alle Board-Karten)\n// Einfluss-Wert dauerhaft anzeigen (oben links) – nur für Regierungskarten\nif(card.kind==='pol'){var _influence;const barH=Math.max(20,Math.floor(s*0.12)+6);ctx.fillStyle='rgba(0,0,0,0.6)';ctx.fillRect(dx,dy+s-barH,s,barH);ctx.fillStyle='#ffffff';const fontSize=Math.floor(s*0.12);ctx.font=\"bold \".concat(fontSize,\"px sans-serif\");ctx.textAlign='left';ctx.textBaseline='middle';ctx.fillText(\"\".concat((_influence=card.influence)!==null&&_influence!==void 0?_influence:0),dx+8,dy+s-barH/2);}// Schutz-Status (blauer Punkt)\nif(card.protected||((_shield=card.shield)!==null&&_shield!==void 0?_shield:0)>0){ctx.fillStyle='#1da1f2';ctx.fillRect(dx+s-22,dy+6,16,16);}// Deaktiviert-Status (roter Punkt)\nif(card.deactivated){ctx.fillStyle='#b63838';ctx.fillRect(dx+s-22,dy+26,16,16);}// Einfluss-Badge für Handkarten oben rechts (nur Regierungskarten)\nif(showAPCost&&player&&card.kind==='pol'){var _influence2;const badgeHeight=Math.max(16,Math.floor(s*0.12));const badgeWidth=badgeHeight*2;const badgeX=dx+s-badgeWidth-6;const badgeY=dy+6;// Semi-transparent dunkler Hintergrund\nctx.fillStyle='rgba(0,0,0,0.6)';ctx.beginPath();ctx.roundRect(badgeX,badgeY,badgeWidth,badgeHeight,badgeHeight/2);ctx.fill();// Influence icon (90% opacity) links im Badge\nif(influenceImgRef.current&&influenceImgRef.current.complete){ctx.globalAlpha=0.9;ctx.drawImage(influenceImgRef.current,badgeX+2,badgeY+2,badgeHeight-4,badgeHeight-4);ctx.globalAlpha=1;}// Influence number rechts im Badge\nctx.fillStyle='#ffffff';ctx.font=\"bold \".concat(Math.floor(badgeHeight*0.5),\"px sans-serif\");ctx.textAlign='right';ctx.textBaseline='middle';ctx.fillText(\"\".concat((_influence2=card.influence)!==null&&_influence2!==void 0?_influence2:0),badgeX+badgeWidth-4,badgeY+badgeHeight/2);// Reset align\nctx.textAlign='start';ctx.textBaseline='alphabetic';}// NOTE: influence overlays (pulse + labels) are drawn in a separate pass\n// Auswahl-Rahmen\nif(selected){ctx.strokeStyle='#61dafb';ctx.lineWidth=3;ctx.strokeRect(dx+1,dy+1,s-2,s-2);ctx.lineWidth=1;}// Return exact 256x256 click zone over the card\n// Since all cards are 256x256, the click zone should match exactly\nreturn{x:dx,y:dy,w:256,h:256};},[gameState]);// Slot-Benennungs-Funktion basierend auf Glossar\nconst getSlotDisplayName=useCallback((zoneId,index,player)=>{const slotNumber=index+1;if(zoneId.includes('government')){if(zoneId.includes('player')){return\"Regierungsreihe Slot \".concat(slotNumber);}else{return\"Gegner Regierung Slot \".concat(slotNumber);}}else if(zoneId.includes('public')){if(zoneId.includes('player')){return\"\\xD6ffentlichkeitsreihe Slot \".concat(slotNumber);}else{return\"Gegner \\xD6ffentlichkeit Slot \".concat(slotNumber);}}else if(zoneId.includes('permanent.government')){if(zoneId.includes('player')){return'Regierung Spezial-Slot';}else{return'Gegner Regierung Spezial-Slot';}}else if(zoneId.includes('permanent.public')){if(zoneId.includes('player')){return'Öffentlichkeit Spezial-Slot';}else{return'Gegner Öffentlichkeit Spezial-Slot';}}else if(zoneId.includes('instant')){if(zoneId.includes('player')){return'Sofort-Slot';}else{return'Gegner Sofort-Slot';}}else if(zoneId.includes('hand')){return'Hand';}else if(zoneId.includes('interventions')){return'Interventionen';}return\"Slot \".concat(slotNumber);},[]);const drawLane=useCallback((ctx,zoneId,player,lane,clickable)=>{const zone=getZone(zoneId);if(!zone)return;const slots=computeSlotRects(zone);const arr=gameState.board[player][lane];slots.forEach((s,idx)=>{const card=arr[idx];// Hintergrundfarbe nach Kategorie\nlet bgColor='rgba(0,0,0,0.1)';// Standard\nif(zoneId.includes('government')){bgColor='rgba(255, 197, 0, 0.15)';// Hellgelb für Regierung\n}else if(zoneId.includes('public')){bgColor='rgba(0, 255, 0, 0.15)';// Hellgrün für Öffentlichkeit\n}ctx.fillStyle=bgColor;ctx.fillRect(s.x,s.y,s.w,s.h);// Slot-Rahmen\nctx.strokeStyle='rgba(255,255,255,0.06)';ctx.strokeRect(s.x+0.5,s.y+0.5,s.w-1,s.h-1);if(card){const isSelected=player===1&&selectedHandIndex!==null&&gameState.hands[1][selectedHandIndex]===card;const clickZone=drawCardAt(ctx,card,s.x,s.y,s.w,isSelected,false);// Kartenname unter dem Slot anzeigen\nctx.fillStyle='rgba(255,255,255,0.9)';ctx.font='bold 12px sans-serif';ctx.textAlign='center';const textY=s.y+s.h+16;ctx.fillText(card.name,s.x+s.w/2,textY);clickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'board_card',player,lane,index:idx,card}}));}else if(clickable&&gameState.current===player){// Slot-Benennung anzeigen (für den aktuellen Spieler)\nconst slotName=getSlotDisplayName(zoneId,idx,player);ctx.fillStyle='rgba(255,255,255,0.6)';ctx.font='11px sans-serif';ctx.textAlign='center';const textY=s.y+s.h/2;ctx.fillText(slotName,s.x+s.w/2,textY);clickZonesRef.current.push({x:s.x,y:s.y,w:s.w,h:s.h,data:{type:'row_slot',lane,index:idx}});}});},[gameState,selectedHandIndex,drawCardAt,getSlotDisplayName]);const drawHandP1=useCallback(ctx=>{const hand=sortHandCards(gameState.hands[1]);const zone=getZone('hand.player');if(!zone)return;const slots=computeSlotRects(zone);// Apply smooth offset (lerp towards target)\nconst target=handScrollTargetRef.current;handScrollCurrentRef.current+=(target-handScrollCurrentRef.current)*0.15;// easing\nconst offsetY=Math.round(handScrollCurrentRef.current);slots.forEach((s,i)=>{const card=hand[i];if(!card)return;// Find original index in unsorted hand for click handling\nconst originalIndex=gameState.hands[1].findIndex(c=>c.uid===card.uid);const isSel=selectedHandIndex===originalIndex;// apply vertical offset\nconst sx=s.x;const sy=s.y+offsetY;const clickZone=drawCardAt(ctx,card,sx,sy,s.w,isSel,true,1);// Show AP cost for player 1 hand\nclickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'hand_p1',index:originalIndex,card}}));});},[gameState.hands,selectedHandIndex,drawCardAt]);// 🔧 DEV MODE: Player 2 Hand (rechts unten, kompakter)\nconst drawHandP2=useCallback(ctx=>{const hand=sortHandCards(gameState.hands[2]);const zone=getZone('hand.opponent');if(!zone)return;const slots=computeSlotRects(zone);// Hintergrund für P2 Hand\nconst[x,y,w,h]=zone.rectPx;ctx.fillStyle='rgba(255, 100, 100, 0.15)';// Rötlicher Hintergrund für P2\nctx.fillRect(x,y,w,h);ctx.strokeStyle='rgba(255, 100, 100, 0.3)';ctx.strokeRect(x+0.5,y+0.5,w-1,h-1);// Label für P2 Hand\nctx.fillStyle='rgba(255, 255, 255, 0.9)';ctx.font='bold 14px sans-serif';ctx.textAlign='center';ctx.fillText('Player 2 Hand',x+w/2,y-8);slots.forEach((s,i)=>{const card=hand[i];if(!card)return;// Find original index in unsorted hand for click handling\nconst originalIndex=gameState.hands[2].findIndex(c=>c.uid===card.uid);const isSel=gameState.current===2&&selectedHandIndex===originalIndex;const clickZone=drawCardAt(ctx,card,s.x,s.y,s.w,isSel,true,2);// Show AP cost for player 2 hand\nclickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'hand_p2',index:originalIndex,card}}));});},[gameState,selectedHandIndex,drawCardAt]);// Interventions strip (player traps)\nconst drawInterventionsP1=useCallback(ctx=>{const traps=gameState.traps[1]||[];const zone=getZone('interventions.player');if(!zone)return;// Single intervention slot\nconst[zx,zy,zw,zh]=zone.rectPx;const card=traps[0];// Only first trap\n// Hintergrund für Interventions-Slot\nctx.fillStyle='rgba(200, 160, 255, 0.15)';// Lavendelfarben für Interventionen\nctx.fillRect(zx,zy,zw,zh);ctx.strokeStyle='rgba(200, 160, 255, 0.3)';ctx.strokeRect(zx+0.5,zy+0.5,zw-1,zh-1);// Slot-Benennung für Interventions-Slot\nctx.fillStyle='rgba(200, 160, 255, 0.8)';ctx.font='11px sans-serif';ctx.textAlign='left';ctx.fillText('Intervention',zx+8,zy+zh-6);if(card){const clickZone=drawCardAt(ctx,card,zx,zy,zw,false,false);clickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'trap_p1',index:0,card}}));}},[gameState.traps,drawCardAt]);// Interventions strip (opponent traps)\nconst drawInterventionsP2=useCallback(ctx=>{const traps=gameState.traps[2]||[];const zone=getZone('interventions.opponent');if(!zone)return;// Single intervention slot\nconst[zx,zy,zw,zh]=zone.rectPx;const card=traps[0];// Only first trap\n// Hintergrund für Interventions-Slot\nctx.fillStyle='rgba(200, 160, 255, 0.15)';// Lavendelfarben für Interventionen\nctx.fillRect(zx,zy,zw,zh);ctx.strokeStyle='rgba(200, 160, 255, 0.3)';ctx.strokeRect(zx+0.5,zy+0.5,zw-1,zh-1);// Slot-Benennung für Interventions-Slot\nctx.fillStyle='rgba(200, 160, 255, 0.8)';ctx.font='11px sans-serif';ctx.textAlign='left';ctx.fillText('Intervention',zx+8,zy+zh-6);if(card){const clickZone=drawCardAt(ctx,card,zx,zy,zw,false,false);clickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'trap_p2',index:0,card}}));}},[gameState.traps,drawCardAt]);// Single slot drawing function\nconst drawSingleSlot=useCallback((ctx,zoneId,card,clickType,player)=>{const zone=getZone(zoneId);if(!zone)return;const[x,y,w,h]=zone.rectPx;// Hintergrundfarbe nach Kategorie\nlet bgColor='rgba(0,0,0,0.1)';// Standard\nif(zoneId.includes('government')){bgColor='rgba(255, 197, 0, 0.15)';// Hellgelb für Regierung\n}else if(zoneId.includes('public')){bgColor='rgba(0, 255, 0, 0.15)';// Hellgrün für Öffentlichkeit\n}else if(zoneId.includes('instant')){bgColor='rgba(127, 116, 91, 0.15)';// Neutral für Sofort-Slots\n}else if(zoneId.includes('permanent')){// Unterscheide zwischen government und public permanent slots\nif(zoneId.includes('government')){bgColor='rgba(255, 197, 0, 0.15)';}else if(zoneId.includes('public')){bgColor='rgba(0, 255, 0, 0.15)';}}ctx.fillStyle=bgColor;ctx.fillRect(x,y,w,h);// Draw slot border\nctx.strokeStyle='rgba(255,255,255,0.06)';ctx.strokeRect(x+0.5,y+0.5,w-1,h-1);if(card){const isSelected=player===1&&selectedHandIndex!==null&&gameState.hands[1][selectedHandIndex]===card;const clickZone=drawCardAt(ctx,card,x,y,w,isSelected,false);// Kartenname unter dem Slot anzeigen\nctx.fillStyle='rgba(255,255,255,0.9)';ctx.font='bold 12px sans-serif';ctx.textAlign='center';const textY=y+h+16;ctx.fillText(card.name,x+w/2,textY);// Register click zone for the card - always in dev mode, otherwise only for current player\nif(devMode||player===gameState.current){clickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'slot_card',slot:clickType,player,card}}));}// 🔧 NEU: Sofort-Initiative-Slots sind immer klickbar für Aktivierung (handled by activateInstantInitiative)\nif(clickType==='instant'){clickZonesRef.current.push({x,y,w,h,data:{type:'activate_instant',player,card}});}}else if(gameState.current===player||devMode){// Slot-Benennung für leere Slots anzeigen (für den aktuellen Spieler oder im Dev Mode)\nconst slotName=getSlotDisplayName(zoneId,0,player);ctx.fillStyle='rgba(255,255,255,0.6)';ctx.font='11px sans-serif';ctx.textAlign='center';const textY=y+h/2;ctx.fillText(slotName,x+w/2,textY);clickZonesRef.current.push({x,y,w,h,data:{type:'empty_slot',slot:clickType,player}});}},[selectedHandIndex,gameState,drawCardAt,getSlotDisplayName,devMode]);// Small UI hook: show a lightweight corruption modal overlay when a target is selected\nuseEffect(()=>{const onTargetSelected=ev=>{const{player,targetUid}=ev.detail||{};if(!player||!targetUid)return;// create transient overlay element if not present\ntry{var _board,_board2,_board2$aussen,_board3,_board4,_board4$aussen;const id='pc-corruption-modal';let el=document.getElementById(id);if(!el){el=document.createElement('div');el.id=id;el.style.position='fixed';el.style.left='50%';el.style.top='40%';el.style.transform='translate(-50%, -50%)';el.style.padding='12px 16px';el.style.background='rgba(6,10,15,0.9)';el.style.border='1px solid rgba(255,255,255,0.12)';el.style.borderRadius='8px';el.style.zIndex='3000';el.style.color='#e5e7eb';el.style.fontFamily='monospace';el.style.fontSize='14px';document.body.appendChild(el);}const card=((_board=gameState.board)===null||_board===void 0?void 0:(_board2=_board[player===1?1:2])===null||_board2===void 0?void 0:(_board2$aussen=_board2.aussen)===null||_board2$aussen===void 0?void 0:_board2$aussen.find(c=>c.uid===targetUid))||((_board3=gameState.board)===null||_board3===void 0?void 0:(_board4=_board3[player===1?2:1])===null||_board4===void 0?void 0:(_board4$aussen=_board4.aussen)===null||_board4$aussen===void 0?void 0:_board4$aussen.find(c=>c.uid===targetUid));el.innerHTML=\"<div style=\\\"display:flex;flex-direction:column;gap:8px;min-width:260px;\\\">\\n          <div style=\\\"font-weight:700\\\">Bestechungsskandal 2.0 \\u2014 Ziel gew\\xE4hlt</div>\\n          <div>Gew\\xE4hltes Ziel: <b>\".concat(card?card.name:'UID '+targetUid,\"</b></div>\\n          <div>Probe: W6 \\u2265 Einfluss (inkl. Oligarch-Bonus)</div>\\n          <div style=\\\"display:flex;gap:8px;justify-content:flex-end;\\\">\\n            <button id=\\\"pc-corruption-roll\\\" style=\\\"background:#2563eb;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\\\">W\\xFCrfeln</button>\\n            <button id=\\\"pc-corruption-cancel\\\" style=\\\"background:#374151;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\\\">Abbrechen</button>\\n          </div>\\n        </div>\");const rollBtn=document.getElementById('pc-corruption-roll');const cancelBtn=document.getElementById('pc-corruption-cancel');if(rollBtn){rollBtn.onclick=()=>{try{console.log('🔥 CORRUPTION WÜRFELN CLICKED - triggering dice roll');// Trigger the dice component to roll\nwindow.dispatchEvent(new CustomEvent('pc:ui_request_dice_roll',{detail:{player,targetUid}}));window.dispatchEvent(new CustomEvent('pc:corruption_request_roll',{detail:{player,targetUid}}));}catch(e){console.error('🔥 ERROR triggering dice roll:',e);}// disable until result\nrollBtn.disabled=true;rollBtn.innerText='Würfelt...';};}if(cancelBtn){cancelBtn.onclick=()=>{el.remove();};}}catch(e){console.debug('corruption modal create failed',e);}};window.addEventListener('pc:corruption_target_selected',onTargetSelected);return()=>window.removeEventListener('pc:corruption_target_selected',onTargetSelected);},[gameState]);// Draw permanent slots for player\nconst drawPermanentSlotsP1=useCallback(ctx=>{drawSingleSlot(ctx,'slot.permanent.government.player',gameState.permanentSlots[1].government,'permanent_government',1);drawSingleSlot(ctx,'slot.permanent.public.player',gameState.permanentSlots[1].public,'permanent_public',1);},[gameState.permanentSlots,drawSingleSlot]);// Draw permanent slots for opponent\nconst drawPermanentSlotsP2=useCallback(ctx=>{drawSingleSlot(ctx,'slot.permanent.government.opponent',gameState.permanentSlots[2].government,'permanent_government',2);drawSingleSlot(ctx,'slot.permanent.public.opponent',gameState.permanentSlots[2].public,'permanent_public',2);},[gameState.permanentSlots,drawSingleSlot]);// Draw instant slots\nconst drawInstantSlots=useCallback(ctx=>{// Sofort-Initiative-Slots aus dem Board zeichnen\nconst sofortPlayerCard=gameState.board[1].sofort[0];const sofortOppCard=gameState.board[2].sofort[0];drawSingleSlot(ctx,'slot.instant.player',sofortPlayerCard,'instant',1);drawSingleSlot(ctx,'slot.instant.opponent',sofortOppCard,'instant',2);},[gameState.board,drawSingleSlot]);// Aktive Schlüsselwörter und Unterkategorien ermitteln\nconst getActiveKeywordsAndSubcategories=useCallback(player=>{const board=gameState.board[player];const permanentSlots=gameState.permanentSlots[player];const allCards=[...board.innen,...board.aussen,permanentSlots.government,permanentSlots.public].filter(c=>c&&c.kind==='pol');const keywords=new Set();const subcategories=new Set();allCards.forEach(card=>{if(!card.deactivated){// Regierungskarten-Schlüsselwörter\nif(card.tag==='Leadership'){keywords.add('Leadership');}if(card.tag==='Diplomat'){keywords.add('Diplomat');}// Öffentlichkeits-Unterkategorien (für Karten in Öffentlichkeitsreihe)\nif(board.innen.includes(card)){const publicCard=card;if(publicCard.tag){// Oligarch\nconst oligarchNames=['Elon Musk','Bill Gates','George Soros','Warren Buffett','Mukesh Ambani','Jeff Bezos','Alisher Usmanov','Gautam Adani','Jack Ma','Zhang Yiming','Roman Abramovich'];if(oligarchNames.includes(publicCard.name)){subcategories.add('Oligarch');}// Plattform\nconst platformNames=['Mark Zuckerberg','Tim Cook','Sam Altman','Jack Ma'];if(platformNames.includes(publicCard.name)){subcategories.add('Plattform');}// Bewegung\nconst movementNames=['Greta Thunberg','Malala Yousafzai','Ai Weiwei','Alexei Navalny'];if(movementNames.includes(publicCard.name)){subcategories.add('Bewegung');}// NGO/Think-Tank\nconst ngoNames=['Bill Gates','George Soros','Jennifer Doudna','Noam Chomsky','Anthony Fauci'];if(ngoNames.includes(publicCard.name)){subcategories.add('NGO/Think-Tank');}// Intelligenz\nconst intelligenceNames=['Jennifer Doudna','Noam Chomsky','Edward Snowden','Julian Assange','Yuval Noah Harari','Ai Weiwei','Alexei Navalny','Anthony Fauci'];if(intelligenceNames.includes(publicCard.name)){subcategories.add('Intelligenz');}// Medien\nconst mediaNames=['Oprah Winfrey'];if(mediaNames.includes(publicCard.name)){subcategories.add('Medien');}}}}});return{keywords:Array.from(keywords),subcategories:Array.from(subcategories)};},[gameState]);// Info-Panels zeichnen\nconst drawInfoPanels=useCallback(ctx=>{const{keywords,subcategories}=getActiveKeywordsAndSubcategories(1);// Panel für Regierungsschlüsselwörter (rechts neben Regierungsslots)\nconst govPanelX=1640+256+20;// Nach dem letzten permanenten Slot\nconst govPanelY=300;// Auf Höhe der Regierungsslots\nconst govPanelW=120;const govPanelH=256;// Regierungspanel Hintergrund\nctx.fillStyle='rgba(255, 197, 0, 0.15)';ctx.fillRect(govPanelX,govPanelY,govPanelW,govPanelH);ctx.strokeStyle='rgba(255, 197, 0, 0.3)';ctx.strokeRect(govPanelX+0.5,govPanelY+0.5,govPanelW-1,govPanelH-1);// Regierungspanel Titel\nctx.fillStyle='rgba(255, 197, 0, 0.9)';ctx.font='bold 12px sans-serif';ctx.textAlign='center';ctx.fillText('Regierung',govPanelX+govPanelW/2,govPanelY+16);// Schlüsselwörter auflisten\nctx.fillStyle='rgba(255, 255, 255, 0.9)';ctx.font='11px sans-serif';ctx.textAlign='left';if(keywords.length>0){keywords.forEach((keyword,idx)=>{ctx.fillText(\"\\u2022 \".concat(keyword),govPanelX+8,govPanelY+36+idx*16);});}else{ctx.fillStyle='rgba(255, 255, 255, 0.5)';ctx.fillText('Keine aktiven',govPanelX+8,govPanelY+36);ctx.fillText('Schlüsselwörter',govPanelX+8,govPanelY+52);}// Panel für Öffentlichkeits-Unterkategorien (rechts neben Öffentlichkeitsslots)\nconst pubPanelX=1640+256+20;const pubPanelY=580;// Auf Höhe der Öffentlichkeitsslots\nconst pubPanelW=120;const pubPanelH=256;// Öffentlichkeitspanel Hintergrund\nctx.fillStyle='rgba(0, 255, 0, 0.15)';ctx.fillRect(pubPanelX,pubPanelY,pubPanelW,pubPanelH);ctx.strokeStyle='rgba(0, 255, 0, 0.3)';ctx.strokeRect(pubPanelX+0.5,pubPanelY+0.5,pubPanelW-1,pubPanelH-1);// Öffentlichkeitspanel Titel\nctx.fillStyle='rgba(0, 255, 0, 0.9)';ctx.font='bold 12px sans-serif';ctx.textAlign='center';ctx.fillText('Öffentlichkeit',pubPanelX+pubPanelW/2,pubPanelY+16);// Unterkategorien auflisten\nctx.fillStyle='rgba(255, 255, 255, 0.9)';ctx.font='11px sans-serif';ctx.textAlign='left';if(subcategories.length>0){subcategories.forEach((subcategory,idx)=>{const displayName=subcategory.length>12?subcategory.substring(0,10)+'...':subcategory;ctx.fillText(\"\\u2022 \".concat(displayName),pubPanelX+8,pubPanelY+36+idx*16);});}else{ctx.fillStyle='rgba(255, 255, 255, 0.5)';ctx.fillText('Keine aktiven',pubPanelX+8,pubPanelY+36);ctx.fillText('Unterkategorien',pubPanelX+8,pubPanelY+52);}},[getActiveKeywordsAndSubcategories]);// Move diagnostics to draw callback to ensure they run after canvas is actually rendered\nconst runDiagnostics=useCallback(()=>{try{const handZones=clickZonesRef.current.filter(z=>z.data&&z.data.type==='hand_p1');const uiUIDs=handZones.map(z=>{var _z$data$card$uid;return z.data.card&&((_z$data$card$uid=z.data.card.uid)!==null&&_z$data$card$uid!==void 0?_z$data$card$uid:z.data.card.id);}).filter(Boolean);const stateHand=gameState.hands&&gameState.hands[1]?gameState.hands[1]:[];const stateUIDs=stateHand.map(c=>{var _c$uid;return(_c$uid=c.uid)!==null&&_c$uid!==void 0?_c$uid:c.id;}).filter(Boolean);const missingInState=uiUIDs.filter(u=>!stateUIDs.includes(u));const missingInUI=stateUIDs.filter(u=>!uiUIDs.includes(u));// Only warn if there are cards in UI that don't exist in state (real error)\n// Don't warn about missing UI cards due to limited slot capacity\nif(missingInState.length>0){var _politicardDebug;const mismatch={ts:Date.now(),uiCount:uiUIDs.length,stateCount:stateUIDs.length,uiUIDs,stateUIDs,missingInState,missingInUI,stack:new Error('mismatch-stack').stack};window.__politicardDebug=_objectSpread(_objectSpread({},window.__politicardDebug),{},{mismatch:[...(((_politicardDebug=window.__politicardDebug)===null||_politicardDebug===void 0?void 0:_politicardDebug.mismatch)||[])].slice(-19).concat([mismatch])});// Clear, then log to console so user can copy/paste trace\nconsole.warn('POLITICARD DIAGNOSTIC: hand mismatch detected',mismatch);}}catch(e){// swallow diagnostic errors to avoid breaking rendering\nconsole.error('Diagnostic error',e);}},[gameState.hands]);const draw=useCallback(()=>{var _LAYOUT$background,_LAYOUT$background2;const canvas=canvasRef.current;if(!canvas)return;const ctx=canvas.getContext('2d');if(!ctx)return;// Detect influence increases and start animations\ntry{const currSnapshot={};const collect=c=>{var _c$uid2,_c$influence;if(!c)return;if(c.kind!=='pol')return;const uid=(_c$uid2=c.uid)!==null&&_c$uid2!==void 0?_c$uid2:c.id!=null?String(c.id):null;if(!uid)return;currSnapshot[uid]=(_c$influence=c.influence)!==null&&_c$influence!==void 0?_c$influence:0;};// board rows\n(gameState.board[1].aussen||[]).forEach(collect);(gameState.board[2].aussen||[]).forEach(collect);(gameState.board[1].innen||[]).forEach(collect);(gameState.board[2].innen||[]).forEach(collect);// permanent slots\ncollect(gameState.permanentSlots[1].government);collect(gameState.permanentSlots[2].government);collect(gameState.permanentSlots[1].public);collect(gameState.permanentSlots[2].public);const now=performance.now();Object.keys(currSnapshot).forEach(uid=>{var _currSnapshot$uid,_prevInfluencesRef$cu;const curr=(_currSnapshot$uid=currSnapshot[uid])!==null&&_currSnapshot$uid!==void 0?_currSnapshot$uid:0;const prev=(_prevInfluencesRef$cu=prevInfluencesRef.current[uid])!==null&&_prevInfluencesRef$cu!==void 0?_prevInfluencesRef$cu:curr;if(curr>prev){const delta=curr-prev;const list=influenceAnimRef.current.get(uid)||[];list.push({start:now,duration:900,amount:delta});influenceAnimRef.current.set(uid,list);}prevInfluencesRef.current[uid]=curr;});}catch(e){// ignore\n}// Clear canvas\nctx.clearRect(0,0,canvas.width,canvas.height);// Clear click zones\nclickZonesRef.current=[];// Background: prefer PNG if configured\nif((_LAYOUT$background=LAYOUT.background)!==null&&_LAYOUT$background!==void 0&&_LAYOUT$background.enabled&&(_LAYOUT$background2=LAYOUT.background)!==null&&_LAYOUT$background2!==void 0&&_LAYOUT$background2.src){if(backgroundImageRef.current){ctx.drawImage(backgroundImageRef.current,0,0,canvas.width,canvas.height);}else{ctx.fillStyle='#0c131b';ctx.fillRect(0,0,canvas.width,canvas.height);}}else{ctx.fillStyle='#0c131b';ctx.fillRect(0,0,canvas.width,canvas.height);}// Apply UI transform (new signature)\nconst{scale,offsetX,offsetY}=getUiTransform(canvas.width,canvas.height);ctx.save();ctx.translate(offsetX,offsetY);ctx.scale(scale,scale);// Draw opponent board (top rows) - clickable im Dev Mode\n// Draw opponent board using new layout system\nconst opponentPublicRects=getPublicRects('opponent');const opponentGovRects=getGovernmentRects('opponent');// Draw opponent public slots\nopponentPublicRects.forEach((s,idx)=>{const card=gameState.board[2].innen[idx];if(card){const clickZone=drawCardAt(ctx,card,s.x,s.y,s.w,false,false,2);// Register hover/click zone for opponent card (always) - include card for hover info\nclickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'board_card',player:2,lane:'innen',index:idx,card}}));}else{// draw placeholder symbol for empty public slot\nconst img=slotSymbolImgsRef.current.get('public');drawSlotIconWithPulse(ctx,img,s.x,s.y,s.w,s.h,0.4);// Register empty slot click zone in dev mode\nif(devMode){clickZonesRef.current.push({x:s.x,y:s.y,w:s.w,h:s.h,data:{type:'row_slot',player:2,lane:'innen',index:idx}});}}});// Draw opponent government slots\nopponentGovRects.forEach((s,idx)=>{const card=gameState.board[2].aussen[idx];const corrActive=!!(gameState.pendingAbilitySelect&&gameState.pendingAbilitySelect.type==='corruption_steal');if(card){const clickZone=drawCardAt(ctx,card,s.x,s.y,s.w,false,false,2);// Register hover/click zone for opponent card (always) - include card for hover info\nclickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'board_card',player:2,lane:'aussen',index:idx,card}}));// When corruption target selection is active, register exact slot rectangle for click detection\nif(corrActive){clickZonesRef.current.push({x:s.x,y:s.y,w:s.w,h:s.h,data:{type:'board_card',player:2,lane:'aussen',index:idx,card}});}}else{const img=slotSymbolImgsRef.current.get('government');drawSlotIconWithPulse(ctx,img,s.x,s.y,s.w,s.h,0.1);// Register empty slot click zone only in dev mode\nif(devMode){clickZonesRef.current.push({x:s.x,y:s.y,w:s.w,h:s.h,data:{type:'row_slot',player:2,lane:'aussen',index:idx}});}}});// Draw opponent permanent slots (show icons even when not current)\ntry{const permGovZoneOpp=getZone('slot.permanent.government.opponent');if(permGovZoneOpp){const card=gameState.permanentSlots[2].government;const[ox,oy,ow,oh]=permGovZoneOpp.rectPx;if(card){drawSingleSlot(ctx,'slot.permanent.government.opponent',card,'permanent_government',2);}else{const img=slotSymbolImgsRef.current.get('dauerhaft');drawSlotIconWithPulse(ctx,img,ox,oy,ow,oh,0.3);// Register empty slot click zone in dev mode\nif(devMode){clickZonesRef.current.push({x:ox,y:oy,w:ow,h:oh,data:{type:'empty_slot',slot:'permanent_government',player:2}});}}}}catch(e){}try{const permPubZoneOpp=getZone('slot.permanent.public.opponent');if(permPubZoneOpp){const card=gameState.permanentSlots[2].public;const[ox2,oy2,ow2,oh2]=permPubZoneOpp.rectPx;if(card){drawSingleSlot(ctx,'slot.permanent.public.opponent',card,'permanent_public',2);}else{const img=slotSymbolImgsRef.current.get('dauerhaft');drawSlotIconWithPulse(ctx,img,ox2,oy2,ow2,oh2,0.7);// Register empty slot click zone in dev mode\nif(devMode){clickZonesRef.current.push({x:ox2,y:oy2,w:ow2,h:oh2,data:{type:'empty_slot',slot:'permanent_public',player:2}});}}}}catch(e){}// Draw player board (middle rows)\n// Draw player board using new layout system\nconst playerPublicRects=getPublicRects('player');const playerGovRects=getGovernmentRects('player');// Draw player public slots\nplayerPublicRects.forEach((s,idx)=>{const card=gameState.board[1].innen[idx];if(card){const clickZone=drawCardAt(ctx,card,s.x,s.y,s.w,false,false,1);// register card zone including card so hover panel can show details\nclickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'board_card',player:1,lane:'innen',index:idx,card}}));}else{// Empty slot click zone and draw public symbol\n// Draw unified pulsing icon for empty public slot\nconst img=slotSymbolImgsRef.current.get('public');drawSlotIconWithPulse(ctx,img,s.x,s.y,s.w,s.h,0.4);clickZonesRef.current.push({x:s.x,y:s.y,w:s.w,h:s.h,data:{type:'row_slot',player:1,lane:'innen',index:idx}});}});// Draw player government slots\nplayerGovRects.forEach((s,idx)=>{const card=gameState.board[1].aussen[idx];if(card){const clickZone=drawCardAt(ctx,card,s.x,s.y,s.w,false,false,1);clickZonesRef.current.push(_objectSpread(_objectSpread({},clickZone),{},{data:{type:'board_card',player:1,lane:'aussen',index:idx,card}}));}else{// Empty slot click zone and draw government symbol\nconst img=slotSymbolImgsRef.current.get('government');drawSlotIconWithPulse(ctx,img,s.x,s.y,s.w,s.h,0.1);clickZonesRef.current.push({x:s.x,y:s.y,w:s.w,h:s.h,data:{type:'row_slot',player:1,lane:'aussen',index:idx}});}});// --- GOV PLACEMENT SPRITESHEET OVERLAY (frame-based) ---\ntry{const sprites=govSpritesRef.current;const gif=govGifRef.current;const anims=visualEffects&&visualEffects.playAnimsRef&&visualEffects.playAnimsRef.current||[];// Start sprite animation when a playAnim for a gov-card is active and maps to a slot\nconst now=performance.now();// Prefer mutating the source anim array so entries are consumed and don't retrigger repeatedly\nconst animsArr=visualEffects&&visualEffects.playAnimsRef&&visualEffects.playAnimsRef.current||(window.__pc_play_anims=window.__pc_play_anims||[]);// Iterate backwards and consume processed animations to ensure one-shot playback\nfor(let i=animsArr.length-1;i>=0;i--){var _zone$data$player,_zone$data$lane,_zone$data$index;const a=animsArr[i];try{// handle specialized 'hit:' playAnims which indicate target-hit sprites by slot key\nif(typeof a.uid==='string'&&a.uid.indexOf('hit:')===0){const inner=a.uid.slice(4);// '1.aussen.0'\nif(!hitSpriteStateRef.current[inner]){hitSpriteStateRef.current[inner]={started:now,frameCount:25,frameDuration:30};animsArr.splice(i,1);}continue;}}catch(e){}// find the zone/slot for this uid\nconst zone=clickZonesRef.current.find(z=>{var _z$data$card$uid2;return z.data&&z.data.card&&((_z$data$card$uid2=z.data.card.uid)!==null&&_z$data$card$uid2!==void 0?_z$data$card$uid2:String(z.data.card.id))===a.uid;});if(!zone)continue;// determine if gov slot or instant\nlet isGov=false;let isInstant=false;try{const dt=zone.data||{};if(dt.type==='row_slot'&&dt.lane==='aussen')isGov=true;if(dt.type==='board_card'&&dt.lane==='aussen')isGov=true;if(dt.slot&&typeof dt.slot==='string'&&dt.slot.includes('government'))isGov=true;if(dt.type==='activate_instant'||dt.slot&&typeof dt.slot==='string'&&dt.slot.includes('instant'))isInstant=true;}catch(e){}if(!isGov&&!isInstant)continue;const player=(_zone$data$player=zone.data.player)!==null&&_zone$data$player!==void 0?_zone$data$player:1;const lane=(_zone$data$lane=zone.data.lane)!==null&&_zone$data$lane!==void 0?_zone$data$lane:'aussen';const idx=(_zone$data$index=zone.data.index)!==null&&_zone$data$index!==void 0?_zone$data$index:0;const key=\"\".concat(player,\".\").concat(lane,\".\").concat(idx);// initialize sprite state if not present; consume the anim entry only when we actually start playback\nlet startedThis=false;if(isGov){if(!govSpriteStateRef.current[key]){govSpriteStateRef.current[key]={started:now,frameCount:14,frameDuration:40};// 14 frames @ ~40ms -> ~560ms\nstartedThis=true;}}if(isInstant){const instKey=\"\".concat(player,\".instant.\").concat(idx);if(!instantSpriteStateRef.current[instKey]){instantSpriteStateRef.current[instKey]={started:now,frameCount:14,frameDuration:40};startedThis=true;}}if(startedThis){animsArr.splice(i,1);}}// draw running sprite animations per gov slot\nObject.keys(govSpriteStateRef.current).forEach(k=>{const st=govSpriteStateRef.current[k];const elapsed=now-st.started;const total=st.frameCount*st.frameDuration;if(elapsed>total){// animation finished; remove state\ndelete govSpriteStateRef.current[k];return;}const frame=Math.floor(elapsed/st.frameDuration);// parse key -> player.lane.index\nconst parts=k.split('.');const player=Number(parts[0])||1;const lane=parts[1]||'aussen';const index=Number(parts[2]||0);// compute slot rect for this gov slot (player or opponent board)\nconst rect=player===1?playerGovRects[index]:opponentGovRects[index];if(!rect)return;// spritesheet: frame N located at x = N*256, y = 0\nif(sprites&&sprites.complete){const sx=frame*256;const sy=0;const sw=256;const sh=256;// draw exactly matching the slot rect size to avoid scaling mismatches\nconst dx=rect.x;const dy=rect.y;ctx.drawImage(sprites,sx,sy,sw,sh,dx,dy,rect.w,rect.h);}else if(gif&&gif.complete){// fallback to static gif if spritesheet missing\nctx.drawImage(gif,rect.x,rect.y,rect.w,rect.h);}});// --- INSTANT INITIATIVE SPRITESHEET (draw on instant slot) ---\ntry{const spritesI=instantSpritesRef.current;const nowI=performance.now();Object.keys(instantSpriteStateRef.current).forEach(k=>{const st=instantSpriteStateRef.current[k];const elapsed=nowI-st.started;const total=st.frameCount*st.frameDuration;if(elapsed>total){delete instantSpriteStateRef.current[k];return;}const frame=Math.floor(elapsed/st.frameDuration);const parts=k.split('.');const player=Number(parts[0])||1;const index=Number(parts[2]||0);const rects=getSofortRect(player?'player':'opponent');// getSofortRect returns one rect; map by player/context — fallback to zone\nconst instantRect=getZone('slot.instant.player').rectPx;const[ix,iy,iw,ih]=instantRect;if(spritesI&&spritesI.complete){const sx=frame*256;const sy=0;const sw=256;const sh=256;ctx.drawImage(spritesI,sx,sy,sw,sh,ix,iy,iw,ih);}});}catch(e){}// --- HIT / TARGET SPRITESHEET (draw as overlay on targeted slot) ---\ntry{const spritesH=hitSpritesRef.current;const nowH=performance.now();Object.keys(hitSpriteStateRef.current).forEach(k=>{const st=hitSpriteStateRef.current[k];const elapsed=nowH-st.started;const total=st.frameCount*st.frameDuration;if(elapsed>total){delete hitSpriteStateRef.current[k];return;}const frame=Math.floor(elapsed/st.frameDuration);// parse key -> player.lane.index\nconst parts=k.split('.');const player=Number(parts[0])||1;const lane=parts[1]||'aussen';const index=Number(parts[2]||0);// compute slot rect for this gov slot (attempt gov then public)\nconst rect=(player===1?playerGovRects:opponentGovRects)[index]||(player===1?playerPublicRects:opponentPublicRects)[index];if(!rect)return;if(spritesH&&spritesH.complete){const sx=frame*256;const sy=0;const sw=256;const sh=256;const dx=rect.x;const dy=rect.y;ctx.drawImage(spritesH,sx,sy,sw,sh,dx,dy,rect.w,rect.h);}});}catch(e){}}catch(e){}// Draw player permanent slots (draw symbols if empty)\n// permanent government\nconst permGovZone=getZone('slot.permanent.government.player');if(permGovZone){const card=gameState.permanentSlots[1].government;const[x,y,w,h]=permGovZone.rectPx;if(card){drawSingleSlot(ctx,'slot.permanent.government.player',card,'permanent_government',1);}else{// Draw all slot icons using unified helper (so 'dauerhaft' used visually for empty permanent gov slot)\nconst img=slotSymbolImgsRef.current.get('dauerhaft');drawSlotIconWithPulse(ctx,img,x,y,w,h,0.2);}}// permanent public\nconst permPubZone=getZone('slot.permanent.public.player');if(permPubZone){const card=gameState.permanentSlots[1].public;const[x2,y2,w2,h2]=permPubZone.rectPx;if(card){drawSingleSlot(ctx,'slot.permanent.public.player',card,'permanent_public',1);}else{// Draw all slot icons using unified helper (so 'dauerhaft' used visually for empty permanent public slot)\nconst img=slotSymbolImgsRef.current.get('dauerhaft');drawSlotIconWithPulse(ctx,img,x2,y2,w2,h2,0.9);}}// Draw instant slots (both players) and placeholder if empty\nconst instantPlayerZone=getZone('slot.instant.player');if(instantPlayerZone){const card=gameState.board[1].sofort[0];const[x,y,w,h]=instantPlayerZone.rectPx;if(card)drawSingleSlot(ctx,'slot.instant.player',card,'instant',1);else{// Use unified icon draw helper for instant slot\nconst img=slotSymbolImgsRef.current.get('sofort');drawSlotIconWithPulse(ctx,img,x,y,w,h,0.0);}}// Draw interventions strip (player)\n// We draw symbol if empty\nconst interventionsZone=getZone('interventions.player');if(interventionsZone){const[zx,zy,zw,zh]=interventionsZone.rectPx;const card=gameState.traps[1]&&gameState.traps[1][0];if(card)drawInterventionsP1(ctx);else{const img=slotSymbolImgsRef.current.get('intervention');drawSlotIconWithPulse(ctx,img,zx,zy,zw,zh,0.6);}}// Draw interventions strip (opponent) - nur im Dev Mode\nif(devMode){drawInterventionsP2(ctx);}// Draw hand (P1)\ndrawHandP1(ctx);// 🔧 DEV MODE: Draw hand (P2) - nur im Dev Mode\nif(devMode){drawHandP2(ctx);}// Draw info panels\ndrawInfoPanels(ctx);// Draw corruption mode indicator\nconst corrActive=!!(gameState.pendingAbilitySelect&&gameState.pendingAbilitySelect.type==='corruption_steal');if(corrActive){ctx.save();ctx.fillStyle='rgba(255, 0, 0, 0.8)';ctx.font='bold 32px sans-serif';ctx.textAlign='center';ctx.fillText('🔥 CORRUPTION TARGET SELECTION ACTIVE 🔥',960,100);ctx.fillStyle='rgba(255, 255, 0, 0.9)';ctx.font='bold 24px sans-serif';ctx.fillText('Click on opponent government card to target',960,140);ctx.restore();}// Draw maulwurf corruption mode indicator\nconst maulwurfActive=!!(gameState.pendingAbilitySelect&&gameState.pendingAbilitySelect.type==='maulwurf_steal');if(maulwurfActive){ctx.save();ctx.fillStyle='rgba(139, 69, 19, 0.8)';// Brown color for mole\nctx.font='bold 32px sans-serif';ctx.textAlign='center';ctx.fillText('🕳️ MAULWURF CORRUPTION ACTIVE 🕳️',960,100);ctx.fillStyle='rgba(255, 255, 0, 0.9)';ctx.font='bold 24px sans-serif';ctx.fillText('Ziel automatisch gewählt - würfeln zum Stehlen',960,140);ctx.restore();}// Draw tunnelvision probe mode indicator\nconst tunnelvisionActive=!!(gameState.pendingAbilitySelect&&gameState.pendingAbilitySelect.type==='tunnelvision_probe');if(tunnelvisionActive){ctx.save();ctx.fillStyle='rgba(75, 0, 130, 0.8)';// Purple color for tunnelvision\nctx.font='bold 32px sans-serif';ctx.textAlign='center';ctx.fillText('🔮 TUNNELVISION PROBE ACTIVE 🔮',960,100);ctx.fillStyle='rgba(255, 255, 0, 0.9)';ctx.font='bold 24px sans-serif';ctx.fillText('Regierungskarte Probe - würfeln zum Fortfahren',960,140);ctx.restore();}// --- VISUAL EFFECTS: Particle bursts, card pop scale, initiative ripple & AP pop ---\ntry{const now=performance.now();const{particlesRef,popsRef,ripplesRef,apLabelsRef,reducedMotion}=visualEffects||{};const parts=particlesRef.current||[];if(!reducedMotion){for(let i=parts.length-1;i>=0;i--){const p=parts[i];const age=now-p.start;if(age>p.life){parts.splice(i,1);continue;}p.vy+=p.gravity||0.09;p.x+=p.vx;p.y+=p.vy;const t=1-age/p.life;ctx.save();ctx.globalAlpha=Math.max(0,Math.min(1,t));ctx.fillStyle=p.color||'#ffd166';ctx.beginPath();ctx.arc(p.x,p.y,(p.size||4)*t,0,Math.PI*2);ctx.fill();ctx.restore();}particlesRef.current=parts;const pops=popsRef.current||[];pops.forEach(pop=>{const p=Math.min(1,Math.max(0,(now-pop.started)/pop.duration));const eased=1+0.12*(1-Math.pow(1-p,3));const zone=clickZonesRef.current.find(z=>{var _z$data$card$uid3;return z.data&&z.data.card&&((_z$data$card$uid3=z.data.card.uid)!==null&&_z$data$card$uid3!==void 0?_z$data$card$uid3:String(z.data.card.id))===pop.uid;});if(!zone)return;ctx.save();ctx.translate(zone.x+zone.w/2,zone.y+zone.h/2);ctx.scale(eased,eased);ctx.globalAlpha=0.12*(1-p);ctx.fillStyle='#ffffff';ctx.fillRect(-zone.w/2,-zone.h/2,zone.w,zone.h);ctx.restore();});const ripples=ripplesRef.current||[];for(let i=ripples.length-1;i>=0;i--){const r=ripples[i];const p=Math.min(1,Math.max(0,(now-r.started)/r.duration));if(p>=1){ripples.splice(i,1);continue;}const radius=r.radius*(0.8+1.8*p);ctx.save();const g=ctx.createRadialGradient(r.cx,r.cy,radius*0.1,r.cx,r.cy,radius);g.addColorStop(0,\"rgba(255,255,255,\".concat(0.12*(1-p),\")\"));g.addColorStop(1,\"rgba(255,255,255,0)\");ctx.fillStyle=g;ctx.beginPath();ctx.arc(r.cx,r.cy,radius,0,Math.PI*2);ctx.fill();ctx.restore();if(r.showAp&&!r._apSpawned){apLabelsRef.current=apLabelsRef.current||[];apLabelsRef.current.push({x:r.apX,y:r.apY,started:now,duration:800,text:'+1'});r._apSpawned=true;}}ripplesRef.current=ripples;const apl=apLabelsRef.current||[];for(let i=apl.length-1;i>=0;i--){const l=apl[i];const p=Math.min(1,Math.max(0,(now-l.started)/l.duration));if(p>=1){apl.splice(i,1);continue;}ctx.save();ctx.globalAlpha=1-p;ctx.fillStyle='#ffdd57';ctx.font='bold 22px sans-serif';ctx.textAlign='center';ctx.fillText(l.text,l.x,l.y-20*p);ctx.restore();}apLabelsRef.current=apl;}else{const apl=apLabelsRef.current||[];for(let i=apl.length-1;i>=0;i--){const l=apl[i];const p=Math.min(1,Math.max(0,(now-l.started)/l.duration));if(p>=1){apl.splice(i,1);continue;}ctx.save();ctx.globalAlpha=1-p;ctx.fillStyle='#ffdd57';ctx.font='bold 18px sans-serif';ctx.textAlign='center';ctx.fillText(l.text,l.x,l.y-10*p);ctx.restore();}apLabelsRef.current=apl;}}catch(e){}// --- Overlay pass: draw influence pulse ring and +N labels on top of all cards ---\ntry{const now=performance.now();// iterate over stored anims\ninfluenceAnimRef.current.forEach((anims,uid)=>{// find card position by scanning clickZones\nconst zone=clickZonesRef.current.find(z=>{var _z$data$card$uid4;return z.data&&(z.data.card&&((_z$data$card$uid4=z.data.card.uid)!==null&&_z$data$card$uid4!==void 0?_z$data$card$uid4:String(z.data.card.id))===uid||z.data.card&&z.data.card.uid===uid);});if(!zone)return;const cx=zone.x+zone.w/2;const cy=zone.y+zone.h/2;// calculate aggregate pulse for this uid\nlet maxPulse=0;let totalAmount=0;const remaining=[];anims.forEach(a=>{const p=Math.min(1,Math.max(0,(now-a.start)/a.duration));const pulse=Math.pow(Math.max(0,1-p),2);if(pulse>maxPulse)maxPulse=pulse;if(p<1){remaining.push(a);totalAmount+=a.amount;}});// update list\nif(remaining.length>0)influenceAnimRef.current.set(uid,remaining);else influenceAnimRef.current.delete(uid);if(maxPulse>0.001){// draw a soft ring to the right-bottom of influence number\nconst ringRadius=Math.max(8,zone.w*0.08)*(1+maxPulse*0.6);const ringX=zone.x+zone.w-28;// near bottom-right where influence text lives\nconst ringY=zone.y+zone.h-20;ctx.save();ctx.beginPath();ctx.strokeStyle=\"rgba(46, 204, 113, \".concat(0.9*maxPulse,\")\");ctx.lineWidth=Math.max(2,Math.ceil(6*maxPulse));ctx.arc(ringX,ringY,ringRadius,0,Math.PI*2);ctx.stroke();ctx.restore();}if(totalAmount>0){// floating +N to the right of influence number\nconst labelX=zone.x+zone.w-12;const labelY=zone.y+zone.h-32-Math.random()*6;// slight jitter\nctx.save();ctx.fillStyle='#2ecc71';ctx.font='bold 16px sans-serif';ctx.textAlign='left';ctx.textBaseline='middle';ctx.fillText(\"+\".concat(totalAmount),labelX,labelY);ctx.restore();}});}catch(e){// ignore overlay errors\n}// --- Outline pass: draw a subtle, slightly pulsing 257x257 square around 256x256 slots ---\ntry{const now2=performance.now();clickZonesRef.current.forEach((z,i)=>{if(!z)return;const w=z.w||0;const h=z.h||0;// only target 256x256 slot-sized zones (covers the icons)\nif(Math.abs(w-256)>0.1||Math.abs(h-256)>0.1)return;const x=z.x;const y=z.y;// Color palette (rgb)\nconst rgbTeal='20,184,166';const rgbBurg='127,29,29';const rgbPurple='139,92,246';const rgbYellow='250,204,21';const rgbOrange='251,146,60';// Determine slot semantic\nlet slotType='default';try{const dt=z.data||{};if(dt.slot&&typeof dt.slot==='string'){if(dt.slot.includes('government'))slotType='government';else if(dt.slot.includes('public'))slotType='public';else if(dt.slot.includes('permanent'))slotType='permanent';else if(dt.slot.includes('instant'))slotType='instant';}if(dt.type==='row_slot'&&dt.lane==='aussen')slotType='government';if(dt.type==='row_slot'&&dt.lane==='innen')slotType='public';if(dt.type==='trap_p1'||dt.type==='trap_p2'||dt.card&&dt.card.kind==='trap')slotType='intervention';if(dt.type==='activate_instant'||dt.slot==='instant')slotType='instant';if(dt.slot==='permanent_government'||dt.slot==='permanent_public'||dt.slot==='permanent')slotType='permanent';}catch(e){}const pulse=0.5+0.5*Math.sin(now2/350+i);const alpha=0.06+0.12*pulse;// subtle alpha\nconst lw=1+2*pulse;// line width between 1 and 3\n// Create gradient based on slot type\nlet grad=null;try{grad=ctx.createLinearGradient(x,y,x+w,y+h);if(slotType==='government'){grad.addColorStop(0,\"rgba(\".concat(rgbTeal,\",1)\"));grad.addColorStop(1,\"rgba(\".concat(rgbBurg,\",1)\"));}else if(slotType==='public'){grad.addColorStop(0,\"rgba(\".concat(rgbBurg,\",1)\"));grad.addColorStop(1,\"rgba(\".concat(rgbTeal,\",1)\"));}else if(slotType==='permanent'){grad.addColorStop(0,\"rgba(\".concat(rgbPurple,\",1)\"));grad.addColorStop(1,\"rgba(\".concat(rgbPurple,\",1)\"));}else if(slotType==='instant'){grad.addColorStop(0,\"rgba(\".concat(rgbYellow,\",1)\"));grad.addColorStop(1,\"rgba(\".concat(rgbYellow,\",1)\"));}else if(slotType==='intervention'){grad.addColorStop(0,\"rgba(\".concat(rgbOrange,\",1)\"));grad.addColorStop(1,\"rgba(\".concat(rgbOrange,\",1)\"));}else{grad.addColorStop(0,\"rgba(255,255,255,1)\");grad.addColorStop(1,\"rgba(255,255,255,1)\");}}catch(e){grad=null;}ctx.save();if(grad)ctx.strokeStyle=grad;else ctx.strokeStyle=\"rgba(255,255,255,\".concat(alpha.toFixed(3),\")\");ctx.globalAlpha=alpha;ctx.lineWidth=lw;// draw 257x257 centered so that it encloses the 256 slot\nctx.strokeRect(x-0.5,y-0.5,w+1,h+1);ctx.restore();});}catch(e){// ignore outline errors\n}ctx.restore();// expose zones for debug snapshot\nwindow.__politicardDebug={uiTransform:getUiTransform(canvas.width,canvas.height),canvasSize:{width:canvas.width,height:canvas.height},zones:LAYOUT.zones,clickZones:clickZonesRef.current.slice(0,1000)};// Build canonical slotPositions map for animations/debugging\ntry{const map={};clickZonesRef.current.forEach(z=>{const d=z.data||{};// support row_slot, board_card, slot_card shapes\nif(d.type==='row_slot'||d.type==='board_card'||d.type==='slot_card'||d.type==='hand_p1'||d.type==='hand_p2'){var _d$player,_d$lane;const player=(_d$player=d.player)!==null&&_d$player!==void 0?_d$player:d.type==='hand_p2'?2:1;const lane=(_d$lane=d.lane)!==null&&_d$lane!==void 0?_d$lane:typeof d.slot==='string'?d.slot:d.type==='hand_p2'?'hand':'unknown';let index;if(d.index!=null){index=d.index;}else if(d.card){// prefer explicit slotIndex, fallback to card.index, otherwise 0\nindex=d.card.slotIndex!=null?d.card.slotIndex:d.card.index!=null?d.card.index:0;}else{index=0;}const key=\"\".concat(player,\".\").concat(lane,\".\").concat(index);map[key]={x:z.x,y:z.y,w:z.w,h:z.h,cx:z.x+z.w/2,cy:z.y+z.h/2};}});slotPositionsRef.current=map;window.__politicardDebug=_objectSpread(_objectSpread({},window.__politicardDebug),{},{slotPositions:slotPositionsRef.current});}catch(e){// don't let debug mapping break rendering\n}// Run diagnostics after canvas is fully rendered\nrunDiagnostics();},[drawLane,drawHandP1,drawHandP2,drawInterventionsP1,drawInterventionsP2,drawPermanentSlotsP1,drawPermanentSlotsP2,drawInstantSlots,drawInfoPanels,devMode,runDiagnostics]);const DRAW_LAYOUT_OVERLAY=false;// force off per new layout system\n// Load slot symbol images once\nuseEffect(()=>{const load=(key,src)=>{const img=new Image();img.onload=()=>{slotSymbolImgsRef.current.set(key,img);};img.onerror=()=>{console.warn('Failed to load slot icon',src);};img.src=src;};// load all slot icons\nload('public',publicSymbolUrl);load('sofort',sofortSymbolUrl);load('dauerhaft',dauerhaftSymbolUrl);load('government',governmentSymbolUrl);load('intervention',interventionSymbolUrl);// load test GIF for gov overlay\ntry{const img=new Image();img.onload=()=>{govGifRef.current=img;};img.onerror=()=>{console.warn('Failed to load gov overlay gif',govPlaceGifUrl);};img.src=govPlaceGifUrl;}catch(e){}// load spritesheet for placement animation\ntry{const s=new Image();s.onload=()=>{govSpritesRef.current=s;};s.onerror=()=>{console.warn('Failed to load gov spritesheet',govPlaceSpritesheetUrl);};s.src=govPlaceSpritesheetUrl;}catch(e){}// load spritesheet for instant initiative activation\ntry{const si=new Image();si.onload=()=>{instantSpritesRef.current=si;};si.onerror=()=>{console.warn('Failed to load instant spritesheet',instantSpritesheetUrl);};si.src=instantSpritesheetUrl;}catch(e){}// load spritesheet for hit/target animation (25 frames)\ntry{const h=new Image();h.onload=()=>{hitSpritesRef.current=h;};h.onerror=()=>{console.warn('Failed to load hit spritesheet',hitSpritesheetUrl);};h.src=hitSpritesheetUrl;}catch(e){}// ensure first draw\nrequestAnimationFrame(draw);},[draw]);// Expose debug trigger to manually start gov sprite animation by slot-key or uid\nuseEffect(()=>{window.__pc_triggerGovAnim=id=>{try{var _zone$data$player2,_zone$data$lane2,_zone$data$index2;const now=performance.now();// if id is slot key like '1.aussen.2'\nif(typeof id==='string'&&id.indexOf('.')>=0){govSpriteStateRef.current[id]={started:now,frameCount:14,frameDuration:40};return;}// otherwise try to resolve as uid/id to a clickZone\nconst uid=id;const zone=clickZonesRef.current.find(z=>{var _z$data$card$uid5;return z.data&&z.data.card&&(((_z$data$card$uid5=z.data.card.uid)!==null&&_z$data$card$uid5!==void 0?_z$data$card$uid5:String(z.data.card.id))===uid||z.data.card.id===uid);});if(!zone){console.warn('pc_triggerGovAnim: no slot found for uid',uid);return;}const player=(_zone$data$player2=zone.data.player)!==null&&_zone$data$player2!==void 0?_zone$data$player2:1;const lane=(_zone$data$lane2=zone.data.lane)!==null&&_zone$data$lane2!==void 0?_zone$data$lane2:zone.data.slot&&typeof zone.data.slot==='string'?zone.data.slot:'aussen';const index=(_zone$data$index2=zone.data.index)!==null&&_zone$data$index2!==void 0?_zone$data$index2:0;const key=\"\".concat(player,\".\").concat(lane,\".\").concat(index);govSpriteStateRef.current[key]={started:now,frameCount:14,frameDuration:40};}catch(e){console.warn('pc_triggerGovAnim error',e);}};// expose easy alias\ntry{window.pc_triggerGovAnim=window.__pc_triggerGovAnim;}catch(e){}return()=>{delete window.__pc_triggerGovAnim;};},[]);// Expose debug trigger for hit animation (key: '1.aussen.0' or uid)\nuseEffect(()=>{window.__pc_triggerHitAnim=id=>{try{var _zone$data$player3,_zone$data$lane3,_zone$data$index3;const now=performance.now();// if id is slot key like '1.aussen.2'\nif(typeof id==='string'&&id.indexOf('.')>=0){hitSpriteStateRef.current[id]={started:now,frameCount:25,frameDuration:30};return;}// otherwise try to resolve as uid/id to a clickZone\nconst uid=id;const zone=clickZonesRef.current.find(z=>{var _z$data$card$uid6;return z.data&&z.data.card&&(((_z$data$card$uid6=z.data.card.uid)!==null&&_z$data$card$uid6!==void 0?_z$data$card$uid6:String(z.data.card.id))===uid||z.data.card.id===uid);});if(!zone){console.warn('pc_triggerHitAnim: no slot found for uid',uid);return;}const player=(_zone$data$player3=zone.data.player)!==null&&_zone$data$player3!==void 0?_zone$data$player3:1;const lane=(_zone$data$lane3=zone.data.lane)!==null&&_zone$data$lane3!==void 0?_zone$data$lane3:zone.data.slot&&typeof zone.data.slot==='string'?zone.data.slot:'aussen';const index=(_zone$data$index3=zone.data.index)!==null&&_zone$data$index3!==void 0?_zone$data$index3:0;const key=\"\".concat(player,\".\").concat(lane,\".\").concat(index);hitSpriteStateRef.current[key]={started:now,frameCount:25,frameDuration:30};}catch(e){console.warn('pc_triggerHitAnim error',e);}};try{window.pc_triggerHitAnim=window.__pc_triggerHitAnim;}catch(e){}return()=>{delete window.__pc_triggerHitAnim;};},[]);// Redraw when game state or selection changes\nuseEffect(()=>{requestAnimationFrame(draw);},[gameState,selectedHandIndex,draw]);// Continuous render loop to keep canvas updated without relying on external state refs\nuseEffect(()=>{let frame;const loop=()=>{draw();frame=requestAnimationFrame(loop);};frame=requestAnimationFrame(loop);return()=>cancelAnimationFrame(frame);},[draw]);const handleCardClick=useCallback(data=>{// Corruption target selection: intercept board card clicks for opponent government\nif(corruptionSelectActorRef.current&&data&&data.type==='board_card'){try{const actor=corruptionSelectActorRef.current;const victim=actor===1?2:1;if(data.player===victim&&(data.lane==='aussen'||data.lane==='government')){var _data$card$uid,_data$card,_data$card2;const uid=(_data$card$uid=(_data$card=data.card)===null||_data$card===void 0?void 0:_data$card.uid)!==null&&_data$card$uid!==void 0?_data$card$uid:(_data$card2=data.card)===null||_data$card2===void 0?void 0:_data$card2.id;if(uid!=null){corruptionSelectActorRef.current=null;try{window.dispatchEvent(new CustomEvent('pc:corruption_target_selected',{detail:{player:actor,targetUid:uid}}));}catch(e){}return;// do not propagate\n}}}catch(e){}}// Hand-Klick\nif(data.type==='hand_p1'){var _data$card$uid2,_data$card3,_data$card4,_gameState$hands;const uid=(_data$card$uid2=(_data$card3=data.card)===null||_data$card3===void 0?void 0:_data$card3.uid)!==null&&_data$card$uid2!==void 0?_data$card$uid2:(_data$card4=data.card)===null||_data$card4===void 0?void 0:_data$card4.id;const stateHand=((_gameState$hands=gameState.hands)===null||_gameState$hands===void 0?void 0:_gameState$hands[1])||[];const idxInState=stateHand.findIndex(c=>{var _c$uid3;return((_c$uid3=c.uid)!==null&&_c$uid3!==void 0?_c$uid3:c.id)===uid;});onCardClick(data);return;}// Slot-Klick\nif(data.type==='row_slot'){var _gameState$board$1$in,_gameState$board,_gameState$board$,_gameState$board$1$au,_gameState$board2,_gameState$board2$;const lane=data.lane;const cap=getLaneCapacity(lane);// Hole aktuelle Row-Länge aus gameState\nconst rowCards=lane==='public'?(_gameState$board$1$in=(_gameState$board=gameState.board)===null||_gameState$board===void 0?void 0:(_gameState$board$=_gameState$board[1])===null||_gameState$board$===void 0?void 0:_gameState$board$.innen)!==null&&_gameState$board$1$in!==void 0?_gameState$board$1$in:[]:(_gameState$board$1$au=(_gameState$board2=gameState.board)===null||_gameState$board2===void 0?void 0:(_gameState$board2$=_gameState$board2[1])===null||_gameState$board2$===void 0?void 0:_gameState$board2$.aussen)!==null&&_gameState$board$1$au!==void 0?_gameState$board$1$au:[];if(rowCards.length>=cap){// Optional: UI Feedback\nconsole.warn(\"Row \".concat(lane,\" is full (\").concat(rowCards.length,\"/\").concat(cap,\")\"));return;}onCardClick(data);return;}// Andere Klicks (empty_slot, board_card, etc.)\nonCardClick(data);},[gameState,onCardClick]);const handleClick=useCallback(e=>{const canvas=canvasRef.current;if(!canvas)return;const rect=canvas.getBoundingClientRect();const{scale,offsetX,offsetY}=getUiTransform(canvas.width,canvas.height);const mx=(e.clientX-rect.left-offsetX)/scale;const my=(e.clientY-rect.top-offsetY)/scale;const hit=clickZonesRef.current.find(z=>mx>=z.x&&mx<=z.x+z.w&&my>=z.y&&my<=z.y+z.h);if(hit){console.debug('[CanvasClick] mx,my,hit:',mx,my,hit.data);try{// If user clicked a drawn card in an instant slot, normalize to activate_instant\nconst d=hit.data||{};if(d.type==='slot_card'&&d.slot==='instant'){handleCardClick({type:'activate_instant',player:d.player||1,card:d.card});return;}// Fallback: if there's an explicit activate_instant zone, pass through\nif(d.type==='activate_instant'){handleCardClick(d);return;}}catch(err){}handleCardClickInternal(hit.data);}},[handleCardClick]);const handleMouseMove=useCallback(e=>{const canvas=canvasRef.current;if(!canvas)return;const rect=canvas.getBoundingClientRect();const{scale,offsetX,offsetY}=getUiTransform(canvas.width,canvas.height);const mx=(e.clientX-rect.left-offsetX)/scale;const my=(e.clientY-rect.top-offsetY)/scale;const hit=clickZonesRef.current.find(z=>mx>=z.x&&mx<=z.x+z.w&&my>=z.y&&my<=z.y+z.h);if(hit){var _hit$data$card;console.log('[hover]',hit.data.type,(_hit$data$card=hit.data.card)===null||_hit$data$card===void 0?void 0:_hit$data$card.name);onCardHover(_objectSpread(_objectSpread({},hit.data),{},{x:e.clientX,y:e.clientY}));}else{onCardHover(null);}},[onCardHover]);const handleWheel=useCallback(e=>{// only enable when player1 has more slots than visible\nconst handLen=gameState.hands&&gameState.hands[1]?gameState.hands[1].length:0;const zone=getZone('hand.player');if(!zone)return;if(handLen<=5)return;// nothing to scroll\n// Prevent page scrolling when over canvas\ne.preventDefault();// accumulate target offset (invert so wheel down moves cards up)\n// Each wheel step moves by 48px per delta unit\nconst delta=Math.sign(e.deltaY)*48;// compute slot height more robustly\nconst slots=computeSlotRects(zone);const slotH=slots&&slots.length>0?slots[0].h:zone.rectPx[3]/5;const visible=5;const maxOffset=-(Math.max(0,handLen-visible)*slotH);handScrollTargetRef.current=Math.max(Math.min(handScrollTargetRef.current-delta,0),maxOffset);},[gameState.hands]);const handleTouchStart=useCallback(e=>{if(!e.touches||e.touches.length===0)return;const handLen=gameState.hands&&gameState.hands[1]?gameState.hands[1].length:0;if(handLen<=5)return;isTouchingRef.current=true;const y=e.touches[0].clientY;touchStartYRef.current=y;lastTouchYRef.current=y;e.preventDefault();},[gameState.hands]);const handleTouchMove=useCallback(e=>{var _lastTouchYRef$curren;if(!isTouchingRef.current)return;if(!e.touches||e.touches.length===0)return;const y=e.touches[0].clientY;const last=(_lastTouchYRef$curren=lastTouchYRef.current)!==null&&_lastTouchYRef$curren!==void 0?_lastTouchYRef$curren:y;const dy=y-last;// positive when moving down\nlastTouchYRef.current=y;// invert so dragging up moves cards up\nconst delta=-dy;const handLen=gameState.hands&&gameState.hands[1]?gameState.hands[1].length:0;const zone=getZone('hand.player');if(!zone)return;const slots=computeSlotRects(zone);const slotH=slots&&slots.length>0?slots[0].h:zone.rectPx[3]/5;const visible=5;const maxOffset=-(Math.max(0,handLen-visible)*slotH);handScrollTargetRef.current=Math.max(Math.min(handScrollTargetRef.current+delta,0),maxOffset);e.preventDefault();},[gameState.hands]);const handleTouchEnd=useCallback(e=>{isTouchingRef.current=false;touchStartYRef.current=null;lastTouchYRef.current=null;},[]);// Expose debug trigger to manually start instant sprite animation by slot-key or uid\nuseEffect(()=>{window.__pc_triggerInstantAnim=key=>{const now=performance.now();instantSpriteStateRef.current[key||'1.instant.0']={started:now,frameCount:14,frameDuration:40};};// alias\ntry{window.pc_triggerInstantAnim=window.__pc_triggerInstantAnim;}catch(e){}return()=>{delete window.__pc_triggerGovAnim;delete window.__pc_triggerInstantAnim;};},[]);// Click handler wrapper for corruption selection\nconst handleCardClickInternal=useCallback(data=>{const sel=gameState.pendingAbilitySelect;if(sel&&sel.type==='corruption_steal'){// Accept clicks on either actual card sprites (with uid) or on empty row_slot hitboxes.\nif(data.player!==sel.actorPlayer&&data.lane==='aussen'){let targetUid=data.uid;// If we got a row_slot hit (no uid), map index→uid from board state\nif(!targetUid&&data.type==='row_slot'){try{var _board5,_board5$p,_board5$p$aussen;const p=data.player;const idx=data.index;const card=(_board5=gameState.board)===null||_board5===void 0?void 0:(_board5$p=_board5[p])===null||_board5$p===void 0?void 0:(_board5$p$aussen=_board5$p.aussen)===null||_board5$p$aussen===void 0?void 0:_board5$p$aussen[idx];targetUid=card===null||card===void 0?void 0:card.uid;}catch(e){}}if(targetUid){try{console.debug('[CORR] forwarding uid',targetUid,'actorPlayer=',sel.actorPlayer);window.dispatchEvent(new CustomEvent('pc:corruption_pick_target',{detail:{player:sel.actorPlayer,targetUid}}));// Also open small confirmation overlay via DOM event for modal convenience\ntry{window.dispatchEvent(new CustomEvent('pc:corruption_target_selected',{detail:{player:sel.actorPlayer,targetUid}}));}catch(e){}}catch(e){}return;// consume click\n}}}onCardClick(data);},[gameState,onCardClick]);useEffect(()=>{const onDiceResult=()=>{// remove corruption modal if exists\nconst el=document.getElementById('pc-corruption-modal');if(el)el.remove();corruptionSelectActorRef.current=null;};window.addEventListener('pc:dice_result',onDiceResult);return()=>window.removeEventListener('pc:dice_result',onDiceResult);},[]);return/*#__PURE__*/_jsx(\"canvas\",{ref:canvasRef,width:1920,height:1080,style:{display:'block',width:'100%',height:'100%',imageRendering:'auto'},onClick:handleClick,onMouseMove:handleMouseMove,onWheel:handleWheel,onTouchStart:handleTouchStart,onTouchMove:handleTouchMove,onTouchEnd:handleTouchEnd});};","map":{"version":3,"names":["React","useRef","useEffect","useCallback","useVisualEffectsSafe","LAYOUT","getZone","computeSlotRects","getUiTransform","getLaneCapacity","getPublicRects","getGovernmentRects","getSofortRect","sortHandCards","getCardImagePath","influenceIconUrl","publicSymbolUrl","sofortSymbolUrl","dauerhaftSymbolUrl","governmentSymbolUrl","interventionSymbolUrl","govPlaceGifUrl","govPlaceSpritesheetUrl","instantSpritesheetUrl","hitSpritesheetUrl","jsx","_jsx","isCorruptionSelection","state","player","sel","pendingAbilitySelect","type","actorPlayer","isMaulwurfCorruption","isTunnelvisionProbe","GameCanvas","_ref","gameState","selectedHandIndex","onCardClick","onCardHover","devMode","handler","ev","_ev$detail","detail","dice","document","querySelector","window","dispatchEvent","CustomEvent","e","addEventListener","removeEventListener","canvasRef","visualEffects","clickZonesRef","handScrollTargetRef","handScrollCurrentRef","handScrollEnabledRef","touchStartYRef","lastTouchYRef","isTouchingRef","backgroundImageRef","imageCacheRef","Map","influenceImgRef","influenceAnimRef","prevInfluencesRef","slotSymbolImgsRef","slotPositionsRef","uidToKeyRef","keyToUidRef","govGifRef","govSpritesRef","hitSpritesRef","govSpriteStateRef","instantSpritesRef","instantSpriteStateRef","hitSpriteStateRef","corruptionSelectActorRef","gameStateRef","current","onEnterCorruptionSelect","_ev$detail2","actor","console","log","error","onKeyDown","_gs$board","_gs$board$victim","_gs$board$victim$auss","_card$uid","k","key","includes","victim","idx","Number","gs","card","board","aussen","debug","uid","id","targetUid","preventDefault","maulwurfSelectActorRef","onEnterMaulwurfSelect","_ev$detail3","_ev$detail4","_ev$detail5","_ev$detail6","requiredRoll","targetName","el","createElement","style","cssText","fontSize","body","appendChild","innerHTML","concat","rollBtn","cancelBtn","removeChild","tunnelvisionProbeActorRef","onEnterTunnelvisionProbe","_ev$detail7","_ev$detail8","_ev$detail9","_ev$detail0","influence","getElementById","onclick","cancel","drawSlotIconWithPulse","ctx","img","x","y","w","h","phase","arguments","length","undefined","complete","now","performance","base","pulseRange","period","pulse","Math","sin","save","globalAlpha","drawImage","grad","createLinearGradient","addColorStop","globalCompositeOperation","fillStyle","fillRect","restore","Image","src","drawCardAt","size","_shield","selected","showAPCost","extraAlpha","_uid","list","playAnimsRef","__pc_play_anims","anim","find","a","p","min","max","started","duration","pow","dx","dy","s","floor","cached","get","naturalWidth","onload","set","kind","_influence","barH","font","textAlign","textBaseline","fillText","protected","shield","deactivated","_influence2","badgeHeight","badgeWidth","badgeX","badgeY","beginPath","roundRect","fill","strokeStyle","lineWidth","strokeRect","getSlotDisplayName","zoneId","index","slotNumber","drawLane","lane","clickable","zone","slots","arr","forEach","bgColor","isSelected","hands","clickZone","textY","name","push","_objectSpread","data","slotName","drawHandP1","hand","target","offsetY","round","i","originalIndex","findIndex","c","isSel","sx","sy","drawHandP2","rectPx","drawInterventionsP1","traps","zx","zy","zw","zh","drawInterventionsP2","drawSingleSlot","clickType","slot","onTargetSelected","_board","_board2","_board2$aussen","_board3","_board4","_board4$aussen","position","left","top","transform","padding","background","border","borderRadius","zIndex","color","fontFamily","disabled","innerText","remove","drawPermanentSlotsP1","permanentSlots","government","public","drawPermanentSlotsP2","drawInstantSlots","sofortPlayerCard","sofort","sofortOppCard","getActiveKeywordsAndSubcategories","allCards","innen","filter","keywords","Set","subcategories","tag","add","publicCard","oligarchNames","platformNames","movementNames","ngoNames","intelligenceNames","mediaNames","Array","from","drawInfoPanels","govPanelX","govPanelY","govPanelW","govPanelH","keyword","pubPanelX","pubPanelY","pubPanelW","pubPanelH","subcategory","displayName","substring","runDiagnostics","handZones","z","uiUIDs","map","_z$data$card$uid","Boolean","stateHand","stateUIDs","_c$uid","missingInState","u","missingInUI","_politicardDebug","mismatch","ts","Date","uiCount","stateCount","stack","Error","__politicardDebug","slice","warn","draw","_LAYOUT$background","_LAYOUT$background2","canvas","getContext","currSnapshot","collect","_c$uid2","_c$influence","String","Object","keys","_currSnapshot$uid","_prevInfluencesRef$cu","curr","prev","delta","start","amount","clearRect","width","height","enabled","scale","offsetX","translate","opponentPublicRects","opponentGovRects","corrActive","permGovZoneOpp","ox","oy","ow","oh","permPubZoneOpp","ox2","oy2","ow2","oh2","playerPublicRects","playerGovRects","sprites","gif","anims","animsArr","_zone$data$player","_zone$data$lane","_zone$data$index","indexOf","inner","frameCount","frameDuration","splice","_z$data$card$uid2","isGov","isInstant","dt","startedThis","instKey","st","elapsed","total","frame","parts","split","rect","sw","sh","spritesI","nowI","rects","instantRect","ix","iy","iw","ih","spritesH","nowH","permGovZone","permPubZone","x2","y2","w2","h2","instantPlayerZone","interventionsZone","maulwurfActive","tunnelvisionActive","particlesRef","popsRef","ripplesRef","apLabelsRef","reducedMotion","age","life","vy","gravity","vx","t","arc","PI","pops","pop","eased","_z$data$card$uid3","ripples","r","radius","g","createRadialGradient","cx","cy","showAp","_apSpawned","apX","apY","text","apl","l","_z$data$card$uid4","maxPulse","totalAmount","remaining","delete","ringRadius","ringX","ringY","ceil","stroke","labelX","labelY","random","now2","abs","rgbTeal","rgbBurg","rgbPurple","rgbYellow","rgbOrange","slotType","alpha","lw","toFixed","uiTransform","canvasSize","zones","clickZones","d","_d$player","_d$lane","slotIndex","slotPositions","DRAW_LAYOUT_OVERLAY","load","onerror","si","requestAnimationFrame","__pc_triggerGovAnim","_zone$data$player2","_zone$data$lane2","_zone$data$index2","_z$data$card$uid5","pc_triggerGovAnim","__pc_triggerHitAnim","_zone$data$player3","_zone$data$lane3","_zone$data$index3","_z$data$card$uid6","pc_triggerHitAnim","loop","cancelAnimationFrame","handleCardClick","_data$card$uid","_data$card","_data$card2","_data$card$uid2","_data$card3","_data$card4","_gameState$hands","idxInState","_c$uid3","_gameState$board$1$in","_gameState$board","_gameState$board$","_gameState$board$1$au","_gameState$board2","_gameState$board2$","cap","rowCards","handleClick","getBoundingClientRect","mx","clientX","my","clientY","hit","err","handleCardClickInternal","handleMouseMove","_hit$data$card","handleWheel","handLen","sign","deltaY","slotH","visible","maxOffset","handleTouchStart","touches","handleTouchMove","_lastTouchYRef$curren","last","handleTouchEnd","__pc_triggerInstantAnim","pc_triggerInstantAnim","_board5","_board5$p","_board5$p$aussen","onDiceResult","ref","display","imageRendering","onClick","onMouseMove","onWheel","onTouchStart","onTouchMove","onTouchEnd"],"sources":["C:/Users/skank/Videos/Cards/Milchcards/src/components/GameCanvas.tsx"],"sourcesContent":["import React, { useRef, useEffect, useCallback } from 'react';\nimport { useVisualEffects, useVisualEffectsSafe } from '../context/VisualEffectsContext';\nimport { GameState, Card, PoliticianCard, Player, Lane } from '../types/game';\nimport { LAYOUT, getZone, computeSlotRects, getUiTransform, getLaneCapacity, getPublicRects, getGovernmentRects, getSofortRect } from '../ui/layout';\nimport { drawCardImage, sortHandCards } from '../utils/gameUtils';\nimport { getNetApCost } from '../utils/ap';\nimport { getCardImagePath } from '../data/gameData';\nimport influenceIconUrl from '../assets/icons/influence.svg';\nimport publicSymbolUrl from '../assets/icons/public_symbol.png';\nimport sofortSymbolUrl from '../assets/icons/sofort_initiative_symbol.png';\nimport dauerhaftSymbolUrl from '../assets/icons/dauerhaft_initative.png';\nimport governmentSymbolUrl from '../assets/icons/government_symbol.png';\nimport interventionSymbolUrl from '../assets/icons/intervention_symbol.png';\nimport govPlaceGifUrl from '../assets/effect_gif/place_card_gov_256x256.gif';\nimport govPlaceSpritesheetUrl from '../ui/sprites/playcard_gov_256x256_14.png';\nimport instantSpritesheetUrl from '../ui/sprites/activate_trap_hit_target_256x256_16x2.png';\nimport hitSpritesheetUrl from '../ui/sprites/activate_inititive_hit_target_256x256_16_2rows.png';\n\ninterface GameCanvasProps {\n  gameState: GameState;\n  selectedHandIndex: number | null;\n  onCardClick: (data: any) => void;\n  onCardHover: (data: any) => void;\n  devMode?: boolean; // 🔧 DEV MODE: Show P2 hand when true\n}\n\n// Helper: is corruption target selection active\nfunction isCorruptionSelection(state: GameState, player: Player) {\n  const sel: any = (state as any).pendingAbilitySelect;\n  return sel && sel.type === 'corruption_steal' && sel.actorPlayer === player;\n}\n\n// Helper: is maulwurf corruption active\nfunction isMaulwurfCorruption(state: GameState, player: Player) {\n  const sel: any = (state as any).pendingAbilitySelect;\n  return sel && sel.type === 'maulwurf_steal' && sel.actorPlayer === player;\n}\n\n// Helper: is tunnelvision probe active\nfunction isTunnelvisionProbe(state: GameState, player: Player) {\n  const sel: any = (state as any).pendingAbilitySelect;\n  return sel && sel.type === 'tunnelvision_probe' && sel.actorPlayer === player;\n}\n\nexport const GameCanvas: React.FC<GameCanvasProps> = ({\n  gameState,\n  selectedHandIndex,\n  onCardClick,\n  onCardHover,\n  devMode = false,\n}) => {\n  // listen for dice roll requests from resolver and trigger Dice3D\n  useEffect(() => {\n    const handler = (ev: any) => {\n      try {\n        const player = ev.detail?.player;\n        // find Dice3D canvas on page and trigger click (it rolls on click)\n        const dice = document.querySelector('canvas') as HTMLCanvasElement | null;\n        // better: dispatch global event so App-level Dice3D component can roll programmatically\n        window.dispatchEvent(new CustomEvent('pc:ui_request_dice_roll', { detail: { player } }));\n      } catch (e) {}\n    };\n    window.addEventListener('pc:request_dice_roll', handler as EventListener);\n    return () => window.removeEventListener('pc:request_dice_roll', handler as EventListener);\n  }, []);\n  const canvasRef = useRef<HTMLCanvasElement>(null);\n  const visualEffects = useVisualEffectsSafe();\n  const clickZonesRef = useRef<Array<{ x: number; y: number; w: number; h: number; data: any }>>([]);\n  // Smooth vertical scroll for P1 hand when it has more than visible slots\n  const handScrollTargetRef = useRef<number>(0);\n  const handScrollCurrentRef = useRef<number>(0);\n  const handScrollEnabledRef = useRef<boolean>(true);\n  // Touch handling refs\n  const touchStartYRef = useRef<number | null>(null);\n  const lastTouchYRef = useRef<number | null>(null);\n  const isTouchingRef = useRef<boolean>(false);\n  const backgroundImageRef = useRef<HTMLImageElement | null>(null);\n  const imageCacheRef = useRef<Map<string, HTMLImageElement>>(new Map());\n  const influenceImgRef = useRef<HTMLImageElement | null>(null);\n  // Animation state for visual influence changes: Map<uid, Array<Anim>>\n  const influenceAnimRef = useRef<Map<string, Array<{ start: number; duration: number; amount: number }>>>(new Map());\n  // Previous per-card influence snapshot to detect increases\n  const prevInfluencesRef = useRef<Record<string, number>>({});\n  // Slot symbol images\n  const slotSymbolImgsRef = useRef<Map<string, HTMLImageElement>>(new Map());\n  // Map of canonical slot positions for animations: key -> {x,y,w,h,cx,cy}\n  const slotPositionsRef = useRef<Record<string, { x: number; y: number; w: number; h: number; cx: number; cy: number }>>({});\n  // Mapping between animation UIDs and slot keys to ensure one-shot playback\n  const uidToKeyRef = useRef<Record<string, string>>({});\n  const keyToUidRef = useRef<Record<string, string>>({});\n  // Temporary test GIF for government slots\n  const govGifRef = useRef<HTMLImageElement | null>(null);\n  const govSpritesRef = useRef<HTMLImageElement | null>(null);\n  // hit (target) spritesheet (25 frames)\n  const hitSpritesRef = useRef<HTMLImageElement | null>(null);\n  // sprite animation state keyed by slot-key (player.lane.index)\n  const govSpriteStateRef = useRef<Record<string, { started: number; frameCount: number; frameDuration: number }>>({});\n  const instantSpritesRef = useRef<HTMLImageElement | null>(null);\n  const instantSpriteStateRef = useRef<Record<string, { started: number; frameCount: number; frameDuration: number }>>({});\n\n  const hitSpriteStateRef = useRef<Record<string, { started: number; frameCount: number; frameDuration: number }>>({});\n\n  // Corruption (Bestechungsskandal) target selection mode\n  const corruptionSelectActorRef = useRef<Player | null>(null);\n  const gameStateRef = useRef<GameState>(gameState);\n  useEffect(() => { gameStateRef.current = gameState; }, [gameState]);\n  useEffect(() => {\n    const onEnterCorruptionSelect = (ev: any) => {\n      try {\n        const actor = ev.detail?.player as Player | undefined;\n        console.log('🔥 GAMECANVAS RECEIVED pc:corruption_select_target - Actor:', actor);\n        corruptionSelectActorRef.current = actor ?? null;\n        console.log('🔥 SET corruptionSelectActorRef.current:', corruptionSelectActorRef.current);\n      } catch (e) {\n        console.error('🔥 ERROR in corruption select handler:', e);\n      }\n    };\n    window.addEventListener('pc:corruption_select_target', onEnterCorruptionSelect as EventListener);\n    // Keyboard hotkeys 1-5 to choose opponent government slot when corruption select is active\n    const onKeyDown = (ev: KeyboardEvent) => {\n      try {\n        const k = ev.key;\n        if (!['1','2','3','4','5'].includes(k)) return;\n        const actor = corruptionSelectActorRef.current;\n        if (!actor) return;\n        const victim = actor === 1 ? 2 : 1;\n        const idx = Number(k) - 1; // map '1' -> slot 0\n        const gs = gameStateRef.current as any;\n        const card = gs?.board?.[victim]?.aussen?.[idx];\n        console.debug('[CORR][KEY] pressed', k, 'actor', actor, 'victim', victim, 'idx', idx, 'card', card);\n        if (!card) return;\n        const uid = card.uid ?? card.id;\n        if (!uid) return;\n        console.debug('[CORR][KEY] dispatching pick_target for uid', uid);\n        window.dispatchEvent(new CustomEvent('pc:corruption_pick_target', { detail: { player: actor, targetUid: uid } }));\n        try {\n          console.debug('[CORR][KEY] dispatching target_selected for uid', uid);\n          window.dispatchEvent(new CustomEvent('pc:corruption_target_selected', { detail: { player: actor, targetUid: uid } }));\n        } catch(e) { console.debug('[CORR][KEY] target_selected dispatch error', e); }\n        ev.preventDefault();\n      } catch(e) {}\n    };\n    window.addEventListener('keydown', onKeyDown as EventListener);\n    return () => {\n      window.removeEventListener('pc:corruption_select_target', onEnterCorruptionSelect as EventListener);\n      window.removeEventListener('keydown', onKeyDown as EventListener);\n    };\n  }, []);\n\n  // Maulwurf corruption target selection mode\n  const maulwurfSelectActorRef = useRef<Player | null>(null);\n  useEffect(() => {\n    const onEnterMaulwurfSelect = (ev: any) => {\n      try {\n        const actor = ev.detail?.player as Player | undefined;\n        const targetUid = ev.detail?.targetUid as number | undefined;\n        const requiredRoll = ev.detail?.requiredRoll as number | undefined;\n        const targetName = ev.detail?.targetName as string | undefined;\n        console.log('🔥 GAMECANVAS RECEIVED pc:maulwurf_select_target - Actor:', actor, 'Target:', targetName, 'Required:', requiredRoll);\n        maulwurfSelectActorRef.current = actor ?? null;\n\n        // Show modal for dice roll\n        const el = document.createElement('div');\n        el.id = 'pc-maulwurf-modal';\n        el.style.cssText = 'position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:10000;';\n        el.style.fontSize = '14px';\n        document.body.appendChild(el);\n\n        el.innerHTML = `<div style=\"display:flex;flex-direction:column;gap:8px;min-width:260px;\">\n          <div style=\"font-weight:700\">Maulwurf — Ziel automatisch gewählt</div>\n          <div>Gewähltes Ziel: <b>${targetName || 'Unbekannt'}</b></div>\n          <div>Probe: W6 ≥ ${requiredRoll || 2} (2 + Anzahl Regierungskarten)</div>\n          <div style=\"display:flex;gap:8px;justify-content:flex-end;\">\n            <button id=\"pc-maulwurf-roll\" style=\"background:#2563eb;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\">Würfeln</button>\n            <button id=\"pc-maulwurf-cancel\" style=\"background:#374151;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\">Abbrechen</button>\n          </div>\n        </div>`;\n\n        // Event listeners for buttons\n        const rollBtn = el.querySelector('#pc-maulwurf-roll');\n        const cancelBtn = el.querySelector('#pc-maulwurf-cancel');\n\n        if (rollBtn) {\n          rollBtn.addEventListener('click', () => {\n            try {\n              window.dispatchEvent(new CustomEvent('pc:maulwurf_request_roll', {\n                detail: { player: actor, targetUid }\n              }));\n              document.body.removeChild(el);\n            } catch (e) {\n              console.error('Maulwurf roll button error:', e);\n            }\n          });\n        }\n\n        if (cancelBtn) {\n          cancelBtn.addEventListener('click', () => {\n            try {\n              document.body.removeChild(el);\n              // Clear pending selection\n              if (typeof window !== 'undefined') {\n                window.dispatchEvent(new CustomEvent('pc:clear_pending_selection'));\n              }\n            } catch (e) {\n              console.error('Maulwurf cancel button error:', e);\n            }\n          });\n        }\n      } catch (e) {\n        console.error('🔥 ERROR in maulwurf select handler:', e);\n      }\n    };\n\n    window.addEventListener('pc:maulwurf_select_target', onEnterMaulwurfSelect as EventListener);\n\n    return () => {\n      window.removeEventListener('pc:maulwurf_select_target', onEnterMaulwurfSelect as EventListener);\n    };\n  }, []);\n\n  // Tunnelvision probe mode\n  const tunnelvisionProbeActorRef = useRef<Player | null>(null);\n  useEffect(() => {\n    const onEnterTunnelvisionProbe = (ev: any) => {\n      try {\n        const actor = ev.detail?.player as Player | undefined;\n        const targetUid = ev.detail?.targetUid as number | undefined;\n        const requiredRoll = ev.detail?.requiredRoll as number | undefined;\n        const influence = ev.detail?.influence as number | undefined;\n        console.log('🔥 GAMECANVAS RECEIVED pc:tunnelvision_probe_start - Actor:', actor, 'Target:', targetUid, 'Required:', requiredRoll, 'Influence:', influence);\n        tunnelvisionProbeActorRef.current = actor ?? null;\n        console.log('🔥 SET tunnelvisionProbeActorRef.current:', tunnelvisionProbeActorRef.current);\n\n        // Create modal for tunnelvision probe\n        const el = document.getElementById('pc-modal-root');\n        if (!el) return;\n\n        el.innerHTML = `<div style=\"display:flex;flex-direction:column;gap:8px;min-width:280px;\">\n          <div style=\"font-weight:700\">Tunnelvision — Regierungskarte Probe</div>\n          <div>Einfluss: <b>${influence || 'Unbekannt'}</b></div>\n          <div>Probe: W6 ≥ ${requiredRoll || 4} ${(influence || 0) >= 9 ? '(Einfluss 9+)' : '(Standard)'}</div>\n          <div style=\"font-size:12px;color:#666;\">Bei Misserfolg: 2-3 Karte bleibt in Hand, 1 kritischer Misserfolg entfernt Karte dauerhaft</div>\n          <div style=\"display:flex;gap:8px;justify-content:flex-end;\">\n            <button id=\"pc-tunnelvision-roll\" style=\"background:#2563eb;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\">Würfeln</button>\n            <button id=\"pc-tunnelvision-cancel\" style=\"background:#374151;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\">Abbrechen</button>\n          </div>\n        </div>`;\n\n        // Add event listeners for buttons\n        const rollBtn = document.getElementById('pc-tunnelvision-roll');\n        const cancelBtn = document.getElementById('pc-tunnelvision-cancel');\n\n        if (rollBtn) {\n          rollBtn.onclick = () => {\n            try {\n              window.dispatchEvent(new CustomEvent('pc:tunnelvision_request_roll', {\n                detail: { player: actor, targetUid, requiredRoll, influence }\n              }));\n              el.innerHTML = '';\n            } catch (e) {\n              console.error('Error dispatching tunnelvision request roll:', e);\n            }\n          };\n        }\n\n        if (cancelBtn) {\n          cancelBtn.onclick = () => {\n            el.innerHTML = '';\n            // Cancel the probe - card stays in hand\n            try {\n              window.dispatchEvent(new CustomEvent('pc:tunnelvision_request_roll', {\n                detail: { player: actor, targetUid, requiredRoll, influence, cancel: true }\n              }));\n            } catch (e) {\n              console.error('Error canceling tunnelvision probe:', e);\n            }\n          };\n        }\n      } catch (e) {\n        console.error('🔥 ERROR in tunnelvision probe handler:', e);\n      }\n    };\n\n    window.addEventListener('pc:tunnelvision_probe_start', onEnterTunnelvisionProbe as EventListener);\n\n    return () => {\n      window.removeEventListener('pc:tunnelvision_probe_start', onEnterTunnelvisionProbe as EventListener);\n    };\n  }, []);\n\n  // Helper: draw slot icons with uniform pulsing opacity and a light reflection\n  const drawSlotIconWithPulse = useCallback((ctx: CanvasRenderingContext2D, img: HTMLImageElement | undefined, x: number, y: number, w: number, h: number, phase = 0) => {\n    if (!img || !img.complete) return;\n    try {\n      const now = performance.now();\n      const base = 0.10; // base opacity\n      const pulseRange = 0.08; // pulse amplitude (-> up to base + pulseRange)\n      const period = 700; // ms\n      const pulse = base + pulseRange * (0.5 + 0.5 * Math.sin(now / period + phase));\n\n      // draw icon with pulsing alpha\n      ctx.save();\n      ctx.globalAlpha = pulse;\n      ctx.drawImage(img, x, y, w, h);\n\n      // subtle reflection: gradient overlay on top half\n      const grad = ctx.createLinearGradient(x, y, x, y + h * 0.5);\n      grad.addColorStop(0, `rgba(255,255,255,${0.18 * pulse})`);\n      grad.addColorStop(1, `rgba(255,255,255,0)`);\n      ctx.globalCompositeOperation = 'lighter';\n      ctx.fillStyle = grad as any;\n      ctx.fillRect(x, y, w, h * 0.5);\n\n      ctx.restore();\n    } catch (e) {\n      // silent fallback\n    }\n  }, []);\n\n  // Load influence icon once\n  useEffect(() => {\n    const img = new Image();\n    img.src = influenceIconUrl;\n    influenceImgRef.current = img;\n  }, []);\n\n\n  const drawCardAt = useCallback((\n    ctx: CanvasRenderingContext2D,\n    card: Card,\n    x: number,\n    y: number,\n    size: number,\n    selected: boolean = false,\n    showAPCost: boolean = false,\n    player?: Player\n  ) => {\n    // Apply per-card fade-in if a play animation is active for this uid\n    let extraAlpha = 1;\n    try {\n      const uid = (card as any).uid ?? (card as any).id;\n      const list = (visualEffects && visualEffects.playAnimsRef && visualEffects.playAnimsRef.current) || (window as any).__pc_play_anims || [];\n      const anim = list.find((a: any) => a.uid === uid);\n      if (anim) {\n        const p = Math.min(1, Math.max(0, (performance.now() - anim.started) / anim.duration));\n        // ease-out\n        extraAlpha = Math.pow(p, 2);\n      }\n    } catch (e) {}\n    let dx = x, dy = y, s = size;\n    if (selected) {\n      s = Math.floor(size * 1.05);\n      dx = x - Math.floor((s - size) / 2);\n      dy = y - Math.floor((s - size) / 2);\n    }\n\n    // Note: pulse overlay is drawn at top layer after all cards are rendered\n\n    // Draw card image with caching to prevent flicker in continuous loop\n    const src = getCardImagePath(card, 'ui');\n    const cached = imageCacheRef.current.get(src);\n    ctx.save();\n    ctx.globalAlpha = extraAlpha;\n    if (cached && cached.complete && cached.naturalWidth > 0) {\n      ctx.drawImage(cached, dx, dy, s, s);\n    } else {\n      const img = new Image();\n      img.onload = () => {\n        imageCacheRef.current.set(src, img);\n        // Note: onload happens async; draw will occur on next frame\n        // don't draw here into stale ctx\n      };\n      img.src = src;\n      imageCacheRef.current.set(src, img);\n    }\n\n    ctx.restore();\n\n    // Status-Indikatoren (für alle Board-Karten)\n    // Einfluss-Wert dauerhaft anzeigen (oben links) – nur für Regierungskarten\n    if ((card as any).kind === 'pol') {\n      const barH = Math.max(20, Math.floor(s * 0.12) + 6);\n      ctx.fillStyle = 'rgba(0,0,0,0.6)';\n      ctx.fillRect(dx, dy + s - barH, s, barH);\n\n      ctx.fillStyle = '#ffffff';\n      const fontSize = Math.floor(s * 0.12);\n      ctx.font = `bold ${fontSize}px sans-serif`;\n      ctx.textAlign = 'left';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(`${(card as any).influence ?? 0}`, dx + 8, dy + s - barH / 2);\n    }\n    // Schutz-Status (blauer Punkt)\n    if ((card as any).protected || ((card as any).shield ?? 0) > 0) {\n      ctx.fillStyle = '#1da1f2';\n      ctx.fillRect(dx + s - 22, dy + 6, 16, 16);\n    }\n    // Deaktiviert-Status (roter Punkt)\n    if ((card as any).deactivated) {\n      ctx.fillStyle = '#b63838';\n      ctx.fillRect(dx + s - 22, dy + 26, 16, 16);\n    }\n\n    // Einfluss-Badge für Handkarten oben rechts (nur Regierungskarten)\n    if (showAPCost && player && (card as any).kind === 'pol') {\n      const badgeHeight = Math.max(16, Math.floor(s * 0.12));\n      const badgeWidth = badgeHeight * 2;\n      const badgeX = dx + s - badgeWidth - 6;\n      const badgeY = dy + 6;\n\n      // Semi-transparent dunkler Hintergrund\n      ctx.fillStyle = 'rgba(0,0,0,0.6)';\n      ctx.beginPath();\n      ctx.roundRect(badgeX, badgeY, badgeWidth, badgeHeight, badgeHeight / 2);\n      ctx.fill();\n\n      // Influence icon (90% opacity) links im Badge\n      if (influenceImgRef.current && influenceImgRef.current.complete) {\n        ctx.globalAlpha = 0.9;\n        ctx.drawImage(influenceImgRef.current, badgeX + 2, badgeY + 2, badgeHeight - 4, badgeHeight - 4);\n        ctx.globalAlpha = 1;\n      }\n\n      // Influence number rechts im Badge\n      ctx.fillStyle = '#ffffff';\n      ctx.font = `bold ${Math.floor(badgeHeight * 0.5)}px sans-serif`;\n      ctx.textAlign = 'right';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(`${(card as any).influence ?? 0}`, badgeX + badgeWidth - 4, badgeY + badgeHeight / 2);\n\n      // Reset align\n      ctx.textAlign = 'start';\n      ctx.textBaseline = 'alphabetic';\n    }\n\n    // NOTE: influence overlays (pulse + labels) are drawn in a separate pass\n\n    // Auswahl-Rahmen\n    if (selected) {\n      ctx.strokeStyle = '#61dafb';\n      ctx.lineWidth = 3;\n      ctx.strokeRect(dx + 1, dy + 1, s - 2, s - 2);\n      ctx.lineWidth = 1;\n    }\n\n    // Return exact 256x256 click zone over the card\n    // Since all cards are 256x256, the click zone should match exactly\n    return { x: dx, y: dy, w: 256, h: 256 };\n  }, [gameState]);\n\n\n\n\n\n\n\n  // Slot-Benennungs-Funktion basierend auf Glossar\n  const getSlotDisplayName = useCallback((zoneId: string, index: number, player: Player): string => {\n    const slotNumber = index + 1;\n\n    if (zoneId.includes('government')) {\n      if (zoneId.includes('player')) {\n        return `Regierungsreihe Slot ${slotNumber}`;\n      } else {\n        return `Gegner Regierung Slot ${slotNumber}`;\n      }\n    } else if (zoneId.includes('public')) {\n      if (zoneId.includes('player')) {\n        return `Öffentlichkeitsreihe Slot ${slotNumber}`;\n      } else {\n        return `Gegner Öffentlichkeit Slot ${slotNumber}`;\n      }\n    } else if (zoneId.includes('permanent.government')) {\n      if (zoneId.includes('player')) {\n        return 'Regierung Spezial-Slot';\n      } else {\n        return 'Gegner Regierung Spezial-Slot';\n      }\n    } else if (zoneId.includes('permanent.public')) {\n      if (zoneId.includes('player')) {\n        return 'Öffentlichkeit Spezial-Slot';\n      } else {\n        return 'Gegner Öffentlichkeit Spezial-Slot';\n      }\n    } else if (zoneId.includes('instant')) {\n      if (zoneId.includes('player')) {\n        return 'Sofort-Slot';\n      } else {\n        return 'Gegner Sofort-Slot';\n      }\n    } else if (zoneId.includes('hand')) {\n      return 'Hand';\n    } else if (zoneId.includes('interventions')) {\n      return 'Interventionen';\n    }\n\n    return `Slot ${slotNumber}`;\n  }, []);\n\n  const drawLane = useCallback((\n    ctx: CanvasRenderingContext2D,\n    zoneId: string,\n    player: Player,\n    lane: Lane,\n    clickable: boolean\n  ) => {\n    const zone = getZone(zoneId);\n    if (!zone) return;\n\n    const slots = computeSlotRects(zone);\n    const arr = gameState.board[player][lane];\n\n    slots.forEach((s, idx) => {\n      const card = arr[idx];\n\n      // Hintergrundfarbe nach Kategorie\n      let bgColor = 'rgba(0,0,0,0.1)'; // Standard\n      if (zoneId.includes('government')) {\n        bgColor = 'rgba(255, 197, 0, 0.15)'; // Hellgelb für Regierung\n      } else if (zoneId.includes('public')) {\n        bgColor = 'rgba(0, 255, 0, 0.15)'; // Hellgrün für Öffentlichkeit\n      }\n\n      ctx.fillStyle = bgColor;\n      ctx.fillRect(s.x, s.y, s.w, s.h);\n\n      // Slot-Rahmen\n      ctx.strokeStyle = 'rgba(255,255,255,0.06)';\n      ctx.strokeRect(s.x + 0.5, s.y + 0.5, s.w - 1, s.h - 1);\n\n      if (card) {\n        const isSelected = player === 1 && selectedHandIndex !== null && gameState.hands[1][selectedHandIndex] === card;\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, isSelected, false);\n\n        // Kartenname unter dem Slot anzeigen\n        ctx.fillStyle = 'rgba(255,255,255,0.9)';\n        ctx.font = 'bold 12px sans-serif';\n        ctx.textAlign = 'center';\n        const textY = s.y + s.h + 16;\n        ctx.fillText(card.name, s.x + s.w/2, textY);\n\n        clickZonesRef.current.push({\n          ...clickZone,\n          data: { type: 'board_card', player, lane, index: idx, card }\n        });\n      } else if (clickable && gameState.current === player) {\n        // Slot-Benennung anzeigen (für den aktuellen Spieler)\n        const slotName = getSlotDisplayName(zoneId, idx, player);\n        ctx.fillStyle = 'rgba(255,255,255,0.6)';\n        ctx.font = '11px sans-serif';\n        ctx.textAlign = 'center';\n        const textY = s.y + s.h/2;\n        ctx.fillText(slotName, s.x + s.w/2, textY);\n\n        clickZonesRef.current.push({\n          x: s.x, y: s.y, w: s.w, h: s.h,\n          data: { type: 'row_slot', lane, index: idx }\n        });\n      }\n    });\n  }, [gameState, selectedHandIndex, drawCardAt, getSlotDisplayName]);\n\n  const drawHandP1 = useCallback((ctx: CanvasRenderingContext2D) => {\n    const hand = sortHandCards(gameState.hands[1]);\n    const zone = getZone('hand.player');\n    if (!zone) return;\n\n    const slots = computeSlotRects(zone);\n    // Apply smooth offset (lerp towards target)\n    const target = handScrollTargetRef.current;\n    handScrollCurrentRef.current += (target - handScrollCurrentRef.current) * 0.15; // easing\n    const offsetY = Math.round(handScrollCurrentRef.current);\n    slots.forEach((s: { x: number; y: number; w: number; h: number }, i: number) => {\n      const card = hand[i];\n      if (!card) return;\n      // Find original index in unsorted hand for click handling\n      const originalIndex = gameState.hands[1].findIndex(c => c.uid === card.uid);\n      const isSel = selectedHandIndex === originalIndex;\n      // apply vertical offset\n      const sx = s.x;\n      const sy = s.y + offsetY;\n      const clickZone = drawCardAt(ctx, card, sx, sy, s.w, isSel, true, 1); // Show AP cost for player 1 hand\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'hand_p1', index: originalIndex, card } });\n    });\n  }, [gameState.hands, selectedHandIndex, drawCardAt]);\n\n      // 🔧 DEV MODE: Player 2 Hand (rechts unten, kompakter)\n  const drawHandP2 = useCallback((ctx: CanvasRenderingContext2D) => {\n    const hand = sortHandCards(gameState.hands[2]);\n    const zone = getZone('hand.opponent');\n    if (!zone) return;\n\n    const slots = computeSlotRects(zone);\n\n    // Hintergrund für P2 Hand\n    const [x, y, w, h] = zone.rectPx;\n    ctx.fillStyle = 'rgba(255, 100, 100, 0.15)'; // Rötlicher Hintergrund für P2\n    ctx.fillRect(x, y, w, h);\n    ctx.strokeStyle = 'rgba(255, 100, 100, 0.3)';\n    ctx.strokeRect(x + 0.5, y + 0.5, w - 1, h - 1);\n\n    // Label für P2 Hand\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.font = 'bold 14px sans-serif';\n    ctx.textAlign = 'center';\n    ctx.fillText('Player 2 Hand', x + w/2, y - 8);\n\n    slots.forEach((s: { x: number; y: number; w: number; h: number }, i: number) => {\n      const card = hand[i];\n      if (!card) return;\n      // Find original index in unsorted hand for click handling\n      const originalIndex = gameState.hands[2].findIndex(c => c.uid === card.uid);\n      const isSel = gameState.current === 2 && selectedHandIndex === originalIndex;\n      const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, isSel, true, 2); // Show AP cost for player 2 hand\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'hand_p2', index: originalIndex, card } });\n    });\n  }, [gameState, selectedHandIndex, drawCardAt]);\n  // Interventions strip (player traps)\n  const drawInterventionsP1 = useCallback((ctx: CanvasRenderingContext2D) => {\n    const traps = gameState.traps[1] || [];\n    const zone = getZone('interventions.player');\n    if (!zone) return;\n\n    // Single intervention slot\n    const [zx, zy, zw, zh] = zone.rectPx;\n    const card = traps[0]; // Only first trap\n\n    // Hintergrund für Interventions-Slot\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.15)'; // Lavendelfarben für Interventionen\n    ctx.fillRect(zx, zy, zw, zh);\n    ctx.strokeStyle = 'rgba(200, 160, 255, 0.3)';\n    ctx.strokeRect(zx + 0.5, zy + 0.5, zw - 1, zh - 1);\n\n    // Slot-Benennung für Interventions-Slot\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.8)';\n    ctx.font = '11px sans-serif';\n    ctx.textAlign = 'left';\n    ctx.fillText('Intervention', zx + 8, zy + zh - 6);\n\n    if (card) {\n      const clickZone = drawCardAt(ctx, card, zx, zy, zw, false, false);\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'trap_p1', index: 0, card } });\n    }\n  }, [gameState.traps, drawCardAt]);\n\n  // Interventions strip (opponent traps)\n  const drawInterventionsP2 = useCallback((ctx: CanvasRenderingContext2D) => {\n    const traps = gameState.traps[2] || [];\n    const zone = getZone('interventions.opponent');\n    if (!zone) return;\n\n    // Single intervention slot\n    const [zx, zy, zw, zh] = zone.rectPx;\n    const card = traps[0]; // Only first trap\n\n    // Hintergrund für Interventions-Slot\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.15)'; // Lavendelfarben für Interventionen\n    ctx.fillRect(zx, zy, zw, zh);\n    ctx.strokeStyle = 'rgba(200, 160, 255, 0.3)';\n    ctx.strokeRect(zx + 0.5, zy + 0.5, zw - 1, zh - 1);\n\n    // Slot-Benennung für Interventions-Slot\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.8)';\n    ctx.font = '11px sans-serif';\n    ctx.textAlign = 'left';\n    ctx.fillText('Intervention', zx + 8, zy + zh - 6);\n\n    if (card) {\n      const clickZone = drawCardAt(ctx, card, zx, zy, zw, false, false);\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'trap_p2', index: 0, card } });\n    }\n  }, [gameState.traps, drawCardAt]);\n\n  // Single slot drawing function\n  const drawSingleSlot = useCallback((\n    ctx: CanvasRenderingContext2D,\n    zoneId: string,\n    card: Card | null,\n    clickType: string,\n    player: Player\n  ) => {\n    const zone = getZone(zoneId);\n    if (!zone) return;\n    const [x, y, w, h] = zone.rectPx;\n\n    // Hintergrundfarbe nach Kategorie\n    let bgColor = 'rgba(0,0,0,0.1)'; // Standard\n    if (zoneId.includes('government')) {\n      bgColor = 'rgba(255, 197, 0, 0.15)'; // Hellgelb für Regierung\n    } else if (zoneId.includes('public')) {\n      bgColor = 'rgba(0, 255, 0, 0.15)'; // Hellgrün für Öffentlichkeit\n    } else if (zoneId.includes('instant')) {\n      bgColor = 'rgba(127, 116, 91, 0.15)'; // Neutral für Sofort-Slots\n    } else if (zoneId.includes('permanent')) {\n      // Unterscheide zwischen government und public permanent slots\n      if (zoneId.includes('government')) {\n        bgColor = 'rgba(255, 197, 0, 0.15)';\n      } else if (zoneId.includes('public')) {\n        bgColor = 'rgba(0, 255, 0, 0.15)';\n      }\n    }\n\n    ctx.fillStyle = bgColor;\n    ctx.fillRect(x, y, w, h);\n\n    // Draw slot border\n    ctx.strokeStyle = 'rgba(255,255,255,0.06)';\n    ctx.strokeRect(x + 0.5, y + 0.5, w - 1, h - 1);\n\n    if (card) {\n      const isSelected = player === 1 && selectedHandIndex !== null && gameState.hands[1][selectedHandIndex] === card;\n      const clickZone = drawCardAt(ctx, card, x, y, w, isSelected, false);\n\n      // Kartenname unter dem Slot anzeigen\n      ctx.fillStyle = 'rgba(255,255,255,0.9)';\n      ctx.font = 'bold 12px sans-serif';\n      ctx.textAlign = 'center';\n      const textY = y + h + 16;\n      ctx.fillText(card.name, x + w/2, textY);\n\n      // Register click zone for the card - always in dev mode, otherwise only for current player\n      if (devMode || player === gameState.current) {\n        clickZonesRef.current.push({ ...clickZone, data: { type: 'slot_card', slot: clickType, player, card } });\n      }\n\n      // 🔧 NEU: Sofort-Initiative-Slots sind immer klickbar für Aktivierung (handled by activateInstantInitiative)\n      if (clickType === 'instant') {\n        clickZonesRef.current.push({\n          x, y, w, h,\n          data: { type: 'activate_instant', player, card }\n        });\n      }\n    } else if (gameState.current === player || devMode) {\n      // Slot-Benennung für leere Slots anzeigen (für den aktuellen Spieler oder im Dev Mode)\n      const slotName = getSlotDisplayName(zoneId, 0, player);\n      ctx.fillStyle = 'rgba(255,255,255,0.6)';\n      ctx.font = '11px sans-serif';\n      ctx.textAlign = 'center';\n      const textY = y + h/2;\n      ctx.fillText(slotName, x + w/2, textY);\n\n      clickZonesRef.current.push({ x, y, w, h, data: { type: 'empty_slot', slot: clickType, player } });\n    }\n  }, [selectedHandIndex, gameState, drawCardAt, getSlotDisplayName, devMode]);\n\n  // Small UI hook: show a lightweight corruption modal overlay when a target is selected\n  useEffect(() => {\n    const onTargetSelected = (ev: any) => {\n      const { player, targetUid } = ev.detail || {};\n      if (!player || !targetUid) return;\n      // create transient overlay element if not present\n      try {\n        const id = 'pc-corruption-modal';\n        let el = document.getElementById(id);\n        if (!el) {\n          el = document.createElement('div');\n          el.id = id;\n          el.style.position = 'fixed';\n          el.style.left = '50%';\n          el.style.top = '40%';\n          el.style.transform = 'translate(-50%, -50%)';\n          el.style.padding = '12px 16px';\n          el.style.background = 'rgba(6,10,15,0.9)';\n          el.style.border = '1px solid rgba(255,255,255,0.12)';\n          el.style.borderRadius = '8px';\n          el.style.zIndex = '3000';\n          el.style.color = '#e5e7eb';\n          el.style.fontFamily = 'monospace';\n          el.style.fontSize = '14px';\n          document.body.appendChild(el);\n        }\n        const card = (gameState as any).board?.[player === 1 ? 1 : 2]?.aussen?.find((c:any)=>c.uid===targetUid) || (gameState as any).board?.[player === 1 ? 2 : 1]?.aussen?.find((c:any)=>c.uid===targetUid);\n        el.innerHTML = `<div style=\"display:flex;flex-direction:column;gap:8px;min-width:260px;\">\n          <div style=\"font-weight:700\">Bestechungsskandal 2.0 — Ziel gewählt</div>\n          <div>Gewähltes Ziel: <b>${card ? card.name : 'UID '+targetUid}</b></div>\n          <div>Probe: W6 ≥ Einfluss (inkl. Oligarch-Bonus)</div>\n          <div style=\"display:flex;gap:8px;justify-content:flex-end;\">\n            <button id=\"pc-corruption-roll\" style=\"background:#2563eb;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\">Würfeln</button>\n            <button id=\"pc-corruption-cancel\" style=\"background:#374151;color:white;border:none;padding:6px 10px;border-radius:6px;cursor:pointer;\">Abbrechen</button>\n          </div>\n        </div>`;\n\n        const rollBtn = document.getElementById('pc-corruption-roll');\n        const cancelBtn = document.getElementById('pc-corruption-cancel');\n        if (rollBtn) {\n          rollBtn.onclick = () => {\n            try {\n              console.log('🔥 CORRUPTION WÜRFELN CLICKED - triggering dice roll');\n              // Trigger the dice component to roll\n              window.dispatchEvent(new CustomEvent('pc:ui_request_dice_roll', { detail: { player, targetUid } }));\n              window.dispatchEvent(new CustomEvent('pc:corruption_request_roll', { detail: { player, targetUid } }));\n            } catch(e) {\n              console.error('🔥 ERROR triggering dice roll:', e);\n            }\n            // disable until result\n            (rollBtn as HTMLButtonElement).disabled = true;\n            (rollBtn as HTMLButtonElement).innerText = 'Würfelt...';\n          };\n        }\n        if (cancelBtn) {\n          cancelBtn.onclick = () => {\n            el!.remove();\n          };\n        }\n      } catch (e) { console.debug('corruption modal create failed', e); }\n    };\n\n    window.addEventListener('pc:corruption_target_selected', onTargetSelected as EventListener);\n    return () => window.removeEventListener('pc:corruption_target_selected', onTargetSelected as EventListener);\n  }, [gameState]);\n\n  // Draw permanent slots for player\n  const drawPermanentSlotsP1 = useCallback((ctx: CanvasRenderingContext2D) => {\n    drawSingleSlot(ctx, 'slot.permanent.government.player', gameState.permanentSlots[1].government, 'permanent_government', 1);\n    drawSingleSlot(ctx, 'slot.permanent.public.player', gameState.permanentSlots[1].public, 'permanent_public', 1);\n  }, [gameState.permanentSlots, drawSingleSlot]);\n\n  // Draw permanent slots for opponent\n  const drawPermanentSlotsP2 = useCallback((ctx: CanvasRenderingContext2D) => {\n    drawSingleSlot(ctx, 'slot.permanent.government.opponent', gameState.permanentSlots[2].government, 'permanent_government', 2);\n    drawSingleSlot(ctx, 'slot.permanent.public.opponent', gameState.permanentSlots[2].public, 'permanent_public', 2);\n  }, [gameState.permanentSlots, drawSingleSlot]);\n\n  // Draw instant slots\n  const drawInstantSlots = useCallback((ctx: CanvasRenderingContext2D) => {\n    // Sofort-Initiative-Slots aus dem Board zeichnen\n    const sofortPlayerCard = gameState.board[1].sofort[0];\n    const sofortOppCard = gameState.board[2].sofort[0];\n\n    drawSingleSlot(ctx, 'slot.instant.player', sofortPlayerCard, 'instant', 1);\n    drawSingleSlot(ctx, 'slot.instant.opponent', sofortOppCard, 'instant', 2);\n  }, [gameState.board, drawSingleSlot]);\n\n  // Aktive Schlüsselwörter und Unterkategorien ermitteln\n  const getActiveKeywordsAndSubcategories = useCallback((player: Player) => {\n    const board = gameState.board[player];\n    const permanentSlots = gameState.permanentSlots[player];\n    const allCards = [\n      ...board.innen,\n      ...board.aussen,\n      permanentSlots.government,\n      permanentSlots.public\n    ].filter(c => c && c.kind === 'pol') as PoliticianCard[];\n\n    const keywords = new Set<string>();\n    const subcategories = new Set<string>();\n\n    allCards.forEach(card => {\n      if (!card.deactivated) {\n        // Regierungskarten-Schlüsselwörter\n        if (card.tag === 'Leadership') {\n          keywords.add('Leadership');\n        }\n        if (card.tag === 'Diplomat') {\n          keywords.add('Diplomat');\n        }\n\n        // Öffentlichkeits-Unterkategorien (für Karten in Öffentlichkeitsreihe)\n        if (board.innen.includes(card)) {\n          const publicCard = card as any;\n          if (publicCard.tag) {\n            // Oligarch\n            const oligarchNames = ['Elon Musk', 'Bill Gates', 'George Soros', 'Warren Buffett', 'Mukesh Ambani', 'Jeff Bezos', 'Alisher Usmanov', 'Gautam Adani', 'Jack Ma', 'Zhang Yiming', 'Roman Abramovich'];\n            if (oligarchNames.includes(publicCard.name)) {\n              subcategories.add('Oligarch');\n            }\n\n            // Plattform\n            const platformNames = ['Mark Zuckerberg', 'Tim Cook', 'Sam Altman', 'Jack Ma'];\n            if (platformNames.includes(publicCard.name)) {\n              subcategories.add('Plattform');\n            }\n\n            // Bewegung\n            const movementNames = ['Greta Thunberg', 'Malala Yousafzai', 'Ai Weiwei', 'Alexei Navalny'];\n            if (movementNames.includes(publicCard.name)) {\n              subcategories.add('Bewegung');\n            }\n\n            // NGO/Think-Tank\n            const ngoNames = ['Bill Gates', 'George Soros', 'Jennifer Doudna', 'Noam Chomsky', 'Anthony Fauci'];\n            if (ngoNames.includes(publicCard.name)) {\n              subcategories.add('NGO/Think-Tank');\n            }\n\n            // Intelligenz\n            const intelligenceNames = ['Jennifer Doudna', 'Noam Chomsky', 'Edward Snowden', 'Julian Assange', 'Yuval Noah Harari', 'Ai Weiwei', 'Alexei Navalny', 'Anthony Fauci'];\n            if (intelligenceNames.includes(publicCard.name)) {\n              subcategories.add('Intelligenz');\n            }\n\n            // Medien\n            const mediaNames = ['Oprah Winfrey'];\n            if (mediaNames.includes(publicCard.name)) {\n              subcategories.add('Medien');\n            }\n          }\n        }\n      }\n    });\n\n    return {\n      keywords: Array.from(keywords),\n      subcategories: Array.from(subcategories)\n    };\n  }, [gameState]);\n\n  // Info-Panels zeichnen\n  const drawInfoPanels = useCallback((ctx: CanvasRenderingContext2D) => {\n    const { keywords, subcategories } = getActiveKeywordsAndSubcategories(1);\n\n    // Panel für Regierungsschlüsselwörter (rechts neben Regierungsslots)\n    const govPanelX = 1640 + 256 + 20; // Nach dem letzten permanenten Slot\n    const govPanelY = 300; // Auf Höhe der Regierungsslots\n    const govPanelW = 120;\n    const govPanelH = 256;\n\n    // Regierungspanel Hintergrund\n    ctx.fillStyle = 'rgba(255, 197, 0, 0.15)';\n    ctx.fillRect(govPanelX, govPanelY, govPanelW, govPanelH);\n    ctx.strokeStyle = 'rgba(255, 197, 0, 0.3)';\n    ctx.strokeRect(govPanelX + 0.5, govPanelY + 0.5, govPanelW - 1, govPanelH - 1);\n\n    // Regierungspanel Titel\n    ctx.fillStyle = 'rgba(255, 197, 0, 0.9)';\n    ctx.font = 'bold 12px sans-serif';\n    ctx.textAlign = 'center';\n    ctx.fillText('Regierung', govPanelX + govPanelW/2, govPanelY + 16);\n\n    // Schlüsselwörter auflisten\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.font = '11px sans-serif';\n    ctx.textAlign = 'left';\n    if (keywords.length > 0) {\n      keywords.forEach((keyword, idx) => {\n        ctx.fillText(`• ${keyword}`, govPanelX + 8, govPanelY + 36 + idx * 16);\n      });\n    } else {\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';\n      ctx.fillText('Keine aktiven', govPanelX + 8, govPanelY + 36);\n      ctx.fillText('Schlüsselwörter', govPanelX + 8, govPanelY + 52);\n    }\n\n    // Panel für Öffentlichkeits-Unterkategorien (rechts neben Öffentlichkeitsslots)\n    const pubPanelX = 1640 + 256 + 20;\n    const pubPanelY = 580; // Auf Höhe der Öffentlichkeitsslots\n    const pubPanelW = 120;\n    const pubPanelH = 256;\n\n    // Öffentlichkeitspanel Hintergrund\n    ctx.fillStyle = 'rgba(0, 255, 0, 0.15)';\n    ctx.fillRect(pubPanelX, pubPanelY, pubPanelW, pubPanelH);\n    ctx.strokeStyle = 'rgba(0, 255, 0, 0.3)';\n    ctx.strokeRect(pubPanelX + 0.5, pubPanelY + 0.5, pubPanelW - 1, pubPanelH - 1);\n\n    // Öffentlichkeitspanel Titel\n    ctx.fillStyle = 'rgba(0, 255, 0, 0.9)';\n    ctx.font = 'bold 12px sans-serif';\n    ctx.textAlign = 'center';\n    ctx.fillText('Öffentlichkeit', pubPanelX + pubPanelW/2, pubPanelY + 16);\n\n    // Unterkategorien auflisten\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.font = '11px sans-serif';\n    ctx.textAlign = 'left';\n    if (subcategories.length > 0) {\n      subcategories.forEach((subcategory, idx) => {\n        const displayName = subcategory.length > 12 ? subcategory.substring(0, 10) + '...' : subcategory;\n        ctx.fillText(`• ${displayName}`, pubPanelX + 8, pubPanelY + 36 + idx * 16);\n      });\n    } else {\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';\n      ctx.fillText('Keine aktiven', pubPanelX + 8, pubPanelY + 36);\n      ctx.fillText('Unterkategorien', pubPanelX + 8, pubPanelY + 52);\n    }\n  }, [getActiveKeywordsAndSubcategories]);\n\n  // Move diagnostics to draw callback to ensure they run after canvas is actually rendered\n  const runDiagnostics = useCallback(() => {\n    try {\n      const handZones = clickZonesRef.current.filter(z => z.data && z.data.type === 'hand_p1');\n      const uiUIDs = handZones.map(z => (z.data.card && (z.data.card.uid ?? z.data.card.id)) ).filter(Boolean);\n      const stateHand = gameState.hands && gameState.hands[1] ? gameState.hands[1] : [];\n      const stateUIDs = stateHand.map((c: any) => c.uid ?? c.id).filter(Boolean);\n\n      const missingInState = uiUIDs.filter((u: any) => !stateUIDs.includes(u));\n      const missingInUI = stateUIDs.filter((u: any) => !uiUIDs.includes(u));\n\n      // Only warn if there are cards in UI that don't exist in state (real error)\n      // Don't warn about missing UI cards due to limited slot capacity\n      if (missingInState.length > 0) {\n        const mismatch = {\n          ts: Date.now(),\n          uiCount: uiUIDs.length,\n          stateCount: stateUIDs.length,\n          uiUIDs,\n          stateUIDs,\n          missingInState,\n          missingInUI,\n          stack: (new Error('mismatch-stack')).stack\n        };\n        (window as any).__politicardDebug = {\n          ...(window as any).__politicardDebug,\n          mismatch: [ ...(window as any).__politicardDebug?.mismatch || [] ].slice(-19).concat([mismatch])\n        };\n        // Clear, then log to console so user can copy/paste trace\n        console.warn('POLITICARD DIAGNOSTIC: hand mismatch detected', mismatch);\n      }\n    } catch (e) {\n      // swallow diagnostic errors to avoid breaking rendering\n      console.error('Diagnostic error', e);\n    }\n  }, [gameState.hands]);\n\n  const draw = useCallback(() => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // Detect influence increases and start animations\n    try {\n      const currSnapshot: Record<string, number> = {};\n      const collect = (c: any) => {\n        if (!c) return;\n        if ((c as any).kind !== 'pol') return;\n        const uid = c.uid ?? (c.id != null ? String(c.id) : null);\n        if (!uid) return;\n        currSnapshot[uid] = (c.influence ?? 0) as number;\n      };\n      // board rows\n      (gameState.board[1].aussen || []).forEach(collect);\n      (gameState.board[2].aussen || []).forEach(collect);\n      (gameState.board[1].innen || []).forEach(collect);\n      (gameState.board[2].innen || []).forEach(collect);\n      // permanent slots\n      collect(gameState.permanentSlots[1].government as any);\n      collect(gameState.permanentSlots[2].government as any);\n      collect(gameState.permanentSlots[1].public as any);\n      collect(gameState.permanentSlots[2].public as any);\n\n      const now = performance.now();\n      Object.keys(currSnapshot).forEach(uid => {\n        const curr = currSnapshot[uid] ?? 0;\n        const prev = prevInfluencesRef.current[uid] ?? curr;\n        if (curr > prev) {\n          const delta = curr - prev;\n          const list = influenceAnimRef.current.get(uid) || [];\n          list.push({ start: now, duration: 900, amount: delta });\n          influenceAnimRef.current.set(uid, list);\n        }\n        prevInfluencesRef.current[uid] = curr;\n      });\n    } catch (e) {\n      // ignore\n    }\n\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Clear click zones\n    clickZonesRef.current = [];\n\n    // Background: prefer PNG if configured\n    if (LAYOUT.background?.enabled && LAYOUT.background?.src) {\n      if (backgroundImageRef.current) {\n        ctx.drawImage(backgroundImageRef.current, 0, 0, canvas.width, canvas.height);\n      } else {\n        ctx.fillStyle = '#0c131b';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n      }\n    } else {\n      ctx.fillStyle = '#0c131b';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n    }\n\n    // Apply UI transform (new signature)\n    const { scale, offsetX, offsetY } = getUiTransform(canvas.width, canvas.height);\n    ctx.save();\n    ctx.translate(offsetX, offsetY);\n    ctx.scale(scale, scale);\n\n    // Draw opponent board (top rows) - clickable im Dev Mode\n    // Draw opponent board using new layout system\n    const opponentPublicRects = getPublicRects('opponent');\n    const opponentGovRects = getGovernmentRects('opponent');\n\n    // Draw opponent public slots\n    opponentPublicRects.forEach((s: { x: number; y: number; w: number; h: number }, idx: number) => {\n      const card = gameState.board[2].innen[idx];\n      if (card) {\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 2);\n        // Register hover/click zone for opponent card (always) - include card for hover info\n        clickZonesRef.current.push({\n          ...clickZone,\n          data: { type: 'board_card', player: 2, lane: 'innen', index: idx, card }\n        });\n      }\n      else {\n        // draw placeholder symbol for empty public slot\n        const img = slotSymbolImgsRef.current.get('public');\n        drawSlotIconWithPulse(ctx, img, s.x, s.y, s.w, s.h, 0.4);\n        // Register empty slot click zone in dev mode\n        if (devMode) {\n          clickZonesRef.current.push({\n            x: s.x, y: s.y, w: s.w, h: s.h,\n            data: { type: 'row_slot', player: 2, lane: 'innen', index: idx }\n          });\n        }\n      }\n    });\n\n    // Draw opponent government slots\n    opponentGovRects.forEach((s: { x: number; y: number; w: number; h: number }, idx: number) => {\n      const card = gameState.board[2].aussen[idx];\n      const corrActive = !!((gameState as any).pendingAbilitySelect && (gameState as any).pendingAbilitySelect.type === 'corruption_steal');\n      if (card) {\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 2);\n        // Register hover/click zone for opponent card (always) - include card for hover info\n        clickZonesRef.current.push({\n          ...clickZone,\n          data: { type: 'board_card', player: 2, lane: 'aussen', index: idx, card }\n        });\n        // When corruption target selection is active, register exact slot rectangle for click detection\n        if (corrActive) {\n          clickZonesRef.current.push({\n            x: s.x,\n            y: s.y,\n            w: s.w,\n            h: s.h,\n            data: { type: 'board_card', player: 2, lane: 'aussen', index: idx, card }\n          });\n        }\n      }\n      else {\n        const img = slotSymbolImgsRef.current.get('government');\n        drawSlotIconWithPulse(ctx, img, s.x, s.y, s.w, s.h, 0.1);\n        // Register empty slot click zone only in dev mode\n        if (devMode) {\n          clickZonesRef.current.push({\n            x: s.x, y: s.y, w: s.w, h: s.h,\n            data: { type: 'row_slot', player: 2, lane: 'aussen', index: idx }\n          });\n        }\n      }\n    });\n\n    // Draw opponent permanent slots (show icons even when not current)\n    try {\n      const permGovZoneOpp = getZone('slot.permanent.government.opponent');\n      if (permGovZoneOpp) {\n        const card = gameState.permanentSlots[2].government;\n        const [ox, oy, ow, oh] = permGovZoneOpp.rectPx;\n        if (card) {\n          drawSingleSlot(ctx, 'slot.permanent.government.opponent', card, 'permanent_government', 2);\n        } else {\n          const img = slotSymbolImgsRef.current.get('dauerhaft');\n          drawSlotIconWithPulse(ctx, img, ox, oy, ow, oh, 0.3);\n          // Register empty slot click zone in dev mode\n          if (devMode) {\n            clickZonesRef.current.push({\n              x: ox, y: oy, w: ow, h: oh,\n              data: { type: 'empty_slot', slot: 'permanent_government', player: 2 }\n            });\n          }\n        }\n      }\n    } catch (e) {}\n    try {\n      const permPubZoneOpp = getZone('slot.permanent.public.opponent');\n      if (permPubZoneOpp) {\n        const card = gameState.permanentSlots[2].public;\n        const [ox2, oy2, ow2, oh2] = permPubZoneOpp.rectPx;\n        if (card) {\n          drawSingleSlot(ctx, 'slot.permanent.public.opponent', card, 'permanent_public', 2);\n        } else {\n          const img = slotSymbolImgsRef.current.get('dauerhaft');\n          drawSlotIconWithPulse(ctx, img, ox2, oy2, ow2, oh2, 0.7);\n          // Register empty slot click zone in dev mode\n          if (devMode) {\n            clickZonesRef.current.push({\n              x: ox2, y: oy2, w: ow2, h: oh2,\n              data: { type: 'empty_slot', slot: 'permanent_public', player: 2 }\n            });\n          }\n        }\n      }\n    } catch (e) {}\n\n    // Draw player board (middle rows)\n    // Draw player board using new layout system\n    const playerPublicRects = getPublicRects('player');\n    const playerGovRects = getGovernmentRects('player');\n\n    // Draw player public slots\n    playerPublicRects.forEach((s: { x: number; y: number; w: number; h: number }, idx: number) => {\n      const card = gameState.board[1].innen[idx];\n      if (card) {\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 1);\n        // register card zone including card so hover panel can show details\n        clickZonesRef.current.push({\n          ...clickZone,\n          data: { type: 'board_card', player: 1, lane: 'innen', index: idx, card }\n        });\n      } else {\n        // Empty slot click zone and draw public symbol\n        // Draw unified pulsing icon for empty public slot\n        const img = slotSymbolImgsRef.current.get('public');\n        drawSlotIconWithPulse(ctx, img, s.x, s.y, s.w, s.h, 0.4);\n        clickZonesRef.current.push({\n          x: s.x, y: s.y, w: s.w, h: s.h,\n          data: { type: 'row_slot', player: 1, lane: 'innen', index: idx }\n        });\n      }\n    });\n\n    // Draw player government slots\n    playerGovRects.forEach((s: { x: number; y: number; w: number; h: number }, idx: number) => {\n      const card = gameState.board[1].aussen[idx];\n      if (card) {\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 1);\n        clickZonesRef.current.push({\n          ...clickZone,\n          data: { type: 'board_card', player: 1, lane: 'aussen', index: idx, card }\n        });\n      } else {\n        // Empty slot click zone and draw government symbol\n        const img = slotSymbolImgsRef.current.get('government');\n        drawSlotIconWithPulse(ctx, img, s.x, s.y, s.w, s.h, 0.1);\n        clickZonesRef.current.push({\n          x: s.x, y: s.y, w: s.w, h: s.h,\n          data: { type: 'row_slot', player: 1, lane: 'aussen', index: idx }\n        });\n      }\n    });\n\n    // --- GOV PLACEMENT SPRITESHEET OVERLAY (frame-based) ---\n    try {\n      const sprites = govSpritesRef.current;\n      const gif = govGifRef.current;\n      const anims = (visualEffects && visualEffects.playAnimsRef && visualEffects.playAnimsRef.current) || [];\n\n      // Start sprite animation when a playAnim for a gov-card is active and maps to a slot\n      const now = performance.now();\n      // Prefer mutating the source anim array so entries are consumed and don't retrigger repeatedly\n      const animsArr: Array<{ uid: string | number; started: number; duration: number; lane?: string }> = (visualEffects && visualEffects.playAnimsRef && visualEffects.playAnimsRef.current) || ((window as any).__pc_play_anims = (window as any).__pc_play_anims || []);\n\n      // Iterate backwards and consume processed animations to ensure one-shot playback\n      for (let i = animsArr.length - 1; i >= 0; i--) {\n        const a = animsArr[i];\n        try {\n          // handle specialized 'hit:' playAnims which indicate target-hit sprites by slot key\n          if (typeof a.uid === 'string' && a.uid.indexOf('hit:') === 0) {\n            const inner = a.uid.slice(4); // '1.aussen.0'\n            if (!hitSpriteStateRef.current[inner]) {\n              hitSpriteStateRef.current[inner] = { started: now, frameCount: 25, frameDuration: 30 };\n              animsArr.splice(i, 1);\n            }\n            continue;\n          }\n        } catch (e) {}\n\n        // find the zone/slot for this uid\n        const zone = clickZonesRef.current.find(z => z.data && z.data.card && ((z.data.card.uid ?? String(z.data.card.id)) === a.uid));\n        if (!zone) continue;\n\n        // determine if gov slot or instant\n        let isGov = false;\n        let isInstant = false;\n        try {\n          const dt = zone.data || {};\n          if (dt.type === 'row_slot' && dt.lane === 'aussen') isGov = true;\n          if (dt.type === 'board_card' && dt.lane === 'aussen') isGov = true;\n          if (dt.slot && typeof dt.slot === 'string' && dt.slot.includes('government')) isGov = true;\n          if (dt.type === 'activate_instant' || (dt.slot && typeof dt.slot === 'string' && dt.slot.includes('instant'))) isInstant = true;\n        } catch (e) {}\n        if (!isGov && !isInstant) continue;\n\n        const player = zone.data.player ?? 1;\n        const lane = zone.data.lane ?? 'aussen';\n        const idx = zone.data.index ?? 0;\n        const key = `${player}.${lane}.${idx}`;\n\n        // initialize sprite state if not present; consume the anim entry only when we actually start playback\n        let startedThis = false;\n        if (isGov) {\n          if (!govSpriteStateRef.current[key]) {\n            govSpriteStateRef.current[key] = { started: now, frameCount: 14, frameDuration: 40 }; // 14 frames @ ~40ms -> ~560ms\n            startedThis = true;\n          }\n        }\n        if (isInstant) {\n          const instKey = `${player}.instant.${idx}`;\n          if (!instantSpriteStateRef.current[instKey]) {\n            instantSpriteStateRef.current[instKey] = { started: now, frameCount: 14, frameDuration: 40 };\n            startedThis = true;\n          }\n        }\n        if (startedThis) {\n          animsArr.splice(i, 1);\n        }\n      }\n\n      // draw running sprite animations per gov slot\n      Object.keys(govSpriteStateRef.current).forEach(k => {\n        const st = govSpriteStateRef.current[k];\n        const elapsed = now - st.started;\n        const total = st.frameCount * st.frameDuration;\n        if (elapsed > total) {\n          // animation finished; remove state\n          delete govSpriteStateRef.current[k];\n          return;\n        }\n        const frame = Math.floor(elapsed / st.frameDuration);\n\n        // parse key -> player.lane.index\n        const parts = k.split('.');\n        const player = Number(parts[0]) || 1;\n        const lane = parts[1] || 'aussen';\n        const index = Number(parts[2] || 0);\n\n        // compute slot rect for this gov slot (player or opponent board)\n        const rect = player === 1 ? playerGovRects[index] : opponentGovRects[index];\n        if (!rect) return;\n\n        // spritesheet: frame N located at x = N*256, y = 0\n        if (sprites && sprites.complete) {\n          const sx = frame * 256;\n          const sy = 0;\n          const sw = 256;\n          const sh = 256;\n          // draw exactly matching the slot rect size to avoid scaling mismatches\n          const dx = rect.x;\n          const dy = rect.y;\n          ctx.drawImage(sprites, sx, sy, sw, sh, dx, dy, rect.w, rect.h);\n        } else if (gif && gif.complete) {\n          // fallback to static gif if spritesheet missing\n          ctx.drawImage(gif, rect.x, rect.y, rect.w, rect.h);\n        }\n      });\n      // --- INSTANT INITIATIVE SPRITESHEET (draw on instant slot) ---\n      try {\n        const spritesI = instantSpritesRef.current;\n        const nowI = performance.now();\n        Object.keys(instantSpriteStateRef.current).forEach(k => {\n          const st = instantSpriteStateRef.current[k];\n          const elapsed = nowI - st.started;\n          const total = st.frameCount * st.frameDuration;\n          if (elapsed > total) { delete instantSpriteStateRef.current[k]; return; }\n          const frame = Math.floor(elapsed / st.frameDuration);\n          const parts = k.split('.');\n          const player = Number(parts[0]) || 1;\n          const index = Number(parts[2] || 0);\n          const rects = getSofortRect(player ? 'player' : 'opponent');\n          // getSofortRect returns one rect; map by player/context — fallback to zone\n          const instantRect = getZone('slot.instant.player').rectPx;\n          const [ix, iy, iw, ih] = instantRect;\n          if (spritesI && spritesI.complete) {\n            const sx = frame * 256; const sy = 0; const sw = 256; const sh = 256;\n            ctx.drawImage(spritesI, sx, sy, sw, sh, ix, iy, iw, ih);\n          }\n        });\n      } catch (e) {}\n      // --- HIT / TARGET SPRITESHEET (draw as overlay on targeted slot) ---\n      try {\n        const spritesH = hitSpritesRef.current;\n        const nowH = performance.now();\n        Object.keys(hitSpriteStateRef.current).forEach(k => {\n          const st = hitSpriteStateRef.current[k];\n          const elapsed = nowH - st.started;\n          const total = st.frameCount * st.frameDuration;\n          if (elapsed > total) { delete hitSpriteStateRef.current[k]; return; }\n          const frame = Math.floor(elapsed / st.frameDuration);\n\n          // parse key -> player.lane.index\n          const parts = k.split('.');\n          const player = Number(parts[0]) || 1;\n          const lane = parts[1] || 'aussen';\n          const index = Number(parts[2] || 0);\n\n          // compute slot rect for this gov slot (attempt gov then public)\n          const rect = (player === 1 ? playerGovRects : opponentGovRects)[index] || (player === 1 ? playerPublicRects : opponentPublicRects)[index];\n          if (!rect) return;\n\n          if (spritesH && spritesH.complete) {\n            const sx = frame * 256;\n            const sy = 0;\n            const sw = 256;\n            const sh = 256;\n            const dx = rect.x;\n            const dy = rect.y;\n            ctx.drawImage(spritesH, sx, sy, sw, sh, dx, dy, rect.w, rect.h);\n          }\n        });\n      } catch (e) {}\n    } catch (e) {}\n\n    // Draw player permanent slots (draw symbols if empty)\n    // permanent government\n    const permGovZone = getZone('slot.permanent.government.player');\n    if (permGovZone) {\n      const card = gameState.permanentSlots[1].government;\n      const [x, y, w, h] = permGovZone.rectPx;\n      if (card) {\n        drawSingleSlot(ctx, 'slot.permanent.government.player', card, 'permanent_government', 1);\n      } else {\n        // Draw all slot icons using unified helper (so 'dauerhaft' used visually for empty permanent gov slot)\n        const img = slotSymbolImgsRef.current.get('dauerhaft');\n        drawSlotIconWithPulse(ctx, img, x, y, w, h, 0.2);\n      }\n    }\n    // permanent public\n    const permPubZone = getZone('slot.permanent.public.player');\n    if (permPubZone) {\n      const card = gameState.permanentSlots[1].public;\n      const [x2, y2, w2, h2] = permPubZone.rectPx;\n      if (card) {\n        drawSingleSlot(ctx, 'slot.permanent.public.player', card, 'permanent_public', 1);\n      } else {\n        // Draw all slot icons using unified helper (so 'dauerhaft' used visually for empty permanent public slot)\n        const img = slotSymbolImgsRef.current.get('dauerhaft');\n        drawSlotIconWithPulse(ctx, img, x2, y2, w2, h2, 0.9);\n      }\n    }\n\n    // Draw instant slots (both players) and placeholder if empty\n    const instantPlayerZone = getZone('slot.instant.player');\n    if (instantPlayerZone) {\n      const card = gameState.board[1].sofort[0];\n      const [x, y, w, h] = instantPlayerZone.rectPx;\n      if (card) drawSingleSlot(ctx, 'slot.instant.player', card, 'instant', 1);\n      else {\n        // Use unified icon draw helper for instant slot\n        const img = slotSymbolImgsRef.current.get('sofort');\n        drawSlotIconWithPulse(ctx, img, x, y, w, h, 0.0);\n      }\n    }\n\n    // Draw interventions strip (player)\n    // We draw symbol if empty\n    const interventionsZone = getZone('interventions.player');\n    if (interventionsZone) {\n      const [zx, zy, zw, zh] = interventionsZone.rectPx;\n      const card = gameState.traps[1] && gameState.traps[1][0];\n      if (card) drawInterventionsP1(ctx);\n      else {\n        const img = slotSymbolImgsRef.current.get('intervention');\n        drawSlotIconWithPulse(ctx, img, zx, zy, zw, zh, 0.6);\n      }\n    }\n\n    // Draw interventions strip (opponent) - nur im Dev Mode\n    if (devMode) {\n      drawInterventionsP2(ctx);\n    }\n\n    // Draw hand (P1)\n    drawHandP1(ctx);\n\n    // 🔧 DEV MODE: Draw hand (P2) - nur im Dev Mode\n    if (devMode) {\n      drawHandP2(ctx);\n    }\n\n    // Draw info panels\n    drawInfoPanels(ctx);\n\n    // Draw corruption mode indicator\n    const corrActive = !!((gameState as any).pendingAbilitySelect && (gameState as any).pendingAbilitySelect.type === 'corruption_steal');\n    if (corrActive) {\n      ctx.save();\n      ctx.fillStyle = 'rgba(255, 0, 0, 0.8)';\n      ctx.font = 'bold 32px sans-serif';\n      ctx.textAlign = 'center';\n      ctx.fillText('🔥 CORRUPTION TARGET SELECTION ACTIVE 🔥', 960, 100);\n\n      ctx.fillStyle = 'rgba(255, 255, 0, 0.9)';\n      ctx.font = 'bold 24px sans-serif';\n      ctx.fillText('Click on opponent government card to target', 960, 140);\n      ctx.restore();\n    }\n\n    // Draw maulwurf corruption mode indicator\n    const maulwurfActive = !!((gameState as any).pendingAbilitySelect && (gameState as any).pendingAbilitySelect.type === 'maulwurf_steal');\n    if (maulwurfActive) {\n      ctx.save();\n      ctx.fillStyle = 'rgba(139, 69, 19, 0.8)'; // Brown color for mole\n      ctx.font = 'bold 32px sans-serif';\n      ctx.textAlign = 'center';\n      ctx.fillText('🕳️ MAULWURF CORRUPTION ACTIVE 🕳️', 960, 100);\n\n      ctx.fillStyle = 'rgba(255, 255, 0, 0.9)';\n      ctx.font = 'bold 24px sans-serif';\n      ctx.fillText('Ziel automatisch gewählt - würfeln zum Stehlen', 960, 140);\n      ctx.restore();\n    }\n\n    // Draw tunnelvision probe mode indicator\n    const tunnelvisionActive = !!((gameState as any).pendingAbilitySelect && (gameState as any).pendingAbilitySelect.type === 'tunnelvision_probe');\n    if (tunnelvisionActive) {\n      ctx.save();\n      ctx.fillStyle = 'rgba(75, 0, 130, 0.8)'; // Purple color for tunnelvision\n      ctx.font = 'bold 32px sans-serif';\n      ctx.textAlign = 'center';\n      ctx.fillText('🔮 TUNNELVISION PROBE ACTIVE 🔮', 960, 100);\n\n      ctx.fillStyle = 'rgba(255, 255, 0, 0.9)';\n      ctx.font = 'bold 24px sans-serif';\n      ctx.fillText('Regierungskarte Probe - würfeln zum Fortfahren', 960, 140);\n      ctx.restore();\n    }\n\n    // --- VISUAL EFFECTS: Particle bursts, card pop scale, initiative ripple & AP pop ---\n    try {\n      const now = performance.now();\n      const { particlesRef, popsRef, ripplesRef, apLabelsRef, reducedMotion } = (visualEffects || {}) as any;\n\n      const parts: any[] = particlesRef.current || [];\n      if (!reducedMotion) {\n        for (let i = parts.length - 1; i >= 0; i--) {\n          const p = parts[i];\n          const age = now - p.start;\n          if (age > p.life) {\n            parts.splice(i, 1);\n            continue;\n          }\n          p.vy += (p.gravity || 0.09);\n          p.x += p.vx;\n          p.y += p.vy;\n          const t = 1 - age / p.life;\n          ctx.save();\n          ctx.globalAlpha = Math.max(0, Math.min(1, t));\n          ctx.fillStyle = p.color || '#ffd166';\n          ctx.beginPath();\n          ctx.arc(p.x, p.y, (p.size || 4) * t, 0, Math.PI * 2);\n          ctx.fill();\n          ctx.restore();\n        }\n        particlesRef.current = parts;\n\n        const pops: any[] = popsRef.current || [];\n        pops.forEach((pop) => {\n          const p = Math.min(1, Math.max(0, (now - pop.started) / pop.duration));\n          const eased = 1 + 0.12 * (1 - Math.pow(1 - p, 3));\n          const zone = clickZonesRef.current.find(z => z.data && z.data.card && ((z.data.card.uid ?? String(z.data.card.id)) === pop.uid));\n          if (!zone) return;\n          ctx.save();\n          ctx.translate(zone.x + zone.w / 2, zone.y + zone.h / 2);\n          ctx.scale(eased, eased);\n          ctx.globalAlpha = 0.12 * (1 - p);\n          ctx.fillStyle = '#ffffff';\n          ctx.fillRect(-zone.w / 2, -zone.h / 2, zone.w, zone.h);\n          ctx.restore();\n        });\n\n        const ripples: any[] = ripplesRef.current || [];\n        for (let i = ripples.length - 1; i >= 0; i--) {\n          const r = ripples[i];\n          const p = Math.min(1, Math.max(0, (now - r.started) / r.duration));\n          if (p >= 1) { ripples.splice(i, 1); continue; }\n          const radius = r.radius * (0.8 + 1.8 * p);\n          ctx.save();\n          const g = ctx.createRadialGradient(r.cx, r.cy, radius * 0.1, r.cx, r.cy, radius);\n          g.addColorStop(0, `rgba(255,255,255,${0.12 * (1 - p)})`);\n          g.addColorStop(1, `rgba(255,255,255,0)`);\n          ctx.fillStyle = g as any;\n          ctx.beginPath();\n          ctx.arc(r.cx, r.cy, radius, 0, Math.PI * 2);\n          ctx.fill();\n          ctx.restore();\n\n          if (r.showAp && !r._apSpawned) {\n            apLabelsRef.current = apLabelsRef.current || [];\n            apLabelsRef.current.push({ x: r.apX, y: r.apY, started: now, duration: 800, text: '+1' });\n            r._apSpawned = true;\n          }\n        }\n        ripplesRef.current = ripples;\n\n        const apl: any[] = apLabelsRef.current || [];\n        for (let i = apl.length - 1; i >= 0; i--) {\n          const l = apl[i];\n          const p = Math.min(1, Math.max(0, (now - l.started) / l.duration));\n          if (p >= 1) { apl.splice(i, 1); continue; }\n          ctx.save();\n          ctx.globalAlpha = 1 - p;\n          ctx.fillStyle = '#ffdd57';\n          ctx.font = 'bold 22px sans-serif';\n          ctx.textAlign = 'center';\n          ctx.fillText(l.text, l.x, l.y - 20 * p);\n          ctx.restore();\n        }\n        apLabelsRef.current = apl;\n      } else {\n        const apl: any[] = apLabelsRef.current || [];\n        for (let i = apl.length - 1; i >= 0; i--) {\n          const l = apl[i];\n          const p = Math.min(1, Math.max(0, (now - l.started) / l.duration));\n          if (p >= 1) { apl.splice(i, 1); continue; }\n          ctx.save();\n          ctx.globalAlpha = 1 - p;\n          ctx.fillStyle = '#ffdd57';\n          ctx.font = 'bold 18px sans-serif';\n          ctx.textAlign = 'center';\n          ctx.fillText(l.text, l.x, l.y - 10 * p);\n          ctx.restore();\n        }\n        apLabelsRef.current = apl;\n      }\n    } catch (e) {}\n\n    // --- Overlay pass: draw influence pulse ring and +N labels on top of all cards ---\n    try {\n      const now = performance.now();\n      // iterate over stored anims\n      influenceAnimRef.current.forEach((anims, uid) => {\n        // find card position by scanning clickZones\n        const zone = clickZonesRef.current.find(z => z.data && ((z.data.card && ((z.data.card.uid ?? String(z.data.card.id)) === uid)) || (z.data.card && z.data.card.uid === uid)) );\n        if (!zone) return;\n        const cx = zone.x + zone.w / 2;\n        const cy = zone.y + zone.h / 2;\n        // calculate aggregate pulse for this uid\n        let maxPulse = 0;\n        let totalAmount = 0;\n        const remaining: Array<{ start: number; duration: number; amount: number }> = [];\n        anims.forEach(a => {\n          const p = Math.min(1, Math.max(0, (now - a.start) / a.duration));\n          const pulse = Math.pow(Math.max(0, 1 - p), 2);\n          if (pulse > maxPulse) maxPulse = pulse;\n          if (p < 1) {\n            remaining.push(a);\n            totalAmount += a.amount;\n          }\n        });\n\n        // update list\n        if (remaining.length > 0) influenceAnimRef.current.set(uid, remaining);\n        else influenceAnimRef.current.delete(uid);\n\n        if (maxPulse > 0.001) {\n          // draw a soft ring to the right-bottom of influence number\n          const ringRadius = Math.max(8, zone.w * 0.08) * (1 + maxPulse * 0.6);\n          const ringX = zone.x + zone.w - 28; // near bottom-right where influence text lives\n          const ringY = zone.y + zone.h - 20;\n\n          ctx.save();\n          ctx.beginPath();\n          ctx.strokeStyle = `rgba(46, 204, 113, ${0.9 * maxPulse})`;\n          ctx.lineWidth = Math.max(2, Math.ceil(6 * maxPulse));\n          ctx.arc(ringX, ringY, ringRadius, 0, Math.PI * 2);\n          ctx.stroke();\n          ctx.restore();\n        }\n\n        if (totalAmount > 0) {\n          // floating +N to the right of influence number\n          const labelX = zone.x + zone.w - 12;\n          const labelY = zone.y + zone.h - 32 - (Math.random() * 6); // slight jitter\n          ctx.save();\n          ctx.fillStyle = '#2ecc71';\n          ctx.font = 'bold 16px sans-serif';\n          ctx.textAlign = 'left';\n          ctx.textBaseline = 'middle';\n          ctx.fillText(`+${totalAmount}`, labelX, labelY);\n          ctx.restore();\n        }\n      });\n    } catch (e) {\n      // ignore overlay errors\n    }\n\n    // --- Outline pass: draw a subtle, slightly pulsing 257x257 square around 256x256 slots ---\n    try {\n      const now2 = performance.now();\n      clickZonesRef.current.forEach((z, i) => {\n        if (!z) return;\n        const w = z.w || 0;\n        const h = z.h || 0;\n        // only target 256x256 slot-sized zones (covers the icons)\n        if (Math.abs(w - 256) > 0.1 || Math.abs(h - 256) > 0.1) return;\n        const x = z.x;\n        const y = z.y;\n\n        // Color palette (rgb)\n        const rgbTeal = '20,184,166';\n        const rgbBurg = '127,29,29';\n        const rgbPurple = '139,92,246';\n        const rgbYellow = '250,204,21';\n        const rgbOrange = '251,146,60';\n\n        // Determine slot semantic\n        let slotType: 'government' | 'public' | 'permanent' | 'instant' | 'intervention' | 'default' = 'default';\n        try {\n          const dt = z.data || {};\n          if (dt.slot && typeof dt.slot === 'string') {\n            if (dt.slot.includes('government')) slotType = 'government';\n            else if (dt.slot.includes('public')) slotType = 'public';\n            else if (dt.slot.includes('permanent')) slotType = 'permanent';\n            else if (dt.slot.includes('instant')) slotType = 'instant';\n          }\n          if (dt.type === 'row_slot' && dt.lane === 'aussen') slotType = 'government';\n          if (dt.type === 'row_slot' && dt.lane === 'innen') slotType = 'public';\n          if (dt.type === 'trap_p1' || dt.type === 'trap_p2' || (dt.card && dt.card.kind === 'trap')) slotType = 'intervention';\n          if (dt.type === 'activate_instant' || dt.slot === 'instant') slotType = 'instant';\n          if (dt.slot === 'permanent_government' || dt.slot === 'permanent_public' || dt.slot === 'permanent') slotType = 'permanent';\n        } catch (e) {}\n\n        const pulse = 0.5 + 0.5 * Math.sin(now2 / 350 + i);\n        const alpha = 0.06 + 0.12 * pulse; // subtle alpha\n        const lw = 1 + 2 * pulse; // line width between 1 and 3\n\n        // Create gradient based on slot type\n        let grad: CanvasGradient | null = null;\n        try {\n          grad = ctx.createLinearGradient(x, y, x + w, y + h);\n          if (slotType === 'government') {\n            grad.addColorStop(0, `rgba(${rgbTeal},1)`);\n            grad.addColorStop(1, `rgba(${rgbBurg},1)`);\n          } else if (slotType === 'public') {\n            grad.addColorStop(0, `rgba(${rgbBurg},1)`);\n            grad.addColorStop(1, `rgba(${rgbTeal},1)`);\n          } else if (slotType === 'permanent') {\n            grad.addColorStop(0, `rgba(${rgbPurple},1)`);\n            grad.addColorStop(1, `rgba(${rgbPurple},1)`);\n          } else if (slotType === 'instant') {\n            grad.addColorStop(0, `rgba(${rgbYellow},1)`);\n            grad.addColorStop(1, `rgba(${rgbYellow},1)`);\n          } else if (slotType === 'intervention') {\n            grad.addColorStop(0, `rgba(${rgbOrange},1)`);\n            grad.addColorStop(1, `rgba(${rgbOrange},1)`);\n          } else {\n            grad.addColorStop(0, `rgba(255,255,255,1)`);\n            grad.addColorStop(1, `rgba(255,255,255,1)`);\n          }\n        } catch (e) {\n          grad = null;\n        }\n\n        ctx.save();\n        if (grad) ctx.strokeStyle = grad as any;\n        else ctx.strokeStyle = `rgba(255,255,255,${alpha.toFixed(3)})`;\n        ctx.globalAlpha = alpha;\n        ctx.lineWidth = lw;\n        // draw 257x257 centered so that it encloses the 256 slot\n        ctx.strokeRect(x - 0.5, y - 0.5, w + 1, h + 1);\n        ctx.restore();\n      });\n    } catch (e) {\n      // ignore outline errors\n    }\n\n    ctx.restore();\n\n    // expose zones for debug snapshot\n    (window as any).__politicardDebug = {\n      uiTransform: getUiTransform(canvas.width, canvas.height),\n      canvasSize: { width: canvas.width, height: canvas.height },\n      zones: LAYOUT.zones,\n      clickZones: clickZonesRef.current.slice(0, 1000)\n    };\n\n    // Build canonical slotPositions map for animations/debugging\n    try {\n      const map: Record<string, { x: number; y: number; w: number; h: number; cx: number; cy: number }> = {};\n      clickZonesRef.current.forEach(z => {\n        const d = z.data || {};\n        // support row_slot, board_card, slot_card shapes\n        if (d.type === 'row_slot' || d.type === 'board_card' || d.type === 'slot_card' || d.type === 'hand_p1' || d.type === 'hand_p2') {\n          const player = d.player ?? (d.type === 'hand_p2' ? 2 : 1);\n          const lane = d.lane ?? (typeof d.slot === 'string' ? d.slot : (d.type === 'hand_p2' ? 'hand' : 'unknown'));\n          let index: number;\n          if (d.index != null) {\n            index = d.index;\n          } else if (d.card) {\n            // prefer explicit slotIndex, fallback to card.index, otherwise 0\n            index = (d.card.slotIndex != null) ? d.card.slotIndex : ((d.card.index != null) ? d.card.index : 0);\n          } else {\n            index = 0;\n          }\n          const key = `${player}.${lane}.${index}`;\n          map[key] = { x: z.x, y: z.y, w: z.w, h: z.h, cx: z.x + z.w / 2, cy: z.y + z.h / 2 };\n        }\n      });\n      slotPositionsRef.current = map;\n      (window as any).__politicardDebug = { ...(window as any).__politicardDebug, slotPositions: slotPositionsRef.current };\n    } catch (e) {\n      // don't let debug mapping break rendering\n    }\n\n    // Run diagnostics after canvas is fully rendered\n    runDiagnostics();\n  }, [drawLane, drawHandP1, drawHandP2, drawInterventionsP1, drawInterventionsP2, drawPermanentSlotsP1, drawPermanentSlotsP2, drawInstantSlots, drawInfoPanels, devMode, runDiagnostics]);\n\n  const DRAW_LAYOUT_OVERLAY = false; // force off per new layout system\n\n  // Load slot symbol images once\n  useEffect(() => {\n    const load = (key: string, src: string) => {\n      const img = new Image();\n      img.onload = () => { slotSymbolImgsRef.current.set(key, img); };\n      img.onerror = () => { console.warn('Failed to load slot icon', src); };\n      img.src = src;\n    };\n    // load all slot icons\n    load('public', publicSymbolUrl);\n    load('sofort', sofortSymbolUrl);\n    load('dauerhaft', dauerhaftSymbolUrl);\n    load('government', governmentSymbolUrl);\n    load('intervention', interventionSymbolUrl);\n\n    // load test GIF for gov overlay\n    try {\n      const img = new Image();\n      img.onload = () => { govGifRef.current = img; };\n      img.onerror = () => { console.warn('Failed to load gov overlay gif', govPlaceGifUrl); };\n      img.src = govPlaceGifUrl;\n    } catch (e) {}\n    // load spritesheet for placement animation\n    try {\n      const s = new Image();\n      s.onload = () => { govSpritesRef.current = s; };\n      s.onerror = () => { console.warn('Failed to load gov spritesheet', govPlaceSpritesheetUrl); };\n      s.src = govPlaceSpritesheetUrl;\n    } catch (e) {}\n    // load spritesheet for instant initiative activation\n    try {\n      const si = new Image();\n      si.onload = () => { instantSpritesRef.current = si; };\n      si.onerror = () => { console.warn('Failed to load instant spritesheet', instantSpritesheetUrl); };\n      si.src = instantSpritesheetUrl;\n    } catch (e) {}\n\n    // load spritesheet for hit/target animation (25 frames)\n    try {\n      const h = new Image();\n      h.onload = () => { hitSpritesRef.current = h; };\n      h.onerror = () => { console.warn('Failed to load hit spritesheet', hitSpritesheetUrl); };\n      h.src = hitSpritesheetUrl;\n    } catch (e) {}\n\n    // ensure first draw\n    requestAnimationFrame(draw);\n  }, [draw]);\n\n  // Expose debug trigger to manually start gov sprite animation by slot-key or uid\n  useEffect(() => {\n    (window as any).__pc_triggerGovAnim = (id: any) => {\n      try {\n        const now = performance.now();\n        // if id is slot key like '1.aussen.2'\n        if (typeof id === 'string' && id.indexOf('.') >= 0) {\n          govSpriteStateRef.current[id] = { started: now, frameCount: 14, frameDuration: 40 };\n          return;\n        }\n\n        // otherwise try to resolve as uid/id to a clickZone\n        const uid = id;\n        const zone = clickZonesRef.current.find(z => z.data && (z.data.card && ((z.data.card.uid ?? String(z.data.card.id)) === uid || (z.data.card.id === uid))));\n        if (!zone) {\n          console.warn('pc_triggerGovAnim: no slot found for uid', uid);\n          return;\n        }\n        const player = zone.data.player ?? 1;\n        const lane = zone.data.lane ?? (zone.data.slot && typeof zone.data.slot === 'string' ? zone.data.slot : 'aussen');\n        const index = zone.data.index ?? 0;\n        const key = `${player}.${lane}.${index}`;\n        govSpriteStateRef.current[key] = { started: now, frameCount: 14, frameDuration: 40 };\n      } catch (e) {\n        console.warn('pc_triggerGovAnim error', e);\n      }\n    };\n    // expose easy alias\n    try { (window as any).pc_triggerGovAnim = (window as any).__pc_triggerGovAnim; } catch (e) {}\n    return () => { delete (window as any).__pc_triggerGovAnim; };\n  }, []);\n\n  // Expose debug trigger for hit animation (key: '1.aussen.0' or uid)\n  useEffect(() => {\n    (window as any).__pc_triggerHitAnim = (id: any) => {\n      try {\n        const now = performance.now();\n        // if id is slot key like '1.aussen.2'\n        if (typeof id === 'string' && id.indexOf('.') >= 0) {\n          hitSpriteStateRef.current[id] = { started: now, frameCount: 25, frameDuration: 30 };\n          return;\n        }\n\n        // otherwise try to resolve as uid/id to a clickZone\n        const uid = id;\n        const zone = clickZonesRef.current.find(z => z.data && (z.data.card && ((z.data.card.uid ?? String(z.data.card.id)) === uid || (z.data.card.id === uid))));\n        if (!zone) {\n          console.warn('pc_triggerHitAnim: no slot found for uid', uid);\n          return;\n        }\n        const player = zone.data.player ?? 1;\n        const lane = zone.data.lane ?? (zone.data.slot && typeof zone.data.slot === 'string' ? zone.data.slot : 'aussen');\n        const index = zone.data.index ?? 0;\n        const key = `${player}.${lane}.${index}`;\n        hitSpriteStateRef.current[key] = { started: now, frameCount: 25, frameDuration: 30 };\n      } catch (e) {\n        console.warn('pc_triggerHitAnim error', e);\n      }\n    };\n    try { (window as any).pc_triggerHitAnim = (window as any).__pc_triggerHitAnim; } catch (e) {}\n    return () => { delete (window as any).__pc_triggerHitAnim; };\n  }, []);\n\n  // Redraw when game state or selection changes\n  useEffect(() => {\n    requestAnimationFrame(draw);\n  }, [gameState, selectedHandIndex, draw]);\n\n  // Continuous render loop to keep canvas updated without relying on external state refs\n  useEffect(() => {\n    let frame: number;\n    const loop = () => {\n      draw();\n      frame = requestAnimationFrame(loop);\n    };\n    frame = requestAnimationFrame(loop);\n    return () => cancelAnimationFrame(frame);\n  }, [draw]);\n\n  const handleCardClick = useCallback((data: any) => {\n    // Corruption target selection: intercept board card clicks for opponent government\n    if (corruptionSelectActorRef.current && data && data.type === 'board_card') {\n      try {\n        const actor = corruptionSelectActorRef.current as Player;\n        const victim = actor === 1 ? 2 : 1;\n        if (data.player === victim && (data.lane === 'aussen' || data.lane === 'government')) {\n          const uid = data.card?.uid ?? data.card?.id;\n          if (uid != null) {\n            corruptionSelectActorRef.current = null;\n            try { window.dispatchEvent(new CustomEvent('pc:corruption_target_selected', { detail: { player: actor, targetUid: uid } })); } catch (e) {}\n            return; // do not propagate\n          }\n        }\n      } catch (e) {}\n    }\n    // Hand-Klick\n    if (data.type === 'hand_p1') {\n      const uid = data.card?.uid ?? data.card?.id;\n      const stateHand = gameState.hands?.[1] || [];\n      const idxInState = stateHand.findIndex((c: any) => (c.uid ?? c.id) === uid);\n      onCardClick(data);\n      return;\n    }\n\n    // Slot-Klick\n    if (data.type === 'row_slot') {\n      const lane: 'public' | 'government' = data.lane;\n      const cap = getLaneCapacity(lane);\n\n      // Hole aktuelle Row-Länge aus gameState\n      const rowCards = lane === 'public'\n        ? gameState.board?.[1]?.innen ?? []\n        : gameState.board?.[1]?.aussen ?? [];\n\n      if (rowCards.length >= cap) {\n        // Optional: UI Feedback\n        console.warn(`Row ${lane} is full (${rowCards.length}/${cap})`);\n        return;\n      }\n\n      onCardClick(data);\n      return;\n    }\n\n    // Andere Klicks (empty_slot, board_card, etc.)\n    onCardClick(data);\n  }, [gameState, onCardClick]);\n\n  const handleClick = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const { scale, offsetX, offsetY } = getUiTransform(canvas.width, canvas.height);\n    const mx = (e.clientX - rect.left - offsetX) / scale;\n    const my = (e.clientY - rect.top - offsetY) / scale;\n\n    const hit = clickZonesRef.current.find(z => mx >= z.x && mx <= z.x + z.w && my >= z.y && my <= z.y + z.h);\n    if (hit) {\n      console.debug('[CanvasClick] mx,my,hit:', mx, my, hit.data);\n      try {\n        // If user clicked a drawn card in an instant slot, normalize to activate_instant\n        const d = hit.data || {};\n        if (d.type === 'slot_card' && d.slot === 'instant') {\n          handleCardClick({ type: 'activate_instant', player: d.player || 1, card: d.card });\n          return;\n        }\n        // Fallback: if there's an explicit activate_instant zone, pass through\n        if (d.type === 'activate_instant') {\n          handleCardClick(d);\n          return;\n        }\n      } catch (err) {}\n      handleCardClickInternal(hit.data);\n    }\n  }, [handleCardClick]);\n\n  const handleMouseMove = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n\n    const rect = canvas.getBoundingClientRect();\n    const { scale, offsetX, offsetY } = getUiTransform(canvas.width, canvas.height);\n    const mx = (e.clientX - rect.left - offsetX) / scale;\n    const my = (e.clientY - rect.top - offsetY) / scale;\n\n    const hit = clickZonesRef.current.find(z => mx >= z.x && mx <= z.x + z.w && my >= z.y && my <= z.y + z.h);\n    if (hit) {\n      console.log('[hover]', hit.data.type, hit.data.card?.name);\n      onCardHover({ ...hit.data, x: e.clientX, y: e.clientY });\n    } else {\n      onCardHover(null);\n    }\n  }, [onCardHover]);\n\n  const handleWheel = useCallback((e: React.WheelEvent<HTMLCanvasElement>) => {\n    // only enable when player1 has more slots than visible\n    const handLen = (gameState.hands && gameState.hands[1]) ? gameState.hands[1].length : 0;\n    const zone = getZone('hand.player');\n    if (!zone) return;\n    if (handLen <= 5) return; // nothing to scroll\n\n    // Prevent page scrolling when over canvas\n    e.preventDefault();\n\n    // accumulate target offset (invert so wheel down moves cards up)\n    // Each wheel step moves by 48px per delta unit\n    const delta = Math.sign(e.deltaY) * 48;\n    // compute slot height more robustly\n    const slots = computeSlotRects(zone);\n    const slotH = slots && slots.length > 0 ? slots[0].h : zone.rectPx[3] / 5;\n    const visible = 5;\n    const maxOffset = -(Math.max(0, handLen - visible) * slotH);\n    handScrollTargetRef.current = Math.max(Math.min(handScrollTargetRef.current - delta, 0), maxOffset);\n  }, [gameState.hands]);\n\n  const handleTouchStart = useCallback((e: React.TouchEvent<HTMLCanvasElement>) => {\n    if (!e.touches || e.touches.length === 0) return;\n    const handLen = (gameState.hands && gameState.hands[1]) ? gameState.hands[1].length : 0;\n    if (handLen <= 5) return;\n    isTouchingRef.current = true;\n    const y = e.touches[0].clientY;\n    touchStartYRef.current = y;\n    lastTouchYRef.current = y;\n    e.preventDefault();\n  }, [gameState.hands]);\n\n  const handleTouchMove = useCallback((e: React.TouchEvent<HTMLCanvasElement>) => {\n    if (!isTouchingRef.current) return;\n    if (!e.touches || e.touches.length === 0) return;\n    const y = e.touches[0].clientY;\n    const last = lastTouchYRef.current ?? y;\n    const dy = y - last; // positive when moving down\n    lastTouchYRef.current = y;\n\n    // invert so dragging up moves cards up\n    const delta = -dy;\n    const handLen = (gameState.hands && gameState.hands[1]) ? gameState.hands[1].length : 0;\n    const zone = getZone('hand.player');\n    if (!zone) return;\n    const slots = computeSlotRects(zone);\n    const slotH = slots && slots.length > 0 ? slots[0].h : zone.rectPx[3] / 5;\n    const visible = 5;\n    const maxOffset = -(Math.max(0, handLen - visible) * slotH);\n    handScrollTargetRef.current = Math.max(Math.min(handScrollTargetRef.current + delta, 0), maxOffset);\n    e.preventDefault();\n  }, [gameState.hands]);\n\n  const handleTouchEnd = useCallback((e: React.TouchEvent<HTMLCanvasElement>) => {\n    isTouchingRef.current = false;\n    touchStartYRef.current = null;\n    lastTouchYRef.current = null;\n  }, []);\n\n\n\n  // Expose debug trigger to manually start instant sprite animation by slot-key or uid\n  useEffect(() => {\n    (window as any).__pc_triggerInstantAnim = (key: any) => {\n      const now = performance.now();\n      instantSpriteStateRef.current[key || '1.instant.0'] = { started: now, frameCount: 14, frameDuration: 40 };\n    };\n    // alias\n    try { (window as any).pc_triggerInstantAnim = (window as any).__pc_triggerInstantAnim; } catch (e) {}\n    return () => { delete (window as any).__pc_triggerGovAnim; delete (window as any).__pc_triggerInstantAnim; };\n  }, []);\n\n  // Click handler wrapper for corruption selection\n  const handleCardClickInternal = useCallback((data: any) => {\n    const sel: any = (gameState as any).pendingAbilitySelect;\n    if (sel && sel.type === 'corruption_steal') {\n      // Accept clicks on either actual card sprites (with uid) or on empty row_slot hitboxes.\n      if (data.player !== sel.actorPlayer && data.lane === 'aussen') {\n        let targetUid = (data as any).uid;\n\n        // If we got a row_slot hit (no uid), map index→uid from board state\n        if (!targetUid && data.type === 'row_slot') {\n          try {\n            const p = data.player;\n            const idx = data.index;\n            const card = (gameState as any).board?.[p]?.aussen?.[idx];\n            targetUid = card?.uid;\n          } catch(e) {}\n        }\n\n        if (targetUid) {\n          try {\n            console.debug('[CORR] forwarding uid', targetUid, 'actorPlayer=', sel.actorPlayer);\n            window.dispatchEvent(new CustomEvent('pc:corruption_pick_target', { detail: { player: sel.actorPlayer, targetUid } }));\n            // Also open small confirmation overlay via DOM event for modal convenience\n            try { window.dispatchEvent(new CustomEvent('pc:corruption_target_selected', { detail: { player: sel.actorPlayer, targetUid } })); } catch(e) {}\n          } catch(e) {}\n          return; // consume click\n        }\n      }\n    }\n    onCardClick(data);\n  }, [gameState, onCardClick]);\n\n  useEffect(() => {\n    const onDiceResult = () => {\n      // remove corruption modal if exists\n      const el = document.getElementById('pc-corruption-modal');\n      if (el) el.remove();\n      corruptionSelectActorRef.current = null;\n    };\n    window.addEventListener('pc:dice_result', onDiceResult as EventListener);\n    return () => window.removeEventListener('pc:dice_result', onDiceResult as EventListener);\n  }, []);\n\n  return (\n    <canvas\n      ref={canvasRef}\n      width={1920}\n      height={1080}\n      style={{\n        display: 'block',\n        width: '100%',\n        height: '100%',\n        imageRendering: 'auto',\n      }}\n      onClick={handleClick}\n      onMouseMove={handleMouseMove}\n      onWheel={handleWheel}\n      onTouchStart={handleTouchStart}\n      onTouchMove={handleTouchMove}\n      onTouchEnd={handleTouchEnd}\n    />\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}