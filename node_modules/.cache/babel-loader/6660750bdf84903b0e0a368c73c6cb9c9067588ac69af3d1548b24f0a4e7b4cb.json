{"ast":null,"code":"import{createKeyboardListener,readGamepadsUnified,P1_KEYS,P2_KEYS}from\"./input\";import{buildSpriteConfig,P1_PROJECTILE_SRC,P2_PROJECTILE_SRC,P1_BLAST_SRC,P2_BLAST_SRC}from\"./assetRegistry\";import{loadAtlas}from\"./atlasLoader\";import{Fighter,Blast}from\"./fighter\";import{getAnimationViewer}from\"./animationViewer\";export function createGame(canvas){const ctx=canvas.getContext(\"2d\");const WIDTH=canvas.width,HEIGHT=canvas.height;// Debug: log when this module is actually instantiated so we can confirm if the rebuilt module is loaded\n// Visible in the browser console immediately after page load\n// eslint-disable-next-line no-console\nconsole.debug(\"[qte] createGame initialized\",{WIDTH,HEIGHT});function clamp(v,min,max){return v<min?min:v>max?max:v;}const input=createKeyboardListener(canvas);// Create animation viewer button\nconst animationViewerBtn=document.createElement('button');animationViewerBtn.textContent='ðŸŽ¬ View Animations';animationViewerBtn.style.cssText=\"\\n    position: fixed;\\n    top: 10px;\\n    right: 10px;\\n    z-index: 1000;\\n    background: #0066cc;\\n    color: white;\\n    border: none;\\n    border-radius: 4px;\\n    padding: 8px 16px;\\n    cursor: pointer;\\n    font-size: 14px;\\n    font-weight: bold;\\n    box-shadow: 0 2px 4px rgba(0,0,0,0.3);\\n  \";animationViewerBtn.onclick=()=>getAnimationViewer().show();document.body.appendChild(animationViewerBtn);const p1Sprite=buildSpriteConfig(\"ninja\");const p2Sprite=buildSpriteConfig(\"cyboard\",{idle:{src:\"cyboard/idle_256x256_4.png\",frames:4,fps:6},walk:{src:\"cyboard/walk_256x256_4.png\",frames:4,fps:10},ranged:{src:\"cyboard/ranged_256x256_4.png\",frames:4,fps:12},parry:{src:\"cyboard/parry_256x256_4.png\",frames:4,fps:10},blast:{src:\"cyboard/blast_256x256_4.png\",frames:4,fps:12}});const projectiles=[];const blasts=[];const p1=new Fighter({x:100,y:HEIGHT-40-256,color:\"#4aa3ff\",keys:P1_KEYS,name:\"P1\",spriteConfig:p1Sprite,ctx,canvasWidth:WIDTH,canvasHeight:HEIGHT,muzzleOffset:{x:36,y:-48}});const p2=new Fighter({x:WIDTH-100-256,y:HEIGHT-40-256,color:\"#ff7a7a\",keys:P2_KEYS,name:\"P2\",spriteConfig:p2Sprite,ctx,canvasWidth:WIDTH,canvasHeight:HEIGHT,muzzleOffset:{x:-36,y:-48}});p2.facing=-1;// Preload stage background\nconst stageImg=new Image();stageImg.src=\"/qte/background/ninjastage0.png\";// Store atlases globally for projectiles/blasts\nlet globalAtlas1=null;let globalAtlas2=null;// Asynchronously load atlases and patch animators once ready\n(async()=>{try{console.log(\"[qte] Starting atlas load...\");console.log(\"[qte] Loading ninja atlas from /qte/ninja\");console.log(\"[qte] Loading cyboard atlas from /qte/cyboard/atlas2\");const[atlas1,atlas2]=await Promise.all([loadAtlas(\"/qte/ninja\"),loadAtlas(\"/qte/cyboard/atlas2\")]);globalAtlas1=atlas1;globalAtlas2=atlas2;console.log(\"[qte] Atlases loaded successfully:\",{ninja:!!atlas1,cyboard:!!atlas2,ninjaAnimations:Object.keys(atlas1.animations),cyboardAnimations:Object.keys(atlas2.animations)});// helper to merge atlas into animator\nconst patchAnimator=(anim,atlas)=>{// ensure default fallback is atlas image\nanim.defaultImage=atlas.image;const allStates=Object.keys(anim.animations);for(const state of allStates){const atlasState=atlas.animations[state];if(!anim.animations[state])anim.animations[state]={};const dest=anim.animations[state];if(atlasState){var _atlas$image,_atlas$image2;const a=atlasState;dest.rects=a.frames;dest.image=atlas.image;dest.src=((_atlas$image=atlas.image)===null||_atlas$image===void 0?void 0:_atlas$image.src)||dest.src||'';dest.frameW=atlas.frameW;dest.frameH=atlas.frameH;dest.frames=a.frames.length;dest.imageLoaded=true;dest.imageBroken=false;console.log(\"[qte] Patched \".concat(state,\" with \").concat(a.frames.length,\" atlas frames (image src=\").concat((_atlas$image2=atlas.image)===null||_atlas$image2===void 0?void 0:_atlas$image2.src,\")\"));}else{var _atlas$image3;// No atlas frames but still ensure image reference so it's not broken\ndest.image=atlas.image;dest.src=((_atlas$image3=atlas.image)===null||_atlas$image3===void 0?void 0:_atlas$image3.src)||dest.src||'';dest.imageLoaded=true;dest.imageBroken=false;// keep existing frameW/frameH if present, otherwise use atlas values\ndest.frameW=dest.frameW||atlas.frameW;dest.frameH=dest.frameH||atlas.frameH;console.log(\"[qte] No atlas frames for \".concat(state,\", using atlas image fallback\"));}}};patchAnimator(p1.anim,atlas1);patchAnimator(p2.anim,atlas2);console.log(\"[qte] atlases loaded and patched successfully\");}catch(e){// eslint-disable-next-line no-console\nconsole.warn(\"[qte] atlas load failed\",e);}})();// Asset diagnostics: after a short delay log the loaded/broken state of important images\nsetTimeout(()=>{try{// eslint-disable-next-line no-console\nconsole.debug(\"[qte] asset diagnostics: checking sprite images\");const dump=(animName,spriteConfig)=>{const keys=Object.keys(spriteConfig.animations||{});keys.forEach(k=>{const a=spriteConfig.animations[k];// eslint-disable-next-line no-console\nconsole.debug(\"[qte] sprite \".concat(animName,\".\").concat(k),{src:a.src,frames:a.frames,fps:a.fps,loaded:!!a.imageLoaded,broken:!!a.imageBroken});});};dump(\"p1\",p1Sprite);dump(\"p2\",p2Sprite);// also log projectile/blast constants\n// eslint-disable-next-line no-console\nconsole.debug(\"[qte] constants\",{P1_PROJECTILE_SRC,P2_PROJECTILE_SRC,P1_BLAST_SRC,P2_BLAST_SRC});}catch(e){// eslint-disable-next-line no-console\nconsole.warn(\"[qte] asset diagnostics failed\",e);}},500);function framesFromFilename(src,fallback){try{const m=/_(\\d+)\\.(png|jpg|jpeg|webp)$/i.exec(src);const n=m?parseInt(m[1],10):NaN;return Number.isFinite(n)?n:fallback;}catch(e){return fallback;}}let last=performance.now();function loop(now){const dt=Math.min(0.05,(now-last)/1000);last=now;// merge inputs\nconst gp=readGamepadsUnified(P1_KEYS,P2_KEYS);const mergedInput={};function getKeyboard(code){return!!input[code];}[P1_KEYS.left,P1_KEYS.right,P1_KEYS.up,P1_KEYS.down,P1_KEYS.attack,P1_KEYS.parry,P1_KEYS.ranged].forEach(k=>{if(k)mergedInput[k]=!!gp[k]||getKeyboard(k);});[P2_KEYS.left,P2_KEYS.right,P2_KEYS.up,P2_KEYS.down,P2_KEYS.attack,P2_KEYS.parry,P2_KEYS.ranged].forEach(k=>{if(k)mergedInput[k]=!!gp[k]||getKeyboard(k);});// draw background\nif(stageImg.complete&&stageImg.naturalWidth>0){ctx.drawImage(stageImg,0,0,WIDTH,HEIGHT);}else{ctx.fillStyle=\"#071428\";ctx.fillRect(0,0,WIDTH,HEIGHT);}ctx.fillStyle=\"#333\";ctx.fillRect(0,HEIGHT-40,WIDTH,40);// update\np1.update(dt,mergedInput,projectiles);p2.update(dt,mergedInput,projectiles);projectiles.forEach(pr=>pr.update(dt));blasts.forEach(b=>b.update(dt));// cleanup\nfor(let i=projectiles.length-1;i>=0;i--)if(!projectiles[i].alive)projectiles.splice(i,1);for(let i=blasts.length-1;i>=0;i--)if(!blasts[i].alive)blasts.splice(i,1);// draw\np1.draw();p2.draw();projectiles.forEach(pr=>pr.draw(ctx));blasts.forEach(b=>b.draw(ctx));// collisions\nconst h1=p1.hitbox(),h2=p2.hitbox();if(h1&&aabb(h1,p2.rect())){if(p2.parrying&&!p2.parryConsumed&&p2.parryTimer>p2.parryDurationDefault-p2.parryWindowLength){p2.parryConsumed=true;p2.parryFreezeTimer=0.12;p1.stunTimer=1.0;}else{p2.hp=clamp(p2.hp-1,0,100);}}if(h2&&aabb(h2,p1.rect())){if(p1.parrying&&!p1.parryConsumed&&p1.parryTimer>p1.parryDurationDefault-p1.parryWindowLength){p1.parryConsumed=true;p1.parryFreezeTimer=0.12;p2.stunTimer=1.0;}else{p1.hp=clamp(p1.hp-1,0,100);}}for(const pr of projectiles){if(!pr.alive)continue;if(pr.owner!==p1&&aabb(pr.rect(),p1.rect())){var _pr$anim$animations$f;p1.hp=clamp(p1.hp-10,0,100);pr.alive=false;// Debug: log hit and blast chosen\n// eslint-disable-next-line no-console\nconsole.debug(\"[qte] projectile hit P1\",{projectileSrc:(_pr$anim$animations$f=pr.anim.animations[\"fly\"])===null||_pr$anim$animations$f===void 0?void 0:_pr$anim$animations$f.src,blastSrc:P2_BLAST_SRC});// Use atlas for blast if available\nlet blastImage=null;let blastRects=null;let blastFrames=4;if(globalAtlas2&&globalAtlas2.animations.blast){blastImage=globalAtlas2.image;blastRects=globalAtlas2.animations.blast.frames;blastFrames=globalAtlas2.animations.blast.frames.length;console.log(\"[qte] Blast using atlas frames from cyboard\");}else{console.log(\"[qte] Blast: No atlas frames for 'blast' in cyboard, falling back to individual image.\");}blasts.push(new Blast(p1.x+p1.w*0.5,p1.y+p1.h*0.5,P2_BLAST_SRC,blastFrames,blastImage,blastRects));}if(pr.owner!==p2&&aabb(pr.rect(),p2.rect())){var _pr$anim$animations$f2;p2.hp=clamp(p2.hp-10,0,100);pr.alive=false;// Debug: log hit and blast chosen\n// eslint-disable-next-line no-console\nconsole.debug(\"[qte] projectile hit P2\",{projectileSrc:(_pr$anim$animations$f2=pr.anim.animations[\"fly\"])===null||_pr$anim$animations$f2===void 0?void 0:_pr$anim$animations$f2.src,blastSrc:P1_BLAST_SRC});// Use atlas for blast if available\nlet blastImage=null;let blastRects=null;let blastFrames=4;if(globalAtlas1&&globalAtlas1.animations.blast){blastImage=globalAtlas1.image;blastRects=globalAtlas1.animations.blast.frames;blastFrames=globalAtlas1.animations.blast.frames.length;console.log(\"[qte] Blast using atlas frames from ninja\");}else{console.log(\"[qte] Blast: No atlas frames for 'blast' in ninja, falling back to individual image.\");}blasts.push(new Blast(p2.x+p2.w*0.5,p2.y+p2.h*0.5,P1_BLAST_SRC,blastFrames,blastImage,blastRects));}}// auto-defeat\nif(p1.hp<=0&&p1.state!==\"defeat\"){p1.state=\"defeat\";p1.attacking=false;p1.parrying=false;p1.ranging=false;p1.vx=0;p1.vy=0;p1.anim.setState(\"defeat\");}if(p2.hp<=0&&p2.state!==\"defeat\"){p2.state=\"defeat\";p2.attacking=false;p2.parrying=false;p2.ranging=false;p2.vx=0;p2.vy=0;p2.anim.setState(\"defeat\");}requestAnimationFrame(loop);}requestAnimationFrame(loop);function aabb(a,b){return!(a.x+a.w<b.x||b.x+b.w<a.x||a.y+a.h<b.y||b.y+b.h<a.y);}return{ctx,p1,p2};}","map":{"version":3,"names":["createKeyboardListener","readGamepadsUnified","P1_KEYS","P2_KEYS","buildSpriteConfig","P1_PROJECTILE_SRC","P2_PROJECTILE_SRC","P1_BLAST_SRC","P2_BLAST_SRC","loadAtlas","Fighter","Blast","getAnimationViewer","createGame","canvas","ctx","getContext","WIDTH","width","HEIGHT","height","console","debug","clamp","v","min","max","input","animationViewerBtn","document","createElement","textContent","style","cssText","onclick","show","body","appendChild","p1Sprite","p2Sprite","idle","src","frames","fps","walk","ranged","parry","blast","projectiles","blasts","p1","x","y","color","keys","name","spriteConfig","canvasWidth","canvasHeight","muzzleOffset","p2","facing","stageImg","Image","globalAtlas1","globalAtlas2","log","atlas1","atlas2","Promise","all","ninja","cyboard","ninjaAnimations","Object","animations","cyboardAnimations","patchAnimator","anim","atlas","defaultImage","image","allStates","state","atlasState","dest","_atlas$image","_atlas$image2","a","rects","frameW","frameH","length","imageLoaded","imageBroken","concat","_atlas$image3","e","warn","setTimeout","dump","animName","forEach","k","loaded","broken","framesFromFilename","fallback","m","exec","n","parseInt","NaN","Number","isFinite","last","performance","now","loop","dt","Math","gp","mergedInput","getKeyboard","code","left","right","up","down","attack","complete","naturalWidth","drawImage","fillStyle","fillRect","update","pr","b","i","alive","splice","draw","h1","hitbox","h2","aabb","rect","parrying","parryConsumed","parryTimer","parryDurationDefault","parryWindowLength","parryFreezeTimer","stunTimer","hp","owner","_pr$anim$animations$f","projectileSrc","blastSrc","blastImage","blastRects","blastFrames","push","w","h","_pr$anim$animations$f2","attacking","ranging","vx","vy","setState","requestAnimationFrame"],"sources":["C:/Users/skank/Videos/Cards/Milchcards/src/qte/gameLoop.ts"],"sourcesContent":["import { createKeyboardListener, readGamepadsUnified, P1_KEYS, P2_KEYS } from \"./input\";\nimport { buildSpriteConfig, P1_PROJECTILE_SRC, P2_PROJECTILE_SRC, P1_BLAST_SRC, P2_BLAST_SRC } from \"./assetRegistry\";\nimport { loadAtlas } from \"./atlasLoader\";\nimport { Fighter, Projectile, Blast } from \"./fighter\";\nimport { getAnimationViewer } from \"./animationViewer\";\n\nexport function createGame(canvas: HTMLCanvasElement) {\n  const ctx = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n  const WIDTH = canvas.width, HEIGHT = canvas.height;\n  // Debug: log when this module is actually instantiated so we can confirm if the rebuilt module is loaded\n  // Visible in the browser console immediately after page load\n  // eslint-disable-next-line no-console\n  console.debug(\"[qte] createGame initialized\", { WIDTH, HEIGHT });\n\n  function clamp(v: number, min: number, max: number) {\n    return v < min ? min : v > max ? max : v;\n  }\n\n  const input = createKeyboardListener(canvas);\n\n  // Create animation viewer button\n  const animationViewerBtn = document.createElement('button');\n  animationViewerBtn.textContent = 'ðŸŽ¬ View Animations';\n  animationViewerBtn.style.cssText = `\n    position: fixed;\n    top: 10px;\n    right: 10px;\n    z-index: 1000;\n    background: #0066cc;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    padding: 8px 16px;\n    cursor: pointer;\n    font-size: 14px;\n    font-weight: bold;\n    box-shadow: 0 2px 4px rgba(0,0,0,0.3);\n  `;\n  animationViewerBtn.onclick = () => getAnimationViewer().show();\n  document.body.appendChild(animationViewerBtn);\n\n  const p1Sprite = buildSpriteConfig(\"ninja\");\n  const p2Sprite = buildSpriteConfig(\"cyboard\", {\n    idle: { src: \"cyboard/idle_256x256_4.png\", frames: 4, fps: 6 },\n    walk: { src: \"cyboard/walk_256x256_4.png\", frames: 4, fps: 10 },\n    ranged: { src: \"cyboard/ranged_256x256_4.png\", frames: 4, fps: 12 },\n    parry: { src: \"cyboard/parry_256x256_4.png\", frames: 4, fps: 10 },\n    blast: { src: \"cyboard/blast_256x256_4.png\", frames: 4, fps: 12 },\n  });\n\n  const projectiles: Projectile[] = [];\n  const blasts: Blast[] = [];\n\n  const p1 = new Fighter({ x: 100, y: HEIGHT - 40 - 256, color: \"#4aa3ff\", keys: P1_KEYS as any, name: \"P1\", spriteConfig: p1Sprite, ctx, canvasWidth: WIDTH, canvasHeight: HEIGHT, muzzleOffset: { x: 36, y: -48 } });\n  const p2 = new Fighter({ x: WIDTH - 100 - 256, y: HEIGHT - 40 - 256, color: \"#ff7a7a\", keys: P2_KEYS as any, name: \"P2\", spriteConfig: p2Sprite, ctx, canvasWidth: WIDTH, canvasHeight: HEIGHT, muzzleOffset: { x: -36, y: -48 } });\n  p2.facing = -1;\n\n  // Preload stage background\n  const stageImg = new Image();\n  stageImg.src = \"/qte/background/ninjastage0.png\";\n\n  // Store atlases globally for projectiles/blasts\n  let globalAtlas1: any = null;\n  let globalAtlas2: any = null;\n\n  // Asynchronously load atlases and patch animators once ready\n  (async () => {\n    try {\n      console.log(\"[qte] Starting atlas load...\");\n      console.log(\"[qte] Loading ninja atlas from /qte/ninja\");\n      console.log(\"[qte] Loading cyboard atlas from /qte/cyboard/atlas2\");\n      const [atlas1, atlas2] = await Promise.all([\n        loadAtlas(\"/qte/ninja\"),\n        loadAtlas(\"/qte/cyboard/atlas2\"),\n      ]);\n\n      globalAtlas1 = atlas1;\n      globalAtlas2 = atlas2;\n      console.log(\"[qte] Atlases loaded successfully:\", {\n        ninja: !!atlas1,\n        cyboard: !!atlas2,\n        ninjaAnimations: Object.keys(atlas1.animations),\n        cyboardAnimations: Object.keys(atlas2.animations)\n      });\n\n      // helper to merge atlas into animator\n      const patchAnimator = (anim: any, atlas: any) => {\n        // ensure default fallback is atlas image\n        anim.defaultImage = atlas.image;\n        const allStates = Object.keys(anim.animations);\n        for (const state of allStates) {\n          const atlasState = atlas.animations[state];\n          if (!anim.animations[state]) anim.animations[state] = {} as any;\n          const dest = anim.animations[state];\n          if (atlasState) {\n            const a = atlasState;\n            dest.rects = a.frames;\n            dest.image = atlas.image;\n            dest.src = atlas.image?.src || dest.src || '';\n            dest.frameW = atlas.frameW;\n            dest.frameH = atlas.frameH;\n            dest.frames = a.frames.length;\n            (dest as any).imageLoaded = true;\n            (dest as any).imageBroken = false;\n            console.log(`[qte] Patched ${state} with ${a.frames.length} atlas frames (image src=${atlas.image?.src})`);\n          } else {\n            // No atlas frames but still ensure image reference so it's not broken\n            dest.image = atlas.image;\n            dest.src = atlas.image?.src || dest.src || '';\n            (dest as any).imageLoaded = true;\n            (dest as any).imageBroken = false;\n            // keep existing frameW/frameH if present, otherwise use atlas values\n            dest.frameW = dest.frameW || atlas.frameW;\n            dest.frameH = dest.frameH || atlas.frameH;\n            console.log(`[qte] No atlas frames for ${state}, using atlas image fallback`);\n          }\n        }\n      };\n      patchAnimator(p1.anim, atlas1);\n      patchAnimator(p2.anim, atlas2);\n      console.log(\"[qte] atlases loaded and patched successfully\");\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\"[qte] atlas load failed\", e);\n    }\n  })();\n\n  // Asset diagnostics: after a short delay log the loaded/broken state of important images\n  setTimeout(() => {\n    try {\n      // eslint-disable-next-line no-console\n      console.debug(\"[qte] asset diagnostics: checking sprite images\");\n      const dump = (animName: string, spriteConfig: any) => {\n        const keys = Object.keys(spriteConfig.animations || {});\n        keys.forEach((k) => {\n          const a = spriteConfig.animations[k];\n          // eslint-disable-next-line no-console\n          console.debug(`[qte] sprite ${animName}.${k}`, { src: a.src, frames: a.frames, fps: a.fps, loaded: !!a.imageLoaded, broken: !!a.imageBroken });\n        });\n      };\n      dump(\"p1\", p1Sprite);\n      dump(\"p2\", p2Sprite);\n      // also log projectile/blast constants\n      // eslint-disable-next-line no-console\n      console.debug(\"[qte] constants\", { P1_PROJECTILE_SRC, P2_PROJECTILE_SRC, P1_BLAST_SRC, P2_BLAST_SRC });\n    } catch (e) {\n      // eslint-disable-next-line no-console\n      console.warn(\"[qte] asset diagnostics failed\", e);\n    }\n  }, 500);\n\n  function framesFromFilename(src: string, fallback: number) {\n    try {\n      const m = /_(\\d+)\\.(png|jpg|jpeg|webp)$/i.exec(src);\n      const n = m ? parseInt(m[1], 10) : NaN;\n      return Number.isFinite(n) ? n : fallback;\n    } catch (e) {\n      return fallback;\n    }\n  }\n\n  let last = performance.now();\n  function loop(now: number) {\n    const dt = Math.min(0.05, (now - last) / 1000);\n    last = now;\n\n    // merge inputs\n    const gp = readGamepadsUnified(P1_KEYS as any, P2_KEYS as any);\n    const mergedInput: Record<string, boolean> = {};\n    function getKeyboard(code: string) {\n      return !!input[code];\n    }\n    [P1_KEYS.left, P1_KEYS.right, P1_KEYS.up, P1_KEYS.down, P1_KEYS.attack, P1_KEYS.parry, P1_KEYS.ranged].forEach((k) => {\n      if (k) mergedInput[k] = !!gp[k] || getKeyboard(k);\n    });\n    [P2_KEYS.left, P2_KEYS.right, P2_KEYS.up, P2_KEYS.down, P2_KEYS.attack, P2_KEYS.parry, P2_KEYS.ranged].forEach((k) => {\n      if (k) mergedInput[k] = !!gp[k] || getKeyboard(k);\n    });\n\n    // draw background\n    if (stageImg.complete && stageImg.naturalWidth > 0) {\n      ctx.drawImage(stageImg, 0, 0, WIDTH, HEIGHT);\n    } else {\n      ctx.fillStyle = \"#071428\";\n      ctx.fillRect(0, 0, WIDTH, HEIGHT);\n    }\n    ctx.fillStyle = \"#333\";\n    ctx.fillRect(0, HEIGHT - 40, WIDTH, 40);\n\n    // update\n    p1.update(dt, mergedInput, projectiles);\n    p2.update(dt, mergedInput, projectiles);\n\n    projectiles.forEach((pr) => pr.update(dt));\n    blasts.forEach((b) => b.update(dt));\n\n    // cleanup\n    for (let i = projectiles.length - 1; i >= 0; i--) if (!projectiles[i].alive) projectiles.splice(i, 1);\n    for (let i = blasts.length - 1; i >= 0; i--) if (!blasts[i].alive) blasts.splice(i, 1);\n\n    // draw\n    p1.draw();\n    p2.draw();\n    projectiles.forEach((pr) => pr.draw(ctx));\n    blasts.forEach((b) => b.draw(ctx));\n\n    // collisions\n    const h1 = p1.hitbox(), h2 = p2.hitbox();\n    if (h1 && aabb(h1, p2.rect())) {\n      if (p2.parrying && !p2.parryConsumed && p2.parryTimer > p2.parryDurationDefault - p2.parryWindowLength) {\n        p2.parryConsumed = true;\n        p2.parryFreezeTimer = 0.12;\n        p1.stunTimer = 1.0;\n      } else {\n        p2.hp = clamp(p2.hp - 1, 0, 100);\n      }\n    }\n    if (h2 && aabb(h2, p1.rect())) {\n      if (p1.parrying && !p1.parryConsumed && p1.parryTimer > p1.parryDurationDefault - p1.parryWindowLength) {\n        p1.parryConsumed = true;\n        p1.parryFreezeTimer = 0.12;\n        p2.stunTimer = 1.0;\n      } else {\n        p1.hp = clamp(p1.hp - 1, 0, 100);\n      }\n    }\n\n    for (const pr of projectiles) {\n      if (!pr.alive) continue;\n      if (pr.owner !== p1 && aabb(pr.rect(), p1.rect())) {\n        p1.hp = clamp(p1.hp - 10, 0, 100);\n        pr.alive = false;\n        // Debug: log hit and blast chosen\n        // eslint-disable-next-line no-console\n        console.debug(\"[qte] projectile hit P1\", { projectileSrc: pr.anim.animations[\"fly\"]?.src, blastSrc: P2_BLAST_SRC });\n        // Use atlas for blast if available\n        let blastImage = null;\n        let blastRects = null;\n        let blastFrames = 4;\n\n        if (globalAtlas2 && globalAtlas2.animations.blast) {\n          blastImage = globalAtlas2.image;\n          blastRects = globalAtlas2.animations.blast.frames;\n          blastFrames = globalAtlas2.animations.blast.frames.length;\n          console.log(`[qte] Blast using atlas frames from cyboard`);\n        } else {\n          console.log(`[qte] Blast: No atlas frames for 'blast' in cyboard, falling back to individual image.`);\n        }\n\n        blasts.push(new Blast(p1.x + p1.w * 0.5, p1.y + p1.h * 0.5, P2_BLAST_SRC, blastFrames, blastImage, blastRects));\n      }\n      if (pr.owner !== p2 && aabb(pr.rect(), p2.rect())) {\n        p2.hp = clamp(p2.hp - 10, 0, 100);\n        pr.alive = false;\n        // Debug: log hit and blast chosen\n        // eslint-disable-next-line no-console\n        console.debug(\"[qte] projectile hit P2\", { projectileSrc: pr.anim.animations[\"fly\"]?.src, blastSrc: P1_BLAST_SRC });\n        // Use atlas for blast if available\n        let blastImage = null;\n        let blastRects = null;\n        let blastFrames = 4;\n\n        if (globalAtlas1 && globalAtlas1.animations.blast) {\n          blastImage = globalAtlas1.image;\n          blastRects = globalAtlas1.animations.blast.frames;\n          blastFrames = globalAtlas1.animations.blast.frames.length;\n          console.log(`[qte] Blast using atlas frames from ninja`);\n        } else {\n          console.log(`[qte] Blast: No atlas frames for 'blast' in ninja, falling back to individual image.`);\n        }\n\n        blasts.push(new Blast(p2.x + p2.w * 0.5, p2.y + p2.h * 0.5, P1_BLAST_SRC, blastFrames, blastImage, blastRects));\n      }\n    }\n\n    // auto-defeat\n    if (p1.hp <= 0 && p1.state !== \"defeat\") {\n      p1.state = \"defeat\";\n      p1.attacking = false;\n      p1.parrying = false;\n      p1.ranging = false;\n      p1.vx = 0;\n      p1.vy = 0;\n      p1.anim.setState(\"defeat\");\n    }\n    if (p2.hp <= 0 && p2.state !== \"defeat\") {\n      p2.state = \"defeat\";\n      p2.attacking = false;\n      p2.parrying = false;\n      p2.ranging = false;\n      p2.vx = 0;\n      p2.vy = 0;\n      p2.anim.setState(\"defeat\");\n    }\n\n    requestAnimationFrame(loop);\n  }\n\n  requestAnimationFrame(loop);\n\n  function aabb(a: { x: number; y: number; w: number; h: number }, b: { x: number; y: number; w: number; h: number }) {\n    return !(a.x + a.w < b.x || b.x + b.w < a.x || a.y + a.h < b.y || b.y + b.h < a.y);\n  }\n\n  return { ctx, p1, p2 };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}