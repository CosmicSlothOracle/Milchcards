{"ast":null,"code":"/**\r\n * Utility: extract frame count from filename pattern *_XX.png.\r\n */function defaultFramesFromFilename(src,fallback){try{const m=/_(\\d+)\\.(png|jpg|jpeg|webp)$/i.exec(src);const n=m?parseInt(m[1],10):NaN;return Number.isFinite(n)?n:fallback;}catch(_unused){return fallback;}}/**\r\n * SpriteAnimator – verwaltet Frame-basierte Sprite-Sheet-Animationen.\r\n *  ‑ Jede Animation liegt in einer PNG-Reihe (Frames horizontal).\r\n *  ‑ draw(ctx, x, y, w, h) rendert den aktuellen Frame.\r\n */export class SpriteAnimator{constructor(defaultImage,frameW,frameH){let animations=arguments.length>3&&arguments[3]!==undefined?arguments[3]:{};this.defaultImage=void 0;this.frameW=void 0;this.frameH=void 0;this.animations=void 0;this.state=\"idle\";this.frame=0;this.acc=0;// Sekunden-Accumulator\nthis.fps=12;this.loop=true;this.defaultImage=defaultImage;this.frameW=frameW;this.frameH=frameH;// Merge defaults\nthis.animations={};for(const key of Object.keys(animations)){var _a$frames,_a$fps,_a$loop,_a$frameW,_a$frameH;const a=animations[key];const full={src:a.src||\"\",frames:(_a$frames=a.frames)!==null&&_a$frames!==void 0?_a$frames:defaultFramesFromFilename(a.src||\"\",1),fps:(_a$fps=a.fps)!==null&&_a$fps!==void 0?_a$fps:12,loop:(_a$loop=a.loop)!==null&&_a$loop!==void 0?_a$loop:true,frameW:(_a$frameW=a.frameW)!==null&&_a$frameW!==void 0?_a$frameW:frameW,frameH:(_a$frameH=a.frameH)!==null&&_a$frameH!==void 0?_a$frameH:frameH};// Preload image (optional)\nif(full.src){const img=new Image();full.image=img;full.imageLoaded=false;full.imageBroken=false;img.onload=()=>full.imageLoaded=true;img.onerror=()=>full.imageBroken=true;img.src=full.src;}this.animations[key]=full;}}setState(state){if(this.state===state)return;this.state=state;this.frame=0;this.acc=0;const a=this.animations[state];if(a){this.fps=a.fps;this.loop=a.loop;}}/**\r\n   * Fixed-timestep Update.\r\n   * @param dt Delta-Zeit in Sekunden\r\n   */update(dt){const a=this.animations[this.state];if(!a)return;this.acc+=dt;const frameTime=1/(a.fps||this.fps);while(this.acc>=frameTime){this.acc-=frameTime;this.frame++;if(this.frame>=a.frames){if(a.loop)this.frame=0;else this.frame=a.frames-1;}}}/**\r\n   * Rendert aktuellen Frame.\r\n   */draw(ctx,x,y,w,h){let flip=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;const a=this.animations[this.state];const img=a&&a.image||this.defaultImage;if(!a||!img||a.imageBroken||!img.complete){// Fallback: graue Box\nctx.fillStyle=\"#666\";ctx.fillRect(x,y,w,h);return;}let sx=this.frame*(a.frameW||this.frameW);let sy=0;// Atlas mode: use rects array if provided\nif(a.rects&&a.rects.length>0){const r=a.rects[this.frame%a.rects.length];sx=r.x;sy=r.y;}ctx.save();if(flip){ctx.translate(x+w,0);ctx.scale(-1,1);x=0;}ctx.drawImage(img,sx,sy,a.frameW,a.frameH,x,y,w,h);ctx.restore();}}","map":{"version":3,"names":["defaultFramesFromFilename","src","fallback","m","exec","n","parseInt","NaN","Number","isFinite","_unused","SpriteAnimator","constructor","defaultImage","frameW","frameH","animations","arguments","length","undefined","state","frame","acc","fps","loop","key","Object","keys","_a$frames","_a$fps","_a$loop","_a$frameW","_a$frameH","a","full","frames","img","Image","image","imageLoaded","imageBroken","onload","onerror","setState","update","dt","frameTime","draw","ctx","x","y","w","h","flip","complete","fillStyle","fillRect","sx","sy","rects","r","save","translate","scale","drawImage","restore"],"sources":["C:/Users/skank/Videos/Cards/Milchcards/src/qte/spriteAnimator.ts"],"sourcesContent":["export interface Rect { x: number; y: number; w: number; h: number }\r\n\r\ninterface AnimationDef {\r\n  src: string; // optional when using atlas\r\n  frames: number;\r\n  fps: number;\r\n  loop: boolean;\r\n  frameW: number;\r\n  frameH: number;\r\n  rects?: Rect[]; // atlas-based frames\r\n  image?: HTMLImageElement;\r\n  imageLoaded?: boolean;\r\n  imageBroken?: boolean;\r\n}\r\n\r\n/**\r\n * Utility: extract frame count from filename pattern *_XX.png.\r\n */\r\nfunction defaultFramesFromFilename(src: string, fallback: number): number {\r\n  try {\r\n    const m = /_(\\d+)\\.(png|jpg|jpeg|webp)$/i.exec(src);\r\n    const n = m ? parseInt(m[1], 10) : NaN;\r\n    return Number.isFinite(n) ? n : fallback;\r\n  } catch {\r\n    return fallback;\r\n  }\r\n}\r\n\r\n/**\r\n * SpriteAnimator – verwaltet Frame-basierte Sprite-Sheet-Animationen.\r\n *  ‑ Jede Animation liegt in einer PNG-Reihe (Frames horizontal).\r\n *  ‑ draw(ctx, x, y, w, h) rendert den aktuellen Frame.\r\n */\r\nexport class SpriteAnimator {\r\n  private defaultImage: HTMLImageElement | null;\r\n  private frameW: number;\r\n  private frameH: number;\r\n  public animations: Record<string, AnimationDef>;\r\n  public state: string = \"idle\";\r\n  public frame = 0;\r\n  private acc = 0; // Sekunden-Accumulator\r\n  private fps = 12;\r\n  private loop = true;\r\n\r\n  constructor(\r\n    defaultImage: HTMLImageElement | null,\r\n    frameW: number,\r\n    frameH: number,\r\n    animations: Record<string, Partial<AnimationDef>> = {}\r\n  ) {\r\n    this.defaultImage = defaultImage;\r\n    this.frameW = frameW;\r\n    this.frameH = frameH;\r\n    // Merge defaults\r\n    this.animations = {};\r\n    for (const key of Object.keys(animations)) {\r\n      const a = animations[key];\r\n      const full: AnimationDef = {\r\n        src: a.src || \"\",\r\n        frames: a.frames ?? defaultFramesFromFilename(a.src || \"\", 1),\r\n        fps: a.fps ?? 12,\r\n        loop: a.loop ?? true,\r\n        frameW: a.frameW ?? frameW,\r\n        frameH: a.frameH ?? frameH,\r\n      } as AnimationDef;\r\n      // Preload image (optional)\r\n      if (full.src) {\r\n        const img = new Image();\r\n        full.image = img;\r\n        full.imageLoaded = false;\r\n        full.imageBroken = false;\r\n        img.onload = () => (full.imageLoaded = true);\r\n        img.onerror = () => (full.imageBroken = true);\r\n        img.src = full.src;\r\n      }\r\n      this.animations[key] = full;\r\n    }\r\n  }\r\n\r\n  setState(state: string) {\r\n    if (this.state === state) return;\r\n    this.state = state;\r\n    this.frame = 0;\r\n    this.acc = 0;\r\n    const a = this.animations[state];\r\n    if (a) {\r\n      this.fps = a.fps;\r\n      this.loop = a.loop;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Fixed-timestep Update.\r\n   * @param dt Delta-Zeit in Sekunden\r\n   */\r\n  update(dt: number) {\r\n    const a = this.animations[this.state];\r\n    if (!a) return;\r\n    this.acc += dt;\r\n    const frameTime = 1 / (a.fps || this.fps);\r\n    while (this.acc >= frameTime) {\r\n      this.acc -= frameTime;\r\n      this.frame++;\r\n      if (this.frame >= a.frames) {\r\n        if (a.loop) this.frame = 0;\r\n        else this.frame = a.frames - 1;\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Rendert aktuellen Frame.\r\n   */\r\n  draw(\r\n    ctx: CanvasRenderingContext2D,\r\n    x: number,\r\n    y: number,\r\n    w: number,\r\n    h: number,\r\n    flip = false\r\n  ) {\r\n    const a = this.animations[this.state];\r\n    const img = (a && a.image) || this.defaultImage;\r\n    if (!a || !img || a.imageBroken || !img.complete) {\r\n      // Fallback: graue Box\r\n      ctx.fillStyle = \"#666\";\r\n      ctx.fillRect(x, y, w, h);\r\n      return;\r\n    }\r\n    let sx = this.frame * (a.frameW || this.frameW);\r\n    let sy = 0;\r\n\r\n    // Atlas mode: use rects array if provided\r\n    if (a.rects && a.rects.length > 0) {\r\n      const r = a.rects[this.frame % a.rects.length];\r\n      sx = r.x;\r\n      sy = r.y;\r\n    }\r\n\r\n    ctx.save();\r\n    if (flip) {\r\n      ctx.translate(x + w, 0);\r\n      ctx.scale(-1, 1);\r\n      x = 0;\r\n    }\r\n    ctx.drawImage(img, sx, sy, a.frameW, a.frameH, x, y, w, h);\r\n    ctx.restore();\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}