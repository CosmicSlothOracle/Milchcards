{"ast":null,"code":"import { triggerCardEffects } from '../effects/cards';\nimport { resolveQueue } from '../utils/queue';\n// Pure game engine - no React dependencies\nexport class GameEngine {\n  constructor(initialState) {\n    this.state = void 0;\n    this.state = {\n      ...initialState\n    };\n  }\n  getState() {\n    return {\n      ...this.state\n    };\n  }\n\n  // Core action: Play a card\n  playCard(player, card, targetLane) {\n    // Validate AP cost\n    if (this.state.actionPoints[player] < 1) {\n      console.warn(`Player ${player} has insufficient AP: ${this.state.actionPoints[player]}`);\n      return false;\n    }\n\n    // Validate card is in hand\n    const handIndex = this.state.hands[player].findIndex(c => c.uid === card.uid);\n    if (handIndex === -1) {\n      console.warn(`Card ${card.name} not found in player ${player}'s hand`);\n      return false;\n    }\n\n    // Remove card from hand\n    const [playedCard] = this.state.hands[player].splice(handIndex, 1);\n\n    // Determine target lane if not specified\n    const lane = targetLane || this.determineCardLane(playedCard);\n\n    // Add card to board\n    this.state.board[player][lane].push(playedCard);\n\n    // Consume AP\n    this.state.actionPoints[player] = Math.max(0, this.state.actionPoints[player] - 1);\n\n    // Trigger card effects\n    triggerCardEffects(this.state, player, playedCard);\n\n    // Check for trap triggers from opponent\n    const opponent = player === 1 ? 2 : 1;\n    const trapEvents = checkTraps(this.state, opponent, playedCard);\n    if (trapEvents.length > 0) {\n      if (!this.state._effectQueue) this.state._effectQueue = [];\n      this.state._effectQueue.push(...trapEvents);\n    }\n\n    // Resolve effect queue\n    if (this.state._effectQueue && this.state._effectQueue.length > 0) {\n      const events = [...this.state._effectQueue];\n      this.state._effectQueue = [];\n      resolveQueue(this.state, events);\n    }\n    console.log(`Card played: ${playedCard.name} by player ${player} in ${lane}`);\n    return true;\n  }\n\n  // Determine which lane a card should go to based on its type\n  determineCardLane(card) {\n    switch (card.kind) {\n      case 'spec':\n        // Check if it's a Sofort-Initiative\n        const specialCard = card;\n        if (specialCard.type && specialCard.type.toLowerCase().includes('sofort-initiative')) {\n          return 'sofort';\n        }\n        return 'innen';\n      case 'pol':\n        return 'aussen';\n      default:\n        console.warn(`Unknown card kind: ${card.kind}, defaulting to 'innen'`);\n        return 'innen';\n    }\n  }\n\n  // Start turn - give player 2 AP\n  startTurn(player) {\n    this.state.actionPoints[player] = 2;\n    console.log(`Turn started for player ${player}, AP set to 2`);\n  }\n\n  // Draw cards\n  drawCards(player, amount) {\n    for (let i = 0; i < amount; i++) {\n      const topCard = this.state.decks[player].shift();\n      if (topCard) {\n        this.state.hands[player].push(topCard);\n      } else {\n        console.warn(`No cards left in deck for player ${player}`);\n        break;\n      }\n    }\n  }\n\n  // Get current AP for player\n  getActionPoints(player) {\n    return this.state.actionPoints[player] || 0;\n  }\n\n  // Check if player can play a card\n  canPlayCard(player) {\n    return this.getActionPoints(player) >= 1;\n  }\n\n  // Get player's hand\n  getHand(player) {\n    return [...this.state.hands[player]];\n  }\n\n  // Get player's board state\n  getBoard(player) {\n    return {\n      innen: [...this.state.board[player].innen],\n      aussen: [...this.state.board[player].aussen],\n      sofort: [...this.state.board[player].sofort]\n    };\n  }\n}","map":{"version":3,"names":["triggerCardEffects","resolveQueue","GameEngine","constructor","initialState","state","getState","playCard","player","card","targetLane","actionPoints","console","warn","handIndex","hands","findIndex","c","uid","name","playedCard","splice","lane","determineCardLane","board","push","Math","max","opponent","trapEvents","checkTraps","length","_effectQueue","events","log","kind","specialCard","type","toLowerCase","includes","startTurn","drawCards","amount","i","topCard","decks","shift","getActionPoints","canPlayCard","getHand","getBoard","innen","aussen","sofort"],"sources":["C:/Users/skank/Videos/Cards/Milchcards/src/engine/gameEngine.ts"],"sourcesContent":["import { GameState, Player, Card } from '../types/game';\r\nimport { triggerCardEffects } from '../effects/cards';\r\nimport { resolveQueue } from '../utils/queue';\r\nimport { applyTrapsOnCardPlayed } from '../utils/traps';\r\n\r\n// Pure game engine - no React dependencies\r\nexport class GameEngine {\r\n  private state: GameState;\r\n\r\n  constructor(initialState: GameState) {\r\n    this.state = { ...initialState };\r\n  }\r\n\r\n  getState(): GameState {\r\n    return { ...this.state };\r\n  }\r\n\r\n  // Core action: Play a card\r\n  playCard(player: Player, card: Card, targetLane?: 'innen' | 'aussen' | 'sofort'): boolean {\r\n    // Validate AP cost\r\n    if (this.state.actionPoints[player] < 1) {\r\n      console.warn(`Player ${player} has insufficient AP: ${this.state.actionPoints[player]}`);\r\n      return false;\r\n    }\r\n\r\n    // Validate card is in hand\r\n    const handIndex = this.state.hands[player].findIndex(c => c.uid === card.uid);\r\n    if (handIndex === -1) {\r\n      console.warn(`Card ${card.name} not found in player ${player}'s hand`);\r\n      return false;\r\n    }\r\n\r\n    // Remove card from hand\r\n    const [playedCard] = this.state.hands[player].splice(handIndex, 1);\r\n\r\n    // Determine target lane if not specified\r\n    const lane = targetLane || this.determineCardLane(playedCard);\r\n\r\n    // Add card to board\r\n    this.state.board[player][lane].push(playedCard);\r\n\r\n    // Consume AP\r\n    this.state.actionPoints[player] = Math.max(0, this.state.actionPoints[player] - 1);\r\n\r\n    // Trigger card effects\r\n    triggerCardEffects(this.state, player, playedCard);\r\n\r\n    // Check for trap triggers from opponent\r\n    const opponent = player === 1 ? 2 : 1;\r\n    const trapEvents = checkTraps(this.state, opponent, playedCard);\r\n    if (trapEvents.length > 0) {\r\n      if (!this.state._effectQueue) this.state._effectQueue = [];\r\n      this.state._effectQueue.push(...trapEvents);\r\n    }\r\n\r\n    // Resolve effect queue\r\n    if (this.state._effectQueue && this.state._effectQueue.length > 0) {\r\n      const events = [...this.state._effectQueue];\r\n      this.state._effectQueue = [];\r\n      resolveQueue(this.state, events);\r\n    }\r\n\r\n    console.log(`Card played: ${playedCard.name} by player ${player} in ${lane}`);\r\n    return true;\r\n  }\r\n\r\n  // Determine which lane a card should go to based on its type\r\n  private determineCardLane(card: Card): 'innen' | 'aussen' | 'sofort' {\r\n    switch (card.kind) {\r\n      case 'spec':\r\n        // Check if it's a Sofort-Initiative\r\n        const specialCard = card as any;\r\n        if (specialCard.type && specialCard.type.toLowerCase().includes('sofort-initiative')) {\r\n          return 'sofort';\r\n        }\r\n        return 'innen';\r\n      case 'pol':\r\n        return 'aussen';\r\n      default:\r\n        console.warn(`Unknown card kind: ${card.kind}, defaulting to 'innen'`);\r\n        return 'innen';\r\n    }\r\n  }\r\n\r\n  // Start turn - give player 2 AP\r\n  startTurn(player: Player): void {\r\n    this.state.actionPoints[player] = 2;\r\n    console.log(`Turn started for player ${player}, AP set to 2`);\r\n  }\r\n\r\n  // Draw cards\r\n  drawCards(player: Player, amount: number): void {\r\n    for (let i = 0; i < amount; i++) {\r\n      const topCard = this.state.decks[player].shift();\r\n      if (topCard) {\r\n        this.state.hands[player].push(topCard);\r\n      } else {\r\n        console.warn(`No cards left in deck for player ${player}`);\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  // Get current AP for player\r\n  getActionPoints(player: Player): number {\r\n    return this.state.actionPoints[player] || 0;\r\n  }\r\n\r\n  // Check if player can play a card\r\n  canPlayCard(player: Player): boolean {\r\n    return this.getActionPoints(player) >= 1;\r\n  }\r\n\r\n  // Get player's hand\r\n  getHand(player: Player): Card[] {\r\n    return [...this.state.hands[player]];\r\n  }\r\n\r\n  // Get player's board state\r\n  getBoard(player: Player) {\r\n    return {\r\n      innen: [...this.state.board[player].innen],\r\n      aussen: [...this.state.board[player].aussen],\r\n      sofort: [...this.state.board[player].sofort]\r\n    };\r\n  }\r\n}\r\n"],"mappings":"AACA,SAASA,kBAAkB,QAAQ,kBAAkB;AACrD,SAASC,YAAY,QAAQ,gBAAgB;AAG7C;AACA,OAAO,MAAMC,UAAU,CAAC;EAGtBC,WAAWA,CAACC,YAAuB,EAAE;IAAA,KAF7BC,KAAK;IAGX,IAAI,CAACA,KAAK,GAAG;MAAE,GAAGD;IAAa,CAAC;EAClC;EAEAE,QAAQA,CAAA,EAAc;IACpB,OAAO;MAAE,GAAG,IAAI,CAACD;IAAM,CAAC;EAC1B;;EAEA;EACAE,QAAQA,CAACC,MAAc,EAAEC,IAAU,EAAEC,UAA0C,EAAW;IACxF;IACA,IAAI,IAAI,CAACL,KAAK,CAACM,YAAY,CAACH,MAAM,CAAC,GAAG,CAAC,EAAE;MACvCI,OAAO,CAACC,IAAI,CAAC,UAAUL,MAAM,yBAAyB,IAAI,CAACH,KAAK,CAACM,YAAY,CAACH,MAAM,CAAC,EAAE,CAAC;MACxF,OAAO,KAAK;IACd;;IAEA;IACA,MAAMM,SAAS,GAAG,IAAI,CAACT,KAAK,CAACU,KAAK,CAACP,MAAM,CAAC,CAACQ,SAAS,CAACC,CAAC,IAAIA,CAAC,CAACC,GAAG,KAAKT,IAAI,CAACS,GAAG,CAAC;IAC7E,IAAIJ,SAAS,KAAK,CAAC,CAAC,EAAE;MACpBF,OAAO,CAACC,IAAI,CAAC,QAAQJ,IAAI,CAACU,IAAI,wBAAwBX,MAAM,SAAS,CAAC;MACtE,OAAO,KAAK;IACd;;IAEA;IACA,MAAM,CAACY,UAAU,CAAC,GAAG,IAAI,CAACf,KAAK,CAACU,KAAK,CAACP,MAAM,CAAC,CAACa,MAAM,CAACP,SAAS,EAAE,CAAC,CAAC;;IAElE;IACA,MAAMQ,IAAI,GAAGZ,UAAU,IAAI,IAAI,CAACa,iBAAiB,CAACH,UAAU,CAAC;;IAE7D;IACA,IAAI,CAACf,KAAK,CAACmB,KAAK,CAAChB,MAAM,CAAC,CAACc,IAAI,CAAC,CAACG,IAAI,CAACL,UAAU,CAAC;;IAE/C;IACA,IAAI,CAACf,KAAK,CAACM,YAAY,CAACH,MAAM,CAAC,GAAGkB,IAAI,CAACC,GAAG,CAAC,CAAC,EAAE,IAAI,CAACtB,KAAK,CAACM,YAAY,CAACH,MAAM,CAAC,GAAG,CAAC,CAAC;;IAElF;IACAR,kBAAkB,CAAC,IAAI,CAACK,KAAK,EAAEG,MAAM,EAAEY,UAAU,CAAC;;IAElD;IACA,MAAMQ,QAAQ,GAAGpB,MAAM,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC;IACrC,MAAMqB,UAAU,GAAGC,UAAU,CAAC,IAAI,CAACzB,KAAK,EAAEuB,QAAQ,EAAER,UAAU,CAAC;IAC/D,IAAIS,UAAU,CAACE,MAAM,GAAG,CAAC,EAAE;MACzB,IAAI,CAAC,IAAI,CAAC1B,KAAK,CAAC2B,YAAY,EAAE,IAAI,CAAC3B,KAAK,CAAC2B,YAAY,GAAG,EAAE;MAC1D,IAAI,CAAC3B,KAAK,CAAC2B,YAAY,CAACP,IAAI,CAAC,GAAGI,UAAU,CAAC;IAC7C;;IAEA;IACA,IAAI,IAAI,CAACxB,KAAK,CAAC2B,YAAY,IAAI,IAAI,CAAC3B,KAAK,CAAC2B,YAAY,CAACD,MAAM,GAAG,CAAC,EAAE;MACjE,MAAME,MAAM,GAAG,CAAC,GAAG,IAAI,CAAC5B,KAAK,CAAC2B,YAAY,CAAC;MAC3C,IAAI,CAAC3B,KAAK,CAAC2B,YAAY,GAAG,EAAE;MAC5B/B,YAAY,CAAC,IAAI,CAACI,KAAK,EAAE4B,MAAM,CAAC;IAClC;IAEArB,OAAO,CAACsB,GAAG,CAAC,gBAAgBd,UAAU,CAACD,IAAI,cAAcX,MAAM,OAAOc,IAAI,EAAE,CAAC;IAC7E,OAAO,IAAI;EACb;;EAEA;EACQC,iBAAiBA,CAACd,IAAU,EAAiC;IACnE,QAAQA,IAAI,CAAC0B,IAAI;MACf,KAAK,MAAM;QACT;QACA,MAAMC,WAAW,GAAG3B,IAAW;QAC/B,IAAI2B,WAAW,CAACC,IAAI,IAAID,WAAW,CAACC,IAAI,CAACC,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,mBAAmB,CAAC,EAAE;UACpF,OAAO,QAAQ;QACjB;QACA,OAAO,OAAO;MAChB,KAAK,KAAK;QACR,OAAO,QAAQ;MACjB;QACE3B,OAAO,CAACC,IAAI,CAAC,sBAAsBJ,IAAI,CAAC0B,IAAI,yBAAyB,CAAC;QACtE,OAAO,OAAO;IAClB;EACF;;EAEA;EACAK,SAASA,CAAChC,MAAc,EAAQ;IAC9B,IAAI,CAACH,KAAK,CAACM,YAAY,CAACH,MAAM,CAAC,GAAG,CAAC;IACnCI,OAAO,CAACsB,GAAG,CAAC,2BAA2B1B,MAAM,eAAe,CAAC;EAC/D;;EAEA;EACAiC,SAASA,CAACjC,MAAc,EAAEkC,MAAc,EAAQ;IAC9C,KAAK,IAAIC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAGD,MAAM,EAAEC,CAAC,EAAE,EAAE;MAC/B,MAAMC,OAAO,GAAG,IAAI,CAACvC,KAAK,CAACwC,KAAK,CAACrC,MAAM,CAAC,CAACsC,KAAK,CAAC,CAAC;MAChD,IAAIF,OAAO,EAAE;QACX,IAAI,CAACvC,KAAK,CAACU,KAAK,CAACP,MAAM,CAAC,CAACiB,IAAI,CAACmB,OAAO,CAAC;MACxC,CAAC,MAAM;QACLhC,OAAO,CAACC,IAAI,CAAC,oCAAoCL,MAAM,EAAE,CAAC;QAC1D;MACF;IACF;EACF;;EAEA;EACAuC,eAAeA,CAACvC,MAAc,EAAU;IACtC,OAAO,IAAI,CAACH,KAAK,CAACM,YAAY,CAACH,MAAM,CAAC,IAAI,CAAC;EAC7C;;EAEA;EACAwC,WAAWA,CAACxC,MAAc,EAAW;IACnC,OAAO,IAAI,CAACuC,eAAe,CAACvC,MAAM,CAAC,IAAI,CAAC;EAC1C;;EAEA;EACAyC,OAAOA,CAACzC,MAAc,EAAU;IAC9B,OAAO,CAAC,GAAG,IAAI,CAACH,KAAK,CAACU,KAAK,CAACP,MAAM,CAAC,CAAC;EACtC;;EAEA;EACA0C,QAAQA,CAAC1C,MAAc,EAAE;IACvB,OAAO;MACL2C,KAAK,EAAE,CAAC,GAAG,IAAI,CAAC9C,KAAK,CAACmB,KAAK,CAAChB,MAAM,CAAC,CAAC2C,KAAK,CAAC;MAC1CC,MAAM,EAAE,CAAC,GAAG,IAAI,CAAC/C,KAAK,CAACmB,KAAK,CAAChB,MAAM,CAAC,CAAC4C,MAAM,CAAC;MAC5CC,MAAM,EAAE,CAAC,GAAG,IAAI,CAAChD,KAAK,CAACmB,KAAK,CAAChB,MAAM,CAAC,CAAC6C,MAAM;IAC7C,CAAC;EACH;AACF","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}