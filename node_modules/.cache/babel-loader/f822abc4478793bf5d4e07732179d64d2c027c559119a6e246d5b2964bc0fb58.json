{"ast":null,"code":"function other(p) {\n  return p === 1 ? 2 : 1;\n}\nexport function startOfTurn(state, p) {\n  var _state$board$p$innen, _state$board$p;\n  // AP reset\n  state.actionPoints[p] = 2;\n\n  // Flags reset\n  const f = state.effectFlags[p];\n  // Flags reset\n  const prevZuck = f.zuckSpent;\n  f.zuckOnceAp = false;\n  f.zuckSpent = false;\n  f.aiWeiweiOnActivate = false;\n  f.auraScience = 0;\n  f.auraHealth = 0;\n  f.auraMilitaryPenalty = 0;\n  // Oppositionsblockade ends at start of player's turn\n  f.initiativesLocked = false;\n  // Reset new AP bonuses – they are \"granted\" fresh each turn\n  f.apBonusInitiativeNext = 0;\n  f.apBonusInitiativeOnce = 0;\n\n  // Helper to consume double aura flag once\n  const consumeDouble = () => {\n    if (f.doublePublicAura) {\n      f.doublePublicAura = false;\n      if (!state._effectQueue) state._effectQueue = [];\n      state._effectQueue.push({\n        type: 'LOG',\n        msg: 'Double Public Aura consumed.'\n      });\n      return true;\n    }\n    return false;\n  };\n\n  // Determine active public cards (inner lane)\n  const pubNames = ((_state$board$p$innen = (_state$board$p = state.board[p]) === null || _state$board$p === void 0 ? void 0 : _state$board$p.innen) !== null && _state$board$p$innen !== void 0 ? _state$board$p$innen : []).map(c => c.name);\n\n  // Apply auras with possible doubling (consume order defined)\n  if (pubNames.includes('Jennifer Doudna')) {\n    var _f$auraScience;\n    const doubled = consumeDouble();\n    f.auraScience = ((_f$auraScience = f.auraScience) !== null && _f$auraScience !== void 0 ? _f$auraScience : 0) + (doubled ? 2 : 1);\n  }\n  if (pubNames.includes('Anthony Fauci')) {\n    var _f$auraHealth;\n    const doubled = consumeDouble();\n    f.auraHealth = ((_f$auraHealth = f.auraHealth) !== null && _f$auraHealth !== void 0 ? _f$auraHealth : 0) + (doubled ? 2 : 1);\n  }\n  if (pubNames.includes('Noam Chomsky')) {\n    var _f$auraMilitaryPenalt;\n    const doubled = consumeDouble();\n    f.auraMilitaryPenalty = ((_f$auraMilitaryPenalt = f.auraMilitaryPenalty) !== null && _f$auraMilitaryPenalt !== void 0 ? _f$auraMilitaryPenalt : 0) + (doubled ? 2 : 1);\n  }\n\n  // einmalige Aktivierungsboni\n  if (pubNames.includes('Mark Zuckerberg')) f.zuckOnceAp = true;\n  if (pubNames.includes('Ai Weiwei')) f.aiWeiweiOnActivate = true;\n}\n\n// Legacy compatibility\nexport function applyStartOfTurnFlags(state, player, log) {\n  startOfTurn(state, player);\n}\nexport function applyStartOfTurnHooks(state, player, log) {\n  applyStartOfTurnFlags(state, player, log);\n}","map":{"version":3,"names":["other","p","startOfTurn","state","_state$board$p$innen","_state$board$p","actionPoints","f","effectFlags","prevZuck","zuckSpent","zuckOnceAp","aiWeiweiOnActivate","auraScience","auraHealth","auraMilitaryPenalty","initiativesLocked","apBonusInitiativeNext","apBonusInitiativeOnce","consumeDouble","doublePublicAura","_effectQueue","push","type","msg","pubNames","board","innen","map","c","name","includes","_f$auraScience","doubled","_f$auraHealth","_f$auraMilitaryPenalt","applyStartOfTurnFlags","player","log","applyStartOfTurnHooks"],"sources":["C:/Users/skank/Videos/Cards/Milchcards/src/utils/startOfTurnHooks.ts"],"sourcesContent":["import { GameState, Player } from '../types/game';\r\n\r\nfunction other(p: Player): Player { return p === 1 ? 2 : 1; }\r\n\r\nexport function startOfTurn(state: GameState, p: Player) {\r\n  // AP reset\r\n  state.actionPoints[p] = 2;\r\n\r\n  // Flags reset\r\n  const f = state.effectFlags[p];\r\n  // Flags reset\r\n  const prevZuck = f.zuckSpent;\r\n  f.zuckOnceAp = false;\r\n  f.zuckSpent = false;\r\n  f.aiWeiweiOnActivate = false;\r\n  f.auraScience = 0;\r\n  f.auraHealth = 0;\r\n  f.auraMilitaryPenalty = 0;\r\n  // Oppositionsblockade ends at start of player's turn\r\n  f.initiativesLocked = false;\r\n  // Reset new AP bonuses – they are \"granted\" fresh each turn\r\n  f.apBonusInitiativeNext = 0;\r\n  f.apBonusInitiativeOnce = 0;\r\n\r\n  // Helper to consume double aura flag once\r\n  const consumeDouble = (): boolean => {\r\n    if (f.doublePublicAura) {\r\n      f.doublePublicAura = false;\r\n      if (!state._effectQueue) state._effectQueue = [];\r\n      state._effectQueue.push({ type: 'LOG', msg: 'Double Public Aura consumed.' } as any);\r\n      return true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  // Determine active public cards (inner lane)\r\n  const pubNames: string[] = (state.board[p]?.innen ?? []).map(c => c.name);\r\n\r\n  // Apply auras with possible doubling (consume order defined)\r\n  if (pubNames.includes('Jennifer Doudna')) {\r\n    const doubled = consumeDouble();\r\n    f.auraScience = (f.auraScience ?? 0) + (doubled ? 2 : 1);\r\n  }\r\n  if (pubNames.includes('Anthony Fauci')) {\r\n    const doubled = consumeDouble();\r\n    f.auraHealth = (f.auraHealth ?? 0) + (doubled ? 2 : 1);\r\n  }\r\n  if (pubNames.includes('Noam Chomsky')) {\r\n    const doubled = consumeDouble();\r\n    f.auraMilitaryPenalty = (f.auraMilitaryPenalty ?? 0) + (doubled ? 2 : 1);\r\n  }\r\n\r\n  // einmalige Aktivierungsboni\r\n  if (pubNames.includes('Mark Zuckerberg')) f.zuckOnceAp = true;\r\n  if (pubNames.includes('Ai Weiwei')) f.aiWeiweiOnActivate = true;\r\n}\r\n\r\n// Legacy compatibility\r\nexport function applyStartOfTurnFlags(state: GameState, player: Player, log: (m: string) => void) {\r\n  startOfTurn(state, player);\r\n}\r\n\r\nexport function applyStartOfTurnHooks(state: GameState, player: Player, log: (m: string) => void) {\r\n  applyStartOfTurnFlags(state, player, log);\r\n}"],"mappings":"AAEA,SAASA,KAAKA,CAACC,CAAS,EAAU;EAAE,OAAOA,CAAC,KAAK,CAAC,GAAG,CAAC,GAAG,CAAC;AAAE;AAE5D,OAAO,SAASC,WAAWA,CAACC,KAAgB,EAAEF,CAAS,EAAE;EAAA,IAAAG,oBAAA,EAAAC,cAAA;EACvD;EACAF,KAAK,CAACG,YAAY,CAACL,CAAC,CAAC,GAAG,CAAC;;EAEzB;EACA,MAAMM,CAAC,GAAGJ,KAAK,CAACK,WAAW,CAACP,CAAC,CAAC;EAC9B;EACA,MAAMQ,QAAQ,GAAGF,CAAC,CAACG,SAAS;EAC5BH,CAAC,CAACI,UAAU,GAAG,KAAK;EACpBJ,CAAC,CAACG,SAAS,GAAG,KAAK;EACnBH,CAAC,CAACK,kBAAkB,GAAG,KAAK;EAC5BL,CAAC,CAACM,WAAW,GAAG,CAAC;EACjBN,CAAC,CAACO,UAAU,GAAG,CAAC;EAChBP,CAAC,CAACQ,mBAAmB,GAAG,CAAC;EACzB;EACAR,CAAC,CAACS,iBAAiB,GAAG,KAAK;EAC3B;EACAT,CAAC,CAACU,qBAAqB,GAAG,CAAC;EAC3BV,CAAC,CAACW,qBAAqB,GAAG,CAAC;;EAE3B;EACA,MAAMC,aAAa,GAAGA,CAAA,KAAe;IACnC,IAAIZ,CAAC,CAACa,gBAAgB,EAAE;MACtBb,CAAC,CAACa,gBAAgB,GAAG,KAAK;MAC1B,IAAI,CAACjB,KAAK,CAACkB,YAAY,EAAElB,KAAK,CAACkB,YAAY,GAAG,EAAE;MAChDlB,KAAK,CAACkB,YAAY,CAACC,IAAI,CAAC;QAAEC,IAAI,EAAE,KAAK;QAAEC,GAAG,EAAE;MAA+B,CAAQ,CAAC;MACpF,OAAO,IAAI;IACb;IACA,OAAO,KAAK;EACd,CAAC;;EAED;EACA,MAAMC,QAAkB,GAAG,EAAArB,oBAAA,IAAAC,cAAA,GAACF,KAAK,CAACuB,KAAK,CAACzB,CAAC,CAAC,cAAAI,cAAA,uBAAdA,cAAA,CAAgBsB,KAAK,cAAAvB,oBAAA,cAAAA,oBAAA,GAAI,EAAE,EAAEwB,GAAG,CAACC,CAAC,IAAIA,CAAC,CAACC,IAAI,CAAC;;EAEzE;EACA,IAAIL,QAAQ,CAACM,QAAQ,CAAC,iBAAiB,CAAC,EAAE;IAAA,IAAAC,cAAA;IACxC,MAAMC,OAAO,GAAGd,aAAa,CAAC,CAAC;IAC/BZ,CAAC,CAACM,WAAW,GAAG,EAAAmB,cAAA,GAACzB,CAAC,CAACM,WAAW,cAAAmB,cAAA,cAAAA,cAAA,GAAI,CAAC,KAAKC,OAAO,GAAG,CAAC,GAAG,CAAC,CAAC;EAC1D;EACA,IAAIR,QAAQ,CAACM,QAAQ,CAAC,eAAe,CAAC,EAAE;IAAA,IAAAG,aAAA;IACtC,MAAMD,OAAO,GAAGd,aAAa,CAAC,CAAC;IAC/BZ,CAAC,CAACO,UAAU,GAAG,EAAAoB,aAAA,GAAC3B,CAAC,CAACO,UAAU,cAAAoB,aAAA,cAAAA,aAAA,GAAI,CAAC,KAAKD,OAAO,GAAG,CAAC,GAAG,CAAC,CAAC;EACxD;EACA,IAAIR,QAAQ,CAACM,QAAQ,CAAC,cAAc,CAAC,EAAE;IAAA,IAAAI,qBAAA;IACrC,MAAMF,OAAO,GAAGd,aAAa,CAAC,CAAC;IAC/BZ,CAAC,CAACQ,mBAAmB,GAAG,EAAAoB,qBAAA,GAAC5B,CAAC,CAACQ,mBAAmB,cAAAoB,qBAAA,cAAAA,qBAAA,GAAI,CAAC,KAAKF,OAAO,GAAG,CAAC,GAAG,CAAC,CAAC;EAC1E;;EAEA;EACA,IAAIR,QAAQ,CAACM,QAAQ,CAAC,iBAAiB,CAAC,EAAExB,CAAC,CAACI,UAAU,GAAG,IAAI;EAC7D,IAAIc,QAAQ,CAACM,QAAQ,CAAC,WAAW,CAAC,EAAExB,CAAC,CAACK,kBAAkB,GAAG,IAAI;AACjE;;AAEA;AACA,OAAO,SAASwB,qBAAqBA,CAACjC,KAAgB,EAAEkC,MAAc,EAAEC,GAAwB,EAAE;EAChGpC,WAAW,CAACC,KAAK,EAAEkC,MAAM,CAAC;AAC5B;AAEA,OAAO,SAASE,qBAAqBA,CAACpC,KAAgB,EAAEkC,MAAc,EAAEC,GAAwB,EAAE;EAChGF,qBAAqB,CAACjC,KAAK,EAAEkC,MAAM,EAAEC,GAAG,CAAC;AAC3C","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}