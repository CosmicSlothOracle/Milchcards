{"ast":null,"code":"import _objectSpread from\"C:/Users/skank/Videos/Cards/Milchcards/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import{useState,useCallback}from'react';import{createDefaultEffectFlags}from'../types/game';import{Pols,Specials,PRESET_DECKS}from'../data/gameData';import{sumRow,shuffle,makePolInstance,makeSpecInstance,buildDeckFromEntries,drawCards,drawCardsAtRoundEnd,tryApplyNegativeEffect,adjustInfluence,findCardLocation,sumGovernmentInfluenceWithAuras,EffectQueueManager,ActiveAbilitiesManager}from'../utils/gameUtils';import{getCardDetails}from'../data/cardDetails';import{useGameActions}from'./useGameActions';import{useGameAI}from'./useGameAI';import{useGameEffects}from'./useGameEffects';import{applyStartOfTurnHooks}from'../utils/startOfTurnHooks';import{emptyBoard}from'../state/board';const initialGameState={round:1,current:1,passed:{1:false,2:false},actionPoints:{1:2,2:2},actionsUsed:{1:0,2:0},decks:{1:[],2:[]},hands:{1:[],2:[]},traps:{1:[],2:[]},board:emptyBoard(),permanentSlots:{1:{government:null,public:null},2:{government:null,public:null}},discard:[],log:[],activeRefresh:{1:0,2:0},roundsWon:{1:0,2:0},gameWinner:null,effectFlags:{1:createDefaultEffectFlags(),2:createDefaultEffectFlags()},effectQueue:EffectQueueManager.initializeQueue(),activeAbilities:{1:[],2:[]},pendingAbilitySelect:undefined,aiEnabled:{1:false,2:false}};export function useGameState(){const[gameState,setGameState]=useState(initialGameState);const[selectedHandIndex,setSelectedHandIndex]=useState(null);const log=useCallback(msg=>{const timestamp=new Date().toLocaleTimeString('de-DE',{hour:'2-digit',minute:'2-digit',second:'2-digit'});const logEntry=\"[\".concat(timestamp,\"] \").concat(msg);console.log(logEntry);// Also log to console for debugging\nsetGameState(prev=>_objectSpread(_objectSpread({},prev),{},{log:[...prev.log,logEntry]}));},[]);// Enhanced logging functions for different types of events\nconst logUIInteraction=useCallback((action,details)=>{log(\"\\uD83C\\uDFAF UI: \".concat(action,\" - \").concat(details));},[log]);const logGameStateChange=useCallback((change,details)=>{log(\"\\uD83D\\uDD04 STATE: \".concat(change,\" - \").concat(details));},[log]);const logAIAction=useCallback((action,details)=>{log(\"\\uD83E\\uDD16 KI: \".concat(action,\" - \").concat(details));},[log]);const logCardEffect=useCallback((cardName,effect)=>{log(\"\\u2728 EFFEKT: \".concat(cardName,\" - \").concat(effect));},[log]);const logIntervention=useCallback((interventionName,trigger)=>{log(\"\\uD83D\\uDCA5 INTERVENTION: \".concat(interventionName,\" ausgel\\xF6st durch \").concat(trigger));},[log]);// New detailed logging functions for debugging\nconst logFunctionCall=useCallback((functionName,params,context)=>{const paramStr=typeof params==='object'?JSON.stringify(params,null,2):String(params);log(\"\\uD83D\\uDD27 CALL: \".concat(functionName,\"(\").concat(paramStr,\") - \").concat(context));},[log]);const logDataFlow=useCallback((from,to,data,action)=>{const dataStr=typeof data==='object'?JSON.stringify(data,null,2):String(data);log(\"\\uD83D\\uDCCA FLOW: \".concat(from,\" \\u2192 \").concat(to,\" | \").concat(action,\" | Data: \").concat(dataStr));},[log]);const logConditionCheck=useCallback((condition,result,context)=>{log(\"\\uD83D\\uDD0D CHECK: \".concat(condition,\" = \").concat(result,\" - \").concat(context));},[log]);const logError=useCallback((error,context)=>{log(\"\\u274C ERROR: \".concat(error,\" - \").concat(context));},[log]);const logWarning=useCallback((warning,context)=>{log(\"\\u26A0\\uFE0F WARN: \".concat(warning,\" - \").concat(context));},[log]);// Nach Queue-AuflÃ¶sung: Hand-Arrays immutabel neu zuweisen â†’ Canvas & UI bekommen die neuen UIDs\nconst afterQueueResolved=useCallback(()=>{setGameState(s=>{var _version;const n=_objectSpread({},s);n.hands={1:[...s.hands[1]],2:[...s.hands[2]]};// optional: version bump fÃ¼r Canvas\nn._version=((_version=s._version)!==null&&_version!==void 0?_version:0)+1;return n;});},[]);// Import functionality from separated hooks\nconst gameActions=useGameActions(gameState,setGameState,log,afterQueueResolved);const gameAI=useGameAI(gameState,setGameState,log);const gameEffects=useGameEffects(gameState,setGameState,log);const dealStartingHands=useCallback(()=>{console.log('[DIAG] dealStartingHands called');function buildDeck(){const polPool=[...Pols];const specPool=[...Specials];shuffle(polPool);shuffle(specPool);const deck=[];polPool.slice(0,14).forEach(p=>deck.push(makePolInstance(p)));// prefer more useful/implemented specials\nconst implFirst=['media','pledge','pledge2','sanctions','dnc1','dnc2','dnc3','reshuffle','mission','trap_fakenews','trap_protest','trap_scandal'];const srt=specPool.slice().sort((a,b)=>implFirst.indexOf(a.impl)-implFirst.indexOf(b.impl));srt.slice(0,11).forEach(s=>deck.push(makeSpecInstance(s)));return shuffle(deck).slice(0,25);}const deck1=buildDeck();const deck2=buildDeck();console.log('[DIAG] built decks lengths',deck1.length,deck2.length);setGameState(prev=>_objectSpread(_objectSpread({},prev),{},{decks:{1:deck1,2:deck2},hands:{1:deck1.splice(0,5),2:deck2.splice(0,5)}}));console.log('[DIAG] setGameState after deal: hands[1].length',deck1.length>=5?5:deck1.length);},[]);const startNewGame=useCallback(()=>{setGameState(_objectSpread(_objectSpread({},initialGameState),{},{round:1,current:1,passed:{1:false,2:false},actionPoints:{1:2,2:2},actionsUsed:{1:0,2:0},board:emptyBoard(),traps:{1:[],2:[]},permanentSlots:{1:{government:null,public:null},2:{government:null,public:null}},// instantSlot wird nicht mehr verwendet - Sofort-Initiativen gehen in board[player].sofort\ndiscard:[],log:[],activeRefresh:{1:0,2:0}}));dealStartingHands();},[dealStartingHands]);const startMatchWithDecks=useCallback((p1DeckEntries,p2DeckEntries)=>{console.log('ðŸ”§ DEBUG: startMatchWithDecks called - activating AI for player 2');// Automatically enable AI for player 2 when starting with decks\nconsole.log('ðŸ”§ DEBUG: About to call gameAI.setAiEnabled(true)');gameAI.setAiEnabled(true);console.log('ðŸ”§ DEBUG: About to call gameAI.setAiPreset(AUTORITAERER_REALIST)');gameAI.setAiPreset('AUTORITAERER_REALIST');console.log('ðŸ”§ DEBUG: AI setup completed');console.log('[DIAG] startMatchWithDecks - p1DeckEntries',p1DeckEntries.length,'p2DeckEntries',p2DeckEntries.length);console.log('[DIAG] startMatchWithDecks - sample entries:',p1DeckEntries.slice(0,2),p2DeckEntries.slice(0,2));const p1Cards=buildDeckFromEntries(p1DeckEntries);const p2Cards=buildDeckFromEntries(p2DeckEntries);const d1=[...p1Cards];const d2=[...p2Cards];const h1=d1.splice(0,Math.min(5,d1.length));const h2=d2.splice(0,Math.min(5,d2.length));console.log('[DIAG] startMatchWithDecks - p1Cards',p1Cards.length,'p2Cards',p2Cards.length);console.log('[DIAG] startMatchWithDecks - h1',h1.length,'h2',h2.length);console.log('[DIAG] startMatchWithDecks - sample cards:',p1Cards.slice(0,2),p2Cards.slice(0,2));setGameState(_objectSpread(_objectSpread({},initialGameState),{},{round:1,current:1,passed:{1:false,2:false},decks:{1:d1,2:d2},hands:{1:h1,2:h2},board:emptyBoard(),traps:{1:[],2:[]},permanentSlots:{1:{government:null,public:null},2:{government:null,public:null}},// instantSlot wird nicht mehr verwendet - Sofort-Initiativen gehen in board[player].sofort\ndiscard:[],log:[\"Match gestartet. P1 und P2 erhalten je \".concat(h1.length,\"/\").concat(h2.length,\" Startkarten.\")],activeRefresh:{1:0,2:0}}));console.log('[DIAG] setGameState called in startMatchWithDecks');},[gameAI]);const startMatchVsAI=useCallback(function(p1DeckEntries){let presetKey=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'AUTORITAERER_REALIST';const p2DeckEntries=PRESET_DECKS[presetKey];gameAI.setAiEnabled(true);gameAI.setAiPreset(presetKey);gameActions.startMatchWithDecks(p1DeckEntries,p2DeckEntries);},[gameAI,gameActions]);// PrÃ¼fe ob der Zug automatisch gewechselt werden soll\nconst shouldAdvanceTurn=useCallback((gameState,player)=>{// Wenn Spieler gepasst hat\nif(gameState.passed[player])return true;// Wenn keine AP mehr verfÃ¼gbar sind\nif(gameState.actionPoints[player]<=0)return true;// Wenn 2 Aktionen verwendet wurden\n// if (gameState.actionsUsed[player] >= 2) return true;\nreturn false;},[]);// Karten-Effekte implementieren\nconst executeCardEffect=useCallback((card,player,state,logFunc)=>{let newState=_objectSpread({},state);logFunctionCall('executeCardEffect',{card:card.name,player,type:card.kind},'Starting card effect execution');if(card.kind==='spec'){const specCard=card;// === SOFORT-INITIATIVEN ===\nif(specCard.name==='Shadow Lobbying'){var _newState$effectFlags;logCardEffect(specCard.name,'Ã–ffentlichkeits-Effekte zÃ¤hlen doppelt diese Runde');const flags=_objectSpread(_objectSpread({},(_newState$effectFlags=newState.effectFlags)===null||_newState$effectFlags===void 0?void 0:_newState$effectFlags[player]),{},{publicEffectDoubled:true});newState.effectFlags=_objectSpread(_objectSpread({},newState.effectFlags),{},{[player]:flags});logDataFlow('effectFlags','newState',{player,publicEffectDoubled:true},'Shadow Lobbying flag set');}else if(specCard.name==='Spin Doctor'){const govCards=newState.board[player].aussen.filter(c=>c.kind==='pol');logDataFlow('board analysis','govCards',{count:govCards.length,cards:govCards.map(c=>c.name)},'Finding government cards');if(govCards.length>0){const targetCard=govCards[0];const oldInfluence=targetCard.influence;adjustInfluence(targetCard,2,'Spin Doctor');const newInfluence=targetCard.influence;logCardEffect(specCard.name,\"\".concat(targetCard.name,\" erh\\xE4lt +2 Einfluss (\").concat(oldInfluence,\" \\u2192 \").concat(newInfluence,\")\"));logDataFlow('influence adjustment','targetCard',{card:targetCard.name,old:oldInfluence,new:newInfluence,change:2},'Spin Doctor effect applied');}else{logWarning('No government cards found','Spin Doctor effect has no target');}}else if(specCard.name==='Digitaler Wahlkampf'){logCardEffect(specCard.name,'Ziehe 2 Karten, nÃ¤chste Initiative -1 AP');const{newHands,newDecks}=drawCards(player,2,newState,logFunc);newState=_objectSpread(_objectSpread({},newState),{},{hands:newHands,decks:newDecks});// Simplified AP system: No discounts\nlogDataFlow('effectFlags','newState',{player},'Platform effect applied');}else if(specCard.name==='Partei-Offensive'){const opponent=player===1?2:1;const oppGovCards=newState.board[opponent].aussen.filter(c=>c.kind==='pol'&&!c.deactivated);logDataFlow('opponent analysis','oppGovCards',{opponent,count:oppGovCards.length,cards:oppGovCards.map(c=>c.name)},'Finding active opponent government cards');if(oppGovCards.length>0){const targetCard=oppGovCards[0];targetCard.deactivated=true;logCardEffect(specCard.name,\"\".concat(targetCard.name,\" wird deaktiviert (bis Rundenende)\"));logDataFlow('card deactivation','targetCard',{card:targetCard.name,deactivated:true},'Partei-Offensive effect applied');}else{logWarning('No active opponent government cards found','Partei-Offensive effect has no target');}}else if(specCard.name==='Oppositionsblockade'){const opponent=player===1?2:1;const oppHand=newState.hands[opponent];logDataFlow('opponent hand','analysis',{opponent,handSize:oppHand.length,cards:oppHand.map(c=>c.name)},'Analyzing opponent hand');if(oppHand.length>0){const discardedCard=oppHand[Math.floor(Math.random()*oppHand.length)];const newOppHand=oppHand.filter(c=>c!==discardedCard);newState.hands=_objectSpread(_objectSpread({},newState.hands),{},{[opponent]:newOppHand});logCardEffect(specCard.name,\"Gegner verliert \".concat(discardedCard.name,\" aus der Hand\"));logDataFlow('card discard','opponent hand',{card:discardedCard.name,newHandSize:newOppHand.length},'Oppositionsblockade effect applied');}else{logWarning('Opponent hand is empty','Oppositionsblockade effect has no target');}}else if(specCard.name==='Opportunist'){const opponent=player===1?2:1;const oppBoard=newState.board[opponent];const totalOppInfluence=sumRow([...oppBoard.innen,...oppBoard.aussen]);logDataFlow('opponent board analysis','influence calculation',{opponent,innen:oppBoard.innen.map(c=>({name:c.name,influence:c.kind==='pol'?c.influence:0})),aussen:oppBoard.aussen.map(c=>({name:c.name,influence:c.kind==='pol'?c.influence:0})),totalInfluence:totalOppInfluence},'Calculating opponent total influence');if(totalOppInfluence>10){const{newHands,newDecks}=drawCards(player,1,newState,logFunc);newState=_objectSpread(_objectSpread({},newState),{},{hands:newHands,decks:newDecks});logCardEffect(specCard.name,\"Gegner hat \".concat(totalOppInfluence,\" Einfluss (>10) - ziehe 1 Karte\"));}else{logCardEffect(specCard.name,\"Gegner hat \".concat(totalOppInfluence,\" Einfluss (\\u226410) - kein Effekt\"));}}else if(specCard.name==='Think-tank'){const{newHands,newDecks}=drawCards(player,1,newState,logFunc);newState=_objectSpread(_objectSpread({},newState),{},{hands:newHands,decks:newDecks});logCardEffect(specCard.name,'Ziehe 1 Karte');}else if(specCard.name==='Influencer-Kampagne'){const publicCards=newState.board[player].innen.filter(c=>c.kind==='pol');logDataFlow('public cards analysis','influence boost',{count:publicCards.length,cards:publicCards.map(c=>c.name)},'Finding public cards for influence boost');publicCards.forEach(card=>{const oldInfluence=card.influence;adjustInfluence(card,1,'Influencer-Kampagne');const newInfluence=card.influence;logCardEffect(specCard.name,\"\".concat(card.name,\" erh\\xE4lt +1 Einfluss (\").concat(oldInfluence,\" \\u2192 \").concat(newInfluence,\")\"));});if(publicCards.length===0){logWarning('No public cards found','Influencer-Kampagne effect has no targets');}}else if(specCard.name==='Systemrelevant'){const opponent=player===1?2:1;const oppGovCards=newState.board[opponent].aussen.filter(c=>c.kind==='pol');logDataFlow('opponent government analysis','systemrelevant effect',{count:oppGovCards.length,cards:oppGovCards.map(c=>c.name)},'Finding opponent government cards');if(oppGovCards.length>0){const targetCard=oppGovCards[0];const oldInfluence=targetCard.influence;adjustInfluence(targetCard,-2,'Systemrelevant');const newInfluence=targetCard.influence;logCardEffect(specCard.name,\"\".concat(targetCard.name,\" verliert 2 Einfluss (\").concat(oldInfluence,\" \\u2192 \").concat(newInfluence,\")\"));logDataFlow('influence reduction','targetCard',{card:targetCard.name,old:oldInfluence,new:newInfluence,change:-2},'Systemrelevant effect applied');}else{logWarning('No opponent government cards found','Systemrelevant effect has no target');}}else if(specCard.name==='Symbolpolitik'){const{newHands,newDecks}=drawCards(player,1,newState,logFunc);newState=_objectSpread(_objectSpread({},newState),{},{hands:newHands,decks:newDecks});newState.actionPoints=_objectSpread(_objectSpread({},newState.actionPoints),{},{[player]:Math.min(2,newState.actionPoints[player]+1)});const oldAP=state.actionPoints[player];const newAP=newState.actionPoints[player];logCardEffect(specCard.name,\"Ziehe 1 Karte, erhalte +1 AP (\".concat(oldAP,\" \\u2192 \").concat(newAP,\")\"));logDataFlow('AP gain','player',{player,old:oldAP,new:newAP,change:1},'Symbolpolitik effect applied');}else if(specCard.name==='Alexei Navalny'){logCardEffect(specCard.name,'Ziehe 1 Karte');const{newHands,newDecks}=drawCards(player,1,newState,logFunc);newState=_objectSpread(_objectSpread({},newState),{},{hands:newHands,decks:newDecks});}else if(specCard.name==='Mukesh Ambani'){logCardEffect(specCard.name,'Ziehe 1 Karte');const{newHands,newDecks}=drawCards(player,1,newState,logFunc);newState=_objectSpread(_objectSpread({},newState),{},{hands:newHands,decks:newDecks});}// Oligarch-Effekte\nelse if(['Elon Musk','Bill Gates','George Soros','Warren Buffett','Mukesh Ambani','Jeff Bezos','Alisher Usmanov','Gautam Adani','Jack Ma','Zhang Yiming','Roman Abramovich'].includes(specCard.name)){logCardEffect(specCard.name,'Ziehe 1 Karte (Oligarch-Effekt)');const{newHands,newDecks}=drawCards(player,1,newState,logFunc);newState=_objectSpread(_objectSpread({},newState),{},{hands:newHands,decks:newDecks});}}// === DAUERHAFTE INITIATIVEN ===\nif(card.kind==='spec'&&card.type==='Dauerhaft-Initiative'){const specCard=card;if(specCard.name==='Algorithmischer Diskurs'){logCardEffect(specCard.name,'Dauerhafte Initiative: Alle Medien-Karten geben +1 Einfluss');// This effect will be applied in applyStartOfTurnHooks\n}else if(specCard.name==='Alternative Fakten'){logCardEffect(specCard.name,'Dauerhafte Initiative: Alle Oligarchen geben +1 Einfluss');// This effect will be applied in applyStartOfTurnHooks\n}}// === POLITIKER-KARTEN ===\nelse if(card.kind==='pol'){const polCard=card;logCardEffect(polCard.name,\"Politiker platziert - Basis-Einfluss: \".concat(polCard.influence));}logDataFlow('executeCardEffect','newState',{card:card.name,effectsApplied:true},'Card effect execution completed');return newState;},[logFunctionCall,logCardEffect,logDataFlow,logWarning]);const nextTurn=useCallback(()=>{logFunctionCall('nextTurn',{},'Starting turn change');setGameState(prev=>{var _prev$aiEnabled$,_prev$aiEnabled,_prev$aiEnabled$2,_prev$aiEnabled2,_prev$aiEnabled$3,_prev$aiEnabled3;logDataFlow('UI','nextTurn',{current:prev.current,passed:prev.passed},'Turn change request');// if both passed -> resolve round\nlogConditionCheck('both players passed',prev.passed[1]&&prev.passed[2],'Round end check');if(prev.passed[1]&&prev.passed[2]){logFunctionCall('resolveRound',{round:prev.round},'Both players passed - resolving round');return resolveRound(prev);}const newCurrent=prev.current===1?2:1;logDataFlow('turn change','newCurrent',{old:prev.current,new:newCurrent},'Player switch');// Reset AP for the new current player\nconst newActionPoints=_objectSpread({},prev.actionPoints);newActionPoints[newCurrent]=2;logDataFlow('AP reset','newCurrent',{player:newCurrent,oldAP:prev.actionPoints[newCurrent],newAP:newActionPoints[newCurrent],oldActions:0,newActions:0},'Resource reset for new player');// Apply start-of-turn hooks for the new current player\nconst newState=_objectSpread(_objectSpread({},prev),{},{current:newCurrent,actionPoints:newActionPoints});// Log turn change\nlog(\"Spieler \".concat(newCurrent,\" ist am Zug (2 AP verf\\xFCgbar)\"));logGameStateChange('turn change',\"Player \".concat(newCurrent,\" turn started\"));logFunctionCall('applyStartOfTurnHooks',{player:newCurrent},'Applying start-of-turn effects');applyStartOfTurnHooks(newState,newCurrent,log);// Check if AI should take turn\nlogConditionCheck('AI turn',newCurrent===2&&((_prev$aiEnabled$=(_prev$aiEnabled=prev.aiEnabled)===null||_prev$aiEnabled===void 0?void 0:_prev$aiEnabled[2])!==null&&_prev$aiEnabled$!==void 0?_prev$aiEnabled$:false),'AI turn check');if(newCurrent===2&&((_prev$aiEnabled$2=(_prev$aiEnabled2=prev.aiEnabled)===null||_prev$aiEnabled2===void 0?void 0:_prev$aiEnabled2[2])!==null&&_prev$aiEnabled$2!==void 0?_prev$aiEnabled$2:false)){logFunctionCall('runAITurn',{player:newCurrent},'Triggering AI turn');// Use setTimeout to avoid state update conflicts\nsetTimeout(()=>{logAIAction('AI turn triggered','Starting AI turn execution');gameAI.runAITurn();},100);}logDataFlow('nextTurn','finalState',{current:newState.current,ap:newState.actionPoints[newCurrent],aiEnabled:(_prev$aiEnabled$3=(_prev$aiEnabled3=prev.aiEnabled)===null||_prev$aiEnabled3===void 0?void 0:_prev$aiEnabled3[2])!==null&&_prev$aiEnabled$3!==void 0?_prev$aiEnabled$3:false},'Turn change completed');return newState;});// Nach Zugwechsel ebenfalls spiegeln (z. B. Auto-Draw am EoT)\nafterQueueResolved();},[logFunctionCall,logDataFlow,logConditionCheck,logGameStateChange,gameAI,log,logAIAction,afterQueueResolved]);// Automatischer Zugwechsel basierend auf AP\nconst checkAndAdvanceTurn=useCallback(gameState=>{const currentPlayer=gameState.current;if(shouldAdvanceTurn(gameState,currentPlayer)){// Nur wechseln wenn der andere Spieler nicht auch fertig ist\nconst otherPlayer=currentPlayer===1?2:1;if(!shouldAdvanceTurn(gameState,otherPlayer)||gameState.passed[otherPlayer]){nextTurn();}}},[shouldAdvanceTurn,nextTurn]);const scores=useCallback(state=>{// Einheitliche Berechnung Ã¼ber Utils-Helfer\nconst s1=sumGovernmentInfluenceWithAuras(state,1);const s2=sumGovernmentInfluenceWithAuras(state,2);return[s1,s2];},[]);const resolveRound=useCallback(state=>{const[s1,s2]=scores(state);let winner=1;let note='';if(s1>s2)winner=1;else if(s2>s1)winner=2;else{// Gleichstand -> erster Pass gewinnt\nwinner=state.passed[1]&&!state.passed[2]?1:2;note=' (Gleichstand â€“ frÃ¼herer Pass)';}log(\"Runde \".concat(state.round,\" endet: P1 \").concat(s1,\" : P2 \").concat(s2,\". Gewinner: P\").concat(winner).concat(note,\".\"));// Rundensieg zÃ¤hlen\nconst newRoundsWon=_objectSpread({},state.roundsWon);newRoundsWon[winner]+=1;// PrÃ¼fe Best-of-3 Gewinner\nlet gameWinner=null;if(newRoundsWon[1]>=2){gameWinner=1;log(\"\\uD83C\\uDF89 SPIEL ENDE: Spieler 1 gewinnt das Spiel! (\".concat(newRoundsWon[1],\":\").concat(newRoundsWon[2],\")\"));}else if(newRoundsWon[2]>=2){gameWinner=2;log(\"\\uD83C\\uDF89 SPIEL ENDE: Spieler 2 gewinnt das Spiel! (\".concat(newRoundsWon[2],\":\").concat(newRoundsWon[1],\")\"));}// clear board (no carryover)\nconst newBoard=emptyBoard();const newTraps={1:[],2:[]};// Verbesserte Karten-Nachzieh-Mechanik (ziehe bis Hand voll ist)\nconst{newHands,newDecks}=drawCardsAtRoundEnd(state,log);const newRound=state.round+1;const newPassed={1:false,2:false};// alternate starter each round\nconst newCurrent=newRound%2===1?1:2;// Wenn Spiel zu Ende, stoppe\nif(gameWinner){return _objectSpread(_objectSpread({},state),{},{roundsWon:newRoundsWon,gameWinner});}log(\"Runde \".concat(newRound,\" beginnt. P\").concat(newCurrent,\" startet.\"));// ðŸ”¥ CLUSTER 3: Reset temporÃ¤re Initiative-Boni am Rundenende\nconst newEffectFlags={1:_objectSpread(_objectSpread({},state.effectFlags[1]),{},{// Reset Cluster 3 Flags\nscienceInitiativeBonus:false,militaryInitiativePenalty:false,healthInitiativeBonus:false,cultureInitiativeBonus:false,// Reset andere rundenbasierte Flags\nmarkZuckerbergUsed:false,opportunistActive:false,publicEffectDoubled:false,cannotPlayInitiatives:false,nextCardProtected:false,platformAfterInitiativeBonus:false,interventionEffectReduced:false}),2:_objectSpread(_objectSpread({},state.effectFlags[2]),{},{// Reset Cluster 3 Flags\nscienceInitiativeBonus:false,militaryInitiativePenalty:false,healthInitiativeBonus:false,cultureInitiativeBonus:false,// Reset andere rundenbasierte Flags\nmarkZuckerbergUsed:false,opportunistActive:false,publicEffectDoubled:false,cannotPlayInitiatives:false,nextCardProtected:false,platformAfterInitiativeBonus:false,interventionEffectReduced:false})};return _objectSpread(_objectSpread({},state),{},{round:newRound,current:newCurrent,passed:newPassed,board:newBoard,traps:newTraps,hands:newHands,decks:newDecks,roundsWon:newRoundsWon,effectFlags:newEffectFlags});},[log,scores]);// Einfache Interventionsauswertung fÃ¼r einige hÃ¤ufige Trigger\nconst evaluateInterventions=(prev,actingPlayer,event,tentativeBoard)=>{const opponent=actingPlayer===1?2:1;const oppTraps=[...(prev.traps[opponent]||[])];let board=tentativeBoard;let trapsChanged=false;for(let i=0;i<oppTraps.length;i++){const trap=oppTraps[i];if(trap.kind!=='spec')continue;const spec=trap;const details=getCardDetails(spec.name);const key=spec.key;// Trigger: Karte gespielt\nif(event.type==='card_played'&&event.card){const played=event.card;const isMedia=['Oprah Winfrey'].includes(played.name);const isNGO=['Bill Gates','Jennifer Doudna','Noam Chomsky'].includes(played.name);const isPlatform=['Mark Zuckerberg','Tim Cook','Jack Ma','Zhang Yiming'].includes(played.name);const isDiplomat=['Joschka Fischer','Sergey Lavrov','Ursula von der Leyen','Jens Stoltenberg','Hans Dietrich Genscher','Colin Powell','Condoleezza Rice','Christine Lagarde'].includes(played.name);const isTier2Gov=played.T===2&&event.lane==='aussen';const isTier1Gov=played.T===1&&event.lane==='aussen';const isWeakGov=played.influence<=5&&event.lane==='aussen';const isLowPowerGov=played.influence<=4&&event.lane==='aussen';// Cancel Culture / Fake News-Kampagne\nif(((details===null||details===void 0?void 0:details.name)==='Cancel Culture'||key==='Cancel_Culture')&&event.lane==='innen'){tryApplyNegativeEffect(played,()=>{played.deactivated=true;},prev.round);oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Cancel Culture \\u2192 \".concat(played.name,\" deaktiviert.\"));logIntervention('Cancel Culture',\"Ausgel\\xF6st gegen \".concat(played.name,\" in \\xD6ffentlichkeit\"));continue;}if(((details===null||details===void 0?void 0:details.name)==='Fake News-Kampagne'||key==='Fake_News_Kampagne')&&isMedia){tryApplyNegativeEffect(played,()=>{played.deactivated=true;},prev.round);oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Fake News-Kampagne \\u2192 \".concat(played.name,\" deaktiviert.\"));logIntervention('Fake News-Kampagne',\"Ausgel\\xF6st gegen \".concat(played.name,\" (Medien)\"));continue;}// Whistleblower (Tier 2 Regierung)\nif(((details===null||details===void 0?void 0:details.name)==='Whistleblower'||key==='Whistleblower')&&isTier2Gov){tryApplyNegativeEffect(played,()=>{adjustInfluence(played,-2,'Whistleblower');},prev.round);oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Whistleblower \\u2192 \".concat(played.name,\" -2 Einfluss.\"));continue;}// Berater-AffÃ¤re (Tier 1 Regierung)\nif(((details===null||details===void 0?void 0:details.name)==='Berater-AffÃ¤re'||key==='Berater_Affaere')&&isTier1Gov){tryApplyNegativeEffect(played,()=>{adjustInfluence(played,-2,'Berater-AffÃ¤re');},prev.round);oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Berater-Aff\\xE4re \\u2192 \".concat(played.name,\" -2 Einfluss.\"));continue;}// Soft Power-Kollaps / Deepfake-Skandal (Diplomat)\nif(((details===null||details===void 0?void 0:details.name)==='Soft Power-Kollaps'||key==='Soft_Power_Kollaps')&&isDiplomat){tryApplyNegativeEffect(played,()=>{adjustInfluence(played,-3,'Soft Power-Kollaps');},prev.round);oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Soft Power-Kollaps \\u2192 \".concat(played.name,\" -3 Einfluss.\"));continue;}if(((details===null||details===void 0?void 0:details.name)==='Deepfake-Skandal'||key==='Deepfake_Skandal')&&isDiplomat){var _prev$effectFlags;// Kein Einflusstransfer mÃ¶glich - Flag setzen\nconst newFlags=_objectSpread(_objectSpread({},(_prev$effectFlags=prev.effectFlags)===null||_prev$effectFlags===void 0?void 0:_prev$effectFlags[actingPlayer]),{},{influenceTransferBlocked:true});prev.effectFlags=_objectSpread(_objectSpread({},prev.effectFlags),{},{[actingPlayer]:newFlags});oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Deepfake-Skandal \\u2192 \".concat(played.name,\" kann keinen Einfluss transferieren.\"));continue;}// Lobby Leak / Boykott-Kampagne (NGO/Bewegung)\nif(((details===null||details===void 0?void 0:details.name)==='Lobby Leak'||key==='Lobby_Leak')&&isNGO){const hands=_objectSpread({},prev.hands);if(hands[actingPlayer].length>0){hands[actingPlayer]=hands[actingPlayer].slice(1);prev.hands=hands;}oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Lobby Leak \\u2192 P\".concat(actingPlayer,\" wirft 1 Karte ab.\"));continue;}if(((details===null||details===void 0?void 0:details.name)==='Boykott-Kampagne'||key==='Boykott_Kampagne')&&(isNGO||['Greta Thunberg','Malala Yousafzai','Ai Weiwei','Alexei Navalny'].includes(played.name))){tryApplyNegativeEffect(played,()=>{played.deactivated=true;},prev.round);oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Boykott-Kampagne \\u2192 \".concat(played.name,\" deaktiviert.\"));continue;}// Cyber-Attacke (Plattform)\nif(((details===null||details===void 0?void 0:details.name)==='Cyber-Attacke'||key==='Cyber_Attacke')&&isPlatform){const loc=findCardLocation(played,_objectSpread(_objectSpread({},prev),{},{board}));if(loc){const arr=[...board[loc.player][loc.lane]];const idx=arr.findIndex(c=>c.uid===played.uid);if(idx>=0){arr.splice(idx,1);board=_objectSpread(_objectSpread({},board),{},{[loc.player]:_objectSpread(_objectSpread({},board[loc.player]),{},{[loc.lane]:arr})});}}oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Cyber-Attacke \\u2192 \".concat(played.name,\" zerst\\xF6rt.\"));continue;}// Bestechungsskandal 2.0 (schwache Regierung Mâ‰¤5)\nif(((details===null||details===void 0?void 0:details.name)==='Bestechungsskandal 2.0'||key==='Bestechungsskandal_2_0')&&isWeakGov){// Ãœbernehme Karte bis Rundenende (vereinfacht: temporÃ¤r deaktiviert)\ntryApplyNegativeEffect(played,()=>{played.deactivated=true;},prev.round);oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Bestechungsskandal 2.0 \\u2192 \".concat(played.name,\" \\xFCbernommen.\"));continue;}// Tunnelvision (Mâ‰¤4 Regierung)\nif(((details===null||details===void 0?void 0:details.name)==='Tunnelvision'||key==='Tunnelvision')&&isLowPowerGov){// Karte zÃ¤hlt nicht zur Runde (vereinfacht: -100% Einfluss)\ntryApplyNegativeEffect(played,()=>{played.influence=0;},prev.round);oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Tunnelvision \\u2192 \".concat(played.name,\" z\\xE4hlt nicht zur Runde.\"));continue;}}// Trigger: Board-Zustand\nif(event.type==='board_state_check'){var _event$card,_event$card2;const actingPlayerGovCount=tentativeBoard[actingPlayer].aussen.length;const actingPlayerPubCount=tentativeBoard[actingPlayer].innen.length;// Strategische EnthÃ¼llung (>2 Regierungskarten)\nif(((details===null||details===void 0?void 0:details.name)==='Strategische EnthÃ¼llung'||key==='Strategische_Enthuellung')&&actingPlayerGovCount>2){// Eine Regierungskarte zurÃ¼ck auf Hand (vereinfacht: entferne erste)\nconst govCards=[...tentativeBoard[actingPlayer].aussen];if(govCards.length>0){govCards.pop();// Entferne letzte\nboard=_objectSpread(_objectSpread({},board),{},{[actingPlayer]:_objectSpread(_objectSpread({},board[actingPlayer]),{},{aussen:govCards})});}oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Strategische Enth\\xFCllung \\u2192 Regierungskarte zur\\xFCck.\");continue;}// Grassroots-Widerstand (>2 Ã–ffentlichkeitskarten)\nif(((details===null||details===void 0?void 0:details.name)==='Grassroots-Widerstand'||key==='Grassroots_Widerstand')&&actingPlayerPubCount>2){const pubCards=tentativeBoard[actingPlayer].innen.filter(c=>c.kind==='pol');if(pubCards.length>0){tryApplyNegativeEffect(pubCards[0],()=>{pubCards[0].deactivated=true;},prev.round);}oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Grassroots-Widerstand \\u2192 \\xD6ffentlichkeitskarte deaktiviert.\");continue;}// Parlament geschlossen (â‰¥2 Regierungskarten)\nif(((details===null||details===void 0?void 0:details.name)==='Parlament geschlossen'||key==='Parlament_geschlossen')&&actingPlayerGovCount>=2){var _prev$effectFlags2;// Blockiere weitere Regierungskarten (Flag fÃ¼r diesen Zug)\nconst newFlags=_objectSpread(_objectSpread({},(_prev$effectFlags2=prev.effectFlags)===null||_prev$effectFlags2===void 0?void 0:_prev$effectFlags2[actingPlayer]),{},{cannotPlayMoreGovernment:true});prev.effectFlags=_objectSpread(_objectSpread({},prev.effectFlags),{},{[actingPlayer]:newFlags});oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Parlament geschlossen \\u2192 keine weiteren Regierungskarten.\");continue;}// Interne FraktionskÃ¤mpfe (groÃŸe Initiative 3-4 HP)\nif(((details===null||details===void 0?void 0:details.name)==='Interne FraktionskÃ¤mpfe'||key==='Interne_Fraktionskaempfe')&&event.type==='card_played'&&((_event$card=event.card)===null||_event$card===void 0?void 0:_event$card.kind)==='spec'){const specCard=event.card;const isLargeInitiative=specCard.type==='Sofort-Initiative'&&specCard.bp>=3;if(isLargeInitiative){// Initiative annullieren (vereinfacht: Karte zurÃ¼ck auf Hand)\nconst hands=_objectSpread({},prev.hands);hands[actingPlayer].push(event.card);prev.hands=hands;oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Interne Fraktionsk\\xE4mpfe \\u2192 \".concat(event.card.name,\" wird annulliert.\"));continue;}}// Massenproteste (2 Regierungskarten in der Runde)\nif(((details===null||details===void 0?void 0:details.name)==='Massenproteste'||key==='Massenproteste')&&event.type==='card_played'&&event.lane==='aussen'){// Vereinfacht: Beide Regierungskarten -1 Einfluss\nconst govCards=board[actingPlayer].aussen.filter(c=>c.kind==='pol');if(govCards.length>=2){adjustInfluence(govCards[0],-1,'Massenproteste');adjustInfluence(govCards[1],-1,'Massenproteste');oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Massenproteste \\u2192 \".concat(govCards[0].name,\" und \").concat(govCards[1].name,\" -1 Einfluss.\"));continue;}}// \"UnabhÃ¤ngige\" Untersuchung (gegen Intervention)\nif(((details===null||details===void 0?void 0:details.name)==='\"UnabhÃ¤ngige\" Untersuchung'||key==='Unabhaengige_Untersuchung')&&event.type==='card_played'&&((_event$card2=event.card)===null||_event$card2===void 0?void 0:_event$card2.kind)==='spec'){const specCard=event.card;if(specCard.type==='Intervention'){// Intervention annullieren (vereinfacht: Karte zurÃ¼ck auf Hand)\nconst hands=_objectSpread({},prev.hands);hands[actingPlayer].push(event.card);prev.hands=hands;oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: \\\"Unabh\\xE4ngige\\\" Untersuchung \\u2192 \".concat(event.card.name,\" wird annulliert.\"));continue;}}// Maulwurf (kopiere schwÃ¤chere Regierungskarte des Gegners)\nif(((details===null||details===void 0?void 0:details.name)==='Maulwurf'||key==='Maulwurf')&&event.type==='card_played'&&event.lane==='aussen'){const oppGovCards=board[opponent].aussen.filter(c=>c.kind==='pol');if(oppGovCards.length>0){// Finde schwÃ¤chste Regierungskarte\nconst weakestCard=oppGovCards.reduce((weakest,current)=>current.influence<weakest.influence?current:weakest);// Kopie erstellen (vereinfacht: gleiche Karte auf eigene Hand)\nconst hands=_objectSpread({},prev.hands);const copyCard=_objectSpread(_objectSpread({},weakestCard),{},{uid:Date.now()+Math.random()});hands[opponent].push(copyCard);prev.hands=hands;oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Maulwurf \\u2192 Kopie von \".concat(weakestCard.name,\" auf Hand.\"));continue;}}// Skandalspirale (Initiative + Ã–ffentlichkeitskarte)\nif(((details===null||details===void 0?void 0:details.name)==='Skandalspirale'||key==='Skandalspirale')&&event.type==='card_played'){// Vereinfacht: PrÃ¼fe ob Initiative und Ã–ffentlichkeitskarte in dieser Runde gespielt wurden\nconst recentCards=board[actingPlayer].innen.concat(board[actingPlayer].aussen);const hasInitiative=recentCards.some(c=>c.kind==='spec'&&c.type==='Sofort-Initiative');const hasPublic=recentCards.some(c=>c.kind==='spec'&&c.type==='Ã–ffentlichkeitskarte');if(hasInitiative&&hasPublic){// Eine der beiden Karten annullieren (vereinfacht: letzte Ã–ffentlichkeitskarte)\nconst pubCards=board[actingPlayer].innen.filter(c=>c.kind==='spec'&&c.type==='Ã–ffentlichkeitskarte');if(pubCards.length>0){const lastPubCard=pubCards[pubCards.length-1];const arr=[...board[actingPlayer].innen];const idx=arr.findIndex(c=>c.uid===lastPubCard.uid);if(idx>=0){arr.splice(idx,1);board=_objectSpread(_objectSpread({},board),{},{[actingPlayer]:_objectSpread(_objectSpread({},board[actingPlayer]),{},{innen:arr})});}}oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Skandalspirale \\u2192 \\xD6ffentlichkeitskarte annulliert.\");continue;}}// Satire-Show (bei mehr Einfluss als Gegner)\nif((details===null||details===void 0?void 0:details.name)==='Satire-Show'||key==='Satire_Show'){const playerInfluence=sumRow([...board[opponent].aussen]);const opponentInfluence=sumRow([...board[actingPlayer].aussen]);if(opponentInfluence>playerInfluence){const oppGovCards=board[opponent].aussen.filter(c=>c.kind==='pol');if(oppGovCards.length>0){// Erste Regierungskarte -2 Einfluss\nadjustInfluence(oppGovCards[0],-2,'Satire-Show');oppTraps.splice(i,1);i--;trapsChanged=true;log(\"Intervention ausgel\\xF6st: Satire-Show \\u2192 \".concat(oppGovCards[0].name,\" -2 Einfluss.\"));continue;}}}}}if(trapsChanged){const newTraps=_objectSpread(_objectSpread({},prev.traps),{},{[opponent]:oppTraps});return[board,newTraps];}return[null,null];};// Zentrale Effekt-Queue Verarbeitung\nconst processEffectQueue=useCallback(state=>{if(!state.effectQueue||state.effectQueue.items.length===0){return state;}const[newQueue,newState]=EffectQueueManager.processQueue(state.effectQueue,state,log);return _objectSpread(_objectSpread({},newState),{},{effectQueue:newQueue});},[log]);// Berechne Einfluss mit dauerhaften Auren-Effekten\nconst sumRowWithAuras=(state,player)=>{const govCards=state.board[player].aussen.filter(c=>c.kind==='pol');const opponent=player===1?2:1;let total=0;// ðŸ” DEBUG: Log welche Regierungskarten gefunden wurden\nconsole.log(\"\\uD83D\\uDD0D sumRowWithAuras P\".concat(player,\": Gefunden \").concat(govCards.length,\" Regierungskarten:\"),govCards.map(c=>\"\".concat(c.name,\"[\").concat(c.influence,\"I]\")).join(', '));govCards.forEach(card=>{let influence=card.influence;// Dauerhafte Auren anwenden\nconst govSlot=state.permanentSlots[player].government;const pubSlot=state.permanentSlots[player].public;// Koalitionszwang: Tier 2 Regierungskarten +1 Einfluss\nif((govSlot===null||govSlot===void 0?void 0:govSlot.kind)==='spec'&&govSlot.name==='Koalitionszwang'){if(card.T===2)influence+=1;}// Napoleon Komplex: Tier 1 Regierungskarten +1 Einfluss\nif((govSlot===null||govSlot===void 0?void 0:govSlot.kind)==='spec'&&govSlot.name==='Napoleon Komplex'){if(card.T===1)influence+=1;}// Zivilgesellschaft: Bewegung-Karten +1 Einfluss\nif((pubSlot===null||pubSlot===void 0?void 0:pubSlot.kind)==='spec'&&pubSlot.name==='Zivilgesellschaft'){const bewegungNames=['Greta Thunberg','Malala Yousafzai','Ai Weiwei','Alexei Navalny'];const hasBewegung=state.board[player].innen.some(c=>c.kind==='spec'&&c.type==='Ã–ffentlichkeitskarte'&&bewegungNames.includes(c.name));if(hasBewegung)influence+=1;}// ðŸ”¥ JOSCHKA FISCHER NGO-BOOST: +1 Einfluss wenn NGO auf dem Board liegt\nif(card.name==='Joschka Fischer'&&card.effect==='ngo_boost'){const hasNgoCard=state.board[player].innen.some(c=>c.kind==='spec'&&c.type==='Ã–ffentlichkeitskarte'&&c.tag==='NGO');if(hasNgoCard){influence+=1;// Log nur beim ersten Mal, um Spam zu vermeiden\nif(!card._ngoBoostLogged){console.log(\"\\uD83D\\uDD25 JOSCHKA FISCHER KONTINUIERLICHER NGO-BOOST: +1 Einfluss\");card._ngoBoostLogged=true;}}else{card._ngoBoostLogged=false;}}// Milchglas Transparenz: +1 Einfluss wenn keine NGO/Bewegung liegt\nif((govSlot===null||govSlot===void 0?void 0:govSlot.kind)==='spec'&&govSlot.name==='Milchglas Transparenz'){const ngoMovementNames=['Jennifer Doudna','Noam Chomsky','Bill Gates','Greta Thunberg','Malala Yousafzai','Ai Weiwei','Alexei Navalny'];const hasNgoMovement=state.board[player].innen.some(c=>c.kind==='spec'&&c.type==='Ã–ffentlichkeitskarte'&&ngoMovementNames.includes(c.name));if(!hasNgoMovement)influence+=1;}// Alternative Fakten: Gegner-Interventionen -1 Wirkung\nconst oppPubSlot=state.permanentSlots[opponent].public;if((oppPubSlot===null||oppPubSlot===void 0?void 0:oppPubSlot.kind)==='spec'&&oppPubSlot.name==='Alternative Fakten'){// Reduziere Effekt von Interventionen (vereinfacht: -1 Einfluss weniger)\n// Wird in der Intervention-Auswertung berÃ¼cksichtigt\n}total+=influence;});// ðŸ” DEBUG: Final influence calculation\nconsole.log(\"\\uD83C\\uDFAF sumRowWithAuras P\".concat(player,\": Gesamt-Einfluss = \").concat(total));return total;};// playCard is now handled by useGameActions hook\n// runAITurn is now handled by useGameAI hook - removed duplicate implementation\nconst applyStartOfTurnHooksLegacy=useCallback((player,state)=>{logFunctionCall('applyStartOfTurnHooksLegacy',{player,round:state.round},'Starting legacy turn hooks');const pool=[...state.board[player].innen,...state.board[player].aussen];pool.forEach(c=>{if(c.kind==='pol'){const polCard=c;if(polCard._pledgeDown&&polCard._pledgeDown.round===state.round){const oldInfluence=polCard.influence;adjustInfluence(polCard,polCard._pledgeDown.amount,'Wahlversprechen');const newInfluence=polCard.influence;log(\"Wahlversprechen Abzug auf \".concat(polCard.name,\": \").concat(oldInfluence,\" \\u2192 \").concat(newInfluence));polCard._pledgeDown=null;}// reset once-per-round flags\npolCard._hypedRoundFlag=false;}});// Apply permanent initiative effects\nconst govSlot=state.permanentSlots[player].government;const pubSlot=state.permanentSlots[player].public;if(govSlot&&govSlot.kind==='spec'){const govInitiative=govSlot;logFunctionCall('applyPermanentInitiative',{slot:'government',initiative:govInitiative.name},'Processing government permanent initiative');if(govInitiative.name==='Alternative Fakten'){// Alle Oligarchen geben +1 Einfluss\nconst oligarchCards=pool.filter(c=>c.kind==='pol'&&['Elon Musk','Bill Gates','George Soros','Warren Buffett','Mukesh Ambani','Jeff Bezos','Alisher Usmanov','Gautam Adani','Jack Ma','Zhang Yiming','Roman Abramovich'].includes(c.name));logDataFlow('board analysis','oligarch cards',{count:oligarchCards.length,cards:oligarchCards.map(c=>({name:c.name,influence:c.kind==='pol'?c.influence:0}))},'Finding oligarch cards for Alternative Fakten effect');let totalInfluenceGained=0;oligarchCards.forEach(card=>{const oldInfluence=card.influence;adjustInfluence(card,1,'Alternative Fakten');const newInfluence=card.influence;totalInfluenceGained+=1;logCardEffect('Alternative Fakten',\"\".concat(card.name,\" erh\\xE4lt +1 Einfluss (\").concat(oldInfluence,\" \\u2192 \").concat(newInfluence,\")\"));});if(oligarchCards.length>0){logCardEffect('Alternative Fakten',\"\".concat(oligarchCards.length,\" Oligarchen gefunden - \").concat(totalInfluenceGained,\" Punkte zum Gesamteinfluss hinzugef\\xFCgt\"));}else{logWarning('No oligarch cards found','Alternative Fakten effect has no targets');}}}if(pubSlot&&pubSlot.kind==='spec'){const pubInitiative=pubSlot;logFunctionCall('applyPermanentInitiative',{slot:'public',initiative:pubInitiative.name},'Processing public permanent initiative');if(pubInitiative.name==='Algorithmischer Diskurs'){// Alle Medien-Karten geben +1 Einfluss\nconst mediaCards=pool.filter(c=>c.kind==='pol'&&['Oprah Winfrey','Mark Zuckerberg','Tim Cook','Sam Altman'].includes(c.name));logDataFlow('board analysis','media cards',{count:mediaCards.length,cards:mediaCards.map(c=>({name:c.name,influence:c.kind==='pol'?c.influence:0}))},'Finding media cards for Algorithmischer Diskurs effect');let totalInfluenceGained=0;mediaCards.forEach(card=>{const oldInfluence=card.influence;adjustInfluence(card,1,'Algorithmischer Diskurs');const newInfluence=card.influence;totalInfluenceGained+=1;logCardEffect('Algorithmischer Diskurs',\"\".concat(card.name,\" erh\\xE4lt +1 Einfluss (\").concat(oldInfluence,\" \\u2192 \").concat(newInfluence,\")\"));});if(mediaCards.length>0){logCardEffect('Algorithmischer Diskurs',\"\".concat(mediaCards.length,\" Medien-Karten gefunden - \").concat(totalInfluenceGained,\" Punkte zum Gesamteinfluss hinzugef\\xFCgt\"));}else{logWarning('No media cards found','Algorithmischer Diskurs effect has no targets');}}}// Legacy flags reset is replaced by the new applyStartOfTurnHooks implementation\nlogFunctionCall('applyStartOfTurnHooksLegacy',{player},'Legacy turn hooks completed');},[logFunctionCall,logDataFlow,logCardEffect,logWarning]);// Helper: Leadership vorhanden?\nconst hasLeadershipCard=(player,state)=>{const gov=state.board[player].aussen;const names=['Justin Trudeau'];return gov.some(c=>c.kind==='pol'&&names.includes(c.name)&&!c.deactivated);};// Helper: Bewegung vorhanden? (Ã–ffentlichkeitsreihe)\nconst hasMovementCard=(player,state)=>{const pub=state.board[player].innen;const names=['Greta Thunberg','Malala Yousafzai','Ai Weiwei','Alexei Navalny'];return pub.some(c=>c.kind==='pol'&&names.includes(c.name)&&!c.deactivated);};// Helper: Plattform vorhanden? (Ã–ffentlichkeitsreihe)\nconst hasPlatformCard=(player,state)=>{const pub=state.board[player].innen;const names=['Mark Zuckerberg','Tim Cook','Jack Ma','Zhang Yiming'];return pub.some(c=>c.kind==='pol'&&names.includes(c.name)&&!c.deactivated);};// Helper: Diplomat vorhanden? (Regierungsreihe)\nconst hasDiplomatCard=(player,state)=>{const gov=state.board[player].aussen;const names=['Joschka Fischer','Sergey Lavrov','Ursula von der Leyen','Jens Stoltenberg','Horst KÃ¶hler','Walter Scheel','Hans Dietrich Genscher','Colin Powell','Condoleezza Rice','Christine Lagarde'];return gov.some(c=>c.kind==='pol'&&names.includes(c.name)&&!c.deactivated);};// Helper: Einfluss-Transfer durch Dauerhaft-Initiativen blockiert? (Koalitionszwang, Napoleon Komplex)\nconst hasInfluenceTransferBlock=(player,state)=>{const govSlot=state.permanentSlots[player].government;if(!govSlot||govSlot.kind!=='spec')return false;const spec=govSlot;return['Koalitionszwang','Napoleon Komplex'].includes(spec.name);};// Helper: Kann Spieler mehrere Interventionen spielen? (Putin-FÃ¤higkeit)\nconst canPlayMultipleInterventions=(player,state)=>{const govCards=state.board[player].aussen.filter(c=>c.kind==='pol');return govCards.some(c=>c.name==='Vladimir Putin'&&!c.deactivated);};const selectHandCard=useCallback(index=>{setSelectedHandIndex(index);},[]);const passTurn=useCallback(player=>{setGameState(prev=>{if(prev.current!==player)return prev;const newState=_objectSpread(_objectSpread({},prev),{},{passed:_objectSpread(_objectSpread({},prev.passed),{},{[player]:true})});log(\"Spieler \".concat(player,\" passt.\"));// If both players have passed, resolve the round\nif(newState.passed[1]&&newState.passed[2]){return resolveRound(newState);}return newState;});},[log,resolveRound]);// Diplomat-Einfluss-Transfer Funktion\nconst transferInfluence=useCallback((player,fromCardUid,toCardUid,amount)=>{setGameState(prev=>{var _prev$effectFlags3;if(prev.current!==player)return prev;const flags=(_prev$effectFlags3=prev.effectFlags)===null||_prev$effectFlags3===void 0?void 0:_prev$effectFlags3[player];if(!flags||flags.diplomatInfluenceTransferUsed||flags.influenceTransferBlocked)return prev;if(!hasDiplomatCard(player,prev))return prev;// Finde beide Karten in der Regierungsreihe\nconst govCards=prev.board[player].aussen;const fromCard=govCards.find(c=>c.uid===fromCardUid&&c.kind==='pol');const toCard=govCards.find(c=>c.uid===toCardUid&&c.kind==='pol');if(!fromCard||!toCard||fromCard.influence<amount)return prev;// Transfer durchfÃ¼hren\nadjustInfluence(fromCard,-amount,'Diplomat-Transfer');adjustInfluence(toCard,amount,'Diplomat-Transfer');// Flag setzen\nconst newFlags=_objectSpread(_objectSpread({},flags),{},{diplomatInfluenceTransferUsed:true});const newEffectFlags=_objectSpread(_objectSpread({},prev.effectFlags),{},{[player]:newFlags});log(\"P\".concat(player,\" transferiert \").concat(amount,\" Einfluss von \").concat(fromCard.name,\" zu \").concat(toCard.name,\" (Diplomat).\"));return _objectSpread(_objectSpread({},prev),{},{effectFlags:newEffectFlags});});},[log]);// Active Abilities Management\nconst getActiveAbilities=useCallback(player=>{return ActiveAbilitiesManager.getAvailableAbilities(player,gameState);},[]);const useActiveAbility=useCallback((abilityId,targetCardUid)=>{setGameState(prev=>{const player=prev.current;const abilities=ActiveAbilitiesManager.getAvailableAbilities(player,prev);const ability=abilities.find(a=>a.id===abilityId);if(!ability||!ActiveAbilitiesManager.canUseAbility(ability,player,prev)){return prev;}// Finde Actor Card\nconst allCards=[...prev.board[player].innen,...prev.board[player].aussen].filter(c=>c.kind==='pol');const actorCard=allCards.find(c=>ability.id.includes(c.uid.toString()));if(!actorCard)return prev;// Finde Target Card wenn nÃ¶tig\nlet targetCard;if(targetCardUid){const allTargets=[...prev.board[1].innen,...prev.board[1].aussen,...prev.board[2].innen,...prev.board[2].aussen].filter(c=>c.kind==='pol');targetCard=allTargets.find(c=>c.uid===targetCardUid);}const select={type:ability.type,actorCard,actorPlayer:player,targetCard};const newState=ActiveAbilitiesManager.executeAbility(ability,select,prev);log(\"\".concat(actorCard.name,\" nutzt \").concat(ability.name).concat(targetCard?\" auf \".concat(targetCard.name):'',\".\"));return newState;});},[gameState,log]);// Reset aktive FÃ¤higkeiten zu Rundenbeginn\nconst resetActiveAbilities=useCallback(state=>{const newState=_objectSpread({},state);// Reset _activeUsed fÃ¼r alle Politikerkarten\n[1,2].forEach(player=>{const allCards=[...newState.board[player].innen,...newState.board[player].aussen].filter(c=>c.kind==='pol');allCards.forEach(card=>{card._activeUsed=false;});});return newState;},[]);// Putin Doppelte Interventionen\nconst executePutinDoubleIntervention=useCallback(interventionCardIds=>{setGameState(prev=>{const player=prev.current;const newState=ActiveAbilitiesManager.executePutinDoubleIntervention(prev,player,interventionCardIds,log);return newState;});},[log]);// Check ob Putin Doppel-Intervention verfÃ¼gbar ist\nconst canUsePutinDoubleIntervention=useCallback(player=>{const board=gameState.board[player];const allCards=[...board.innen,...board.aussen].filter(c=>c.kind==='pol');const putin=allCards.find(c=>c.name==='Vladimir Putin');if(!putin||putin.deactivated||putin._activeUsed)return false;const interventions=gameState.hands[player].filter(c=>c.kind==='spec');return interventions.length>=2;},[gameState]);// Manual turn advancement for testing\nconst manualAdvanceTurn=useCallback(()=>{console.log('ðŸ”§ DEBUG: Manual turn advancement triggered');log('ðŸ”§ DEBUG: Manual turn advancement triggered');nextTurn();},[nextTurn,log]);return{gameState,selectedHandIndex,log,startNewGame,selectHandCard:setSelectedHandIndex,scores,manualAdvanceTurn,// Manual turn advancement for testing\n// Core game state functions\ndealStartingHands,resolveRound,nextTurn:gameActions.nextTurn,endTurn:gameActions.endTurn,checkAndAdvanceTurn,shouldAdvanceTurn,// Helper functions kept for compatibility\nhasLeadershipCard,hasMovementCard,hasPlatformCard,hasDiplomatCard,hasInfluenceTransferBlock,canPlayMultipleInterventions,sumRowWithAuras,applyStartOfTurnHooksLegacy,// Functions that were migrated to separate hooks\npassTurn:gameActions.passTurn,transferInfluence,getActiveAbilities,useActiveAbility,resetActiveAbilities,executePutinDoubleIntervention,canUsePutinDoubleIntervention,// Delegate primary functionality to separated hooks\nstartMatchWithDecks:gameActions.startMatchWithDecks,startMatchVsAI:gameActions.startMatchVsAI,playCard:gameActions.playCard,activateInstantInitiative:gameActions.activateInstantInitiative,// AI functionality\nrunAITurn:gameAI.runAITurn,aiEnabled:gameAI.aiEnabled,setAiEnabled:gameAI.setAiEnabled,aiPreset:gameAI.aiPreset,setAiPreset:gameAI.setAiPreset,// Effects functionality\nexecuteCardEffect,processEffectQueue,afterQueueResolved};}","map":{"version":3,"names":["useState","useCallback","createDefaultEffectFlags","Pols","Specials","PRESET_DECKS","sumRow","shuffle","makePolInstance","makeSpecInstance","buildDeckFromEntries","drawCards","drawCardsAtRoundEnd","tryApplyNegativeEffect","adjustInfluence","findCardLocation","sumGovernmentInfluenceWithAuras","EffectQueueManager","ActiveAbilitiesManager","getCardDetails","useGameActions","useGameAI","useGameEffects","applyStartOfTurnHooks","emptyBoard","initialGameState","round","current","passed","actionPoints","actionsUsed","decks","hands","traps","board","permanentSlots","government","public","discard","log","activeRefresh","roundsWon","gameWinner","effectFlags","effectQueue","initializeQueue","activeAbilities","pendingAbilitySelect","undefined","aiEnabled","useGameState","gameState","setGameState","selectedHandIndex","setSelectedHandIndex","msg","timestamp","Date","toLocaleTimeString","hour","minute","second","logEntry","concat","console","prev","_objectSpread","logUIInteraction","action","details","logGameStateChange","change","logAIAction","logCardEffect","cardName","effect","logIntervention","interventionName","trigger","logFunctionCall","functionName","params","context","paramStr","JSON","stringify","String","logDataFlow","from","to","data","dataStr","logConditionCheck","condition","result","logError","error","logWarning","warning","afterQueueResolved","s","_version","n","gameActions","gameAI","gameEffects","dealStartingHands","buildDeck","polPool","specPool","deck","slice","forEach","p","push","implFirst","srt","sort","a","b","indexOf","impl","deck1","deck2","length","splice","startNewGame","startMatchWithDecks","p1DeckEntries","p2DeckEntries","setAiEnabled","setAiPreset","p1Cards","p2Cards","d1","d2","h1","Math","min","h2","startMatchVsAI","presetKey","arguments","shouldAdvanceTurn","player","executeCardEffect","card","state","logFunc","newState","name","type","kind","specCard","_newState$effectFlags","flags","publicEffectDoubled","govCards","aussen","filter","c","count","cards","map","targetCard","oldInfluence","influence","newInfluence","old","new","newHands","newDecks","opponent","oppGovCards","deactivated","oppHand","handSize","discardedCard","floor","random","newOppHand","newHandSize","oppBoard","totalOppInfluence","innen","totalInfluence","publicCards","oldAP","newAP","includes","polCard","effectsApplied","nextTurn","_prev$aiEnabled$","_prev$aiEnabled","_prev$aiEnabled$2","_prev$aiEnabled2","_prev$aiEnabled$3","_prev$aiEnabled3","resolveRound","newCurrent","newActionPoints","oldActions","newActions","setTimeout","runAITurn","ap","checkAndAdvanceTurn","currentPlayer","otherPlayer","scores","s1","s2","winner","note","newRoundsWon","newBoard","newTraps","newRound","newPassed","newEffectFlags","scienceInitiativeBonus","militaryInitiativePenalty","healthInitiativeBonus","cultureInitiativeBonus","markZuckerbergUsed","opportunistActive","cannotPlayInitiatives","nextCardProtected","platformAfterInitiativeBonus","interventionEffectReduced","evaluateInterventions","actingPlayer","event","tentativeBoard","oppTraps","trapsChanged","i","trap","spec","key","played","isMedia","isNGO","isPlatform","isDiplomat","isTier2Gov","T","lane","isTier1Gov","isWeakGov","isLowPowerGov","_prev$effectFlags","newFlags","influenceTransferBlocked","loc","arr","idx","findIndex","uid","_event$card","_event$card2","actingPlayerGovCount","actingPlayerPubCount","pop","pubCards","_prev$effectFlags2","cannotPlayMoreGovernment","isLargeInitiative","bp","weakestCard","reduce","weakest","copyCard","now","recentCards","hasInitiative","some","hasPublic","lastPubCard","playerInfluence","opponentInfluence","processEffectQueue","items","newQueue","processQueue","sumRowWithAuras","total","join","govSlot","pubSlot","bewegungNames","hasBewegung","hasNgoCard","tag","_ngoBoostLogged","ngoMovementNames","hasNgoMovement","oppPubSlot","applyStartOfTurnHooksLegacy","pool","_pledgeDown","amount","_hypedRoundFlag","govInitiative","slot","initiative","oligarchCards","totalInfluenceGained","pubInitiative","mediaCards","hasLeadershipCard","gov","names","hasMovementCard","pub","hasPlatformCard","hasDiplomatCard","hasInfluenceTransferBlock","canPlayMultipleInterventions","selectHandCard","index","passTurn","transferInfluence","fromCardUid","toCardUid","_prev$effectFlags3","diplomatInfluenceTransferUsed","fromCard","find","toCard","getActiveAbilities","getAvailableAbilities","useActiveAbility","abilityId","targetCardUid","abilities","ability","id","canUseAbility","allCards","actorCard","toString","allTargets","select","actorPlayer","executeAbility","resetActiveAbilities","_activeUsed","executePutinDoubleIntervention","interventionCardIds","canUsePutinDoubleIntervention","putin","interventions","manualAdvanceTurn","endTurn","playCard","activateInstantInitiative","aiPreset"],"sources":["C:/Users/skank/Videos/Cards/Milchcards/src/hooks/useGameState.ts"],"sourcesContent":["import { useState, useCallback } from 'react';\nimport { GameState, Card, PoliticianCard, SpecialCard, Player, BuilderEntry, createDefaultEffectFlags } from '../types/game';\nimport { Pols, Specials, PRESET_DECKS } from '../data/gameData';\nimport {\n  sumRow,\n  shuffle,\n  makePolInstance,\n  makeSpecInstance,\n  buildDeckFromEntries,\n  drawCards,\n  drawCardsAtRoundEnd,\n  tryApplyNegativeEffect,\n  adjustInfluence,\n  findCardLocation,\n  sumGovernmentInfluenceWithAuras,\n  EffectQueueManager,\n  ActiveAbilitiesManager\n} from '../utils/gameUtils';\nimport { getCardDetails } from '../data/cardDetails';\nimport { useGameActions } from './useGameActions';\nimport { useGameAI } from './useGameAI';\nimport { useGameEffects } from './useGameEffects';\nimport { applyStartOfTurnHooks } from '../utils/startOfTurnHooks';\nimport { emptyBoard, emptyBoardSide, ensureSofortBoard } from '../state/board';\n\nconst initialGameState: GameState = {\n  round: 1,\n  current: 1,\n  passed: { 1: false, 2: false },\n  actionPoints: { 1: 2, 2: 2 },\n  actionsUsed: { 1: 0, 2: 0 },\n  decks: { 1: [], 2: [] },\n  hands: { 1: [], 2: [] },\n  traps: { 1: [], 2: [] },\n  board: emptyBoard(),\n  permanentSlots: {\n    1: { government: null, public: null },\n    2: { government: null, public: null },\n  },\n  discard: [],\n  log: [],\n  activeRefresh: { 1: 0, 2: 0 },\n  roundsWon: { 1: 0, 2: 0 },\n  gameWinner: null,\n  effectFlags: {\n    1: createDefaultEffectFlags(),\n    2: createDefaultEffectFlags()\n  },\n  effectQueue: EffectQueueManager.initializeQueue(),\n  activeAbilities: {\n    1: [],\n    2: []\n  },\n  pendingAbilitySelect: undefined,\n  aiEnabled: { 1: false, 2: false },\n};\n\nexport function useGameState() {\n  const [gameState, setGameState] = useState<GameState>(initialGameState);\n  const [selectedHandIndex, setSelectedHandIndex] = useState<number | null>(null);\n\n  const log = useCallback((msg: string) => {\n    const timestamp = new Date().toLocaleTimeString('de-DE', {\n      hour: '2-digit',\n      minute: '2-digit',\n      second: '2-digit'\n    });\n    const logEntry = `[${timestamp}] ${msg}`;\n\n    console.log(logEntry); // Also log to console for debugging\n\n    setGameState(prev => ({\n      ...prev,\n      log: [...prev.log, logEntry]\n    }));\n  }, []);\n\n  // Enhanced logging functions for different types of events\n  const logUIInteraction = useCallback((action: string, details: string) => {\n    log(`ðŸŽ¯ UI: ${action} - ${details}`);\n  }, [log]);\n\n  const logGameStateChange = useCallback((change: string, details: string) => {\n    log(`ðŸ”„ STATE: ${change} - ${details}`);\n  }, [log]);\n\n  const logAIAction = useCallback((action: string, details: string) => {\n    log(`ðŸ¤– KI: ${action} - ${details}`);\n  }, [log]);\n\n  const logCardEffect = useCallback((cardName: string, effect: string) => {\n    log(`âœ¨ EFFEKT: ${cardName} - ${effect}`);\n  }, [log]);\n\n  const logIntervention = useCallback((interventionName: string, trigger: string) => {\n    log(`ðŸ’¥ INTERVENTION: ${interventionName} ausgelÃ¶st durch ${trigger}`);\n  }, [log]);\n\n  // New detailed logging functions for debugging\n  const logFunctionCall = useCallback((functionName: string, params: any, context: string) => {\n    const paramStr = typeof params === 'object' ? JSON.stringify(params, null, 2) : String(params);\n    log(`ðŸ”§ CALL: ${functionName}(${paramStr}) - ${context}`);\n  }, [log]);\n\n  const logDataFlow = useCallback((from: string, to: string, data: any, action: string) => {\n    const dataStr = typeof data === 'object' ? JSON.stringify(data, null, 2) : String(data);\n    log(`ðŸ“Š FLOW: ${from} â†’ ${to} | ${action} | Data: ${dataStr}`);\n  }, [log]);\n\n  const logConditionCheck = useCallback((condition: string, result: boolean, context: string) => {\n    log(`ðŸ” CHECK: ${condition} = ${result} - ${context}`);\n  }, [log]);\n\n  const logError = useCallback((error: string, context: string) => {\n    log(`âŒ ERROR: ${error} - ${context}`);\n  }, [log]);\n\n  const logWarning = useCallback((warning: string, context: string) => {\n    log(`âš ï¸ WARN: ${warning} - ${context}`);\n  }, [log]);\n\n  // Nach Queue-AuflÃ¶sung: Hand-Arrays immutabel neu zuweisen â†’ Canvas & UI bekommen die neuen UIDs\n  const afterQueueResolved = useCallback(() => {\n    setGameState(s => {\n      const n = { ...s };\n      n.hands = {\n        1: [...s.hands[1]],\n        2: [...s.hands[2]],\n      } as any;\n      // optional: version bump fÃ¼r Canvas\n      (n as any)._version = ((s as any)._version ?? 0) + 1;\n      return n;\n    });\n  }, []);\n\n  // Import functionality from separated hooks\n  const gameActions = useGameActions(gameState, setGameState, log, afterQueueResolved);\n  const gameAI = useGameAI(gameState, setGameState, log);\n  const gameEffects = useGameEffects(gameState, setGameState, log);\n\n  const dealStartingHands = useCallback(() => {\n    console.log('[DIAG] dealStartingHands called');\n    function buildDeck(): Card[] {\n      const polPool = [...Pols];\n      const specPool = [...Specials];\n      shuffle(polPool);\n      shuffle(specPool);\n      const deck: Card[] = [];\n      polPool.slice(0, 14).forEach(p => deck.push(makePolInstance(p)));\n\n      // prefer more useful/implemented specials\n      const implFirst = ['media', 'pledge', 'pledge2', 'sanctions', 'dnc1', 'dnc2', 'dnc3', 'reshuffle', 'mission', 'trap_fakenews', 'trap_protest', 'trap_scandal'];\n      const srt = specPool.slice().sort((a, b) => implFirst.indexOf(a.impl) - implFirst.indexOf(b.impl));\n      srt.slice(0, 11).forEach(s => deck.push(makeSpecInstance(s)));\n      return shuffle(deck).slice(0, 25);\n    }\n\n    const deck1 = buildDeck();\n    const deck2 = buildDeck();\n\n    console.log('[DIAG] built decks lengths', deck1.length, deck2.length);\n\n    setGameState(prev => ({\n      ...prev,\n      decks: { 1: deck1, 2: deck2 },\n      hands: {\n        1: deck1.splice(0, 5),\n        2: deck2.splice(0, 5)\n      }\n    }));\n    console.log('[DIAG] setGameState after deal: hands[1].length', (deck1.length >= 5 ? 5 : deck1.length));\n  }, []);\n\n  const startNewGame = useCallback(() => {\n    setGameState({\n      ...initialGameState,\n      round: 1,\n      current: 1,\n      passed: { 1: false, 2: false },\n      actionPoints: { 1: 2, 2: 2 },\n      actionsUsed: { 1: 0, 2: 0 },\n      board: emptyBoard(),\n      traps: { 1: [], 2: [] },\n      permanentSlots: {\n        1: { government: null, public: null },\n        2: { government: null, public: null },\n      },\n      // instantSlot wird nicht mehr verwendet - Sofort-Initiativen gehen in board[player].sofort\n      discard: [],\n      log: [],\n      activeRefresh: { 1: 0, 2: 0 },\n    });\n    dealStartingHands();\n  }, [dealStartingHands]);\n\n  const startMatchWithDecks = useCallback((p1DeckEntries: BuilderEntry[], p2DeckEntries: BuilderEntry[]) => {\n    console.log('ðŸ”§ DEBUG: startMatchWithDecks called - activating AI for player 2');\n    // Automatically enable AI for player 2 when starting with decks\n    console.log('ðŸ”§ DEBUG: About to call gameAI.setAiEnabled(true)');\n    gameAI.setAiEnabled(true);\n    console.log('ðŸ”§ DEBUG: About to call gameAI.setAiPreset(AUTORITAERER_REALIST)');\n    gameAI.setAiPreset('AUTORITAERER_REALIST');\n    console.log('ðŸ”§ DEBUG: AI setup completed');\n\n    console.log('[DIAG] startMatchWithDecks - p1DeckEntries', p1DeckEntries.length, 'p2DeckEntries', p2DeckEntries.length);\n    console.log('[DIAG] startMatchWithDecks - sample entries:', p1DeckEntries.slice(0, 2), p2DeckEntries.slice(0, 2));\n\n    const p1Cards = buildDeckFromEntries(p1DeckEntries);\n    const p2Cards = buildDeckFromEntries(p2DeckEntries);\n\n    const d1 = [...p1Cards];\n    const d2 = [...p2Cards];\n    const h1 = d1.splice(0, Math.min(5, d1.length));\n    const h2 = d2.splice(0, Math.min(5, d2.length));\n\n    console.log('[DIAG] startMatchWithDecks - p1Cards', p1Cards.length, 'p2Cards', p2Cards.length);\n    console.log('[DIAG] startMatchWithDecks - h1', h1.length, 'h2', h2.length);\n    console.log('[DIAG] startMatchWithDecks - sample cards:', p1Cards.slice(0, 2), p2Cards.slice(0, 2));\n\n    setGameState({\n      ...initialGameState,\n      round: 1,\n      current: 1,\n      passed: { 1: false, 2: false },\n      decks: { 1: d1, 2: d2 },\n      hands: { 1: h1, 2: h2 },\n      board: emptyBoard(),\n      traps: { 1: [], 2: [] },\n      permanentSlots: {\n        1: { government: null, public: null },\n        2: { government: null, public: null },\n      },\n      // instantSlot wird nicht mehr verwendet - Sofort-Initiativen gehen in board[player].sofort\n      discard: [],\n      log: [`Match gestartet. P1 und P2 erhalten je ${h1.length}/${h2.length} Startkarten.`],\n      activeRefresh: { 1: 0, 2: 0 },\n    });\n    console.log('[DIAG] setGameState called in startMatchWithDecks');\n  }, [gameAI]);\n\n  const startMatchVsAI = useCallback((p1DeckEntries: BuilderEntry[], presetKey: keyof typeof PRESET_DECKS = 'AUTORITAERER_REALIST') => {\n    const p2DeckEntries = PRESET_DECKS[presetKey] as BuilderEntry[];\n    gameAI.setAiEnabled(true);\n    gameAI.setAiPreset(presetKey);\n    gameActions.startMatchWithDecks(p1DeckEntries, p2DeckEntries);\n  }, [gameAI, gameActions]);\n\n  // PrÃ¼fe ob der Zug automatisch gewechselt werden soll\n  const shouldAdvanceTurn = useCallback((gameState: GameState, player: Player): boolean => {\n    // Wenn Spieler gepasst hat\n    if (gameState.passed[player]) return true;\n\n    // Wenn keine AP mehr verfÃ¼gbar sind\n    if (gameState.actionPoints[player] <= 0) return true;\n\n    // Wenn 2 Aktionen verwendet wurden\n    // if (gameState.actionsUsed[player] >= 2) return true;\n\n    return false;\n  }, []);\n\n  // Karten-Effekte implementieren\n  const executeCardEffect = useCallback((\n    card: Card,\n    player: Player,\n    state: GameState,\n    logFunc: (msg: string) => void\n  ): GameState => {\n    let newState = { ...state };\n\n    logFunctionCall('executeCardEffect', { card: card.name, player, type: card.kind }, 'Starting card effect execution');\n\n    if (card.kind === 'spec') {\n      const specCard = card as SpecialCard;\n\n      // === SOFORT-INITIATIVEN ===\n      if (specCard.name === 'Shadow Lobbying') {\n        logCardEffect(specCard.name, 'Ã–ffentlichkeits-Effekte zÃ¤hlen doppelt diese Runde');\n        const flags = { ...newState.effectFlags?.[player], publicEffectDoubled: true };\n        newState.effectFlags = { ...newState.effectFlags, [player]: flags } as GameState['effectFlags'];\n        logDataFlow('effectFlags', 'newState', { player, publicEffectDoubled: true }, 'Shadow Lobbying flag set');\n      }\n      else if (specCard.name === 'Spin Doctor') {\n        const govCards = newState.board[player].aussen.filter(c => c.kind === 'pol') as PoliticianCard[];\n        logDataFlow('board analysis', 'govCards', { count: govCards.length, cards: govCards.map(c => c.name) }, 'Finding government cards');\n\n        if (govCards.length > 0) {\n          const targetCard = govCards[0];\n          const oldInfluence = targetCard.influence;\n          adjustInfluence(targetCard, 2, 'Spin Doctor');\n          const newInfluence = targetCard.influence;\n\n          logCardEffect(specCard.name, `${targetCard.name} erhÃ¤lt +2 Einfluss (${oldInfluence} â†’ ${newInfluence})`);\n          logDataFlow('influence adjustment', 'targetCard', { card: targetCard.name, old: oldInfluence, new: newInfluence, change: 2 }, 'Spin Doctor effect applied');\n        } else {\n          logWarning('No government cards found', 'Spin Doctor effect has no target');\n        }\n      }\n      else if (specCard.name === 'Digitaler Wahlkampf') {\n        logCardEffect(specCard.name, 'Ziehe 2 Karten, nÃ¤chste Initiative -1 AP');\n        const { newHands, newDecks } = drawCards(player, 2, newState, logFunc);\n        newState = { ...newState, hands: newHands, decks: newDecks };\n\n        // Simplified AP system: No discounts\n        logDataFlow('effectFlags', 'newState', { player }, 'Platform effect applied');\n      }\n      else if (specCard.name === 'Partei-Offensive') {\n        const opponent: Player = player === 1 ? 2 : 1;\n        const oppGovCards = newState.board[opponent].aussen.filter(c => c.kind === 'pol' && !(c as PoliticianCard).deactivated) as PoliticianCard[];\n        logDataFlow('opponent analysis', 'oppGovCards', { opponent, count: oppGovCards.length, cards: oppGovCards.map(c => c.name) }, 'Finding active opponent government cards');\n\n        if (oppGovCards.length > 0) {\n          const targetCard = oppGovCards[0];\n          targetCard.deactivated = true;\n          logCardEffect(specCard.name, `${targetCard.name} wird deaktiviert (bis Rundenende)`);\n          logDataFlow('card deactivation', 'targetCard', { card: targetCard.name, deactivated: true }, 'Partei-Offensive effect applied');\n        } else {\n          logWarning('No active opponent government cards found', 'Partei-Offensive effect has no target');\n        }\n      }\n      else if (specCard.name === 'Oppositionsblockade') {\n        const opponent: Player = player === 1 ? 2 : 1;\n        const oppHand = newState.hands[opponent];\n        logDataFlow('opponent hand', 'analysis', { opponent, handSize: oppHand.length, cards: oppHand.map(c => c.name) }, 'Analyzing opponent hand');\n\n        if (oppHand.length > 0) {\n          const discardedCard = oppHand[Math.floor(Math.random() * oppHand.length)];\n          const newOppHand = oppHand.filter(c => c !== discardedCard);\n          newState.hands = { ...newState.hands, [opponent]: newOppHand };\n\n          logCardEffect(specCard.name, `Gegner verliert ${discardedCard.name} aus der Hand`);\n          logDataFlow('card discard', 'opponent hand', { card: discardedCard.name, newHandSize: newOppHand.length }, 'Oppositionsblockade effect applied');\n        } else {\n          logWarning('Opponent hand is empty', 'Oppositionsblockade effect has no target');\n        }\n      }\n      else if (specCard.name === 'Opportunist') {\n        const opponent: Player = player === 1 ? 2 : 1;\n        const oppBoard = newState.board[opponent];\n        const totalOppInfluence = sumRow([...oppBoard.innen, ...oppBoard.aussen]);\n\n        logDataFlow('opponent board analysis', 'influence calculation', {\n          opponent,\n          innen: oppBoard.innen.map(c => ({ name: c.name, influence: c.kind === 'pol' ? (c as any).influence : 0 })),\n          aussen: oppBoard.aussen.map(c => ({ name: c.name, influence: c.kind === 'pol' ? (c as any).influence : 0 })),\n          totalInfluence: totalOppInfluence\n        }, 'Calculating opponent total influence');\n\n        if (totalOppInfluence > 10) {\n          const { newHands, newDecks } = drawCards(player, 1, newState, logFunc);\n          newState = { ...newState, hands: newHands, decks: newDecks };\n          logCardEffect(specCard.name, `Gegner hat ${totalOppInfluence} Einfluss (>10) - ziehe 1 Karte`);\n        } else {\n          logCardEffect(specCard.name, `Gegner hat ${totalOppInfluence} Einfluss (â‰¤10) - kein Effekt`);\n        }\n      }\n      else if (specCard.name === 'Think-tank') {\n        const { newHands, newDecks } = drawCards(player, 1, newState, logFunc);\n        newState = { ...newState, hands: newHands, decks: newDecks };\n        logCardEffect(specCard.name, 'Ziehe 1 Karte');\n      }\n      else if (specCard.name === 'Influencer-Kampagne') {\n        const publicCards = newState.board[player].innen.filter(c => c.kind === 'pol') as PoliticianCard[];\n        logDataFlow('public cards analysis', 'influence boost', { count: publicCards.length, cards: publicCards.map(c => c.name) }, 'Finding public cards for influence boost');\n\n        publicCards.forEach(card => {\n          const oldInfluence = card.influence;\n          adjustInfluence(card, 1, 'Influencer-Kampagne');\n          const newInfluence = card.influence;\n          logCardEffect(specCard.name, `${card.name} erhÃ¤lt +1 Einfluss (${oldInfluence} â†’ ${newInfluence})`);\n        });\n\n        if (publicCards.length === 0) {\n          logWarning('No public cards found', 'Influencer-Kampagne effect has no targets');\n        }\n      }\n      else if (specCard.name === 'Systemrelevant') {\n        const opponent: Player = player === 1 ? 2 : 1;\n        const oppGovCards = newState.board[opponent].aussen.filter(c => c.kind === 'pol') as PoliticianCard[];\n        logDataFlow('opponent government analysis', 'systemrelevant effect', { count: oppGovCards.length, cards: oppGovCards.map(c => c.name) }, 'Finding opponent government cards');\n\n        if (oppGovCards.length > 0) {\n          const targetCard = oppGovCards[0];\n          const oldInfluence = targetCard.influence;\n          adjustInfluence(targetCard, -2, 'Systemrelevant');\n          const newInfluence = targetCard.influence;\n\n          logCardEffect(specCard.name, `${targetCard.name} verliert 2 Einfluss (${oldInfluence} â†’ ${newInfluence})`);\n          logDataFlow('influence reduction', 'targetCard', { card: targetCard.name, old: oldInfluence, new: newInfluence, change: -2 }, 'Systemrelevant effect applied');\n        } else {\n          logWarning('No opponent government cards found', 'Systemrelevant effect has no target');\n        }\n      }\n      else if (specCard.name === 'Symbolpolitik') {\n        const { newHands, newDecks } = drawCards(player, 1, newState, logFunc);\n        newState = { ...newState, hands: newHands, decks: newDecks };\n\n        newState.actionPoints = {\n          ...newState.actionPoints,\n          [player]: Math.min(2, newState.actionPoints[player] + 1)\n        };\n\n        const oldAP = state.actionPoints[player];\n        const newAP = newState.actionPoints[player];\n        logCardEffect(specCard.name, `Ziehe 1 Karte, erhalte +1 AP (${oldAP} â†’ ${newAP})`);\n        logDataFlow('AP gain', 'player', { player, old: oldAP, new: newAP, change: 1 }, 'Symbolpolitik effect applied');\n      }\n      else if (specCard.name === 'Alexei Navalny') {\n        logCardEffect(specCard.name, 'Ziehe 1 Karte');\n        const { newHands, newDecks } = drawCards(player, 1, newState, logFunc);\n        newState = { ...newState, hands: newHands, decks: newDecks };\n      }\n      else if (specCard.name === 'Mukesh Ambani') {\n        logCardEffect(specCard.name, 'Ziehe 1 Karte');\n        const { newHands, newDecks } = drawCards(player, 1, newState, logFunc);\n        newState = { ...newState, hands: newHands, decks: newDecks };\n      }\n\n      // Oligarch-Effekte\n      else if (['Elon Musk', 'Bill Gates', 'George Soros', 'Warren Buffett', 'Mukesh Ambani', 'Jeff Bezos', 'Alisher Usmanov', 'Gautam Adani', 'Jack Ma', 'Zhang Yiming', 'Roman Abramovich'].includes(specCard.name)) {\n        logCardEffect(specCard.name, 'Ziehe 1 Karte (Oligarch-Effekt)');\n        const { newHands, newDecks } = drawCards(player, 1, newState, logFunc);\n        newState = { ...newState, hands: newHands, decks: newDecks };\n      }\n    }\n\n    // === DAUERHAFTE INITIATIVEN ===\n    if (card.kind === 'spec' && (card as SpecialCard).type === 'Dauerhaft-Initiative') {\n      const specCard = card as SpecialCard;\n\n      if (specCard.name === 'Algorithmischer Diskurs') {\n        logCardEffect(specCard.name, 'Dauerhafte Initiative: Alle Medien-Karten geben +1 Einfluss');\n        // This effect will be applied in applyStartOfTurnHooks\n      }\n      else if (specCard.name === 'Alternative Fakten') {\n        logCardEffect(specCard.name, 'Dauerhafte Initiative: Alle Oligarchen geben +1 Einfluss');\n        // This effect will be applied in applyStartOfTurnHooks\n      }\n    }\n\n    // === POLITIKER-KARTEN ===\n    else if (card.kind === 'pol') {\n      const polCard = card as PoliticianCard;\n      logCardEffect(polCard.name, `Politiker platziert - Basis-Einfluss: ${polCard.influence}`);\n    }\n\n    logDataFlow('executeCardEffect', 'newState', { card: card.name, effectsApplied: true }, 'Card effect execution completed');\n    return newState;\n  }, [logFunctionCall, logCardEffect, logDataFlow, logWarning]);\n\n  const nextTurn = useCallback(() => {\n    logFunctionCall('nextTurn', {}, 'Starting turn change');\n\n    setGameState((prev): GameState => {\n      logDataFlow('UI', 'nextTurn', { current: prev.current, passed: prev.passed }, 'Turn change request');\n\n      // if both passed -> resolve round\n      logConditionCheck('both players passed', prev.passed[1] && prev.passed[2], 'Round end check');\n      if (prev.passed[1] && prev.passed[2]) {\n        logFunctionCall('resolveRound', { round: prev.round }, 'Both players passed - resolving round');\n        return resolveRound(prev);\n      }\n\n      const newCurrent: Player = prev.current === 1 ? 2 : 1;\n      logDataFlow('turn change', 'newCurrent', { old: prev.current, new: newCurrent }, 'Player switch');\n\n      // Reset AP for the new current player\n      const newActionPoints = { ...prev.actionPoints };\n      newActionPoints[newCurrent] = 2;\n\n      logDataFlow('AP reset', 'newCurrent', {\n        player: newCurrent,\n        oldAP: prev.actionPoints[newCurrent],\n        newAP: newActionPoints[newCurrent],\n        oldActions: 0,\n        newActions: 0\n      }, 'Resource reset for new player');\n\n      // Apply start-of-turn hooks for the new current player\n      const newState: GameState = {\n        ...prev,\n        current: newCurrent,\n        actionPoints: newActionPoints\n      };\n\n      // Log turn change\n      log(`Spieler ${newCurrent} ist am Zug (2 AP verfÃ¼gbar)`);\n      logGameStateChange('turn change', `Player ${newCurrent} turn started`);\n\n      logFunctionCall('applyStartOfTurnHooks', { player: newCurrent }, 'Applying start-of-turn effects');\n      applyStartOfTurnHooks(newState, newCurrent, log);\n\n      // Check if AI should take turn\n      logConditionCheck('AI turn', newCurrent === 2 && (prev.aiEnabled?.[2] ?? false), 'AI turn check');\n      if (newCurrent === 2 && (prev.aiEnabled?.[2] ?? false)) {\n        logFunctionCall('runAITurn', { player: newCurrent }, 'Triggering AI turn');\n        // Use setTimeout to avoid state update conflicts\n        setTimeout(() => {\n          logAIAction('AI turn triggered', 'Starting AI turn execution');\n          gameAI.runAITurn();\n        }, 100);\n      }\n\n      logDataFlow('nextTurn', 'finalState', {\n        current: newState.current,\n        ap: newState.actionPoints[newCurrent],\n        aiEnabled: prev.aiEnabled?.[2] ?? false\n      }, 'Turn change completed');\n\n      return newState;\n    });\n\n    // Nach Zugwechsel ebenfalls spiegeln (z. B. Auto-Draw am EoT)\n    afterQueueResolved();\n  }, [logFunctionCall, logDataFlow, logConditionCheck, logGameStateChange, gameAI, log, logAIAction, afterQueueResolved]);\n\n  // Automatischer Zugwechsel basierend auf AP\n  const checkAndAdvanceTurn = useCallback((gameState: GameState) => {\n    const currentPlayer = gameState.current;\n    if (shouldAdvanceTurn(gameState, currentPlayer)) {\n      // Nur wechseln wenn der andere Spieler nicht auch fertig ist\n      const otherPlayer: Player = currentPlayer === 1 ? 2 : 1;\n      if (!shouldAdvanceTurn(gameState, otherPlayer) || gameState.passed[otherPlayer]) {\n        nextTurn();\n      }\n    }\n  }, [shouldAdvanceTurn, nextTurn]);\n\n  const scores = useCallback((state: GameState): [number, number] => {\n    // Einheitliche Berechnung Ã¼ber Utils-Helfer\n    const s1 = sumGovernmentInfluenceWithAuras(state, 1);\n    const s2 = sumGovernmentInfluenceWithAuras(state, 2);\n    return [s1, s2];\n  }, []);\n\n  const resolveRound = useCallback((state: GameState): GameState => {\n    const [s1, s2] = scores(state);\n    let winner: 1 | 2 = 1;\n    let note = '';\n\n    if (s1 > s2) winner = 1;\n    else if (s2 > s1) winner = 2;\n    else {\n      // Gleichstand -> erster Pass gewinnt\n      winner = state.passed[1] && !state.passed[2] ? 1 : 2;\n      note = ' (Gleichstand â€“ frÃ¼herer Pass)';\n    }\n\n    log(`Runde ${state.round} endet: P1 ${s1} : P2 ${s2}. Gewinner: P${winner}${note}.`);\n\n    // Rundensieg zÃ¤hlen\n    const newRoundsWon = { ...state.roundsWon };\n    newRoundsWon[winner] += 1;\n\n    // PrÃ¼fe Best-of-3 Gewinner\n    let gameWinner: 1 | 2 | null = null;\n    if (newRoundsWon[1] >= 2) {\n      gameWinner = 1;\n      log(`ðŸŽ‰ SPIEL ENDE: Spieler 1 gewinnt das Spiel! (${newRoundsWon[1]}:${newRoundsWon[2]})`);\n    } else if (newRoundsWon[2] >= 2) {\n      gameWinner = 2;\n      log(`ðŸŽ‰ SPIEL ENDE: Spieler 2 gewinnt das Spiel! (${newRoundsWon[2]}:${newRoundsWon[1]})`);\n    }\n\n    // clear board (no carryover)\n    const newBoard = emptyBoard();\n    const newTraps = { 1: [], 2: [] };\n\n    // Verbesserte Karten-Nachzieh-Mechanik (ziehe bis Hand voll ist)\n    const { newHands, newDecks } = drawCardsAtRoundEnd(state, log);\n\n    const newRound = state.round + 1;\n    const newPassed = { 1: false, 2: false };\n    // alternate starter each round\n    const newCurrent = (newRound % 2 === 1) ? 1 : 2;\n\n    // Wenn Spiel zu Ende, stoppe\n    if (gameWinner) {\n      return {\n        ...state,\n        roundsWon: newRoundsWon,\n        gameWinner,\n      };\n    }\n\n    log(`Runde ${newRound} beginnt. P${newCurrent} startet.`);\n\n    // ðŸ”¥ CLUSTER 3: Reset temporÃ¤re Initiative-Boni am Rundenende\n    const newEffectFlags = {\n      1: {\n        ...state.effectFlags[1],\n        // Reset Cluster 3 Flags\n        scienceInitiativeBonus: false,\n        militaryInitiativePenalty: false,\n        healthInitiativeBonus: false,\n        cultureInitiativeBonus: false,\n        // Reset andere rundenbasierte Flags\n        markZuckerbergUsed: false,\n        opportunistActive: false,\n        publicEffectDoubled: false,\n        cannotPlayInitiatives: false,\n        nextCardProtected: false,\n        platformAfterInitiativeBonus: false,\n        interventionEffectReduced: false,\n      },\n      2: {\n        ...state.effectFlags[2],\n        // Reset Cluster 3 Flags\n        scienceInitiativeBonus: false,\n        militaryInitiativePenalty: false,\n        healthInitiativeBonus: false,\n        cultureInitiativeBonus: false,\n        // Reset andere rundenbasierte Flags\n        markZuckerbergUsed: false,\n        opportunistActive: false,\n        publicEffectDoubled: false,\n        cannotPlayInitiatives: false,\n        nextCardProtected: false,\n        platformAfterInitiativeBonus: false,\n        interventionEffectReduced: false,\n      }\n    };\n\n    return {\n      ...state,\n      round: newRound,\n      current: newCurrent,\n      passed: newPassed,\n      board: newBoard,\n      traps: newTraps,\n      hands: newHands,\n      decks: newDecks,\n      roundsWon: newRoundsWon,\n      effectFlags: newEffectFlags,\n    };\n  }, [log, scores]);\n\n  // Einfache Interventionsauswertung fÃ¼r einige hÃ¤ufige Trigger\n  const evaluateInterventions = (\n    prev: GameState,\n    actingPlayer: Player,\n    event: any,\n    tentativeBoard: GameState['board']\n  ): [GameState['board'] | null, GameState['traps'] | null] => {\n    const opponent: Player = actingPlayer === 1 ? 2 : 1;\n    const oppTraps = [...(prev.traps[opponent] || [])];\n    let board = tentativeBoard;\n    let trapsChanged = false;\n\n    for (let i = 0; i < oppTraps.length; i++) {\n      const trap = oppTraps[i];\n      if (trap.kind !== 'spec') continue;\n      const spec = trap as SpecialCard;\n      const details = getCardDetails(spec.name);\n      const key = spec.key;\n\n      // Trigger: Karte gespielt\n      if (event.type === 'card_played' && (event.card as PoliticianCard)) {\n        const played = event.card as PoliticianCard;\n        const isMedia = ['Oprah Winfrey'].includes(played.name);\n        const isNGO = ['Bill Gates', 'Jennifer Doudna', 'Noam Chomsky'].includes(played.name);\n        const isPlatform = ['Mark Zuckerberg', 'Tim Cook', 'Jack Ma', 'Zhang Yiming'].includes(played.name);\n        const isDiplomat = ['Joschka Fischer', 'Sergey Lavrov', 'Ursula von der Leyen', 'Jens Stoltenberg', 'Hans Dietrich Genscher', 'Colin Powell', 'Condoleezza Rice', 'Christine Lagarde'].includes(played.name);\n        const isTier2Gov = (played.T === 2 && event.lane === 'aussen');\n        const isTier1Gov = (played.T === 1 && event.lane === 'aussen');\n        const isWeakGov = (played.influence <= 5 && event.lane === 'aussen');\n        const isLowPowerGov = (played.influence <= 4 && event.lane === 'aussen');\n\n        // Cancel Culture / Fake News-Kampagne\n        if ((details?.name === 'Cancel Culture' || key === 'Cancel_Culture') && event.lane === 'innen') {\n          tryApplyNegativeEffect(played, () => { played.deactivated = true; }, prev.round);\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Cancel Culture â†’ ${played.name} deaktiviert.`);\n          logIntervention('Cancel Culture', `AusgelÃ¶st gegen ${played.name} in Ã–ffentlichkeit`);\n          continue;\n        }\n        if ((details?.name === 'Fake News-Kampagne' || key === 'Fake_News_Kampagne') && isMedia) {\n          tryApplyNegativeEffect(played, () => { played.deactivated = true; }, prev.round);\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Fake News-Kampagne â†’ ${played.name} deaktiviert.`);\n          logIntervention('Fake News-Kampagne', `AusgelÃ¶st gegen ${played.name} (Medien)`);\n          continue;\n        }\n\n        // Whistleblower (Tier 2 Regierung)\n        if ((details?.name === 'Whistleblower' || key === 'Whistleblower') && isTier2Gov) {\n          tryApplyNegativeEffect(played, () => { adjustInfluence(played, -2, 'Whistleblower'); }, prev.round);\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Whistleblower â†’ ${played.name} -2 Einfluss.`);\n          continue;\n        }\n\n        // Berater-AffÃ¤re (Tier 1 Regierung)\n        if ((details?.name === 'Berater-AffÃ¤re' || key === 'Berater_Affaere') && isTier1Gov) {\n          tryApplyNegativeEffect(played, () => { adjustInfluence(played, -2, 'Berater-AffÃ¤re'); }, prev.round);\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Berater-AffÃ¤re â†’ ${played.name} -2 Einfluss.`);\n          continue;\n        }\n\n        // Soft Power-Kollaps / Deepfake-Skandal (Diplomat)\n        if ((details?.name === 'Soft Power-Kollaps' || key === 'Soft_Power_Kollaps') && isDiplomat) {\n          tryApplyNegativeEffect(played, () => { adjustInfluence(played, -3, 'Soft Power-Kollaps'); }, prev.round);\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Soft Power-Kollaps â†’ ${played.name} -3 Einfluss.`);\n          continue;\n        }\n        if ((details?.name === 'Deepfake-Skandal' || key === 'Deepfake_Skandal') && isDiplomat) {\n          // Kein Einflusstransfer mÃ¶glich - Flag setzen\n          const newFlags = { ...prev.effectFlags?.[actingPlayer], influenceTransferBlocked: true };\n          prev.effectFlags = { ...prev.effectFlags, [actingPlayer]: newFlags } as GameState['effectFlags'];\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Deepfake-Skandal â†’ ${played.name} kann keinen Einfluss transferieren.`);\n          continue;\n        }\n\n        // Lobby Leak / Boykott-Kampagne (NGO/Bewegung)\n        if ((details?.name === 'Lobby Leak' || key === 'Lobby_Leak') && isNGO) {\n          const hands = { ...prev.hands } as GameState['hands'];\n          if (hands[actingPlayer].length > 0) {\n            hands[actingPlayer] = hands[actingPlayer].slice(1);\n            prev.hands = hands;\n          }\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Lobby Leak â†’ P${actingPlayer} wirft 1 Karte ab.`);\n          continue;\n        }\n        if ((details?.name === 'Boykott-Kampagne' || key === 'Boykott_Kampagne') && (isNGO || ['Greta Thunberg', 'Malala Yousafzai', 'Ai Weiwei', 'Alexei Navalny'].includes(played.name))) {\n          tryApplyNegativeEffect(played, () => { played.deactivated = true; }, prev.round);\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Boykott-Kampagne â†’ ${played.name} deaktiviert.`);\n          continue;\n        }\n\n        // Cyber-Attacke (Plattform)\n        if ((details?.name === 'Cyber-Attacke' || key === 'Cyber_Attacke') && isPlatform) {\n          const loc = findCardLocation(played as any, { ...prev, board } as GameState);\n          if (loc) {\n            const arr = [...board[loc.player][loc.lane]];\n            const idx = arr.findIndex(c => c.uid === played.uid);\n            if (idx >= 0) {\n              arr.splice(idx, 1);\n              board = {\n                ...board,\n                [loc.player]: {\n                  ...board[loc.player],\n                  [loc.lane]: arr\n                }\n              } as GameState['board'];\n            }\n          }\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Cyber-Attacke â†’ ${played.name} zerstÃ¶rt.`);\n          continue;\n        }\n\n        // Bestechungsskandal 2.0 (schwache Regierung Mâ‰¤5)\n        if ((details?.name === 'Bestechungsskandal 2.0' || key === 'Bestechungsskandal_2_0') && isWeakGov) {\n          // Ãœbernehme Karte bis Rundenende (vereinfacht: temporÃ¤r deaktiviert)\n          tryApplyNegativeEffect(played, () => { played.deactivated = true; }, prev.round);\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Bestechungsskandal 2.0 â†’ ${played.name} Ã¼bernommen.`);\n          continue;\n        }\n\n        // Tunnelvision (Mâ‰¤4 Regierung)\n        if ((details?.name === 'Tunnelvision' || key === 'Tunnelvision') && isLowPowerGov) {\n          // Karte zÃ¤hlt nicht zur Runde (vereinfacht: -100% Einfluss)\n          tryApplyNegativeEffect(played, () => { played.influence = 0; }, prev.round);\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Tunnelvision â†’ ${played.name} zÃ¤hlt nicht zur Runde.`);\n          continue;\n        }\n      }\n\n      // Trigger: Board-Zustand\n      if (event.type === 'board_state_check') {\n        const actingPlayerGovCount = tentativeBoard[actingPlayer].aussen.length;\n        const actingPlayerPubCount = tentativeBoard[actingPlayer].innen.length;\n\n        // Strategische EnthÃ¼llung (>2 Regierungskarten)\n        if ((details?.name === 'Strategische EnthÃ¼llung' || key === 'Strategische_Enthuellung') && actingPlayerGovCount > 2) {\n          // Eine Regierungskarte zurÃ¼ck auf Hand (vereinfacht: entferne erste)\n          const govCards = [...tentativeBoard[actingPlayer].aussen];\n          if (govCards.length > 0) {\n            govCards.pop(); // Entferne letzte\n            board = { ...board, [actingPlayer]: { ...board[actingPlayer], aussen: govCards } } as GameState['board'];\n          }\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Strategische EnthÃ¼llung â†’ Regierungskarte zurÃ¼ck.`);\n          continue;\n        }\n\n        // Grassroots-Widerstand (>2 Ã–ffentlichkeitskarten)\n        if ((details?.name === 'Grassroots-Widerstand' || key === 'Grassroots_Widerstand') && actingPlayerPubCount > 2) {\n          const pubCards = tentativeBoard[actingPlayer].innen.filter(c => c.kind === 'pol') as PoliticianCard[];\n          if (pubCards.length > 0) {\n            tryApplyNegativeEffect(pubCards[0], () => { pubCards[0].deactivated = true; }, prev.round);\n          }\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Grassroots-Widerstand â†’ Ã–ffentlichkeitskarte deaktiviert.`);\n          continue;\n        }\n\n        // Parlament geschlossen (â‰¥2 Regierungskarten)\n        if ((details?.name === 'Parlament geschlossen' || key === 'Parlament_geschlossen') && actingPlayerGovCount >= 2) {\n          // Blockiere weitere Regierungskarten (Flag fÃ¼r diesen Zug)\n          const newFlags = { ...prev.effectFlags?.[actingPlayer], cannotPlayMoreGovernment: true };\n          prev.effectFlags = { ...prev.effectFlags, [actingPlayer]: newFlags } as GameState['effectFlags'];\n          oppTraps.splice(i, 1); i--; trapsChanged = true;\n          log(`Intervention ausgelÃ¶st: Parlament geschlossen â†’ keine weiteren Regierungskarten.`);\n          continue;\n        }\n\n        // Interne FraktionskÃ¤mpfe (groÃŸe Initiative 3-4 HP)\n        if ((details?.name === 'Interne FraktionskÃ¤mpfe' || key === 'Interne_Fraktionskaempfe') && event.type === 'card_played' && event.card?.kind === 'spec') {\n          const specCard = event.card as SpecialCard;\n          const isLargeInitiative = specCard.type === 'Sofort-Initiative' && (specCard.bp >= 3);\n          if (isLargeInitiative) {\n            // Initiative annullieren (vereinfacht: Karte zurÃ¼ck auf Hand)\n            const hands = { ...prev.hands } as GameState['hands'];\n            hands[actingPlayer].push(event.card);\n            prev.hands = hands;\n            oppTraps.splice(i, 1); i--; trapsChanged = true;\n            log(`Intervention ausgelÃ¶st: Interne FraktionskÃ¤mpfe â†’ ${event.card.name} wird annulliert.`);\n            continue;\n          }\n        }\n\n        // Massenproteste (2 Regierungskarten in der Runde)\n        if ((details?.name === 'Massenproteste' || key === 'Massenproteste') && event.type === 'card_played' && event.lane === 'aussen') {\n          // Vereinfacht: Beide Regierungskarten -1 Einfluss\n          const govCards = board[actingPlayer].aussen.filter(c => c.kind === 'pol') as PoliticianCard[];\n          if (govCards.length >= 2) {\n            adjustInfluence(govCards[0], -1, 'Massenproteste');\n            adjustInfluence(govCards[1], -1, 'Massenproteste');\n            oppTraps.splice(i, 1); i--; trapsChanged = true;\n            log(`Intervention ausgelÃ¶st: Massenproteste â†’ ${govCards[0].name} und ${govCards[1].name} -1 Einfluss.`);\n            continue;\n          }\n        }\n\n        // \"UnabhÃ¤ngige\" Untersuchung (gegen Intervention)\n        if ((details?.name === '\"UnabhÃ¤ngige\" Untersuchung' || key === 'Unabhaengige_Untersuchung') && event.type === 'card_played' && event.card?.kind === 'spec') {\n          const specCard = event.card as SpecialCard;\n          if (specCard.type === 'Intervention') {\n            // Intervention annullieren (vereinfacht: Karte zurÃ¼ck auf Hand)\n            const hands = { ...prev.hands } as GameState['hands'];\n            hands[actingPlayer].push(event.card);\n            prev.hands = hands;\n            oppTraps.splice(i, 1); i--; trapsChanged = true;\n            log(`Intervention ausgelÃ¶st: \"UnabhÃ¤ngige\" Untersuchung â†’ ${event.card.name} wird annulliert.`);\n            continue;\n          }\n        }\n\n        // Maulwurf (kopiere schwÃ¤chere Regierungskarte des Gegners)\n        if ((details?.name === 'Maulwurf' || key === 'Maulwurf') && event.type === 'card_played' && event.lane === 'aussen') {\n          const oppGovCards = board[opponent].aussen.filter(c => c.kind === 'pol') as PoliticianCard[];\n          if (oppGovCards.length > 0) {\n            // Finde schwÃ¤chste Regierungskarte\n            const weakestCard = oppGovCards.reduce((weakest, current) =>\n              (current.influence < weakest.influence) ? current : weakest\n            );\n            // Kopie erstellen (vereinfacht: gleiche Karte auf eigene Hand)\n            const hands = { ...prev.hands } as GameState['hands'];\n            const copyCard = { ...weakestCard, uid: Date.now() + Math.random() };\n            hands[opponent].push(copyCard);\n            prev.hands = hands;\n            oppTraps.splice(i, 1); i--; trapsChanged = true;\n            log(`Intervention ausgelÃ¶st: Maulwurf â†’ Kopie von ${weakestCard.name} auf Hand.`);\n            continue;\n          }\n        }\n\n        // Skandalspirale (Initiative + Ã–ffentlichkeitskarte)\n        if ((details?.name === 'Skandalspirale' || key === 'Skandalspirale') && event.type === 'card_played') {\n          // Vereinfacht: PrÃ¼fe ob Initiative und Ã–ffentlichkeitskarte in dieser Runde gespielt wurden\n          const recentCards = board[actingPlayer].innen.concat(board[actingPlayer].aussen);\n          const hasInitiative = recentCards.some(c => c.kind === 'spec' && (c as SpecialCard).type === 'Sofort-Initiative');\n          const hasPublic = recentCards.some(c => c.kind === 'spec' && (c as SpecialCard).type === 'Ã–ffentlichkeitskarte');\n          if (hasInitiative && hasPublic) {\n            // Eine der beiden Karten annullieren (vereinfacht: letzte Ã–ffentlichkeitskarte)\n            const pubCards = board[actingPlayer].innen.filter(c => c.kind === 'spec' && (c as SpecialCard).type === 'Ã–ffentlichkeitskarte');\n            if (pubCards.length > 0) {\n              const lastPubCard = pubCards[pubCards.length - 1];\n              const arr = [...board[actingPlayer].innen];\n              const idx = arr.findIndex(c => c.uid === lastPubCard.uid);\n              if (idx >= 0) {\n                arr.splice(idx, 1);\n                board = {\n                  ...board,\n                  [actingPlayer]: { ...board[actingPlayer], innen: arr }\n                } as GameState['board'];\n              }\n            }\n            oppTraps.splice(i, 1); i--; trapsChanged = true;\n            log(`Intervention ausgelÃ¶st: Skandalspirale â†’ Ã–ffentlichkeitskarte annulliert.`);\n            continue;\n          }\n        }\n\n        // Satire-Show (bei mehr Einfluss als Gegner)\n        if ((details?.name === 'Satire-Show' || key === 'Satire_Show')) {\n          const playerInfluence = sumRow([...board[opponent].aussen]);\n          const opponentInfluence = sumRow([...board[actingPlayer].aussen]);\n          if (opponentInfluence > playerInfluence) {\n            const oppGovCards = board[opponent].aussen.filter(c => c.kind === 'pol') as PoliticianCard[];\n            if (oppGovCards.length > 0) {\n              // Erste Regierungskarte -2 Einfluss\n              adjustInfluence(oppGovCards[0], -2, 'Satire-Show');\n              oppTraps.splice(i, 1); i--; trapsChanged = true;\n              log(`Intervention ausgelÃ¶st: Satire-Show â†’ ${oppGovCards[0].name} -2 Einfluss.`);\n              continue;\n            }\n          }\n        }\n      }\n    }\n\n    if (trapsChanged) {\n      const newTraps = { ...prev.traps, [opponent]: oppTraps } as GameState['traps'];\n      return [board, newTraps];\n    }\n    return [null, null];\n  };\n\n  // Zentrale Effekt-Queue Verarbeitung\n  const processEffectQueue = useCallback((state: GameState): GameState => {\n    if (!state.effectQueue || state.effectQueue.items.length === 0) {\n      return state;\n    }\n\n    const [newQueue, newState] = EffectQueueManager.processQueue(\n      state.effectQueue,\n      state,\n      log\n    );\n\n    return {\n      ...newState,\n      effectQueue: newQueue\n    };\n  }, [log]);\n\n  // Berechne Einfluss mit dauerhaften Auren-Effekten\n  const sumRowWithAuras = (state: GameState, player: Player): number => {\n    const govCards = state.board[player].aussen.filter(c => c.kind === 'pol') as PoliticianCard[];\n    const opponent: Player = player === 1 ? 2 : 1;\n    let total = 0;\n\n    // ðŸ” DEBUG: Log welche Regierungskarten gefunden wurden\n    console.log(`ðŸ” sumRowWithAuras P${player}: Gefunden ${govCards.length} Regierungskarten:`,\n      govCards.map(c => `${c.name}[${c.influence}I]`).join(', '));\n\n    govCards.forEach(card => {\n      let influence = card.influence;\n\n      // Dauerhafte Auren anwenden\n      const govSlot = state.permanentSlots[player].government;\n      const pubSlot = state.permanentSlots[player].public;\n\n      // Koalitionszwang: Tier 2 Regierungskarten +1 Einfluss\n      if (govSlot?.kind === 'spec' && (govSlot as SpecialCard).name === 'Koalitionszwang') {\n        if (card.T === 2) influence += 1;\n      }\n\n      // Napoleon Komplex: Tier 1 Regierungskarten +1 Einfluss\n      if (govSlot?.kind === 'spec' && (govSlot as SpecialCard).name === 'Napoleon Komplex') {\n        if (card.T === 1) influence += 1;\n      }\n\n      // Zivilgesellschaft: Bewegung-Karten +1 Einfluss\n      if (pubSlot?.kind === 'spec' && (pubSlot as SpecialCard).name === 'Zivilgesellschaft') {\n        const bewegungNames = ['Greta Thunberg', 'Malala Yousafzai', 'Ai Weiwei', 'Alexei Navalny'];\n        const hasBewegung = state.board[player].innen.some(c => c.kind === 'spec' && (c as SpecialCard).type === 'Ã–ffentlichkeitskarte' && bewegungNames.includes(c.name));\n        if (hasBewegung) influence += 1;\n      }\n\n      // ðŸ”¥ JOSCHKA FISCHER NGO-BOOST: +1 Einfluss wenn NGO auf dem Board liegt\n      if (card.name === 'Joschka Fischer' && (card as any).effect === 'ngo_boost') {\n        const hasNgoCard = state.board[player].innen.some(c =>\n          c.kind === 'spec' &&\n          (c as SpecialCard).type === 'Ã–ffentlichkeitskarte' &&\n          (c as any).tag === 'NGO'\n        );\n        if (hasNgoCard) {\n          influence += 1;\n          // Log nur beim ersten Mal, um Spam zu vermeiden\n          if (!(card as any)._ngoBoostLogged) {\n            console.log(`ðŸ”¥ JOSCHKA FISCHER KONTINUIERLICHER NGO-BOOST: +1 Einfluss`);\n            (card as any)._ngoBoostLogged = true;\n          }\n        } else {\n          (card as any)._ngoBoostLogged = false;\n        }\n      }\n\n      // Milchglas Transparenz: +1 Einfluss wenn keine NGO/Bewegung liegt\n      if (govSlot?.kind === 'spec' && (govSlot as SpecialCard).name === 'Milchglas Transparenz') {\n        const ngoMovementNames = ['Jennifer Doudna', 'Noam Chomsky', 'Bill Gates', 'Greta Thunberg', 'Malala Yousafzai', 'Ai Weiwei', 'Alexei Navalny'];\n        const hasNgoMovement = state.board[player].innen.some(c => c.kind === 'spec' && (c as SpecialCard).type === 'Ã–ffentlichkeitskarte' && ngoMovementNames.includes(c.name));\n        if (!hasNgoMovement) influence += 1;\n      }\n\n      // Alternative Fakten: Gegner-Interventionen -1 Wirkung\n      const oppPubSlot = state.permanentSlots[opponent].public;\n      if (oppPubSlot?.kind === 'spec' && (oppPubSlot as SpecialCard).name === 'Alternative Fakten') {\n        // Reduziere Effekt von Interventionen (vereinfacht: -1 Einfluss weniger)\n        // Wird in der Intervention-Auswertung berÃ¼cksichtigt\n      }\n\n      total += influence;\n    });\n\n    // ðŸ” DEBUG: Final influence calculation\n    console.log(`ðŸŽ¯ sumRowWithAuras P${player}: Gesamt-Einfluss = ${total}`);\n    return total;\n  };\n\n  // playCard is now handled by useGameActions hook\n\n  // runAITurn is now handled by useGameAI hook - removed duplicate implementation\n\n  const applyStartOfTurnHooksLegacy = useCallback((player: Player, state: GameState) => {\n    logFunctionCall('applyStartOfTurnHooksLegacy', { player, round: state.round }, 'Starting legacy turn hooks');\n\n    const pool = [...state.board[player].innen, ...state.board[player].aussen];\n    pool.forEach(c => {\n        if (c.kind === 'pol') {\n        const polCard = c as PoliticianCard;\n        if (polCard._pledgeDown && polCard._pledgeDown.round === state.round) {\n          const oldInfluence = polCard.influence;\n          adjustInfluence(polCard, polCard._pledgeDown.amount, 'Wahlversprechen');\n          const newInfluence = polCard.influence;\n          log(`Wahlversprechen Abzug auf ${polCard.name}: ${oldInfluence} â†’ ${newInfluence}`);\n          polCard._pledgeDown = null;\n        }\n        // reset once-per-round flags\n        polCard._hypedRoundFlag = false;\n      }\n    });\n\n    // Apply permanent initiative effects\n    const govSlot = state.permanentSlots[player].government;\n    const pubSlot = state.permanentSlots[player].public;\n\n    if (govSlot && govSlot.kind === 'spec') {\n      const govInitiative = govSlot as SpecialCard;\n      logFunctionCall('applyPermanentInitiative', { slot: 'government', initiative: govInitiative.name }, 'Processing government permanent initiative');\n\n      if (govInitiative.name === 'Alternative Fakten') {\n        // Alle Oligarchen geben +1 Einfluss\n        const oligarchCards = pool.filter(c =>\n          c.kind === 'pol' &&\n          ['Elon Musk', 'Bill Gates', 'George Soros', 'Warren Buffett', 'Mukesh Ambani', 'Jeff Bezos', 'Alisher Usmanov', 'Gautam Adani', 'Jack Ma', 'Zhang Yiming', 'Roman Abramovich'].includes(c.name)\n        ) as PoliticianCard[];\n\n        logDataFlow('board analysis', 'oligarch cards', {\n          count: oligarchCards.length,\n          cards: oligarchCards.map(c => ({ name: c.name, influence: c.kind === 'pol' ? (c as any).influence : 0 }))\n        }, 'Finding oligarch cards for Alternative Fakten effect');\n\n        let totalInfluenceGained = 0;\n        oligarchCards.forEach(card => {\n          const oldInfluence = card.influence;\n          adjustInfluence(card, 1, 'Alternative Fakten');\n          const newInfluence = card.influence;\n          totalInfluenceGained += 1;\n          logCardEffect('Alternative Fakten', `${card.name} erhÃ¤lt +1 Einfluss (${oldInfluence} â†’ ${newInfluence})`);\n        });\n\n        if (oligarchCards.length > 0) {\n          logCardEffect('Alternative Fakten', `${oligarchCards.length} Oligarchen gefunden - ${totalInfluenceGained} Punkte zum Gesamteinfluss hinzugefÃ¼gt`);\n        } else {\n          logWarning('No oligarch cards found', 'Alternative Fakten effect has no targets');\n        }\n      }\n    }\n\n    if (pubSlot && pubSlot.kind === 'spec') {\n      const pubInitiative = pubSlot as SpecialCard;\n      logFunctionCall('applyPermanentInitiative', { slot: 'public', initiative: pubInitiative.name }, 'Processing public permanent initiative');\n\n      if (pubInitiative.name === 'Algorithmischer Diskurs') {\n        // Alle Medien-Karten geben +1 Einfluss\n        const mediaCards = pool.filter(c =>\n          c.kind === 'pol' &&\n          ['Oprah Winfrey', 'Mark Zuckerberg', 'Tim Cook', 'Sam Altman'].includes(c.name)\n        ) as PoliticianCard[];\n\n        logDataFlow('board analysis', 'media cards', {\n          count: mediaCards.length,\n          cards: mediaCards.map(c => ({ name: c.name, influence: c.kind === 'pol' ? (c as any).influence : 0 }))\n        }, 'Finding media cards for Algorithmischer Diskurs effect');\n\n        let totalInfluenceGained = 0;\n        mediaCards.forEach(card => {\n          const oldInfluence = card.influence;\n          adjustInfluence(card, 1, 'Algorithmischer Diskurs');\n          const newInfluence = card.influence;\n          totalInfluenceGained += 1;\n          logCardEffect('Algorithmischer Diskurs', `${card.name} erhÃ¤lt +1 Einfluss (${oldInfluence} â†’ ${newInfluence})`);\n        });\n\n        if (mediaCards.length > 0) {\n          logCardEffect('Algorithmischer Diskurs', `${mediaCards.length} Medien-Karten gefunden - ${totalInfluenceGained} Punkte zum Gesamteinfluss hinzugefÃ¼gt`);\n        } else {\n          logWarning('No media cards found', 'Algorithmischer Diskurs effect has no targets');\n        }\n      }\n    }\n\n    // Legacy flags reset is replaced by the new applyStartOfTurnHooks implementation\n\n    logFunctionCall('applyStartOfTurnHooksLegacy', { player }, 'Legacy turn hooks completed');\n  }, [logFunctionCall, logDataFlow, logCardEffect, logWarning]);\n\n  // Helper: Leadership vorhanden?\n  const hasLeadershipCard = (player: Player, state: GameState): boolean => {\n    const gov = state.board[player].aussen;\n    const names = ['Justin Trudeau'];\n    return gov.some(c => c.kind === 'pol' && names.includes(c.name) && !(c as PoliticianCard).deactivated);\n  };\n\n  // Helper: Bewegung vorhanden? (Ã–ffentlichkeitsreihe)\n  const hasMovementCard = (player: Player, state: GameState): boolean => {\n    const pub = state.board[player].innen;\n    const names = ['Greta Thunberg', 'Malala Yousafzai', 'Ai Weiwei', 'Alexei Navalny'];\n    return pub.some(c => c.kind === 'pol' && names.includes(c.name) && !(c as PoliticianCard).deactivated);\n  };\n\n  // Helper: Plattform vorhanden? (Ã–ffentlichkeitsreihe)\n  const hasPlatformCard = (player: Player, state: GameState): boolean => {\n    const pub = state.board[player].innen;\n    const names = ['Mark Zuckerberg', 'Tim Cook', 'Jack Ma', 'Zhang Yiming'];\n    return pub.some(c => c.kind === 'pol' && names.includes(c.name) && !(c as PoliticianCard).deactivated);\n  };\n\n  // Helper: Diplomat vorhanden? (Regierungsreihe)\n  const hasDiplomatCard = (player: Player, state: GameState): boolean => {\n    const gov = state.board[player].aussen;\n    const names = ['Joschka Fischer', 'Sergey Lavrov', 'Ursula von der Leyen', 'Jens Stoltenberg', 'Horst KÃ¶hler', 'Walter Scheel', 'Hans Dietrich Genscher', 'Colin Powell', 'Condoleezza Rice', 'Christine Lagarde'];\n    return gov.some(c => c.kind === 'pol' && names.includes(c.name) && !(c as PoliticianCard).deactivated);\n  };\n\n  // Helper: Einfluss-Transfer durch Dauerhaft-Initiativen blockiert? (Koalitionszwang, Napoleon Komplex)\n  const hasInfluenceTransferBlock = (player: Player, state: GameState): boolean => {\n    const govSlot = state.permanentSlots[player].government;\n    if (!govSlot || govSlot.kind !== 'spec') return false;\n    const spec = govSlot as SpecialCard;\n    return ['Koalitionszwang', 'Napoleon Komplex'].includes(spec.name);\n  };\n\n  // Helper: Kann Spieler mehrere Interventionen spielen? (Putin-FÃ¤higkeit)\n  const canPlayMultipleInterventions = (player: Player, state: GameState): boolean => {\n    const govCards = state.board[player].aussen.filter(c => c.kind === 'pol') as PoliticianCard[];\n    return govCards.some(c => c.name === 'Vladimir Putin' && !c.deactivated);\n  };\n\n  const selectHandCard = useCallback((index: number | null) => {\n    setSelectedHandIndex(index);\n  }, []);\n\n  const passTurn = useCallback((player: Player) => {\n    setGameState(prev => {\n      if (prev.current !== player) return prev;\n\n      const newState = { ...prev, passed: { ...prev.passed, [player]: true } };\n      log(`Spieler ${player} passt.`);\n\n      // If both players have passed, resolve the round\n      if (newState.passed[1] && newState.passed[2]) {\n        return resolveRound(newState);\n      }\n\n      return newState;\n    });\n  }, [log, resolveRound]);\n\n  // Diplomat-Einfluss-Transfer Funktion\n  const transferInfluence = useCallback((player: Player, fromCardUid: number, toCardUid: number, amount: number) => {\n    setGameState(prev => {\n      if (prev.current !== player) return prev;\n\n      const flags = prev.effectFlags?.[player];\n      if (!flags || flags.diplomatInfluenceTransferUsed || flags.influenceTransferBlocked) return prev;\n      if (!hasDiplomatCard(player, prev)) return prev;\n\n      // Finde beide Karten in der Regierungsreihe\n      const govCards = prev.board[player].aussen;\n      const fromCard = govCards.find(c => c.uid === fromCardUid && c.kind === 'pol') as PoliticianCard;\n      const toCard = govCards.find(c => c.uid === toCardUid && c.kind === 'pol') as PoliticianCard;\n\n      if (!fromCard || !toCard || fromCard.influence < amount) return prev;\n\n      // Transfer durchfÃ¼hren\n      adjustInfluence(fromCard, -amount, 'Diplomat-Transfer');\n      adjustInfluence(toCard, amount, 'Diplomat-Transfer');\n\n      // Flag setzen\n      const newFlags = { ...flags, diplomatInfluenceTransferUsed: true };\n      const newEffectFlags = { ...prev.effectFlags, [player]: newFlags } as GameState['effectFlags'];\n\n      log(`P${player} transferiert ${amount} Einfluss von ${fromCard.name} zu ${toCard.name} (Diplomat).`);\n\n      return {\n        ...prev,\n        effectFlags: newEffectFlags\n      };\n    });\n  }, [log]);\n\n  // Active Abilities Management\n  const getActiveAbilities = useCallback((player: Player) => {\n    return ActiveAbilitiesManager.getAvailableAbilities(player, gameState);\n  }, []);\n\n  const useActiveAbility = useCallback((abilityId: string, targetCardUid?: number) => {\n    setGameState(prev => {\n      const player = prev.current;\n      const abilities = ActiveAbilitiesManager.getAvailableAbilities(player, prev);\n      const ability = abilities.find(a => a.id === abilityId);\n\n      if (!ability || !ActiveAbilitiesManager.canUseAbility(ability, player, prev)) {\n        return prev;\n      }\n\n      // Finde Actor Card\n      const allCards = [...prev.board[player].innen, ...prev.board[player].aussen].filter(c => c.kind === 'pol') as PoliticianCard[];\n      const actorCard = allCards.find(c => ability.id.includes(c.uid.toString()));\n\n      if (!actorCard) return prev;\n\n      // Finde Target Card wenn nÃ¶tig\n      let targetCard: PoliticianCard | undefined;\n      if (targetCardUid) {\n        const allTargets = [...prev.board[1].innen, ...prev.board[1].aussen, ...prev.board[2].innen, ...prev.board[2].aussen].filter(c => c.kind === 'pol') as PoliticianCard[];\n        targetCard = allTargets.find(c => c.uid === targetCardUid);\n      }\n\n      const select = {\n        type: ability.type,\n        actorCard,\n        actorPlayer: player,\n        targetCard\n      } as any;\n\n      const newState = ActiveAbilitiesManager.executeAbility(ability, select, prev);\n\n      log(`${actorCard.name} nutzt ${ability.name}${targetCard ? ` auf ${targetCard.name}` : ''}.`);\n\n      return newState;\n    });\n  }, [gameState, log]);\n\n  // Reset aktive FÃ¤higkeiten zu Rundenbeginn\n  const resetActiveAbilities = useCallback((state: GameState): GameState => {\n    const newState = { ...state };\n\n    // Reset _activeUsed fÃ¼r alle Politikerkarten\n    [1, 2].forEach(player => {\n      const allCards = [...newState.board[player as Player].innen, ...newState.board[player as Player].aussen].filter(c => c.kind === 'pol') as PoliticianCard[];\n      allCards.forEach(card => {\n        card._activeUsed = false;\n      });\n    });\n\n    return newState;\n  }, []);\n\n  // Putin Doppelte Interventionen\n  const executePutinDoubleIntervention = useCallback((interventionCardIds: number[]) => {\n    setGameState(prev => {\n      const player = prev.current;\n      const newState = ActiveAbilitiesManager.executePutinDoubleIntervention(prev, player, interventionCardIds, log);\n      return newState;\n    });\n  }, [log]);\n\n  // Check ob Putin Doppel-Intervention verfÃ¼gbar ist\n  const canUsePutinDoubleIntervention = useCallback((player: Player): boolean => {\n    const board = gameState.board[player];\n    const allCards = [...board.innen, ...board.aussen].filter(c => c.kind === 'pol') as PoliticianCard[];\n    const putin = allCards.find(c => c.name === 'Vladimir Putin');\n\n    if (!putin || putin.deactivated || putin._activeUsed) return false;\n\n    const interventions = gameState.hands[player].filter(c => c.kind === 'spec');\n    return interventions.length >= 2;\n  }, [gameState]);\n\n  // Manual turn advancement for testing\n  const manualAdvanceTurn = useCallback(() => {\n    console.log('ðŸ”§ DEBUG: Manual turn advancement triggered');\n    log('ðŸ”§ DEBUG: Manual turn advancement triggered');\n    nextTurn();\n  }, [nextTurn, log]);\n\n  return {\n    gameState,\n    selectedHandIndex,\n    log,\n    startNewGame,\n    selectHandCard: setSelectedHandIndex,\n    scores,\n    manualAdvanceTurn, // Manual turn advancement for testing\n\n    // Core game state functions\n    dealStartingHands,\n    resolveRound,\n    nextTurn: gameActions.nextTurn,\n    endTurn: gameActions.endTurn,\n    checkAndAdvanceTurn,\n    shouldAdvanceTurn,\n\n    // Helper functions kept for compatibility\n    hasLeadershipCard,\n    hasMovementCard,\n    hasPlatformCard,\n    hasDiplomatCard,\n    hasInfluenceTransferBlock,\n    canPlayMultipleInterventions,\n    sumRowWithAuras,\n    applyStartOfTurnHooksLegacy,\n\n    // Functions that were migrated to separate hooks\n    passTurn: gameActions.passTurn,\n    transferInfluence,\n    getActiveAbilities,\n    useActiveAbility,\n    resetActiveAbilities,\n    executePutinDoubleIntervention,\n    canUsePutinDoubleIntervention,\n\n    // Delegate primary functionality to separated hooks\n    startMatchWithDecks: gameActions.startMatchWithDecks,\n    startMatchVsAI: gameActions.startMatchVsAI,\n    playCard: gameActions.playCard,\n    activateInstantInitiative: gameActions.activateInstantInitiative,\n\n    // AI functionality\n    runAITurn: gameAI.runAITurn,\n    aiEnabled: gameAI.aiEnabled,\n    setAiEnabled: gameAI.setAiEnabled,\n    aiPreset: gameAI.aiPreset,\n    setAiPreset: gameAI.setAiPreset,\n\n    // Effects functionality\n    executeCardEffect,\n    processEffectQueue,\n    afterQueueResolved,\n  };\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}