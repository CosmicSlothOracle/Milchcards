{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\skank\\\\Videos\\\\Cards\\\\Milchcards\\\\src\\\\components\\\\GameCanvas.tsx\",\n  _s = $RefreshSig$();\nimport React, { useRef, useEffect, useCallback } from 'react';\nimport { LAYOUT, getZone, computeSlotRects, getUiTransform, getLaneCapacity, getPublicRects, getGovernmentRects } from '../ui/layout';\nimport { drawCardImage, sortHandCards } from '../utils/gameUtils';\nimport { getNetApCost } from '../utils/ap';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const GameCanvas = ({\n  gameState,\n  selectedHandIndex,\n  onCardClick,\n  onCardHover,\n  devMode = false\n}) => {\n  _s();\n  const canvasRef = useRef(null);\n  const clickZonesRef = useRef([]);\n  const backgroundImageRef = useRef(null);\n  const drawCardAt = useCallback((ctx, card, x, y, size, selected = false, showAPCost = false, player) => {\n    var _shield;\n    let dx = x,\n      dy = y,\n      s = size;\n    if (selected) {\n      s = Math.floor(size * 1.05);\n      dx = x - Math.floor((s - size) / 2);\n      dy = y - Math.floor((s - size) / 2);\n    }\n    drawCardImage(ctx, card, dx, dy, s, 'ui');\n\n    // Status-Indikatoren (fÃ¼r alle Board-Karten)\n    // Einfluss-Wert unten links â€“ nur fÃ¼r Politiker\n    if (card.kind === 'pol') {\n      var _influence;\n      ctx.fillStyle = 'rgba(0,0,0,0.5)';\n      ctx.fillRect(dx, dy + s - 22, s, 22);\n      ctx.fillStyle = '#D7E7F8';\n      ctx.font = 'bold 16px sans-serif';\n      ctx.fillText(`${(_influence = card.influence) !== null && _influence !== void 0 ? _influence : 0}`, dx + 8, dy + s - 6);\n    }\n    // Schutz-Status (blauer Punkt)\n    if (card.protected || ((_shield = card.shield) !== null && _shield !== void 0 ? _shield : 0) > 0) {\n      ctx.fillStyle = '#1da1f2';\n      ctx.fillRect(dx + s - 22, dy + 6, 16, 16);\n    }\n    // Deaktiviert-Status (roter Punkt)\n    if (card.deactivated) {\n      ctx.fillStyle = '#b63838';\n      ctx.fillRect(dx + s - 22, dy + 26, 16, 16);\n    }\n\n    // Netto-AP Badge anzeigen (modern) - nur fÃ¼r Handkarten\n    if (showAPCost && player) {\n      const apInfo = getNetApCost(gameState, player, card, 'innen'); // Default auf innen\n      const netText = `âš¡${apInfo.net}`;\n\n      // Badge-GrÃ¶ÃŸe berechnen\n      const badgeHeight = Math.max(16, Math.floor(s * 0.12));\n      const badgeWidth = badgeHeight * 2;\n      const badgeX = dx + s - badgeWidth - 6;\n      const badgeY = dy + 6;\n\n      // Badge-Hintergrund (grÃ¼n fÃ¼r 0 AP, gelb fÃ¼r > 0)\n      const bgColor = apInfo.net === 0 ? '#E7F8EF' : '#FFF7E6';\n      const borderColor = apInfo.net === 0 ? '#10b981' : '#f59e0b';\n      ctx.fillStyle = bgColor;\n      ctx.beginPath();\n      ctx.roundRect(badgeX, badgeY, badgeWidth, badgeHeight, badgeHeight / 2);\n      ctx.fill();\n\n      // Badge-Rand\n      ctx.strokeStyle = borderColor;\n      ctx.lineWidth = 1;\n      ctx.stroke();\n\n      // Text\n      ctx.fillStyle = apInfo.net === 0 ? '#065f46' : '#92400e';\n      ctx.font = `bold ${Math.floor(badgeHeight * 0.5)}px sans-serif`;\n      ctx.textAlign = 'center';\n      ctx.textBaseline = 'middle';\n      ctx.fillText(netText, badgeX + badgeWidth / 2, badgeY + badgeHeight / 2);\n\n      // Reset text align\n      ctx.textAlign = 'start';\n      ctx.textBaseline = 'alphabetic';\n    }\n\n    // Auswahl-Rahmen\n    if (selected) {\n      ctx.strokeStyle = '#61dafb';\n      ctx.lineWidth = 3;\n      ctx.strokeRect(dx + 1, dy + 1, s - 2, s - 2);\n      ctx.lineWidth = 1;\n    }\n\n    // Return exact 256x256 click zone over the card\n    // Since all cards are 256x256, the click zone should match exactly\n    return {\n      x: dx,\n      y: dy,\n      w: 256,\n      h: 256\n    };\n  }, [gameState]);\n\n  // Slot-Benennungs-Funktion basierend auf Glossar\n  const getSlotDisplayName = useCallback((zoneId, index, player) => {\n    const slotNumber = index + 1;\n    if (zoneId.includes('government')) {\n      if (zoneId.includes('player')) {\n        return `Regierungsreihe Slot ${slotNumber}`;\n      } else {\n        return `Gegner Regierung Slot ${slotNumber}`;\n      }\n    } else if (zoneId.includes('public')) {\n      if (zoneId.includes('player')) {\n        return `Ã–ffentlichkeitsreihe Slot ${slotNumber}`;\n      } else {\n        return `Gegner Ã–ffentlichkeit Slot ${slotNumber}`;\n      }\n    } else if (zoneId.includes('permanent.government')) {\n      if (zoneId.includes('player')) {\n        return 'Regierung Spezial-Slot';\n      } else {\n        return 'Gegner Regierung Spezial-Slot';\n      }\n    } else if (zoneId.includes('permanent.public')) {\n      if (zoneId.includes('player')) {\n        return 'Ã–ffentlichkeit Spezial-Slot';\n      } else {\n        return 'Gegner Ã–ffentlichkeit Spezial-Slot';\n      }\n    } else if (zoneId.includes('instant')) {\n      if (zoneId.includes('player')) {\n        return 'Sofort-Slot';\n      } else {\n        return 'Gegner Sofort-Slot';\n      }\n    } else if (zoneId.includes('hand')) {\n      return 'Hand';\n    } else if (zoneId.includes('interventions')) {\n      return 'Interventionen';\n    }\n    return `Slot ${slotNumber}`;\n  }, []);\n  const drawLane = useCallback((ctx, zoneId, player, lane, clickable) => {\n    const zone = getZone(zoneId);\n    if (!zone) return;\n    const slots = computeSlotRects(zone);\n    const arr = gameState.board[player][lane];\n    slots.forEach((s, idx) => {\n      const card = arr[idx];\n\n      // Hintergrundfarbe nach Kategorie\n      let bgColor = 'rgba(0,0,0,0.1)'; // Standard\n      if (zoneId.includes('government')) {\n        bgColor = 'rgba(255, 197, 0, 0.15)'; // Hellgelb fÃ¼r Regierung\n      } else if (zoneId.includes('public')) {\n        bgColor = 'rgba(0, 255, 0, 0.15)'; // HellgrÃ¼n fÃ¼r Ã–ffentlichkeit\n      }\n      ctx.fillStyle = bgColor;\n      ctx.fillRect(s.x, s.y, s.w, s.h);\n\n      // Slot-Rahmen\n      ctx.strokeStyle = 'rgba(255,255,255,0.06)';\n      ctx.strokeRect(s.x + 0.5, s.y + 0.5, s.w - 1, s.h - 1);\n      if (card) {\n        const isSelected = player === 1 && selectedHandIndex !== null && gameState.hands[1][selectedHandIndex] === card;\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, isSelected, false);\n\n        // Kartenname unter dem Slot anzeigen\n        ctx.fillStyle = 'rgba(255,255,255,0.9)';\n        ctx.font = 'bold 12px sans-serif';\n        ctx.textAlign = 'center';\n        const textY = s.y + s.h + 16;\n        ctx.fillText(card.name, s.x + s.w / 2, textY);\n        clickZonesRef.current.push({\n          ...clickZone,\n          data: {\n            type: 'board_card',\n            player,\n            lane,\n            index: idx,\n            card\n          }\n        });\n      } else if (clickable && gameState.current === player) {\n        // Slot-Benennung anzeigen (fÃ¼r den aktuellen Spieler)\n        const slotName = getSlotDisplayName(zoneId, idx, player);\n        ctx.fillStyle = 'rgba(255,255,255,0.6)';\n        ctx.font = '11px sans-serif';\n        ctx.textAlign = 'center';\n        const textY = s.y + s.h / 2;\n        ctx.fillText(slotName, s.x + s.w / 2, textY);\n        clickZonesRef.current.push({\n          x: s.x,\n          y: s.y,\n          w: s.w,\n          h: s.h,\n          data: {\n            type: 'row_slot',\n            lane,\n            index: idx\n          }\n        });\n      }\n    });\n  }, [gameState, selectedHandIndex, drawCardAt, getSlotDisplayName]);\n  const drawHandP1 = useCallback(ctx => {\n    const hand = sortHandCards(gameState.hands[1]);\n    const zone = getZone('hand.player');\n    if (!zone) return;\n    const slots = computeSlotRects(zone);\n    slots.forEach((s, i) => {\n      const card = hand[i];\n      if (!card) return;\n      // Find original index in unsorted hand for click handling\n      const originalIndex = gameState.hands[1].findIndex(c => c.uid === card.uid);\n      const isSel = selectedHandIndex === originalIndex;\n      const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, isSel, true, 1); // Show AP cost for player 1 hand\n      clickZonesRef.current.push({\n        ...clickZone,\n        data: {\n          type: 'hand_p1',\n          index: originalIndex,\n          card\n        }\n      });\n    });\n  }, [gameState.hands, selectedHandIndex, drawCardAt]);\n\n  // ðŸ”§ DEV MODE: Player 2 Hand (rechts unten, kompakter)\n  const drawHandP2 = useCallback(ctx => {\n    const hand = sortHandCards(gameState.hands[2]);\n    const zone = getZone('hand.opponent');\n    if (!zone) return;\n    const slots = computeSlotRects(zone);\n\n    // Hintergrund fÃ¼r P2 Hand\n    const [x, y, w, h] = zone.rectPx;\n    ctx.fillStyle = 'rgba(255, 100, 100, 0.15)'; // RÃ¶tlicher Hintergrund fÃ¼r P2\n    ctx.fillRect(x, y, w, h);\n    ctx.strokeStyle = 'rgba(255, 100, 100, 0.3)';\n    ctx.strokeRect(x + 0.5, y + 0.5, w - 1, h - 1);\n\n    // Label fÃ¼r P2 Hand\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.font = 'bold 14px sans-serif';\n    ctx.textAlign = 'center';\n    ctx.fillText('Player 2 Hand', x + w / 2, y - 8);\n    slots.forEach((s, i) => {\n      const card = hand[i];\n      if (!card) return;\n      // Find original index in unsorted hand for click handling\n      const originalIndex = gameState.hands[2].findIndex(c => c.uid === card.uid);\n      const isSel = gameState.current === 2 && selectedHandIndex === originalIndex;\n      const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, isSel, true, 2); // Show AP cost for player 2 hand\n      clickZonesRef.current.push({\n        ...clickZone,\n        data: {\n          type: 'hand_p2',\n          index: originalIndex,\n          card\n        }\n      });\n    });\n  }, [gameState, selectedHandIndex, drawCardAt]);\n  // Interventions strip (player traps)\n  const drawInterventionsP1 = useCallback(ctx => {\n    const traps = gameState.traps[1] || [];\n    const zone = getZone('interventions.player');\n    if (!zone) return;\n\n    // Single intervention slot\n    const [zx, zy, zw, zh] = zone.rectPx;\n    const card = traps[0]; // Only first trap\n\n    // Hintergrund fÃ¼r Interventions-Slot\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.15)'; // Lavendelfarben fÃ¼r Interventionen\n    ctx.fillRect(zx, zy, zw, zh);\n    ctx.strokeStyle = 'rgba(200, 160, 255, 0.3)';\n    ctx.strokeRect(zx + 0.5, zy + 0.5, zw - 1, zh - 1);\n\n    // Slot-Benennung fÃ¼r Interventions-Slot\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.8)';\n    ctx.font = '11px sans-serif';\n    ctx.textAlign = 'left';\n    ctx.fillText('Intervention', zx + 8, zy + zh - 6);\n    if (card) {\n      const clickZone = drawCardAt(ctx, card, zx, zy, zw, false, false);\n      clickZonesRef.current.push({\n        ...clickZone,\n        data: {\n          type: 'trap_p1',\n          index: 0,\n          card\n        }\n      });\n    }\n  }, [gameState.traps, drawCardAt]);\n\n  // Interventions strip (opponent traps)\n  const drawInterventionsP2 = useCallback(ctx => {\n    const traps = gameState.traps[2] || [];\n    const zone = getZone('interventions.opponent');\n    if (!zone) return;\n\n    // Single intervention slot\n    const [zx, zy, zw, zh] = zone.rectPx;\n    const card = traps[0]; // Only first trap\n\n    // Hintergrund fÃ¼r Interventions-Slot\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.15)'; // Lavendelfarben fÃ¼r Interventionen\n    ctx.fillRect(zx, zy, zw, zh);\n    ctx.strokeStyle = 'rgba(200, 160, 255, 0.3)';\n    ctx.strokeRect(zx + 0.5, zy + 0.5, zw - 1, zh - 1);\n\n    // Slot-Benennung fÃ¼r Interventions-Slot\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.8)';\n    ctx.font = '11px sans-serif';\n    ctx.textAlign = 'left';\n    ctx.fillText('Intervention', zx + 8, zy + zh - 6);\n    if (card) {\n      const clickZone = drawCardAt(ctx, card, zx, zy, zw, false, false);\n      clickZonesRef.current.push({\n        ...clickZone,\n        data: {\n          type: 'trap_p2',\n          index: 0,\n          card\n        }\n      });\n    }\n  }, [gameState.traps, drawCardAt]);\n\n  // Single slot drawing function\n  const drawSingleSlot = useCallback((ctx, zoneId, card, clickType, player) => {\n    const zone = getZone(zoneId);\n    if (!zone) return;\n    const [x, y, w, h] = zone.rectPx;\n\n    // Hintergrundfarbe nach Kategorie\n    let bgColor = 'rgba(0,0,0,0.1)'; // Standard\n    if (zoneId.includes('government')) {\n      bgColor = 'rgba(255, 197, 0, 0.15)'; // Hellgelb fÃ¼r Regierung\n    } else if (zoneId.includes('public')) {\n      bgColor = 'rgba(0, 255, 0, 0.15)'; // HellgrÃ¼n fÃ¼r Ã–ffentlichkeit\n    } else if (zoneId.includes('instant')) {\n      bgColor = 'rgba(127, 116, 91, 0.15)'; // Neutral fÃ¼r Sofort-Slots\n    } else if (zoneId.includes('permanent')) {\n      // Unterscheide zwischen government und public permanent slots\n      if (zoneId.includes('government')) {\n        bgColor = 'rgba(255, 197, 0, 0.15)';\n      } else if (zoneId.includes('public')) {\n        bgColor = 'rgba(0, 255, 0, 0.15)';\n      }\n    }\n    ctx.fillStyle = bgColor;\n    ctx.fillRect(x, y, w, h);\n\n    // Draw slot border\n    ctx.strokeStyle = 'rgba(255,255,255,0.06)';\n    ctx.strokeRect(x + 0.5, y + 0.5, w - 1, h - 1);\n    if (card) {\n      const isSelected = player === 1 && selectedHandIndex !== null && gameState.hands[1][selectedHandIndex] === card;\n      const clickZone = drawCardAt(ctx, card, x, y, w, isSelected, false);\n\n      // Kartenname unter dem Slot anzeigen\n      ctx.fillStyle = 'rgba(255,255,255,0.9)';\n      ctx.font = 'bold 12px sans-serif';\n      ctx.textAlign = 'center';\n      const textY = y + h + 16;\n      ctx.fillText(card.name, x + w / 2, textY);\n      clickZonesRef.current.push({\n        ...clickZone,\n        data: {\n          type: 'slot_card',\n          slot: clickType,\n          card\n        }\n      });\n\n      // ðŸ”§ NEU: Sofort-Initiative-Slots sind klickbar fÃ¼r Aktivierung\n      if (clickType === 'instant' && gameState.current === player) {\n        clickZonesRef.current.push({\n          x,\n          y,\n          w,\n          h,\n          data: {\n            type: 'activate_instant',\n            player,\n            card\n          }\n        });\n      }\n    } else if (gameState.current === player) {\n      // Slot-Benennung fÃ¼r leere Slots anzeigen (fÃ¼r den aktuellen Spieler)\n      const slotName = getSlotDisplayName(zoneId, 0, player);\n      ctx.fillStyle = 'rgba(255,255,255,0.6)';\n      ctx.font = '11px sans-serif';\n      ctx.textAlign = 'center';\n      const textY = y + h / 2;\n      ctx.fillText(slotName, x + w / 2, textY);\n      clickZonesRef.current.push({\n        x,\n        y,\n        w,\n        h,\n        data: {\n          type: 'empty_slot',\n          slot: clickType\n        }\n      });\n    }\n  }, [selectedHandIndex, gameState, drawCardAt, getSlotDisplayName]);\n\n  // Draw permanent slots for player\n  const drawPermanentSlotsP1 = useCallback(ctx => {\n    drawSingleSlot(ctx, 'slot.permanent.government.player', gameState.permanentSlots[1].government, 'permanent_government', 1);\n    drawSingleSlot(ctx, 'slot.permanent.public.player', gameState.permanentSlots[1].public, 'permanent_public', 1);\n  }, [gameState.permanentSlots, drawSingleSlot]);\n\n  // Draw permanent slots for opponent\n  const drawPermanentSlotsP2 = useCallback(ctx => {\n    drawSingleSlot(ctx, 'slot.permanent.government.opponent', gameState.permanentSlots[2].government, 'permanent_government', 2);\n    drawSingleSlot(ctx, 'slot.permanent.public.opponent', gameState.permanentSlots[2].public, 'permanent_public', 2);\n  }, [gameState.permanentSlots, drawSingleSlot]);\n\n  // Draw instant slots\n  const drawInstantSlots = useCallback(ctx => {\n    // Sofort-Initiative-Slots aus dem Board zeichnen\n    const sofortPlayerCard = gameState.board[1].sofort[0];\n    const sofortOppCard = gameState.board[2].sofort[0];\n    drawSingleSlot(ctx, 'slot.instant.player', sofortPlayerCard, 'instant', 1);\n    drawSingleSlot(ctx, 'slot.instant.opponent', sofortOppCard, 'instant', 2);\n  }, [gameState.board, drawSingleSlot]);\n\n  // Aktive SchlÃ¼sselwÃ¶rter und Unterkategorien ermitteln\n  const getActiveKeywordsAndSubcategories = useCallback(player => {\n    const board = gameState.board[player];\n    const permanentSlots = gameState.permanentSlots[player];\n    const allCards = [...board.innen, ...board.aussen, permanentSlots.government, permanentSlots.public].filter(c => c && c.kind === 'pol');\n    const keywords = new Set();\n    const subcategories = new Set();\n    allCards.forEach(card => {\n      if (!card.deactivated) {\n        // Regierungskarten-SchlÃ¼sselwÃ¶rter\n        if (card.tag === 'Leadership') {\n          keywords.add('Leadership');\n        }\n        if (card.tag === 'Diplomat') {\n          keywords.add('Diplomat');\n        }\n\n        // Ã–ffentlichkeits-Unterkategorien (fÃ¼r Karten in Ã–ffentlichkeitsreihe)\n        if (board.innen.includes(card)) {\n          const publicCard = card;\n          if (publicCard.tag) {\n            // Oligarch\n            const oligarchNames = ['Elon Musk', 'Bill Gates', 'George Soros', 'Warren Buffett', 'Mukesh Ambani', 'Jeff Bezos', 'Alisher Usmanov', 'Gautam Adani', 'Jack Ma', 'Zhang Yiming', 'Roman Abramovich'];\n            if (oligarchNames.includes(publicCard.name)) {\n              subcategories.add('Oligarch');\n            }\n\n            // Plattform\n            const platformNames = ['Mark Zuckerberg', 'Tim Cook', 'Sam Altman', 'Jack Ma'];\n            if (platformNames.includes(publicCard.name)) {\n              subcategories.add('Plattform');\n            }\n\n            // Bewegung\n            const movementNames = ['Greta Thunberg', 'Malala Yousafzai', 'Ai Weiwei', 'Alexei Navalny'];\n            if (movementNames.includes(publicCard.name)) {\n              subcategories.add('Bewegung');\n            }\n\n            // NGO/Think-Tank\n            const ngoNames = ['Bill Gates', 'George Soros', 'Jennifer Doudna', 'Noam Chomsky', 'Anthony Fauci'];\n            if (ngoNames.includes(publicCard.name)) {\n              subcategories.add('NGO/Think-Tank');\n            }\n\n            // Intelligenz\n            const intelligenceNames = ['Jennifer Doudna', 'Noam Chomsky', 'Edward Snowden', 'Julian Assange', 'Yuval Noah Harari', 'Ai Weiwei', 'Alexei Navalny', 'Anthony Fauci'];\n            if (intelligenceNames.includes(publicCard.name)) {\n              subcategories.add('Intelligenz');\n            }\n\n            // Medien\n            const mediaNames = ['Oprah Winfrey'];\n            if (mediaNames.includes(publicCard.name)) {\n              subcategories.add('Medien');\n            }\n          }\n        }\n      }\n    });\n    return {\n      keywords: Array.from(keywords),\n      subcategories: Array.from(subcategories)\n    };\n  }, [gameState]);\n\n  // Info-Panels zeichnen\n  const drawInfoPanels = useCallback(ctx => {\n    const {\n      keywords,\n      subcategories\n    } = getActiveKeywordsAndSubcategories(1);\n\n    // Panel fÃ¼r RegierungsschlÃ¼sselwÃ¶rter (rechts neben Regierungsslots)\n    const govPanelX = 1640 + 256 + 20; // Nach dem letzten permanenten Slot\n    const govPanelY = 300; // Auf HÃ¶he der Regierungsslots\n    const govPanelW = 120;\n    const govPanelH = 256;\n\n    // Regierungspanel Hintergrund\n    ctx.fillStyle = 'rgba(255, 197, 0, 0.15)';\n    ctx.fillRect(govPanelX, govPanelY, govPanelW, govPanelH);\n    ctx.strokeStyle = 'rgba(255, 197, 0, 0.3)';\n    ctx.strokeRect(govPanelX + 0.5, govPanelY + 0.5, govPanelW - 1, govPanelH - 1);\n\n    // Regierungspanel Titel\n    ctx.fillStyle = 'rgba(255, 197, 0, 0.9)';\n    ctx.font = 'bold 12px sans-serif';\n    ctx.textAlign = 'center';\n    ctx.fillText('Regierung', govPanelX + govPanelW / 2, govPanelY + 16);\n\n    // SchlÃ¼sselwÃ¶rter auflisten\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.font = '11px sans-serif';\n    ctx.textAlign = 'left';\n    if (keywords.length > 0) {\n      keywords.forEach((keyword, idx) => {\n        ctx.fillText(`â€¢ ${keyword}`, govPanelX + 8, govPanelY + 36 + idx * 16);\n      });\n    } else {\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';\n      ctx.fillText('Keine aktiven', govPanelX + 8, govPanelY + 36);\n      ctx.fillText('SchlÃ¼sselwÃ¶rter', govPanelX + 8, govPanelY + 52);\n    }\n\n    // Panel fÃ¼r Ã–ffentlichkeits-Unterkategorien (rechts neben Ã–ffentlichkeitsslots)\n    const pubPanelX = 1640 + 256 + 20;\n    const pubPanelY = 580; // Auf HÃ¶he der Ã–ffentlichkeitsslots\n    const pubPanelW = 120;\n    const pubPanelH = 256;\n\n    // Ã–ffentlichkeitspanel Hintergrund\n    ctx.fillStyle = 'rgba(0, 255, 0, 0.15)';\n    ctx.fillRect(pubPanelX, pubPanelY, pubPanelW, pubPanelH);\n    ctx.strokeStyle = 'rgba(0, 255, 0, 0.3)';\n    ctx.strokeRect(pubPanelX + 0.5, pubPanelY + 0.5, pubPanelW - 1, pubPanelH - 1);\n\n    // Ã–ffentlichkeitspanel Titel\n    ctx.fillStyle = 'rgba(0, 255, 0, 0.9)';\n    ctx.font = 'bold 12px sans-serif';\n    ctx.textAlign = 'center';\n    ctx.fillText('Ã–ffentlichkeit', pubPanelX + pubPanelW / 2, pubPanelY + 16);\n\n    // Unterkategorien auflisten\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.font = '11px sans-serif';\n    ctx.textAlign = 'left';\n    if (subcategories.length > 0) {\n      subcategories.forEach((subcategory, idx) => {\n        const displayName = subcategory.length > 12 ? subcategory.substring(0, 10) + '...' : subcategory;\n        ctx.fillText(`â€¢ ${displayName}`, pubPanelX + 8, pubPanelY + 36 + idx * 16);\n      });\n    } else {\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';\n      ctx.fillText('Keine aktiven', pubPanelX + 8, pubPanelY + 36);\n      ctx.fillText('Unterkategorien', pubPanelX + 8, pubPanelY + 52);\n    }\n  }, [getActiveKeywordsAndSubcategories]);\n  const draw = useCallback(() => {\n    var _LAYOUT$background, _LAYOUT$background2;\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const ctx = canvas.getContext('2d');\n    if (!ctx) return;\n\n    // Clear canvas\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\n\n    // Clear click zones\n    clickZonesRef.current = [];\n\n    // Background: prefer PNG if configured\n    if ((_LAYOUT$background = LAYOUT.background) !== null && _LAYOUT$background !== void 0 && _LAYOUT$background.enabled && (_LAYOUT$background2 = LAYOUT.background) !== null && _LAYOUT$background2 !== void 0 && _LAYOUT$background2.src) {\n      if (backgroundImageRef.current) {\n        ctx.drawImage(backgroundImageRef.current, 0, 0, canvas.width, canvas.height);\n      } else {\n        ctx.fillStyle = '#0c131b';\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\n      }\n    } else {\n      ctx.fillStyle = '#0c131b';\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\n    }\n\n    // Apply UI transform (new signature)\n    const {\n      scale,\n      offsetX,\n      offsetY\n    } = getUiTransform(canvas.width, canvas.height);\n    ctx.save();\n    ctx.translate(offsetX, offsetY);\n    ctx.scale(scale, scale);\n\n    // Draw opponent board (top rows) - clickable im Dev Mode\n    // Draw opponent board using new layout system\n    const opponentPublicRects = getPublicRects('opponent');\n    const opponentGovRects = getGovernmentRects('opponent');\n\n    // Draw opponent public slots\n    opponentPublicRects.forEach((s, idx) => {\n      const card = gameState.board[2].innen[idx];\n      if (card) {\n        drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 2);\n      }\n    });\n\n    // Draw opponent government slots\n    opponentGovRects.forEach((s, idx) => {\n      const card = gameState.board[2].aussen[idx];\n      if (card) {\n        drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 2);\n      }\n    });\n\n    // Draw opponent permanent slots\n    drawPermanentSlotsP2(ctx);\n\n    // Draw player board (middle rows)\n    // Draw player board using new layout system\n    const playerPublicRects = getPublicRects('player');\n    const playerGovRects = getGovernmentRects('player');\n\n    // Draw player public slots\n    playerPublicRects.forEach((s, idx) => {\n      const card = gameState.board[1].innen[idx];\n      if (card) {\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 1);\n        clickZonesRef.current.push({\n          ...clickZone,\n          data: {\n            type: 'row_slot',\n            player: 1,\n            lane: 'innen',\n            index: idx\n          }\n        });\n      } else {\n        // Empty slot click zone\n        clickZonesRef.current.push({\n          x: s.x,\n          y: s.y,\n          w: s.w,\n          h: s.h,\n          data: {\n            type: 'row_slot',\n            player: 1,\n            lane: 'innen',\n            index: idx\n          }\n        });\n      }\n    });\n\n    // Draw player government slots\n    playerGovRects.forEach((s, idx) => {\n      const card = gameState.board[1].aussen[idx];\n      if (card) {\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 1);\n        clickZonesRef.current.push({\n          ...clickZone,\n          data: {\n            type: 'row_slot',\n            player: 1,\n            lane: 'aussen',\n            index: idx\n          }\n        });\n      } else {\n        // Empty slot click zone\n        clickZonesRef.current.push({\n          x: s.x,\n          y: s.y,\n          w: s.w,\n          h: s.h,\n          data: {\n            type: 'row_slot',\n            player: 1,\n            lane: 'aussen',\n            index: idx\n          }\n        });\n      }\n    });\n\n    // Draw player permanent slots\n    drawPermanentSlotsP1(ctx);\n\n    // Draw instant slots (both players)\n    drawInstantSlots(ctx);\n\n    // Draw interventions strip (player)\n    drawInterventionsP1(ctx);\n\n    // Draw interventions strip (opponent) - nur im Dev Mode\n    if (devMode) {\n      drawInterventionsP2(ctx);\n    }\n\n    // Draw hand (P1)\n    drawHandP1(ctx);\n\n    // ðŸ”§ DEV MODE: Draw hand (P2) - nur im Dev Mode\n    if (devMode) {\n      drawHandP2(ctx);\n    }\n\n    // Draw info panels\n    drawInfoPanels(ctx);\n    ctx.restore();\n\n    // expose zones for debug snapshot\n    window.__politicardDebug = {\n      uiTransform: getUiTransform(canvas.width, canvas.height),\n      canvasSize: {\n        width: canvas.width,\n        height: canvas.height\n      },\n      zones: LAYOUT.zones,\n      clickZones: clickZonesRef.current.slice(0, 1000)\n    };\n\n    // Diagnostics: verify UI hand click zones match authoritative gameState.hands[1]\n    try {\n      const handZones = clickZonesRef.current.filter(z => z.data && z.data.type === 'hand_p1');\n      const uiUIDs = handZones.map(z => {\n        var _z$data$card$uid;\n        return z.data.card && ((_z$data$card$uid = z.data.card.uid) !== null && _z$data$card$uid !== void 0 ? _z$data$card$uid : z.data.card.id);\n      }).filter(Boolean);\n      const stateHand = gameState.hands && gameState.hands[1] ? gameState.hands[1] : [];\n      const stateUIDs = stateHand.map(c => {\n        var _c$uid;\n        return (_c$uid = c.uid) !== null && _c$uid !== void 0 ? _c$uid : c.id;\n      }).filter(Boolean);\n      const missingInState = uiUIDs.filter(u => !stateUIDs.includes(u));\n      const missingInUI = stateUIDs.filter(u => !uiUIDs.includes(u));\n      if (uiUIDs.length !== stateUIDs.length || missingInState.length > 0 || missingInUI.length > 0) {\n        var _politicardDebug;\n        const mismatch = {\n          ts: Date.now(),\n          uiCount: uiUIDs.length,\n          stateCount: stateUIDs.length,\n          uiUIDs,\n          stateUIDs,\n          missingInState,\n          missingInUI,\n          stack: new Error('mismatch-stack').stack\n        };\n        window.__politicardDebug = {\n          ...window.__politicardDebug,\n          mismatch: [...(((_politicardDebug = window.__politicardDebug) === null || _politicardDebug === void 0 ? void 0 : _politicardDebug.mismatch) || [])].slice(-19).concat([mismatch])\n        };\n        // Clear, then log to console so user can copy/paste trace\n        console.warn('POLITICARD DIAGNOSTIC: hand mismatch detected', mismatch);\n      }\n    } catch (e) {\n      // swallow diagnostic errors to avoid breaking rendering\n      console.error('Diagnostic error', e);\n    }\n  }, [drawLane, drawHandP1, drawHandP2, drawInterventionsP1, drawInterventionsP2, drawPermanentSlotsP1, drawPermanentSlotsP2, drawInstantSlots, drawInfoPanels, devMode, gameState.hands]);\n  const DRAW_LAYOUT_OVERLAY = false; // force off per new layout system\n\n  // Load background image if configured\n  useEffect(() => {\n    var _LAYOUT$background3, _LAYOUT$background4;\n    if ((_LAYOUT$background3 = LAYOUT.background) !== null && _LAYOUT$background3 !== void 0 && _LAYOUT$background3.enabled && (_LAYOUT$background4 = LAYOUT.background) !== null && _LAYOUT$background4 !== void 0 && _LAYOUT$background4.src) {\n      const img = new Image();\n      img.onload = () => {\n        backgroundImageRef.current = img;\n        requestAnimationFrame(draw);\n      };\n      img.onerror = () => {\n        var _LAYOUT$background5;\n        console.warn('Failed to load background image', (_LAYOUT$background5 = LAYOUT.background) === null || _LAYOUT$background5 === void 0 ? void 0 : _LAYOUT$background5.src);\n      };\n      img.src = LAYOUT.background.src;\n    }\n  }, [draw]);\n  const handleCardClick = useCallback(data => {\n    // Hand-Klick\n    if (data.type === 'hand_p1') {\n      var _data$card$uid, _data$card, _data$card2, _gameState$hands;\n      const uid = (_data$card$uid = (_data$card = data.card) === null || _data$card === void 0 ? void 0 : _data$card.uid) !== null && _data$card$uid !== void 0 ? _data$card$uid : (_data$card2 = data.card) === null || _data$card2 === void 0 ? void 0 : _data$card2.id;\n      const stateHand = ((_gameState$hands = gameState.hands) === null || _gameState$hands === void 0 ? void 0 : _gameState$hands[1]) || [];\n      const idxInState = stateHand.findIndex(c => {\n        var _c$uid2;\n        return ((_c$uid2 = c.uid) !== null && _c$uid2 !== void 0 ? _c$uid2 : c.id) === uid;\n      });\n      onCardClick(data);\n      return;\n    }\n\n    // Slot-Klick\n    if (data.type === 'row_slot') {\n      var _gameState$board$1$in, _gameState$board, _gameState$board$, _gameState$board$1$au, _gameState$board2, _gameState$board2$;\n      const lane = data.lane;\n      const cap = getLaneCapacity(lane);\n\n      // Hole aktuelle Row-LÃ¤nge aus gameState\n      const rowCards = lane === 'public' ? (_gameState$board$1$in = (_gameState$board = gameState.board) === null || _gameState$board === void 0 ? void 0 : (_gameState$board$ = _gameState$board[1]) === null || _gameState$board$ === void 0 ? void 0 : _gameState$board$.innen) !== null && _gameState$board$1$in !== void 0 ? _gameState$board$1$in : [] : (_gameState$board$1$au = (_gameState$board2 = gameState.board) === null || _gameState$board2 === void 0 ? void 0 : (_gameState$board2$ = _gameState$board2[1]) === null || _gameState$board2$ === void 0 ? void 0 : _gameState$board2$.aussen) !== null && _gameState$board$1$au !== void 0 ? _gameState$board$1$au : [];\n      if (rowCards.length >= cap) {\n        // Optional: UI Feedback\n        console.warn(`Row ${lane} is full (${rowCards.length}/${cap})`);\n        return;\n      }\n      onCardClick(data);\n      return;\n    }\n\n    // Andere Klicks (empty_slot, board_card, etc.)\n    onCardClick(data);\n  }, [gameState, onCardClick]);\n  const handleClick = useCallback(e => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const rect = canvas.getBoundingClientRect();\n    const {\n      scale,\n      offsetX,\n      offsetY\n    } = getUiTransform(canvas.width, canvas.height);\n    const mx = (e.clientX - rect.left - offsetX) / scale;\n    const my = (e.clientY - rect.top - offsetY) / scale;\n    const hit = clickZonesRef.current.find(z => mx >= z.x && mx <= z.x + z.w && my >= z.y && my <= z.y + z.h);\n    if (hit) handleCardClick(hit.data);\n  }, [handleCardClick]);\n  const handleMouseMove = useCallback(e => {\n    const canvas = canvasRef.current;\n    if (!canvas) return;\n    const rect = canvas.getBoundingClientRect();\n    const {\n      scale,\n      offsetX,\n      offsetY\n    } = getUiTransform(canvas.width, canvas.height);\n    const mx = (e.clientX - rect.left - offsetX) / scale;\n    const my = (e.clientY - rect.top - offsetY) / scale;\n    const hit = clickZonesRef.current.find(z => mx >= z.x && mx <= z.x + z.w && my >= z.y && my <= z.y + z.h);\n    if (hit) {\n      onCardHover({\n        ...hit.data,\n        x: e.clientX,\n        y: e.clientY\n      });\n    } else {\n      onCardHover(null);\n    }\n  }, [onCardHover]);\n  return /*#__PURE__*/_jsxDEV(\"canvas\", {\n    ref: canvasRef,\n    width: 1920,\n    height: 1080,\n    style: {\n      display: 'block',\n      width: '100%',\n      height: '100%',\n      imageRendering: 'auto'\n    },\n    onClick: handleClick,\n    onMouseMove: handleMouseMove\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 813,\n    columnNumber: 5\n  }, this);\n};\n_s(GameCanvas, \"ACKNjr7vhH2WMJM4qkNDBcQUBd0=\");\n_c = GameCanvas;\nvar _c;\n$RefreshReg$(_c, \"GameCanvas\");","map":{"version":3,"names":["React","useRef","useEffect","useCallback","LAYOUT","getZone","computeSlotRects","getUiTransform","getLaneCapacity","getPublicRects","getGovernmentRects","drawCardImage","sortHandCards","getNetApCost","jsxDEV","_jsxDEV","GameCanvas","gameState","selectedHandIndex","onCardClick","onCardHover","devMode","_s","canvasRef","clickZonesRef","backgroundImageRef","drawCardAt","ctx","card","x","y","size","selected","showAPCost","player","_shield","dx","dy","s","Math","floor","kind","_influence","fillStyle","fillRect","font","fillText","influence","protected","shield","deactivated","apInfo","netText","net","badgeHeight","max","badgeWidth","badgeX","badgeY","bgColor","borderColor","beginPath","roundRect","fill","strokeStyle","lineWidth","stroke","textAlign","textBaseline","strokeRect","w","h","getSlotDisplayName","zoneId","index","slotNumber","includes","drawLane","lane","clickable","zone","slots","arr","board","forEach","idx","isSelected","hands","clickZone","textY","name","current","push","data","type","slotName","drawHandP1","hand","i","originalIndex","findIndex","c","uid","isSel","drawHandP2","rectPx","drawInterventionsP1","traps","zx","zy","zw","zh","drawInterventionsP2","drawSingleSlot","clickType","slot","drawPermanentSlotsP1","permanentSlots","government","public","drawPermanentSlotsP2","drawInstantSlots","sofortPlayerCard","sofort","sofortOppCard","getActiveKeywordsAndSubcategories","allCards","innen","aussen","filter","keywords","Set","subcategories","tag","add","publicCard","oligarchNames","platformNames","movementNames","ngoNames","intelligenceNames","mediaNames","Array","from","drawInfoPanels","govPanelX","govPanelY","govPanelW","govPanelH","length","keyword","pubPanelX","pubPanelY","pubPanelW","pubPanelH","subcategory","displayName","substring","draw","_LAYOUT$background","_LAYOUT$background2","canvas","getContext","clearRect","width","height","background","enabled","src","drawImage","scale","offsetX","offsetY","save","translate","opponentPublicRects","opponentGovRects","playerPublicRects","playerGovRects","restore","window","__politicardDebug","uiTransform","canvasSize","zones","clickZones","slice","handZones","z","uiUIDs","map","_z$data$card$uid","id","Boolean","stateHand","stateUIDs","_c$uid","missingInState","u","missingInUI","_politicardDebug","mismatch","ts","Date","now","uiCount","stateCount","stack","Error","concat","console","warn","e","error","DRAW_LAYOUT_OVERLAY","_LAYOUT$background3","_LAYOUT$background4","img","Image","onload","requestAnimationFrame","onerror","_LAYOUT$background5","handleCardClick","_data$card$uid","_data$card","_data$card2","_gameState$hands","idxInState","_c$uid2","_gameState$board$1$in","_gameState$board","_gameState$board$","_gameState$board$1$au","_gameState$board2","_gameState$board2$","cap","rowCards","handleClick","rect","getBoundingClientRect","mx","clientX","left","my","clientY","top","hit","find","handleMouseMove","ref","style","display","imageRendering","onClick","onMouseMove","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/skank/Videos/Cards/Milchcards/src/components/GameCanvas.tsx"],"sourcesContent":["import React, { useRef, useEffect, useCallback } from 'react';\r\nimport { GameState, Card, PoliticianCard, Player, Lane } from '../types/game';\r\nimport { LAYOUT, getZone, computeSlotRects, getUiTransform, getLaneCapacity, getPublicRects, getGovernmentRects, getSofortRect } from '../ui/layout';\r\nimport { drawCardImage, sortHandCards } from '../utils/gameUtils';\r\nimport { getNetApCost } from '../utils/ap';\r\n\r\ninterface GameCanvasProps {\r\n  gameState: GameState;\r\n  selectedHandIndex: number | null;\r\n  onCardClick: (data: any) => void;\r\n  onCardHover: (data: any) => void;\r\n  devMode?: boolean; // ðŸ”§ DEV MODE: Show P2 hand when true\r\n}\r\n\r\n\r\n\r\nexport const GameCanvas: React.FC<GameCanvasProps> = ({\r\n  gameState,\r\n  selectedHandIndex,\r\n  onCardClick,\r\n  onCardHover,\r\n  devMode = false,\r\n}) => {\r\n  const canvasRef = useRef<HTMLCanvasElement>(null);\r\n  const clickZonesRef = useRef<Array<{ x: number; y: number; w: number; h: number; data: any }>>([]);\r\n  const backgroundImageRef = useRef<HTMLImageElement | null>(null);\r\n\r\n\r\n\r\n  const drawCardAt = useCallback((\r\n    ctx: CanvasRenderingContext2D,\r\n    card: Card,\r\n    x: number,\r\n    y: number,\r\n    size: number,\r\n    selected: boolean = false,\r\n    showAPCost: boolean = false,\r\n    player?: Player\r\n  ) => {\r\n    let dx = x, dy = y, s = size;\r\n    if (selected) {\r\n      s = Math.floor(size * 1.05);\r\n      dx = x - Math.floor((s - size) / 2);\r\n      dy = y - Math.floor((s - size) / 2);\r\n    }\r\n\r\n    drawCardImage(ctx, card, dx, dy, s, 'ui');\r\n\r\n    // Status-Indikatoren (fÃ¼r alle Board-Karten)\r\n    // Einfluss-Wert unten links â€“ nur fÃ¼r Politiker\r\n    if ((card as any).kind === 'pol') {\r\n      ctx.fillStyle = 'rgba(0,0,0,0.5)';\r\n      ctx.fillRect(dx, dy + s - 22, s, 22);\r\n      ctx.fillStyle = '#D7E7F8';\r\n      ctx.font = 'bold 16px sans-serif';\r\n      ctx.fillText(`${(card as any).influence ?? 0}`, dx + 8, dy + s - 6);\r\n    }\r\n    // Schutz-Status (blauer Punkt)\r\n    if ((card as any).protected || ((card as any).shield ?? 0) > 0) {\r\n      ctx.fillStyle = '#1da1f2';\r\n      ctx.fillRect(dx + s - 22, dy + 6, 16, 16);\r\n    }\r\n    // Deaktiviert-Status (roter Punkt)\r\n    if ((card as any).deactivated) {\r\n      ctx.fillStyle = '#b63838';\r\n      ctx.fillRect(dx + s - 22, dy + 26, 16, 16);\r\n    }\r\n\r\n    // Netto-AP Badge anzeigen (modern) - nur fÃ¼r Handkarten\r\n    if (showAPCost && player) {\r\n      const apInfo = getNetApCost(gameState, player, card, 'innen'); // Default auf innen\r\n      const netText = `âš¡${apInfo.net}`;\r\n\r\n      // Badge-GrÃ¶ÃŸe berechnen\r\n      const badgeHeight = Math.max(16, Math.floor(s * 0.12));\r\n      const badgeWidth = badgeHeight * 2;\r\n      const badgeX = dx + s - badgeWidth - 6;\r\n      const badgeY = dy + 6;\r\n\r\n      // Badge-Hintergrund (grÃ¼n fÃ¼r 0 AP, gelb fÃ¼r > 0)\r\n      const bgColor = apInfo.net === 0 ? '#E7F8EF' : '#FFF7E6';\r\n      const borderColor = apInfo.net === 0 ? '#10b981' : '#f59e0b';\r\n\r\n      ctx.fillStyle = bgColor;\r\n      ctx.beginPath();\r\n      ctx.roundRect(badgeX, badgeY, badgeWidth, badgeHeight, badgeHeight / 2);\r\n      ctx.fill();\r\n\r\n      // Badge-Rand\r\n      ctx.strokeStyle = borderColor;\r\n      ctx.lineWidth = 1;\r\n      ctx.stroke();\r\n\r\n      // Text\r\n      ctx.fillStyle = apInfo.net === 0 ? '#065f46' : '#92400e';\r\n      ctx.font = `bold ${Math.floor(badgeHeight * 0.5)}px sans-serif`;\r\n      ctx.textAlign = 'center';\r\n      ctx.textBaseline = 'middle';\r\n      ctx.fillText(netText, badgeX + badgeWidth / 2, badgeY + badgeHeight / 2);\r\n\r\n      // Reset text align\r\n      ctx.textAlign = 'start';\r\n      ctx.textBaseline = 'alphabetic';\r\n    }\r\n\r\n    // Auswahl-Rahmen\r\n    if (selected) {\r\n      ctx.strokeStyle = '#61dafb';\r\n      ctx.lineWidth = 3;\r\n      ctx.strokeRect(dx + 1, dy + 1, s - 2, s - 2);\r\n      ctx.lineWidth = 1;\r\n    }\r\n\r\n    // Return exact 256x256 click zone over the card\r\n    // Since all cards are 256x256, the click zone should match exactly\r\n    return { x: dx, y: dy, w: 256, h: 256 };\r\n  }, [gameState]);\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n  // Slot-Benennungs-Funktion basierend auf Glossar\r\n  const getSlotDisplayName = useCallback((zoneId: string, index: number, player: Player): string => {\r\n    const slotNumber = index + 1;\r\n\r\n    if (zoneId.includes('government')) {\r\n      if (zoneId.includes('player')) {\r\n        return `Regierungsreihe Slot ${slotNumber}`;\r\n      } else {\r\n        return `Gegner Regierung Slot ${slotNumber}`;\r\n      }\r\n    } else if (zoneId.includes('public')) {\r\n      if (zoneId.includes('player')) {\r\n        return `Ã–ffentlichkeitsreihe Slot ${slotNumber}`;\r\n      } else {\r\n        return `Gegner Ã–ffentlichkeit Slot ${slotNumber}`;\r\n      }\r\n    } else if (zoneId.includes('permanent.government')) {\r\n      if (zoneId.includes('player')) {\r\n        return 'Regierung Spezial-Slot';\r\n      } else {\r\n        return 'Gegner Regierung Spezial-Slot';\r\n      }\r\n    } else if (zoneId.includes('permanent.public')) {\r\n      if (zoneId.includes('player')) {\r\n        return 'Ã–ffentlichkeit Spezial-Slot';\r\n      } else {\r\n        return 'Gegner Ã–ffentlichkeit Spezial-Slot';\r\n      }\r\n    } else if (zoneId.includes('instant')) {\r\n      if (zoneId.includes('player')) {\r\n        return 'Sofort-Slot';\r\n      } else {\r\n        return 'Gegner Sofort-Slot';\r\n      }\r\n    } else if (zoneId.includes('hand')) {\r\n      return 'Hand';\r\n    } else if (zoneId.includes('interventions')) {\r\n      return 'Interventionen';\r\n    }\r\n\r\n    return `Slot ${slotNumber}`;\r\n  }, []);\r\n\r\n  const drawLane = useCallback((\r\n    ctx: CanvasRenderingContext2D,\r\n    zoneId: string,\r\n    player: Player,\r\n    lane: Lane,\r\n    clickable: boolean\r\n  ) => {\r\n    const zone = getZone(zoneId);\r\n    if (!zone) return;\r\n\r\n    const slots = computeSlotRects(zone);\r\n    const arr = gameState.board[player][lane];\r\n\r\n    slots.forEach((s, idx) => {\r\n      const card = arr[idx];\r\n\r\n      // Hintergrundfarbe nach Kategorie\r\n      let bgColor = 'rgba(0,0,0,0.1)'; // Standard\r\n      if (zoneId.includes('government')) {\r\n        bgColor = 'rgba(255, 197, 0, 0.15)'; // Hellgelb fÃ¼r Regierung\r\n      } else if (zoneId.includes('public')) {\r\n        bgColor = 'rgba(0, 255, 0, 0.15)'; // HellgrÃ¼n fÃ¼r Ã–ffentlichkeit\r\n      }\r\n\r\n      ctx.fillStyle = bgColor;\r\n      ctx.fillRect(s.x, s.y, s.w, s.h);\r\n\r\n      // Slot-Rahmen\r\n      ctx.strokeStyle = 'rgba(255,255,255,0.06)';\r\n      ctx.strokeRect(s.x + 0.5, s.y + 0.5, s.w - 1, s.h - 1);\r\n\r\n      if (card) {\r\n        const isSelected = player === 1 && selectedHandIndex !== null && gameState.hands[1][selectedHandIndex] === card;\r\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, isSelected, false);\r\n\r\n        // Kartenname unter dem Slot anzeigen\r\n        ctx.fillStyle = 'rgba(255,255,255,0.9)';\r\n        ctx.font = 'bold 12px sans-serif';\r\n        ctx.textAlign = 'center';\r\n        const textY = s.y + s.h + 16;\r\n        ctx.fillText(card.name, s.x + s.w/2, textY);\r\n\r\n        clickZonesRef.current.push({\r\n          ...clickZone,\r\n          data: { type: 'board_card', player, lane, index: idx, card }\r\n        });\r\n      } else if (clickable && gameState.current === player) {\r\n        // Slot-Benennung anzeigen (fÃ¼r den aktuellen Spieler)\r\n        const slotName = getSlotDisplayName(zoneId, idx, player);\r\n        ctx.fillStyle = 'rgba(255,255,255,0.6)';\r\n        ctx.font = '11px sans-serif';\r\n        ctx.textAlign = 'center';\r\n        const textY = s.y + s.h/2;\r\n        ctx.fillText(slotName, s.x + s.w/2, textY);\r\n\r\n        clickZonesRef.current.push({\r\n          x: s.x, y: s.y, w: s.w, h: s.h,\r\n          data: { type: 'row_slot', lane, index: idx }\r\n        });\r\n      }\r\n    });\r\n  }, [gameState, selectedHandIndex, drawCardAt, getSlotDisplayName]);\r\n\r\n  const drawHandP1 = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    const hand = sortHandCards(gameState.hands[1]);\r\n    const zone = getZone('hand.player');\r\n    if (!zone) return;\r\n\r\n    const slots = computeSlotRects(zone);\r\n    slots.forEach((s: { x: number; y: number; w: number; h: number }, i: number) => {\r\n      const card = hand[i];\r\n      if (!card) return;\r\n      // Find original index in unsorted hand for click handling\r\n      const originalIndex = gameState.hands[1].findIndex(c => c.uid === card.uid);\r\n      const isSel = selectedHandIndex === originalIndex;\r\n      const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, isSel, true, 1); // Show AP cost for player 1 hand\r\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'hand_p1', index: originalIndex, card } });\r\n    });\r\n  }, [gameState.hands, selectedHandIndex, drawCardAt]);\r\n\r\n      // ðŸ”§ DEV MODE: Player 2 Hand (rechts unten, kompakter)\r\n  const drawHandP2 = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    const hand = sortHandCards(gameState.hands[2]);\r\n    const zone = getZone('hand.opponent');\r\n    if (!zone) return;\r\n\r\n    const slots = computeSlotRects(zone);\r\n\r\n    // Hintergrund fÃ¼r P2 Hand\r\n    const [x, y, w, h] = zone.rectPx;\r\n    ctx.fillStyle = 'rgba(255, 100, 100, 0.15)'; // RÃ¶tlicher Hintergrund fÃ¼r P2\r\n    ctx.fillRect(x, y, w, h);\r\n    ctx.strokeStyle = 'rgba(255, 100, 100, 0.3)';\r\n    ctx.strokeRect(x + 0.5, y + 0.5, w - 1, h - 1);\r\n\r\n    // Label fÃ¼r P2 Hand\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n    ctx.font = 'bold 14px sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.fillText('Player 2 Hand', x + w/2, y - 8);\r\n\r\n    slots.forEach((s: { x: number; y: number; w: number; h: number }, i: number) => {\r\n      const card = hand[i];\r\n      if (!card) return;\r\n      // Find original index in unsorted hand for click handling\r\n      const originalIndex = gameState.hands[2].findIndex(c => c.uid === card.uid);\r\n      const isSel = gameState.current === 2 && selectedHandIndex === originalIndex;\r\n      const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, isSel, true, 2); // Show AP cost for player 2 hand\r\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'hand_p2', index: originalIndex, card } });\r\n    });\r\n  }, [gameState, selectedHandIndex, drawCardAt]);\r\n  // Interventions strip (player traps)\r\n  const drawInterventionsP1 = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    const traps = gameState.traps[1] || [];\r\n    const zone = getZone('interventions.player');\r\n    if (!zone) return;\r\n\r\n    // Single intervention slot\r\n    const [zx, zy, zw, zh] = zone.rectPx;\r\n    const card = traps[0]; // Only first trap\r\n\r\n    // Hintergrund fÃ¼r Interventions-Slot\r\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.15)'; // Lavendelfarben fÃ¼r Interventionen\r\n    ctx.fillRect(zx, zy, zw, zh);\r\n    ctx.strokeStyle = 'rgba(200, 160, 255, 0.3)';\r\n    ctx.strokeRect(zx + 0.5, zy + 0.5, zw - 1, zh - 1);\r\n\r\n    // Slot-Benennung fÃ¼r Interventions-Slot\r\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.8)';\r\n    ctx.font = '11px sans-serif';\r\n    ctx.textAlign = 'left';\r\n    ctx.fillText('Intervention', zx + 8, zy + zh - 6);\r\n\r\n    if (card) {\r\n      const clickZone = drawCardAt(ctx, card, zx, zy, zw, false, false);\r\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'trap_p1', index: 0, card } });\r\n    }\r\n  }, [gameState.traps, drawCardAt]);\r\n\r\n  // Interventions strip (opponent traps)\r\n  const drawInterventionsP2 = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    const traps = gameState.traps[2] || [];\r\n    const zone = getZone('interventions.opponent');\r\n    if (!zone) return;\r\n\r\n    // Single intervention slot\r\n    const [zx, zy, zw, zh] = zone.rectPx;\r\n    const card = traps[0]; // Only first trap\r\n\r\n    // Hintergrund fÃ¼r Interventions-Slot\r\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.15)'; // Lavendelfarben fÃ¼r Interventionen\r\n    ctx.fillRect(zx, zy, zw, zh);\r\n    ctx.strokeStyle = 'rgba(200, 160, 255, 0.3)';\r\n    ctx.strokeRect(zx + 0.5, zy + 0.5, zw - 1, zh - 1);\r\n\r\n    // Slot-Benennung fÃ¼r Interventions-Slot\r\n    ctx.fillStyle = 'rgba(200, 160, 255, 0.8)';\r\n    ctx.font = '11px sans-serif';\r\n    ctx.textAlign = 'left';\r\n    ctx.fillText('Intervention', zx + 8, zy + zh - 6);\r\n\r\n    if (card) {\r\n      const clickZone = drawCardAt(ctx, card, zx, zy, zw, false, false);\r\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'trap_p2', index: 0, card } });\r\n    }\r\n  }, [gameState.traps, drawCardAt]);\r\n\r\n  // Single slot drawing function\r\n  const drawSingleSlot = useCallback((\r\n    ctx: CanvasRenderingContext2D,\r\n    zoneId: string,\r\n    card: Card | null,\r\n    clickType: string,\r\n    player: Player\r\n  ) => {\r\n    const zone = getZone(zoneId);\r\n    if (!zone) return;\r\n    const [x, y, w, h] = zone.rectPx;\r\n\r\n    // Hintergrundfarbe nach Kategorie\r\n    let bgColor = 'rgba(0,0,0,0.1)'; // Standard\r\n    if (zoneId.includes('government')) {\r\n      bgColor = 'rgba(255, 197, 0, 0.15)'; // Hellgelb fÃ¼r Regierung\r\n    } else if (zoneId.includes('public')) {\r\n      bgColor = 'rgba(0, 255, 0, 0.15)'; // HellgrÃ¼n fÃ¼r Ã–ffentlichkeit\r\n    } else if (zoneId.includes('instant')) {\r\n      bgColor = 'rgba(127, 116, 91, 0.15)'; // Neutral fÃ¼r Sofort-Slots\r\n    } else if (zoneId.includes('permanent')) {\r\n      // Unterscheide zwischen government und public permanent slots\r\n      if (zoneId.includes('government')) {\r\n        bgColor = 'rgba(255, 197, 0, 0.15)';\r\n      } else if (zoneId.includes('public')) {\r\n        bgColor = 'rgba(0, 255, 0, 0.15)';\r\n      }\r\n    }\r\n\r\n    ctx.fillStyle = bgColor;\r\n    ctx.fillRect(x, y, w, h);\r\n\r\n    // Draw slot border\r\n    ctx.strokeStyle = 'rgba(255,255,255,0.06)';\r\n    ctx.strokeRect(x + 0.5, y + 0.5, w - 1, h - 1);\r\n\r\n    if (card) {\r\n      const isSelected = player === 1 && selectedHandIndex !== null && gameState.hands[1][selectedHandIndex] === card;\r\n      const clickZone = drawCardAt(ctx, card, x, y, w, isSelected, false);\r\n\r\n      // Kartenname unter dem Slot anzeigen\r\n      ctx.fillStyle = 'rgba(255,255,255,0.9)';\r\n      ctx.font = 'bold 12px sans-serif';\r\n      ctx.textAlign = 'center';\r\n      const textY = y + h + 16;\r\n      ctx.fillText(card.name, x + w/2, textY);\r\n\r\n      clickZonesRef.current.push({ ...clickZone, data: { type: 'slot_card', slot: clickType, card } });\r\n\r\n      // ðŸ”§ NEU: Sofort-Initiative-Slots sind klickbar fÃ¼r Aktivierung\r\n      if (clickType === 'instant' && gameState.current === player) {\r\n        clickZonesRef.current.push({\r\n          x, y, w, h,\r\n          data: { type: 'activate_instant', player, card }\r\n        });\r\n      }\r\n    } else if (gameState.current === player) {\r\n      // Slot-Benennung fÃ¼r leere Slots anzeigen (fÃ¼r den aktuellen Spieler)\r\n      const slotName = getSlotDisplayName(zoneId, 0, player);\r\n      ctx.fillStyle = 'rgba(255,255,255,0.6)';\r\n      ctx.font = '11px sans-serif';\r\n      ctx.textAlign = 'center';\r\n      const textY = y + h/2;\r\n      ctx.fillText(slotName, x + w/2, textY);\r\n\r\n      clickZonesRef.current.push({ x, y, w, h, data: { type: 'empty_slot', slot: clickType } });\r\n    }\r\n  }, [selectedHandIndex, gameState, drawCardAt, getSlotDisplayName]);\r\n\r\n  // Draw permanent slots for player\r\n  const drawPermanentSlotsP1 = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    drawSingleSlot(ctx, 'slot.permanent.government.player', gameState.permanentSlots[1].government, 'permanent_government', 1);\r\n    drawSingleSlot(ctx, 'slot.permanent.public.player', gameState.permanentSlots[1].public, 'permanent_public', 1);\r\n  }, [gameState.permanentSlots, drawSingleSlot]);\r\n\r\n  // Draw permanent slots for opponent\r\n  const drawPermanentSlotsP2 = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    drawSingleSlot(ctx, 'slot.permanent.government.opponent', gameState.permanentSlots[2].government, 'permanent_government', 2);\r\n    drawSingleSlot(ctx, 'slot.permanent.public.opponent', gameState.permanentSlots[2].public, 'permanent_public', 2);\r\n  }, [gameState.permanentSlots, drawSingleSlot]);\r\n\r\n  // Draw instant slots\r\n  const drawInstantSlots = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    // Sofort-Initiative-Slots aus dem Board zeichnen\r\n    const sofortPlayerCard = gameState.board[1].sofort[0];\r\n    const sofortOppCard = gameState.board[2].sofort[0];\r\n\r\n    drawSingleSlot(ctx, 'slot.instant.player', sofortPlayerCard, 'instant', 1);\r\n    drawSingleSlot(ctx, 'slot.instant.opponent', sofortOppCard, 'instant', 2);\r\n  }, [gameState.board, drawSingleSlot]);\r\n\r\n  // Aktive SchlÃ¼sselwÃ¶rter und Unterkategorien ermitteln\r\n  const getActiveKeywordsAndSubcategories = useCallback((player: Player) => {\r\n    const board = gameState.board[player];\r\n    const permanentSlots = gameState.permanentSlots[player];\r\n    const allCards = [\r\n      ...board.innen,\r\n      ...board.aussen,\r\n      permanentSlots.government,\r\n      permanentSlots.public\r\n    ].filter(c => c && c.kind === 'pol') as PoliticianCard[];\r\n\r\n    const keywords = new Set<string>();\r\n    const subcategories = new Set<string>();\r\n\r\n    allCards.forEach(card => {\r\n      if (!card.deactivated) {\r\n        // Regierungskarten-SchlÃ¼sselwÃ¶rter\r\n        if (card.tag === 'Leadership') {\r\n          keywords.add('Leadership');\r\n        }\r\n        if (card.tag === 'Diplomat') {\r\n          keywords.add('Diplomat');\r\n        }\r\n\r\n        // Ã–ffentlichkeits-Unterkategorien (fÃ¼r Karten in Ã–ffentlichkeitsreihe)\r\n        if (board.innen.includes(card)) {\r\n          const publicCard = card as any;\r\n          if (publicCard.tag) {\r\n            // Oligarch\r\n            const oligarchNames = ['Elon Musk', 'Bill Gates', 'George Soros', 'Warren Buffett', 'Mukesh Ambani', 'Jeff Bezos', 'Alisher Usmanov', 'Gautam Adani', 'Jack Ma', 'Zhang Yiming', 'Roman Abramovich'];\r\n            if (oligarchNames.includes(publicCard.name)) {\r\n              subcategories.add('Oligarch');\r\n            }\r\n\r\n            // Plattform\r\n            const platformNames = ['Mark Zuckerberg', 'Tim Cook', 'Sam Altman', 'Jack Ma'];\r\n            if (platformNames.includes(publicCard.name)) {\r\n              subcategories.add('Plattform');\r\n            }\r\n\r\n            // Bewegung\r\n            const movementNames = ['Greta Thunberg', 'Malala Yousafzai', 'Ai Weiwei', 'Alexei Navalny'];\r\n            if (movementNames.includes(publicCard.name)) {\r\n              subcategories.add('Bewegung');\r\n            }\r\n\r\n            // NGO/Think-Tank\r\n            const ngoNames = ['Bill Gates', 'George Soros', 'Jennifer Doudna', 'Noam Chomsky', 'Anthony Fauci'];\r\n            if (ngoNames.includes(publicCard.name)) {\r\n              subcategories.add('NGO/Think-Tank');\r\n            }\r\n\r\n            // Intelligenz\r\n            const intelligenceNames = ['Jennifer Doudna', 'Noam Chomsky', 'Edward Snowden', 'Julian Assange', 'Yuval Noah Harari', 'Ai Weiwei', 'Alexei Navalny', 'Anthony Fauci'];\r\n            if (intelligenceNames.includes(publicCard.name)) {\r\n              subcategories.add('Intelligenz');\r\n            }\r\n\r\n            // Medien\r\n            const mediaNames = ['Oprah Winfrey'];\r\n            if (mediaNames.includes(publicCard.name)) {\r\n              subcategories.add('Medien');\r\n            }\r\n          }\r\n        }\r\n      }\r\n    });\r\n\r\n    return {\r\n      keywords: Array.from(keywords),\r\n      subcategories: Array.from(subcategories)\r\n    };\r\n  }, [gameState]);\r\n\r\n  // Info-Panels zeichnen\r\n  const drawInfoPanels = useCallback((ctx: CanvasRenderingContext2D) => {\r\n    const { keywords, subcategories } = getActiveKeywordsAndSubcategories(1);\r\n\r\n    // Panel fÃ¼r RegierungsschlÃ¼sselwÃ¶rter (rechts neben Regierungsslots)\r\n    const govPanelX = 1640 + 256 + 20; // Nach dem letzten permanenten Slot\r\n    const govPanelY = 300; // Auf HÃ¶he der Regierungsslots\r\n    const govPanelW = 120;\r\n    const govPanelH = 256;\r\n\r\n    // Regierungspanel Hintergrund\r\n    ctx.fillStyle = 'rgba(255, 197, 0, 0.15)';\r\n    ctx.fillRect(govPanelX, govPanelY, govPanelW, govPanelH);\r\n    ctx.strokeStyle = 'rgba(255, 197, 0, 0.3)';\r\n    ctx.strokeRect(govPanelX + 0.5, govPanelY + 0.5, govPanelW - 1, govPanelH - 1);\r\n\r\n    // Regierungspanel Titel\r\n    ctx.fillStyle = 'rgba(255, 197, 0, 0.9)';\r\n    ctx.font = 'bold 12px sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.fillText('Regierung', govPanelX + govPanelW/2, govPanelY + 16);\r\n\r\n    // SchlÃ¼sselwÃ¶rter auflisten\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n    ctx.font = '11px sans-serif';\r\n    ctx.textAlign = 'left';\r\n    if (keywords.length > 0) {\r\n      keywords.forEach((keyword, idx) => {\r\n        ctx.fillText(`â€¢ ${keyword}`, govPanelX + 8, govPanelY + 36 + idx * 16);\r\n      });\r\n    } else {\r\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';\r\n      ctx.fillText('Keine aktiven', govPanelX + 8, govPanelY + 36);\r\n      ctx.fillText('SchlÃ¼sselwÃ¶rter', govPanelX + 8, govPanelY + 52);\r\n    }\r\n\r\n    // Panel fÃ¼r Ã–ffentlichkeits-Unterkategorien (rechts neben Ã–ffentlichkeitsslots)\r\n    const pubPanelX = 1640 + 256 + 20;\r\n    const pubPanelY = 580; // Auf HÃ¶he der Ã–ffentlichkeitsslots\r\n    const pubPanelW = 120;\r\n    const pubPanelH = 256;\r\n\r\n    // Ã–ffentlichkeitspanel Hintergrund\r\n    ctx.fillStyle = 'rgba(0, 255, 0, 0.15)';\r\n    ctx.fillRect(pubPanelX, pubPanelY, pubPanelW, pubPanelH);\r\n    ctx.strokeStyle = 'rgba(0, 255, 0, 0.3)';\r\n    ctx.strokeRect(pubPanelX + 0.5, pubPanelY + 0.5, pubPanelW - 1, pubPanelH - 1);\r\n\r\n    // Ã–ffentlichkeitspanel Titel\r\n    ctx.fillStyle = 'rgba(0, 255, 0, 0.9)';\r\n    ctx.font = 'bold 12px sans-serif';\r\n    ctx.textAlign = 'center';\r\n    ctx.fillText('Ã–ffentlichkeit', pubPanelX + pubPanelW/2, pubPanelY + 16);\r\n\r\n    // Unterkategorien auflisten\r\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';\r\n    ctx.font = '11px sans-serif';\r\n    ctx.textAlign = 'left';\r\n    if (subcategories.length > 0) {\r\n      subcategories.forEach((subcategory, idx) => {\r\n        const displayName = subcategory.length > 12 ? subcategory.substring(0, 10) + '...' : subcategory;\r\n        ctx.fillText(`â€¢ ${displayName}`, pubPanelX + 8, pubPanelY + 36 + idx * 16);\r\n      });\r\n    } else {\r\n      ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';\r\n      ctx.fillText('Keine aktiven', pubPanelX + 8, pubPanelY + 36);\r\n      ctx.fillText('Unterkategorien', pubPanelX + 8, pubPanelY + 52);\r\n    }\r\n  }, [getActiveKeywordsAndSubcategories]);\r\n\r\n  const draw = useCallback(() => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n\r\n    const ctx = canvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    // Clear canvas\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    // Clear click zones\r\n    clickZonesRef.current = [];\r\n\r\n    // Background: prefer PNG if configured\r\n    if (LAYOUT.background?.enabled && LAYOUT.background?.src) {\r\n      if (backgroundImageRef.current) {\r\n        ctx.drawImage(backgroundImageRef.current, 0, 0, canvas.width, canvas.height);\r\n      } else {\r\n        ctx.fillStyle = '#0c131b';\r\n        ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n      }\r\n    } else {\r\n      ctx.fillStyle = '#0c131b';\r\n      ctx.fillRect(0, 0, canvas.width, canvas.height);\r\n    }\r\n\r\n    // Apply UI transform (new signature)\r\n    const { scale, offsetX, offsetY } = getUiTransform(canvas.width, canvas.height);\r\n    ctx.save();\r\n    ctx.translate(offsetX, offsetY);\r\n    ctx.scale(scale, scale);\r\n\r\n    // Draw opponent board (top rows) - clickable im Dev Mode\r\n    // Draw opponent board using new layout system\r\n    const opponentPublicRects = getPublicRects('opponent');\r\n    const opponentGovRects = getGovernmentRects('opponent');\r\n\r\n    // Draw opponent public slots\r\n    opponentPublicRects.forEach((s: { x: number; y: number; w: number; h: number }, idx: number) => {\r\n      const card = gameState.board[2].innen[idx];\r\n      if (card) {\r\n        drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 2);\r\n      }\r\n    });\r\n\r\n    // Draw opponent government slots\r\n    opponentGovRects.forEach((s: { x: number; y: number; w: number; h: number }, idx: number) => {\r\n      const card = gameState.board[2].aussen[idx];\r\n      if (card) {\r\n        drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 2);\r\n      }\r\n    });\r\n\r\n    // Draw opponent permanent slots\r\n    drawPermanentSlotsP2(ctx);\r\n\r\n    // Draw player board (middle rows)\r\n    // Draw player board using new layout system\r\n    const playerPublicRects = getPublicRects('player');\r\n    const playerGovRects = getGovernmentRects('player');\r\n\r\n    // Draw player public slots\r\n    playerPublicRects.forEach((s: { x: number; y: number; w: number; h: number }, idx: number) => {\r\n      const card = gameState.board[1].innen[idx];\r\n      if (card) {\r\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 1);\r\n        clickZonesRef.current.push({\r\n          ...clickZone,\r\n          data: { type: 'row_slot', player: 1, lane: 'innen', index: idx }\r\n        });\r\n      } else {\r\n        // Empty slot click zone\r\n        clickZonesRef.current.push({\r\n          x: s.x, y: s.y, w: s.w, h: s.h,\r\n          data: { type: 'row_slot', player: 1, lane: 'innen', index: idx }\r\n        });\r\n      }\r\n    });\r\n\r\n    // Draw player government slots\r\n    playerGovRects.forEach((s: { x: number; y: number; w: number; h: number }, idx: number) => {\r\n      const card = gameState.board[1].aussen[idx];\r\n      if (card) {\r\n        const clickZone = drawCardAt(ctx, card, s.x, s.y, s.w, false, false, 1);\r\n        clickZonesRef.current.push({\r\n          ...clickZone,\r\n          data: { type: 'row_slot', player: 1, lane: 'aussen', index: idx }\r\n        });\r\n      } else {\r\n        // Empty slot click zone\r\n        clickZonesRef.current.push({\r\n          x: s.x, y: s.y, w: s.w, h: s.h,\r\n          data: { type: 'row_slot', player: 1, lane: 'aussen', index: idx }\r\n        });\r\n      }\r\n    });\r\n\r\n    // Draw player permanent slots\r\n    drawPermanentSlotsP1(ctx);\r\n\r\n    // Draw instant slots (both players)\r\n    drawInstantSlots(ctx);\r\n\r\n    // Draw interventions strip (player)\r\n    drawInterventionsP1(ctx);\r\n\r\n    // Draw interventions strip (opponent) - nur im Dev Mode\r\n    if (devMode) {\r\n      drawInterventionsP2(ctx);\r\n    }\r\n\r\n    // Draw hand (P1)\r\n    drawHandP1(ctx);\r\n\r\n    // ðŸ”§ DEV MODE: Draw hand (P2) - nur im Dev Mode\r\n    if (devMode) {\r\n      drawHandP2(ctx);\r\n    }\r\n\r\n    // Draw info panels\r\n    drawInfoPanels(ctx);\r\n\r\n    ctx.restore();\r\n\r\n    // expose zones for debug snapshot\r\n    (window as any).__politicardDebug = {\r\n      uiTransform: getUiTransform(canvas.width, canvas.height),\r\n      canvasSize: { width: canvas.width, height: canvas.height },\r\n      zones: LAYOUT.zones,\r\n      clickZones: clickZonesRef.current.slice(0, 1000)\r\n    };\r\n\r\n    // Diagnostics: verify UI hand click zones match authoritative gameState.hands[1]\r\n    try {\r\n      const handZones = clickZonesRef.current.filter(z => z.data && z.data.type === 'hand_p1');\r\n      const uiUIDs = handZones.map(z => (z.data.card && (z.data.card.uid ?? z.data.card.id)) ).filter(Boolean);\r\n      const stateHand = gameState.hands && gameState.hands[1] ? gameState.hands[1] : [];\r\n      const stateUIDs = stateHand.map((c: any) => c.uid ?? c.id).filter(Boolean);\r\n\r\n      const missingInState = uiUIDs.filter((u: any) => !stateUIDs.includes(u));\r\n      const missingInUI = stateUIDs.filter((u: any) => !uiUIDs.includes(u));\r\n\r\n      if (uiUIDs.length !== stateUIDs.length || missingInState.length > 0 || missingInUI.length > 0) {\r\n        const mismatch = {\r\n          ts: Date.now(),\r\n          uiCount: uiUIDs.length,\r\n          stateCount: stateUIDs.length,\r\n          uiUIDs,\r\n          stateUIDs,\r\n          missingInState,\r\n          missingInUI,\r\n          stack: (new Error('mismatch-stack')).stack\r\n        };\r\n        (window as any).__politicardDebug = {\r\n          ...(window as any).__politicardDebug,\r\n          mismatch: [ ...(window as any).__politicardDebug?.mismatch || [] ].slice(-19).concat([mismatch])\r\n        };\r\n        // Clear, then log to console so user can copy/paste trace\r\n        console.warn('POLITICARD DIAGNOSTIC: hand mismatch detected', mismatch);\r\n      }\r\n    } catch (e) {\r\n      // swallow diagnostic errors to avoid breaking rendering\r\n      console.error('Diagnostic error', e);\r\n    }\r\n  }, [drawLane, drawHandP1, drawHandP2, drawInterventionsP1, drawInterventionsP2, drawPermanentSlotsP1, drawPermanentSlotsP2, drawInstantSlots, drawInfoPanels, devMode, gameState.hands]);\r\n\r\n  const DRAW_LAYOUT_OVERLAY = false; // force off per new layout system\r\n\r\n  // Load background image if configured\r\n  useEffect(() => {\r\n    if (LAYOUT.background?.enabled && LAYOUT.background?.src) {\r\n      const img = new Image();\r\n      img.onload = () => { backgroundImageRef.current = img; requestAnimationFrame(draw); };\r\n      img.onerror = () => { console.warn('Failed to load background image', LAYOUT.background?.src); };\r\n      img.src = LAYOUT.background.src as string;\r\n    }\r\n  }, [draw]);\r\n\r\n  const handleCardClick = useCallback((data: any) => {\r\n    // Hand-Klick\r\n    if (data.type === 'hand_p1') {\r\n      const uid = data.card?.uid ?? data.card?.id;\r\n      const stateHand = gameState.hands?.[1] || [];\r\n      const idxInState = stateHand.findIndex((c: any) => (c.uid ?? c.id) === uid);\r\n      onCardClick(data);\r\n      return;\r\n    }\r\n\r\n    // Slot-Klick\r\n    if (data.type === 'row_slot') {\r\n      const lane: 'public' | 'government' = data.lane;\r\n      const cap = getLaneCapacity(lane);\r\n\r\n      // Hole aktuelle Row-LÃ¤nge aus gameState\r\n      const rowCards = lane === 'public'\r\n        ? gameState.board?.[1]?.innen ?? []\r\n        : gameState.board?.[1]?.aussen ?? [];\r\n\r\n      if (rowCards.length >= cap) {\r\n        // Optional: UI Feedback\r\n        console.warn(`Row ${lane} is full (${rowCards.length}/${cap})`);\r\n        return;\r\n      }\r\n\r\n      onCardClick(data);\r\n      return;\r\n    }\r\n\r\n    // Andere Klicks (empty_slot, board_card, etc.)\r\n    onCardClick(data);\r\n  }, [gameState, onCardClick]);\r\n\r\n  const handleClick = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n\r\n    const rect = canvas.getBoundingClientRect();\r\n    const { scale, offsetX, offsetY } = getUiTransform(canvas.width, canvas.height);\r\n    const mx = (e.clientX - rect.left - offsetX) / scale;\r\n    const my = (e.clientY - rect.top - offsetY) / scale;\r\n\r\n    const hit = clickZonesRef.current.find(z => mx >= z.x && mx <= z.x + z.w && my >= z.y && my <= z.y + z.h);\r\n    if (hit) handleCardClick(hit.data);\r\n  }, [handleCardClick]);\r\n\r\n  const handleMouseMove = useCallback((e: React.MouseEvent<HTMLCanvasElement>) => {\r\n    const canvas = canvasRef.current;\r\n    if (!canvas) return;\r\n\r\n    const rect = canvas.getBoundingClientRect();\r\n    const { scale, offsetX, offsetY } = getUiTransform(canvas.width, canvas.height);\r\n    const mx = (e.clientX - rect.left - offsetX) / scale;\r\n    const my = (e.clientY - rect.top - offsetY) / scale;\r\n\r\n    const hit = clickZonesRef.current.find(z => mx >= z.x && mx <= z.x + z.w && my >= z.y && my <= z.y + z.h);\r\n    if (hit) {\r\n      onCardHover({ ...hit.data, x: e.clientX, y: e.clientY });\r\n    } else {\r\n      onCardHover(null);\r\n    }\r\n  }, [onCardHover]);\r\n\r\n  return (\r\n    <canvas\r\n      ref={canvasRef}\r\n      width={1920}\r\n      height={1080}\r\n      style={{\r\n        display: 'block',\r\n        width: '100%',\r\n        height: '100%',\r\n        imageRendering: 'auto',\r\n      }}\r\n      onClick={handleClick}\r\n      onMouseMove={handleMouseMove}\r\n    />\r\n  );\r\n};\r\n"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,MAAM,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AAE7D,SAASC,MAAM,EAAEC,OAAO,EAAEC,gBAAgB,EAAEC,cAAc,EAAEC,eAAe,EAAEC,cAAc,EAAEC,kBAAkB,QAAuB,cAAc;AACpJ,SAASC,aAAa,EAAEC,aAAa,QAAQ,oBAAoB;AACjE,SAASC,YAAY,QAAQ,aAAa;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAY3C,OAAO,MAAMC,UAAqC,GAAGA,CAAC;EACpDC,SAAS;EACTC,iBAAiB;EACjBC,WAAW;EACXC,WAAW;EACXC,OAAO,GAAG;AACZ,CAAC,KAAK;EAAAC,EAAA;EACJ,MAAMC,SAAS,GAAGtB,MAAM,CAAoB,IAAI,CAAC;EACjD,MAAMuB,aAAa,GAAGvB,MAAM,CAAmE,EAAE,CAAC;EAClG,MAAMwB,kBAAkB,GAAGxB,MAAM,CAA0B,IAAI,CAAC;EAIhE,MAAMyB,UAAU,GAAGvB,WAAW,CAAC,CAC7BwB,GAA6B,EAC7BC,IAAU,EACVC,CAAS,EACTC,CAAS,EACTC,IAAY,EACZC,QAAiB,GAAG,KAAK,EACzBC,UAAmB,GAAG,KAAK,EAC3BC,MAAe,KACZ;IAAA,IAAAC,OAAA;IACH,IAAIC,EAAE,GAAGP,CAAC;MAAEQ,EAAE,GAAGP,CAAC;MAAEQ,CAAC,GAAGP,IAAI;IAC5B,IAAIC,QAAQ,EAAE;MACZM,CAAC,GAAGC,IAAI,CAACC,KAAK,CAACT,IAAI,GAAG,IAAI,CAAC;MAC3BK,EAAE,GAAGP,CAAC,GAAGU,IAAI,CAACC,KAAK,CAAC,CAACF,CAAC,GAAGP,IAAI,IAAI,CAAC,CAAC;MACnCM,EAAE,GAAGP,CAAC,GAAGS,IAAI,CAACC,KAAK,CAAC,CAACF,CAAC,GAAGP,IAAI,IAAI,CAAC,CAAC;IACrC;IAEApB,aAAa,CAACgB,GAAG,EAAEC,IAAI,EAAEQ,EAAE,EAAEC,EAAE,EAAEC,CAAC,EAAE,IAAI,CAAC;;IAEzC;IACA;IACA,IAAKV,IAAI,CAASa,IAAI,KAAK,KAAK,EAAE;MAAA,IAAAC,UAAA;MAChCf,GAAG,CAACgB,SAAS,GAAG,iBAAiB;MACjChB,GAAG,CAACiB,QAAQ,CAACR,EAAE,EAAEC,EAAE,GAAGC,CAAC,GAAG,EAAE,EAAEA,CAAC,EAAE,EAAE,CAAC;MACpCX,GAAG,CAACgB,SAAS,GAAG,SAAS;MACzBhB,GAAG,CAACkB,IAAI,GAAG,sBAAsB;MACjClB,GAAG,CAACmB,QAAQ,CAAC,IAAAJ,UAAA,GAAId,IAAI,CAASmB,SAAS,cAAAL,UAAA,cAAAA,UAAA,GAAI,CAAC,EAAE,EAAEN,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAGC,CAAC,GAAG,CAAC,CAAC;IACrE;IACA;IACA,IAAKV,IAAI,CAASoB,SAAS,IAAI,EAAAb,OAAA,GAAEP,IAAI,CAASqB,MAAM,cAAAd,OAAA,cAAAA,OAAA,GAAI,CAAC,IAAI,CAAC,EAAE;MAC9DR,GAAG,CAACgB,SAAS,GAAG,SAAS;MACzBhB,GAAG,CAACiB,QAAQ,CAACR,EAAE,GAAGE,CAAC,GAAG,EAAE,EAAED,EAAE,GAAG,CAAC,EAAE,EAAE,EAAE,EAAE,CAAC;IAC3C;IACA;IACA,IAAKT,IAAI,CAASsB,WAAW,EAAE;MAC7BvB,GAAG,CAACgB,SAAS,GAAG,SAAS;MACzBhB,GAAG,CAACiB,QAAQ,CAACR,EAAE,GAAGE,CAAC,GAAG,EAAE,EAAED,EAAE,GAAG,EAAE,EAAE,EAAE,EAAE,EAAE,CAAC;IAC5C;;IAEA;IACA,IAAIJ,UAAU,IAAIC,MAAM,EAAE;MACxB,MAAMiB,MAAM,GAAGtC,YAAY,CAACI,SAAS,EAAEiB,MAAM,EAAEN,IAAI,EAAE,OAAO,CAAC,CAAC,CAAC;MAC/D,MAAMwB,OAAO,GAAG,IAAID,MAAM,CAACE,GAAG,EAAE;;MAEhC;MACA,MAAMC,WAAW,GAAGf,IAAI,CAACgB,GAAG,CAAC,EAAE,EAAEhB,IAAI,CAACC,KAAK,CAACF,CAAC,GAAG,IAAI,CAAC,CAAC;MACtD,MAAMkB,UAAU,GAAGF,WAAW,GAAG,CAAC;MAClC,MAAMG,MAAM,GAAGrB,EAAE,GAAGE,CAAC,GAAGkB,UAAU,GAAG,CAAC;MACtC,MAAME,MAAM,GAAGrB,EAAE,GAAG,CAAC;;MAErB;MACA,MAAMsB,OAAO,GAAGR,MAAM,CAACE,GAAG,KAAK,CAAC,GAAG,SAAS,GAAG,SAAS;MACxD,MAAMO,WAAW,GAAGT,MAAM,CAACE,GAAG,KAAK,CAAC,GAAG,SAAS,GAAG,SAAS;MAE5D1B,GAAG,CAACgB,SAAS,GAAGgB,OAAO;MACvBhC,GAAG,CAACkC,SAAS,CAAC,CAAC;MACflC,GAAG,CAACmC,SAAS,CAACL,MAAM,EAAEC,MAAM,EAAEF,UAAU,EAAEF,WAAW,EAAEA,WAAW,GAAG,CAAC,CAAC;MACvE3B,GAAG,CAACoC,IAAI,CAAC,CAAC;;MAEV;MACApC,GAAG,CAACqC,WAAW,GAAGJ,WAAW;MAC7BjC,GAAG,CAACsC,SAAS,GAAG,CAAC;MACjBtC,GAAG,CAACuC,MAAM,CAAC,CAAC;;MAEZ;MACAvC,GAAG,CAACgB,SAAS,GAAGQ,MAAM,CAACE,GAAG,KAAK,CAAC,GAAG,SAAS,GAAG,SAAS;MACxD1B,GAAG,CAACkB,IAAI,GAAG,QAAQN,IAAI,CAACC,KAAK,CAACc,WAAW,GAAG,GAAG,CAAC,eAAe;MAC/D3B,GAAG,CAACwC,SAAS,GAAG,QAAQ;MACxBxC,GAAG,CAACyC,YAAY,GAAG,QAAQ;MAC3BzC,GAAG,CAACmB,QAAQ,CAACM,OAAO,EAAEK,MAAM,GAAGD,UAAU,GAAG,CAAC,EAAEE,MAAM,GAAGJ,WAAW,GAAG,CAAC,CAAC;;MAExE;MACA3B,GAAG,CAACwC,SAAS,GAAG,OAAO;MACvBxC,GAAG,CAACyC,YAAY,GAAG,YAAY;IACjC;;IAEA;IACA,IAAIpC,QAAQ,EAAE;MACZL,GAAG,CAACqC,WAAW,GAAG,SAAS;MAC3BrC,GAAG,CAACsC,SAAS,GAAG,CAAC;MACjBtC,GAAG,CAAC0C,UAAU,CAACjC,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAG,CAAC,EAAEC,CAAC,GAAG,CAAC,EAAEA,CAAC,GAAG,CAAC,CAAC;MAC5CX,GAAG,CAACsC,SAAS,GAAG,CAAC;IACnB;;IAEA;IACA;IACA,OAAO;MAAEpC,CAAC,EAAEO,EAAE;MAAEN,CAAC,EAAEO,EAAE;MAAEiC,CAAC,EAAE,GAAG;MAAEC,CAAC,EAAE;IAAI,CAAC;EACzC,CAAC,EAAE,CAACtD,SAAS,CAAC,CAAC;;EAQf;EACA,MAAMuD,kBAAkB,GAAGrE,WAAW,CAAC,CAACsE,MAAc,EAAEC,KAAa,EAAExC,MAAc,KAAa;IAChG,MAAMyC,UAAU,GAAGD,KAAK,GAAG,CAAC;IAE5B,IAAID,MAAM,CAACG,QAAQ,CAAC,YAAY,CAAC,EAAE;MACjC,IAAIH,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;QAC7B,OAAO,wBAAwBD,UAAU,EAAE;MAC7C,CAAC,MAAM;QACL,OAAO,yBAAyBA,UAAU,EAAE;MAC9C;IACF,CAAC,MAAM,IAAIF,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;MACpC,IAAIH,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;QAC7B,OAAO,6BAA6BD,UAAU,EAAE;MAClD,CAAC,MAAM;QACL,OAAO,8BAA8BA,UAAU,EAAE;MACnD;IACF,CAAC,MAAM,IAAIF,MAAM,CAACG,QAAQ,CAAC,sBAAsB,CAAC,EAAE;MAClD,IAAIH,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;QAC7B,OAAO,wBAAwB;MACjC,CAAC,MAAM;QACL,OAAO,+BAA+B;MACxC;IACF,CAAC,MAAM,IAAIH,MAAM,CAACG,QAAQ,CAAC,kBAAkB,CAAC,EAAE;MAC9C,IAAIH,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;QAC7B,OAAO,6BAA6B;MACtC,CAAC,MAAM;QACL,OAAO,oCAAoC;MAC7C;IACF,CAAC,MAAM,IAAIH,MAAM,CAACG,QAAQ,CAAC,SAAS,CAAC,EAAE;MACrC,IAAIH,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;QAC7B,OAAO,aAAa;MACtB,CAAC,MAAM;QACL,OAAO,oBAAoB;MAC7B;IACF,CAAC,MAAM,IAAIH,MAAM,CAACG,QAAQ,CAAC,MAAM,CAAC,EAAE;MAClC,OAAO,MAAM;IACf,CAAC,MAAM,IAAIH,MAAM,CAACG,QAAQ,CAAC,eAAe,CAAC,EAAE;MAC3C,OAAO,gBAAgB;IACzB;IAEA,OAAO,QAAQD,UAAU,EAAE;EAC7B,CAAC,EAAE,EAAE,CAAC;EAEN,MAAME,QAAQ,GAAG1E,WAAW,CAAC,CAC3BwB,GAA6B,EAC7B8C,MAAc,EACdvC,MAAc,EACd4C,IAAU,EACVC,SAAkB,KACf;IACH,MAAMC,IAAI,GAAG3E,OAAO,CAACoE,MAAM,CAAC;IAC5B,IAAI,CAACO,IAAI,EAAE;IAEX,MAAMC,KAAK,GAAG3E,gBAAgB,CAAC0E,IAAI,CAAC;IACpC,MAAME,GAAG,GAAGjE,SAAS,CAACkE,KAAK,CAACjD,MAAM,CAAC,CAAC4C,IAAI,CAAC;IAEzCG,KAAK,CAACG,OAAO,CAAC,CAAC9C,CAAC,EAAE+C,GAAG,KAAK;MACxB,MAAMzD,IAAI,GAAGsD,GAAG,CAACG,GAAG,CAAC;;MAErB;MACA,IAAI1B,OAAO,GAAG,iBAAiB,CAAC,CAAC;MACjC,IAAIc,MAAM,CAACG,QAAQ,CAAC,YAAY,CAAC,EAAE;QACjCjB,OAAO,GAAG,yBAAyB,CAAC,CAAC;MACvC,CAAC,MAAM,IAAIc,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;QACpCjB,OAAO,GAAG,uBAAuB,CAAC,CAAC;MACrC;MAEAhC,GAAG,CAACgB,SAAS,GAAGgB,OAAO;MACvBhC,GAAG,CAACiB,QAAQ,CAACN,CAAC,CAACT,CAAC,EAAES,CAAC,CAACR,CAAC,EAAEQ,CAAC,CAACgC,CAAC,EAAEhC,CAAC,CAACiC,CAAC,CAAC;;MAEhC;MACA5C,GAAG,CAACqC,WAAW,GAAG,wBAAwB;MAC1CrC,GAAG,CAAC0C,UAAU,CAAC/B,CAAC,CAACT,CAAC,GAAG,GAAG,EAAES,CAAC,CAACR,CAAC,GAAG,GAAG,EAAEQ,CAAC,CAACgC,CAAC,GAAG,CAAC,EAAEhC,CAAC,CAACiC,CAAC,GAAG,CAAC,CAAC;MAEtD,IAAI3C,IAAI,EAAE;QACR,MAAM0D,UAAU,GAAGpD,MAAM,KAAK,CAAC,IAAIhB,iBAAiB,KAAK,IAAI,IAAID,SAAS,CAACsE,KAAK,CAAC,CAAC,CAAC,CAACrE,iBAAiB,CAAC,KAAKU,IAAI;QAC/G,MAAM4D,SAAS,GAAG9D,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEU,CAAC,CAACT,CAAC,EAAES,CAAC,CAACR,CAAC,EAAEQ,CAAC,CAACgC,CAAC,EAAEgB,UAAU,EAAE,KAAK,CAAC;;QAEzE;QACA3D,GAAG,CAACgB,SAAS,GAAG,uBAAuB;QACvChB,GAAG,CAACkB,IAAI,GAAG,sBAAsB;QACjClB,GAAG,CAACwC,SAAS,GAAG,QAAQ;QACxB,MAAMsB,KAAK,GAAGnD,CAAC,CAACR,CAAC,GAAGQ,CAAC,CAACiC,CAAC,GAAG,EAAE;QAC5B5C,GAAG,CAACmB,QAAQ,CAAClB,IAAI,CAAC8D,IAAI,EAAEpD,CAAC,CAACT,CAAC,GAAGS,CAAC,CAACgC,CAAC,GAAC,CAAC,EAAEmB,KAAK,CAAC;QAE3CjE,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;UACzB,GAAGJ,SAAS;UACZK,IAAI,EAAE;YAAEC,IAAI,EAAE,YAAY;YAAE5D,MAAM;YAAE4C,IAAI;YAAEJ,KAAK,EAAEW,GAAG;YAAEzD;UAAK;QAC7D,CAAC,CAAC;MACJ,CAAC,MAAM,IAAImD,SAAS,IAAI9D,SAAS,CAAC0E,OAAO,KAAKzD,MAAM,EAAE;QACpD;QACA,MAAM6D,QAAQ,GAAGvB,kBAAkB,CAACC,MAAM,EAAEY,GAAG,EAAEnD,MAAM,CAAC;QACxDP,GAAG,CAACgB,SAAS,GAAG,uBAAuB;QACvChB,GAAG,CAACkB,IAAI,GAAG,iBAAiB;QAC5BlB,GAAG,CAACwC,SAAS,GAAG,QAAQ;QACxB,MAAMsB,KAAK,GAAGnD,CAAC,CAACR,CAAC,GAAGQ,CAAC,CAACiC,CAAC,GAAC,CAAC;QACzB5C,GAAG,CAACmB,QAAQ,CAACiD,QAAQ,EAAEzD,CAAC,CAACT,CAAC,GAAGS,CAAC,CAACgC,CAAC,GAAC,CAAC,EAAEmB,KAAK,CAAC;QAE1CjE,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;UACzB/D,CAAC,EAAES,CAAC,CAACT,CAAC;UAAEC,CAAC,EAAEQ,CAAC,CAACR,CAAC;UAAEwC,CAAC,EAAEhC,CAAC,CAACgC,CAAC;UAAEC,CAAC,EAAEjC,CAAC,CAACiC,CAAC;UAC9BsB,IAAI,EAAE;YAAEC,IAAI,EAAE,UAAU;YAAEhB,IAAI;YAAEJ,KAAK,EAAEW;UAAI;QAC7C,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;EACJ,CAAC,EAAE,CAACpE,SAAS,EAAEC,iBAAiB,EAAEQ,UAAU,EAAE8C,kBAAkB,CAAC,CAAC;EAElE,MAAMwB,UAAU,GAAG7F,WAAW,CAAEwB,GAA6B,IAAK;IAChE,MAAMsE,IAAI,GAAGrF,aAAa,CAACK,SAAS,CAACsE,KAAK,CAAC,CAAC,CAAC,CAAC;IAC9C,MAAMP,IAAI,GAAG3E,OAAO,CAAC,aAAa,CAAC;IACnC,IAAI,CAAC2E,IAAI,EAAE;IAEX,MAAMC,KAAK,GAAG3E,gBAAgB,CAAC0E,IAAI,CAAC;IACpCC,KAAK,CAACG,OAAO,CAAC,CAAC9C,CAAiD,EAAE4D,CAAS,KAAK;MAC9E,MAAMtE,IAAI,GAAGqE,IAAI,CAACC,CAAC,CAAC;MACpB,IAAI,CAACtE,IAAI,EAAE;MACX;MACA,MAAMuE,aAAa,GAAGlF,SAAS,CAACsE,KAAK,CAAC,CAAC,CAAC,CAACa,SAAS,CAACC,CAAC,IAAIA,CAAC,CAACC,GAAG,KAAK1E,IAAI,CAAC0E,GAAG,CAAC;MAC3E,MAAMC,KAAK,GAAGrF,iBAAiB,KAAKiF,aAAa;MACjD,MAAMX,SAAS,GAAG9D,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEU,CAAC,CAACT,CAAC,EAAES,CAAC,CAACR,CAAC,EAAEQ,CAAC,CAACgC,CAAC,EAAEiC,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;MACxE/E,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;QAAE,GAAGJ,SAAS;QAAEK,IAAI,EAAE;UAAEC,IAAI,EAAE,SAAS;UAAEpB,KAAK,EAAEyB,aAAa;UAAEvE;QAAK;MAAE,CAAC,CAAC;IACrG,CAAC,CAAC;EACJ,CAAC,EAAE,CAACX,SAAS,CAACsE,KAAK,EAAErE,iBAAiB,EAAEQ,UAAU,CAAC,CAAC;;EAEhD;EACJ,MAAM8E,UAAU,GAAGrG,WAAW,CAAEwB,GAA6B,IAAK;IAChE,MAAMsE,IAAI,GAAGrF,aAAa,CAACK,SAAS,CAACsE,KAAK,CAAC,CAAC,CAAC,CAAC;IAC9C,MAAMP,IAAI,GAAG3E,OAAO,CAAC,eAAe,CAAC;IACrC,IAAI,CAAC2E,IAAI,EAAE;IAEX,MAAMC,KAAK,GAAG3E,gBAAgB,CAAC0E,IAAI,CAAC;;IAEpC;IACA,MAAM,CAACnD,CAAC,EAAEC,CAAC,EAAEwC,CAAC,EAAEC,CAAC,CAAC,GAAGS,IAAI,CAACyB,MAAM;IAChC9E,GAAG,CAACgB,SAAS,GAAG,2BAA2B,CAAC,CAAC;IAC7ChB,GAAG,CAACiB,QAAQ,CAACf,CAAC,EAAEC,CAAC,EAAEwC,CAAC,EAAEC,CAAC,CAAC;IACxB5C,GAAG,CAACqC,WAAW,GAAG,0BAA0B;IAC5CrC,GAAG,CAAC0C,UAAU,CAACxC,CAAC,GAAG,GAAG,EAAEC,CAAC,GAAG,GAAG,EAAEwC,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAG,CAAC,CAAC;;IAE9C;IACA5C,GAAG,CAACgB,SAAS,GAAG,0BAA0B;IAC1ChB,GAAG,CAACkB,IAAI,GAAG,sBAAsB;IACjClB,GAAG,CAACwC,SAAS,GAAG,QAAQ;IACxBxC,GAAG,CAACmB,QAAQ,CAAC,eAAe,EAAEjB,CAAC,GAAGyC,CAAC,GAAC,CAAC,EAAExC,CAAC,GAAG,CAAC,CAAC;IAE7CmD,KAAK,CAACG,OAAO,CAAC,CAAC9C,CAAiD,EAAE4D,CAAS,KAAK;MAC9E,MAAMtE,IAAI,GAAGqE,IAAI,CAACC,CAAC,CAAC;MACpB,IAAI,CAACtE,IAAI,EAAE;MACX;MACA,MAAMuE,aAAa,GAAGlF,SAAS,CAACsE,KAAK,CAAC,CAAC,CAAC,CAACa,SAAS,CAACC,CAAC,IAAIA,CAAC,CAACC,GAAG,KAAK1E,IAAI,CAAC0E,GAAG,CAAC;MAC3E,MAAMC,KAAK,GAAGtF,SAAS,CAAC0E,OAAO,KAAK,CAAC,IAAIzE,iBAAiB,KAAKiF,aAAa;MAC5E,MAAMX,SAAS,GAAG9D,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEU,CAAC,CAACT,CAAC,EAAES,CAAC,CAACR,CAAC,EAAEQ,CAAC,CAACgC,CAAC,EAAEiC,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC;MACxE/E,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;QAAE,GAAGJ,SAAS;QAAEK,IAAI,EAAE;UAAEC,IAAI,EAAE,SAAS;UAAEpB,KAAK,EAAEyB,aAAa;UAAEvE;QAAK;MAAE,CAAC,CAAC;IACrG,CAAC,CAAC;EACJ,CAAC,EAAE,CAACX,SAAS,EAAEC,iBAAiB,EAAEQ,UAAU,CAAC,CAAC;EAC9C;EACA,MAAMgF,mBAAmB,GAAGvG,WAAW,CAAEwB,GAA6B,IAAK;IACzE,MAAMgF,KAAK,GAAG1F,SAAS,CAAC0F,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE;IACtC,MAAM3B,IAAI,GAAG3E,OAAO,CAAC,sBAAsB,CAAC;IAC5C,IAAI,CAAC2E,IAAI,EAAE;;IAEX;IACA,MAAM,CAAC4B,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC,GAAG/B,IAAI,CAACyB,MAAM;IACpC,MAAM7E,IAAI,GAAG+E,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;;IAEvB;IACAhF,GAAG,CAACgB,SAAS,GAAG,2BAA2B,CAAC,CAAC;IAC7ChB,GAAG,CAACiB,QAAQ,CAACgE,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;IAC5BpF,GAAG,CAACqC,WAAW,GAAG,0BAA0B;IAC5CrC,GAAG,CAAC0C,UAAU,CAACuC,EAAE,GAAG,GAAG,EAAEC,EAAE,GAAG,GAAG,EAAEC,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAG,CAAC,CAAC;;IAElD;IACApF,GAAG,CAACgB,SAAS,GAAG,0BAA0B;IAC1ChB,GAAG,CAACkB,IAAI,GAAG,iBAAiB;IAC5BlB,GAAG,CAACwC,SAAS,GAAG,MAAM;IACtBxC,GAAG,CAACmB,QAAQ,CAAC,cAAc,EAAE8D,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAGE,EAAE,GAAG,CAAC,CAAC;IAEjD,IAAInF,IAAI,EAAE;MACR,MAAM4D,SAAS,GAAG9D,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEgF,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC;MACjEtF,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;QAAE,GAAGJ,SAAS;QAAEK,IAAI,EAAE;UAAEC,IAAI,EAAE,SAAS;UAAEpB,KAAK,EAAE,CAAC;UAAE9C;QAAK;MAAE,CAAC,CAAC;IACzF;EACF,CAAC,EAAE,CAACX,SAAS,CAAC0F,KAAK,EAAEjF,UAAU,CAAC,CAAC;;EAEjC;EACA,MAAMsF,mBAAmB,GAAG7G,WAAW,CAAEwB,GAA6B,IAAK;IACzE,MAAMgF,KAAK,GAAG1F,SAAS,CAAC0F,KAAK,CAAC,CAAC,CAAC,IAAI,EAAE;IACtC,MAAM3B,IAAI,GAAG3E,OAAO,CAAC,wBAAwB,CAAC;IAC9C,IAAI,CAAC2E,IAAI,EAAE;;IAEX;IACA,MAAM,CAAC4B,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC,GAAG/B,IAAI,CAACyB,MAAM;IACpC,MAAM7E,IAAI,GAAG+E,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;;IAEvB;IACAhF,GAAG,CAACgB,SAAS,GAAG,2BAA2B,CAAC,CAAC;IAC7ChB,GAAG,CAACiB,QAAQ,CAACgE,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAEC,EAAE,CAAC;IAC5BpF,GAAG,CAACqC,WAAW,GAAG,0BAA0B;IAC5CrC,GAAG,CAAC0C,UAAU,CAACuC,EAAE,GAAG,GAAG,EAAEC,EAAE,GAAG,GAAG,EAAEC,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAG,CAAC,CAAC;;IAElD;IACApF,GAAG,CAACgB,SAAS,GAAG,0BAA0B;IAC1ChB,GAAG,CAACkB,IAAI,GAAG,iBAAiB;IAC5BlB,GAAG,CAACwC,SAAS,GAAG,MAAM;IACtBxC,GAAG,CAACmB,QAAQ,CAAC,cAAc,EAAE8D,EAAE,GAAG,CAAC,EAAEC,EAAE,GAAGE,EAAE,GAAG,CAAC,CAAC;IAEjD,IAAInF,IAAI,EAAE;MACR,MAAM4D,SAAS,GAAG9D,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEgF,EAAE,EAAEC,EAAE,EAAEC,EAAE,EAAE,KAAK,EAAE,KAAK,CAAC;MACjEtF,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;QAAE,GAAGJ,SAAS;QAAEK,IAAI,EAAE;UAAEC,IAAI,EAAE,SAAS;UAAEpB,KAAK,EAAE,CAAC;UAAE9C;QAAK;MAAE,CAAC,CAAC;IACzF;EACF,CAAC,EAAE,CAACX,SAAS,CAAC0F,KAAK,EAAEjF,UAAU,CAAC,CAAC;;EAEjC;EACA,MAAMuF,cAAc,GAAG9G,WAAW,CAAC,CACjCwB,GAA6B,EAC7B8C,MAAc,EACd7C,IAAiB,EACjBsF,SAAiB,EACjBhF,MAAc,KACX;IACH,MAAM8C,IAAI,GAAG3E,OAAO,CAACoE,MAAM,CAAC;IAC5B,IAAI,CAACO,IAAI,EAAE;IACX,MAAM,CAACnD,CAAC,EAAEC,CAAC,EAAEwC,CAAC,EAAEC,CAAC,CAAC,GAAGS,IAAI,CAACyB,MAAM;;IAEhC;IACA,IAAI9C,OAAO,GAAG,iBAAiB,CAAC,CAAC;IACjC,IAAIc,MAAM,CAACG,QAAQ,CAAC,YAAY,CAAC,EAAE;MACjCjB,OAAO,GAAG,yBAAyB,CAAC,CAAC;IACvC,CAAC,MAAM,IAAIc,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;MACpCjB,OAAO,GAAG,uBAAuB,CAAC,CAAC;IACrC,CAAC,MAAM,IAAIc,MAAM,CAACG,QAAQ,CAAC,SAAS,CAAC,EAAE;MACrCjB,OAAO,GAAG,0BAA0B,CAAC,CAAC;IACxC,CAAC,MAAM,IAAIc,MAAM,CAACG,QAAQ,CAAC,WAAW,CAAC,EAAE;MACvC;MACA,IAAIH,MAAM,CAACG,QAAQ,CAAC,YAAY,CAAC,EAAE;QACjCjB,OAAO,GAAG,yBAAyB;MACrC,CAAC,MAAM,IAAIc,MAAM,CAACG,QAAQ,CAAC,QAAQ,CAAC,EAAE;QACpCjB,OAAO,GAAG,uBAAuB;MACnC;IACF;IAEAhC,GAAG,CAACgB,SAAS,GAAGgB,OAAO;IACvBhC,GAAG,CAACiB,QAAQ,CAACf,CAAC,EAAEC,CAAC,EAAEwC,CAAC,EAAEC,CAAC,CAAC;;IAExB;IACA5C,GAAG,CAACqC,WAAW,GAAG,wBAAwB;IAC1CrC,GAAG,CAAC0C,UAAU,CAACxC,CAAC,GAAG,GAAG,EAAEC,CAAC,GAAG,GAAG,EAAEwC,CAAC,GAAG,CAAC,EAAEC,CAAC,GAAG,CAAC,CAAC;IAE9C,IAAI3C,IAAI,EAAE;MACR,MAAM0D,UAAU,GAAGpD,MAAM,KAAK,CAAC,IAAIhB,iBAAiB,KAAK,IAAI,IAAID,SAAS,CAACsE,KAAK,CAAC,CAAC,CAAC,CAACrE,iBAAiB,CAAC,KAAKU,IAAI;MAC/G,MAAM4D,SAAS,GAAG9D,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEC,CAAC,EAAEC,CAAC,EAAEwC,CAAC,EAAEgB,UAAU,EAAE,KAAK,CAAC;;MAEnE;MACA3D,GAAG,CAACgB,SAAS,GAAG,uBAAuB;MACvChB,GAAG,CAACkB,IAAI,GAAG,sBAAsB;MACjClB,GAAG,CAACwC,SAAS,GAAG,QAAQ;MACxB,MAAMsB,KAAK,GAAG3D,CAAC,GAAGyC,CAAC,GAAG,EAAE;MACxB5C,GAAG,CAACmB,QAAQ,CAAClB,IAAI,CAAC8D,IAAI,EAAE7D,CAAC,GAAGyC,CAAC,GAAC,CAAC,EAAEmB,KAAK,CAAC;MAEvCjE,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;QAAE,GAAGJ,SAAS;QAAEK,IAAI,EAAE;UAAEC,IAAI,EAAE,WAAW;UAAEqB,IAAI,EAAED,SAAS;UAAEtF;QAAK;MAAE,CAAC,CAAC;;MAEhG;MACA,IAAIsF,SAAS,KAAK,SAAS,IAAIjG,SAAS,CAAC0E,OAAO,KAAKzD,MAAM,EAAE;QAC3DV,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;UACzB/D,CAAC;UAAEC,CAAC;UAAEwC,CAAC;UAAEC,CAAC;UACVsB,IAAI,EAAE;YAAEC,IAAI,EAAE,kBAAkB;YAAE5D,MAAM;YAAEN;UAAK;QACjD,CAAC,CAAC;MACJ;IACF,CAAC,MAAM,IAAIX,SAAS,CAAC0E,OAAO,KAAKzD,MAAM,EAAE;MACvC;MACA,MAAM6D,QAAQ,GAAGvB,kBAAkB,CAACC,MAAM,EAAE,CAAC,EAAEvC,MAAM,CAAC;MACtDP,GAAG,CAACgB,SAAS,GAAG,uBAAuB;MACvChB,GAAG,CAACkB,IAAI,GAAG,iBAAiB;MAC5BlB,GAAG,CAACwC,SAAS,GAAG,QAAQ;MACxB,MAAMsB,KAAK,GAAG3D,CAAC,GAAGyC,CAAC,GAAC,CAAC;MACrB5C,GAAG,CAACmB,QAAQ,CAACiD,QAAQ,EAAElE,CAAC,GAAGyC,CAAC,GAAC,CAAC,EAAEmB,KAAK,CAAC;MAEtCjE,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;QAAE/D,CAAC;QAAEC,CAAC;QAAEwC,CAAC;QAAEC,CAAC;QAAEsB,IAAI,EAAE;UAAEC,IAAI,EAAE,YAAY;UAAEqB,IAAI,EAAED;QAAU;MAAE,CAAC,CAAC;IAC3F;EACF,CAAC,EAAE,CAAChG,iBAAiB,EAAED,SAAS,EAAES,UAAU,EAAE8C,kBAAkB,CAAC,CAAC;;EAElE;EACA,MAAM4C,oBAAoB,GAAGjH,WAAW,CAAEwB,GAA6B,IAAK;IAC1EsF,cAAc,CAACtF,GAAG,EAAE,kCAAkC,EAAEV,SAAS,CAACoG,cAAc,CAAC,CAAC,CAAC,CAACC,UAAU,EAAE,sBAAsB,EAAE,CAAC,CAAC;IAC1HL,cAAc,CAACtF,GAAG,EAAE,8BAA8B,EAAEV,SAAS,CAACoG,cAAc,CAAC,CAAC,CAAC,CAACE,MAAM,EAAE,kBAAkB,EAAE,CAAC,CAAC;EAChH,CAAC,EAAE,CAACtG,SAAS,CAACoG,cAAc,EAAEJ,cAAc,CAAC,CAAC;;EAE9C;EACA,MAAMO,oBAAoB,GAAGrH,WAAW,CAAEwB,GAA6B,IAAK;IAC1EsF,cAAc,CAACtF,GAAG,EAAE,oCAAoC,EAAEV,SAAS,CAACoG,cAAc,CAAC,CAAC,CAAC,CAACC,UAAU,EAAE,sBAAsB,EAAE,CAAC,CAAC;IAC5HL,cAAc,CAACtF,GAAG,EAAE,gCAAgC,EAAEV,SAAS,CAACoG,cAAc,CAAC,CAAC,CAAC,CAACE,MAAM,EAAE,kBAAkB,EAAE,CAAC,CAAC;EAClH,CAAC,EAAE,CAACtG,SAAS,CAACoG,cAAc,EAAEJ,cAAc,CAAC,CAAC;;EAE9C;EACA,MAAMQ,gBAAgB,GAAGtH,WAAW,CAAEwB,GAA6B,IAAK;IACtE;IACA,MAAM+F,gBAAgB,GAAGzG,SAAS,CAACkE,KAAK,CAAC,CAAC,CAAC,CAACwC,MAAM,CAAC,CAAC,CAAC;IACrD,MAAMC,aAAa,GAAG3G,SAAS,CAACkE,KAAK,CAAC,CAAC,CAAC,CAACwC,MAAM,CAAC,CAAC,CAAC;IAElDV,cAAc,CAACtF,GAAG,EAAE,qBAAqB,EAAE+F,gBAAgB,EAAE,SAAS,EAAE,CAAC,CAAC;IAC1ET,cAAc,CAACtF,GAAG,EAAE,uBAAuB,EAAEiG,aAAa,EAAE,SAAS,EAAE,CAAC,CAAC;EAC3E,CAAC,EAAE,CAAC3G,SAAS,CAACkE,KAAK,EAAE8B,cAAc,CAAC,CAAC;;EAErC;EACA,MAAMY,iCAAiC,GAAG1H,WAAW,CAAE+B,MAAc,IAAK;IACxE,MAAMiD,KAAK,GAAGlE,SAAS,CAACkE,KAAK,CAACjD,MAAM,CAAC;IACrC,MAAMmF,cAAc,GAAGpG,SAAS,CAACoG,cAAc,CAACnF,MAAM,CAAC;IACvD,MAAM4F,QAAQ,GAAG,CACf,GAAG3C,KAAK,CAAC4C,KAAK,EACd,GAAG5C,KAAK,CAAC6C,MAAM,EACfX,cAAc,CAACC,UAAU,EACzBD,cAAc,CAACE,MAAM,CACtB,CAACU,MAAM,CAAC5B,CAAC,IAAIA,CAAC,IAAIA,CAAC,CAAC5D,IAAI,KAAK,KAAK,CAAqB;IAExD,MAAMyF,QAAQ,GAAG,IAAIC,GAAG,CAAS,CAAC;IAClC,MAAMC,aAAa,GAAG,IAAID,GAAG,CAAS,CAAC;IAEvCL,QAAQ,CAAC1C,OAAO,CAACxD,IAAI,IAAI;MACvB,IAAI,CAACA,IAAI,CAACsB,WAAW,EAAE;QACrB;QACA,IAAItB,IAAI,CAACyG,GAAG,KAAK,YAAY,EAAE;UAC7BH,QAAQ,CAACI,GAAG,CAAC,YAAY,CAAC;QAC5B;QACA,IAAI1G,IAAI,CAACyG,GAAG,KAAK,UAAU,EAAE;UAC3BH,QAAQ,CAACI,GAAG,CAAC,UAAU,CAAC;QAC1B;;QAEA;QACA,IAAInD,KAAK,CAAC4C,KAAK,CAACnD,QAAQ,CAAChD,IAAI,CAAC,EAAE;UAC9B,MAAM2G,UAAU,GAAG3G,IAAW;UAC9B,IAAI2G,UAAU,CAACF,GAAG,EAAE;YAClB;YACA,MAAMG,aAAa,GAAG,CAAC,WAAW,EAAE,YAAY,EAAE,cAAc,EAAE,gBAAgB,EAAE,eAAe,EAAE,YAAY,EAAE,iBAAiB,EAAE,cAAc,EAAE,SAAS,EAAE,cAAc,EAAE,kBAAkB,CAAC;YACpM,IAAIA,aAAa,CAAC5D,QAAQ,CAAC2D,UAAU,CAAC7C,IAAI,CAAC,EAAE;cAC3C0C,aAAa,CAACE,GAAG,CAAC,UAAU,CAAC;YAC/B;;YAEA;YACA,MAAMG,aAAa,GAAG,CAAC,iBAAiB,EAAE,UAAU,EAAE,YAAY,EAAE,SAAS,CAAC;YAC9E,IAAIA,aAAa,CAAC7D,QAAQ,CAAC2D,UAAU,CAAC7C,IAAI,CAAC,EAAE;cAC3C0C,aAAa,CAACE,GAAG,CAAC,WAAW,CAAC;YAChC;;YAEA;YACA,MAAMI,aAAa,GAAG,CAAC,gBAAgB,EAAE,kBAAkB,EAAE,WAAW,EAAE,gBAAgB,CAAC;YAC3F,IAAIA,aAAa,CAAC9D,QAAQ,CAAC2D,UAAU,CAAC7C,IAAI,CAAC,EAAE;cAC3C0C,aAAa,CAACE,GAAG,CAAC,UAAU,CAAC;YAC/B;;YAEA;YACA,MAAMK,QAAQ,GAAG,CAAC,YAAY,EAAE,cAAc,EAAE,iBAAiB,EAAE,cAAc,EAAE,eAAe,CAAC;YACnG,IAAIA,QAAQ,CAAC/D,QAAQ,CAAC2D,UAAU,CAAC7C,IAAI,CAAC,EAAE;cACtC0C,aAAa,CAACE,GAAG,CAAC,gBAAgB,CAAC;YACrC;;YAEA;YACA,MAAMM,iBAAiB,GAAG,CAAC,iBAAiB,EAAE,cAAc,EAAE,gBAAgB,EAAE,gBAAgB,EAAE,mBAAmB,EAAE,WAAW,EAAE,gBAAgB,EAAE,eAAe,CAAC;YACtK,IAAIA,iBAAiB,CAAChE,QAAQ,CAAC2D,UAAU,CAAC7C,IAAI,CAAC,EAAE;cAC/C0C,aAAa,CAACE,GAAG,CAAC,aAAa,CAAC;YAClC;;YAEA;YACA,MAAMO,UAAU,GAAG,CAAC,eAAe,CAAC;YACpC,IAAIA,UAAU,CAACjE,QAAQ,CAAC2D,UAAU,CAAC7C,IAAI,CAAC,EAAE;cACxC0C,aAAa,CAACE,GAAG,CAAC,QAAQ,CAAC;YAC7B;UACF;QACF;MACF;IACF,CAAC,CAAC;IAEF,OAAO;MACLJ,QAAQ,EAAEY,KAAK,CAACC,IAAI,CAACb,QAAQ,CAAC;MAC9BE,aAAa,EAAEU,KAAK,CAACC,IAAI,CAACX,aAAa;IACzC,CAAC;EACH,CAAC,EAAE,CAACnH,SAAS,CAAC,CAAC;;EAEf;EACA,MAAM+H,cAAc,GAAG7I,WAAW,CAAEwB,GAA6B,IAAK;IACpE,MAAM;MAAEuG,QAAQ;MAAEE;IAAc,CAAC,GAAGP,iCAAiC,CAAC,CAAC,CAAC;;IAExE;IACA,MAAMoB,SAAS,GAAG,IAAI,GAAG,GAAG,GAAG,EAAE,CAAC,CAAC;IACnC,MAAMC,SAAS,GAAG,GAAG,CAAC,CAAC;IACvB,MAAMC,SAAS,GAAG,GAAG;IACrB,MAAMC,SAAS,GAAG,GAAG;;IAErB;IACAzH,GAAG,CAACgB,SAAS,GAAG,yBAAyB;IACzChB,GAAG,CAACiB,QAAQ,CAACqG,SAAS,EAAEC,SAAS,EAAEC,SAAS,EAAEC,SAAS,CAAC;IACxDzH,GAAG,CAACqC,WAAW,GAAG,wBAAwB;IAC1CrC,GAAG,CAAC0C,UAAU,CAAC4E,SAAS,GAAG,GAAG,EAAEC,SAAS,GAAG,GAAG,EAAEC,SAAS,GAAG,CAAC,EAAEC,SAAS,GAAG,CAAC,CAAC;;IAE9E;IACAzH,GAAG,CAACgB,SAAS,GAAG,wBAAwB;IACxChB,GAAG,CAACkB,IAAI,GAAG,sBAAsB;IACjClB,GAAG,CAACwC,SAAS,GAAG,QAAQ;IACxBxC,GAAG,CAACmB,QAAQ,CAAC,WAAW,EAAEmG,SAAS,GAAGE,SAAS,GAAC,CAAC,EAAED,SAAS,GAAG,EAAE,CAAC;;IAElE;IACAvH,GAAG,CAACgB,SAAS,GAAG,0BAA0B;IAC1ChB,GAAG,CAACkB,IAAI,GAAG,iBAAiB;IAC5BlB,GAAG,CAACwC,SAAS,GAAG,MAAM;IACtB,IAAI+D,QAAQ,CAACmB,MAAM,GAAG,CAAC,EAAE;MACvBnB,QAAQ,CAAC9C,OAAO,CAAC,CAACkE,OAAO,EAAEjE,GAAG,KAAK;QACjC1D,GAAG,CAACmB,QAAQ,CAAC,KAAKwG,OAAO,EAAE,EAAEL,SAAS,GAAG,CAAC,EAAEC,SAAS,GAAG,EAAE,GAAG7D,GAAG,GAAG,EAAE,CAAC;MACxE,CAAC,CAAC;IACJ,CAAC,MAAM;MACL1D,GAAG,CAACgB,SAAS,GAAG,0BAA0B;MAC1ChB,GAAG,CAACmB,QAAQ,CAAC,eAAe,EAAEmG,SAAS,GAAG,CAAC,EAAEC,SAAS,GAAG,EAAE,CAAC;MAC5DvH,GAAG,CAACmB,QAAQ,CAAC,iBAAiB,EAAEmG,SAAS,GAAG,CAAC,EAAEC,SAAS,GAAG,EAAE,CAAC;IAChE;;IAEA;IACA,MAAMK,SAAS,GAAG,IAAI,GAAG,GAAG,GAAG,EAAE;IACjC,MAAMC,SAAS,GAAG,GAAG,CAAC,CAAC;IACvB,MAAMC,SAAS,GAAG,GAAG;IACrB,MAAMC,SAAS,GAAG,GAAG;;IAErB;IACA/H,GAAG,CAACgB,SAAS,GAAG,uBAAuB;IACvChB,GAAG,CAACiB,QAAQ,CAAC2G,SAAS,EAAEC,SAAS,EAAEC,SAAS,EAAEC,SAAS,CAAC;IACxD/H,GAAG,CAACqC,WAAW,GAAG,sBAAsB;IACxCrC,GAAG,CAAC0C,UAAU,CAACkF,SAAS,GAAG,GAAG,EAAEC,SAAS,GAAG,GAAG,EAAEC,SAAS,GAAG,CAAC,EAAEC,SAAS,GAAG,CAAC,CAAC;;IAE9E;IACA/H,GAAG,CAACgB,SAAS,GAAG,sBAAsB;IACtChB,GAAG,CAACkB,IAAI,GAAG,sBAAsB;IACjClB,GAAG,CAACwC,SAAS,GAAG,QAAQ;IACxBxC,GAAG,CAACmB,QAAQ,CAAC,gBAAgB,EAAEyG,SAAS,GAAGE,SAAS,GAAC,CAAC,EAAED,SAAS,GAAG,EAAE,CAAC;;IAEvE;IACA7H,GAAG,CAACgB,SAAS,GAAG,0BAA0B;IAC1ChB,GAAG,CAACkB,IAAI,GAAG,iBAAiB;IAC5BlB,GAAG,CAACwC,SAAS,GAAG,MAAM;IACtB,IAAIiE,aAAa,CAACiB,MAAM,GAAG,CAAC,EAAE;MAC5BjB,aAAa,CAAChD,OAAO,CAAC,CAACuE,WAAW,EAAEtE,GAAG,KAAK;QAC1C,MAAMuE,WAAW,GAAGD,WAAW,CAACN,MAAM,GAAG,EAAE,GAAGM,WAAW,CAACE,SAAS,CAAC,CAAC,EAAE,EAAE,CAAC,GAAG,KAAK,GAAGF,WAAW;QAChGhI,GAAG,CAACmB,QAAQ,CAAC,KAAK8G,WAAW,EAAE,EAAEL,SAAS,GAAG,CAAC,EAAEC,SAAS,GAAG,EAAE,GAAGnE,GAAG,GAAG,EAAE,CAAC;MAC5E,CAAC,CAAC;IACJ,CAAC,MAAM;MACL1D,GAAG,CAACgB,SAAS,GAAG,0BAA0B;MAC1ChB,GAAG,CAACmB,QAAQ,CAAC,eAAe,EAAEyG,SAAS,GAAG,CAAC,EAAEC,SAAS,GAAG,EAAE,CAAC;MAC5D7H,GAAG,CAACmB,QAAQ,CAAC,iBAAiB,EAAEyG,SAAS,GAAG,CAAC,EAAEC,SAAS,GAAG,EAAE,CAAC;IAChE;EACF,CAAC,EAAE,CAAC3B,iCAAiC,CAAC,CAAC;EAEvC,MAAMiC,IAAI,GAAG3J,WAAW,CAAC,MAAM;IAAA,IAAA4J,kBAAA,EAAAC,mBAAA;IAC7B,MAAMC,MAAM,GAAG1I,SAAS,CAACoE,OAAO;IAChC,IAAI,CAACsE,MAAM,EAAE;IAEb,MAAMtI,GAAG,GAAGsI,MAAM,CAACC,UAAU,CAAC,IAAI,CAAC;IACnC,IAAI,CAACvI,GAAG,EAAE;;IAEV;IACAA,GAAG,CAACwI,SAAS,CAAC,CAAC,EAAE,CAAC,EAAEF,MAAM,CAACG,KAAK,EAAEH,MAAM,CAACI,MAAM,CAAC;;IAEhD;IACA7I,aAAa,CAACmE,OAAO,GAAG,EAAE;;IAE1B;IACA,IAAI,CAAAoE,kBAAA,GAAA3J,MAAM,CAACkK,UAAU,cAAAP,kBAAA,eAAjBA,kBAAA,CAAmBQ,OAAO,KAAAP,mBAAA,GAAI5J,MAAM,CAACkK,UAAU,cAAAN,mBAAA,eAAjBA,mBAAA,CAAmBQ,GAAG,EAAE;MACxD,IAAI/I,kBAAkB,CAACkE,OAAO,EAAE;QAC9BhE,GAAG,CAAC8I,SAAS,CAAChJ,kBAAkB,CAACkE,OAAO,EAAE,CAAC,EAAE,CAAC,EAAEsE,MAAM,CAACG,KAAK,EAAEH,MAAM,CAACI,MAAM,CAAC;MAC9E,CAAC,MAAM;QACL1I,GAAG,CAACgB,SAAS,GAAG,SAAS;QACzBhB,GAAG,CAACiB,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAEqH,MAAM,CAACG,KAAK,EAAEH,MAAM,CAACI,MAAM,CAAC;MACjD;IACF,CAAC,MAAM;MACL1I,GAAG,CAACgB,SAAS,GAAG,SAAS;MACzBhB,GAAG,CAACiB,QAAQ,CAAC,CAAC,EAAE,CAAC,EAAEqH,MAAM,CAACG,KAAK,EAAEH,MAAM,CAACI,MAAM,CAAC;IACjD;;IAEA;IACA,MAAM;MAAEK,KAAK;MAAEC,OAAO;MAAEC;IAAQ,CAAC,GAAGrK,cAAc,CAAC0J,MAAM,CAACG,KAAK,EAAEH,MAAM,CAACI,MAAM,CAAC;IAC/E1I,GAAG,CAACkJ,IAAI,CAAC,CAAC;IACVlJ,GAAG,CAACmJ,SAAS,CAACH,OAAO,EAAEC,OAAO,CAAC;IAC/BjJ,GAAG,CAAC+I,KAAK,CAACA,KAAK,EAAEA,KAAK,CAAC;;IAEvB;IACA;IACA,MAAMK,mBAAmB,GAAGtK,cAAc,CAAC,UAAU,CAAC;IACtD,MAAMuK,gBAAgB,GAAGtK,kBAAkB,CAAC,UAAU,CAAC;;IAEvD;IACAqK,mBAAmB,CAAC3F,OAAO,CAAC,CAAC9C,CAAiD,EAAE+C,GAAW,KAAK;MAC9F,MAAMzD,IAAI,GAAGX,SAAS,CAACkE,KAAK,CAAC,CAAC,CAAC,CAAC4C,KAAK,CAAC1C,GAAG,CAAC;MAC1C,IAAIzD,IAAI,EAAE;QACRF,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEU,CAAC,CAACT,CAAC,EAAES,CAAC,CAACR,CAAC,EAAEQ,CAAC,CAACgC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;MACvD;IACF,CAAC,CAAC;;IAEF;IACA0G,gBAAgB,CAAC5F,OAAO,CAAC,CAAC9C,CAAiD,EAAE+C,GAAW,KAAK;MAC3F,MAAMzD,IAAI,GAAGX,SAAS,CAACkE,KAAK,CAAC,CAAC,CAAC,CAAC6C,MAAM,CAAC3C,GAAG,CAAC;MAC3C,IAAIzD,IAAI,EAAE;QACRF,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEU,CAAC,CAACT,CAAC,EAAES,CAAC,CAACR,CAAC,EAAEQ,CAAC,CAACgC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;MACvD;IACF,CAAC,CAAC;;IAEF;IACAkD,oBAAoB,CAAC7F,GAAG,CAAC;;IAEzB;IACA;IACA,MAAMsJ,iBAAiB,GAAGxK,cAAc,CAAC,QAAQ,CAAC;IAClD,MAAMyK,cAAc,GAAGxK,kBAAkB,CAAC,QAAQ,CAAC;;IAEnD;IACAuK,iBAAiB,CAAC7F,OAAO,CAAC,CAAC9C,CAAiD,EAAE+C,GAAW,KAAK;MAC5F,MAAMzD,IAAI,GAAGX,SAAS,CAACkE,KAAK,CAAC,CAAC,CAAC,CAAC4C,KAAK,CAAC1C,GAAG,CAAC;MAC1C,IAAIzD,IAAI,EAAE;QACR,MAAM4D,SAAS,GAAG9D,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEU,CAAC,CAACT,CAAC,EAAES,CAAC,CAACR,CAAC,EAAEQ,CAAC,CAACgC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;QACvE9C,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;UACzB,GAAGJ,SAAS;UACZK,IAAI,EAAE;YAAEC,IAAI,EAAE,UAAU;YAAE5D,MAAM,EAAE,CAAC;YAAE4C,IAAI,EAAE,OAAO;YAAEJ,KAAK,EAAEW;UAAI;QACjE,CAAC,CAAC;MACJ,CAAC,MAAM;QACL;QACA7D,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;UACzB/D,CAAC,EAAES,CAAC,CAACT,CAAC;UAAEC,CAAC,EAAEQ,CAAC,CAACR,CAAC;UAAEwC,CAAC,EAAEhC,CAAC,CAACgC,CAAC;UAAEC,CAAC,EAAEjC,CAAC,CAACiC,CAAC;UAC9BsB,IAAI,EAAE;YAAEC,IAAI,EAAE,UAAU;YAAE5D,MAAM,EAAE,CAAC;YAAE4C,IAAI,EAAE,OAAO;YAAEJ,KAAK,EAAEW;UAAI;QACjE,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;;IAEF;IACA6F,cAAc,CAAC9F,OAAO,CAAC,CAAC9C,CAAiD,EAAE+C,GAAW,KAAK;MACzF,MAAMzD,IAAI,GAAGX,SAAS,CAACkE,KAAK,CAAC,CAAC,CAAC,CAAC6C,MAAM,CAAC3C,GAAG,CAAC;MAC3C,IAAIzD,IAAI,EAAE;QACR,MAAM4D,SAAS,GAAG9D,UAAU,CAACC,GAAG,EAAEC,IAAI,EAAEU,CAAC,CAACT,CAAC,EAAES,CAAC,CAACR,CAAC,EAAEQ,CAAC,CAACgC,CAAC,EAAE,KAAK,EAAE,KAAK,EAAE,CAAC,CAAC;QACvE9C,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;UACzB,GAAGJ,SAAS;UACZK,IAAI,EAAE;YAAEC,IAAI,EAAE,UAAU;YAAE5D,MAAM,EAAE,CAAC;YAAE4C,IAAI,EAAE,QAAQ;YAAEJ,KAAK,EAAEW;UAAI;QAClE,CAAC,CAAC;MACJ,CAAC,MAAM;QACL;QACA7D,aAAa,CAACmE,OAAO,CAACC,IAAI,CAAC;UACzB/D,CAAC,EAAES,CAAC,CAACT,CAAC;UAAEC,CAAC,EAAEQ,CAAC,CAACR,CAAC;UAAEwC,CAAC,EAAEhC,CAAC,CAACgC,CAAC;UAAEC,CAAC,EAAEjC,CAAC,CAACiC,CAAC;UAC9BsB,IAAI,EAAE;YAAEC,IAAI,EAAE,UAAU;YAAE5D,MAAM,EAAE,CAAC;YAAE4C,IAAI,EAAE,QAAQ;YAAEJ,KAAK,EAAEW;UAAI;QAClE,CAAC,CAAC;MACJ;IACF,CAAC,CAAC;;IAEF;IACA+B,oBAAoB,CAACzF,GAAG,CAAC;;IAEzB;IACA8F,gBAAgB,CAAC9F,GAAG,CAAC;;IAErB;IACA+E,mBAAmB,CAAC/E,GAAG,CAAC;;IAExB;IACA,IAAIN,OAAO,EAAE;MACX2F,mBAAmB,CAACrF,GAAG,CAAC;IAC1B;;IAEA;IACAqE,UAAU,CAACrE,GAAG,CAAC;;IAEf;IACA,IAAIN,OAAO,EAAE;MACXmF,UAAU,CAAC7E,GAAG,CAAC;IACjB;;IAEA;IACAqH,cAAc,CAACrH,GAAG,CAAC;IAEnBA,GAAG,CAACwJ,OAAO,CAAC,CAAC;;IAEb;IACCC,MAAM,CAASC,iBAAiB,GAAG;MAClCC,WAAW,EAAE/K,cAAc,CAAC0J,MAAM,CAACG,KAAK,EAAEH,MAAM,CAACI,MAAM,CAAC;MACxDkB,UAAU,EAAE;QAAEnB,KAAK,EAAEH,MAAM,CAACG,KAAK;QAAEC,MAAM,EAAEJ,MAAM,CAACI;MAAO,CAAC;MAC1DmB,KAAK,EAAEpL,MAAM,CAACoL,KAAK;MACnBC,UAAU,EAAEjK,aAAa,CAACmE,OAAO,CAAC+F,KAAK,CAAC,CAAC,EAAE,IAAI;IACjD,CAAC;;IAED;IACA,IAAI;MACF,MAAMC,SAAS,GAAGnK,aAAa,CAACmE,OAAO,CAACsC,MAAM,CAAC2D,CAAC,IAAIA,CAAC,CAAC/F,IAAI,IAAI+F,CAAC,CAAC/F,IAAI,CAACC,IAAI,KAAK,SAAS,CAAC;MACxF,MAAM+F,MAAM,GAAGF,SAAS,CAACG,GAAG,CAACF,CAAC;QAAA,IAAAG,gBAAA;QAAA,OAAKH,CAAC,CAAC/F,IAAI,CAACjE,IAAI,MAAAmK,gBAAA,GAAKH,CAAC,CAAC/F,IAAI,CAACjE,IAAI,CAAC0E,GAAG,cAAAyF,gBAAA,cAAAA,gBAAA,GAAIH,CAAC,CAAC/F,IAAI,CAACjE,IAAI,CAACoK,EAAE,CAAC;MAAA,CAAE,CAAC,CAAC/D,MAAM,CAACgE,OAAO,CAAC;MACxG,MAAMC,SAAS,GAAGjL,SAAS,CAACsE,KAAK,IAAItE,SAAS,CAACsE,KAAK,CAAC,CAAC,CAAC,GAAGtE,SAAS,CAACsE,KAAK,CAAC,CAAC,CAAC,GAAG,EAAE;MACjF,MAAM4G,SAAS,GAAGD,SAAS,CAACJ,GAAG,CAAEzF,CAAM;QAAA,IAAA+F,MAAA;QAAA,QAAAA,MAAA,GAAK/F,CAAC,CAACC,GAAG,cAAA8F,MAAA,cAAAA,MAAA,GAAI/F,CAAC,CAAC2F,EAAE;MAAA,EAAC,CAAC/D,MAAM,CAACgE,OAAO,CAAC;MAE1E,MAAMI,cAAc,GAAGR,MAAM,CAAC5D,MAAM,CAAEqE,CAAM,IAAK,CAACH,SAAS,CAACvH,QAAQ,CAAC0H,CAAC,CAAC,CAAC;MACxE,MAAMC,WAAW,GAAGJ,SAAS,CAAClE,MAAM,CAAEqE,CAAM,IAAK,CAACT,MAAM,CAACjH,QAAQ,CAAC0H,CAAC,CAAC,CAAC;MAErE,IAAIT,MAAM,CAACxC,MAAM,KAAK8C,SAAS,CAAC9C,MAAM,IAAIgD,cAAc,CAAChD,MAAM,GAAG,CAAC,IAAIkD,WAAW,CAAClD,MAAM,GAAG,CAAC,EAAE;QAAA,IAAAmD,gBAAA;QAC7F,MAAMC,QAAQ,GAAG;UACfC,EAAE,EAAEC,IAAI,CAACC,GAAG,CAAC,CAAC;UACdC,OAAO,EAAEhB,MAAM,CAACxC,MAAM;UACtByD,UAAU,EAAEX,SAAS,CAAC9C,MAAM;UAC5BwC,MAAM;UACNM,SAAS;UACTE,cAAc;UACdE,WAAW;UACXQ,KAAK,EAAG,IAAIC,KAAK,CAAC,gBAAgB,CAAC,CAAED;QACvC,CAAC;QACA3B,MAAM,CAASC,iBAAiB,GAAG;UAClC,GAAID,MAAM,CAASC,iBAAiB;UACpCoB,QAAQ,EAAE,CAAE,IAAG,EAAAD,gBAAA,GAACpB,MAAM,CAASC,iBAAiB,cAAAmB,gBAAA,uBAAjCA,gBAAA,CAAmCC,QAAQ,KAAI,EAAE,EAAE,CAACf,KAAK,CAAC,CAAC,EAAE,CAAC,CAACuB,MAAM,CAAC,CAACR,QAAQ,CAAC;QACjG,CAAC;QACD;QACAS,OAAO,CAACC,IAAI,CAAC,+CAA+C,EAAEV,QAAQ,CAAC;MACzE;IACF,CAAC,CAAC,OAAOW,CAAC,EAAE;MACV;MACAF,OAAO,CAACG,KAAK,CAAC,kBAAkB,EAAED,CAAC,CAAC;IACtC;EACF,CAAC,EAAE,CAACvI,QAAQ,EAAEmB,UAAU,EAAEQ,UAAU,EAAEE,mBAAmB,EAAEM,mBAAmB,EAAEI,oBAAoB,EAAEI,oBAAoB,EAAEC,gBAAgB,EAAEuB,cAAc,EAAE3H,OAAO,EAAEJ,SAAS,CAACsE,KAAK,CAAC,CAAC;EAExL,MAAM+H,mBAAmB,GAAG,KAAK,CAAC,CAAC;;EAEnC;EACApN,SAAS,CAAC,MAAM;IAAA,IAAAqN,mBAAA,EAAAC,mBAAA;IACd,IAAI,CAAAD,mBAAA,GAAAnN,MAAM,CAACkK,UAAU,cAAAiD,mBAAA,eAAjBA,mBAAA,CAAmBhD,OAAO,KAAAiD,mBAAA,GAAIpN,MAAM,CAACkK,UAAU,cAAAkD,mBAAA,eAAjBA,mBAAA,CAAmBhD,GAAG,EAAE;MACxD,MAAMiD,GAAG,GAAG,IAAIC,KAAK,CAAC,CAAC;MACvBD,GAAG,CAACE,MAAM,GAAG,MAAM;QAAElM,kBAAkB,CAACkE,OAAO,GAAG8H,GAAG;QAAEG,qBAAqB,CAAC9D,IAAI,CAAC;MAAE,CAAC;MACrF2D,GAAG,CAACI,OAAO,GAAG,MAAM;QAAA,IAAAC,mBAAA;QAAEZ,OAAO,CAACC,IAAI,CAAC,iCAAiC,GAAAW,mBAAA,GAAE1N,MAAM,CAACkK,UAAU,cAAAwD,mBAAA,uBAAjBA,mBAAA,CAAmBtD,GAAG,CAAC;MAAE,CAAC;MAChGiD,GAAG,CAACjD,GAAG,GAAGpK,MAAM,CAACkK,UAAU,CAACE,GAAa;IAC3C;EACF,CAAC,EAAE,CAACV,IAAI,CAAC,CAAC;EAEV,MAAMiE,eAAe,GAAG5N,WAAW,CAAE0F,IAAS,IAAK;IACjD;IACA,IAAIA,IAAI,CAACC,IAAI,KAAK,SAAS,EAAE;MAAA,IAAAkI,cAAA,EAAAC,UAAA,EAAAC,WAAA,EAAAC,gBAAA;MAC3B,MAAM7H,GAAG,IAAA0H,cAAA,IAAAC,UAAA,GAAGpI,IAAI,CAACjE,IAAI,cAAAqM,UAAA,uBAATA,UAAA,CAAW3H,GAAG,cAAA0H,cAAA,cAAAA,cAAA,IAAAE,WAAA,GAAIrI,IAAI,CAACjE,IAAI,cAAAsM,WAAA,uBAATA,WAAA,CAAWlC,EAAE;MAC3C,MAAME,SAAS,GAAG,EAAAiC,gBAAA,GAAAlN,SAAS,CAACsE,KAAK,cAAA4I,gBAAA,uBAAfA,gBAAA,CAAkB,CAAC,CAAC,KAAI,EAAE;MAC5C,MAAMC,UAAU,GAAGlC,SAAS,CAAC9F,SAAS,CAAEC,CAAM;QAAA,IAAAgI,OAAA;QAAA,OAAK,EAAAA,OAAA,GAAChI,CAAC,CAACC,GAAG,cAAA+H,OAAA,cAAAA,OAAA,GAAIhI,CAAC,CAAC2F,EAAE,MAAM1F,GAAG;MAAA,EAAC;MAC3EnF,WAAW,CAAC0E,IAAI,CAAC;MACjB;IACF;;IAEA;IACA,IAAIA,IAAI,CAACC,IAAI,KAAK,UAAU,EAAE;MAAA,IAAAwI,qBAAA,EAAAC,gBAAA,EAAAC,iBAAA,EAAAC,qBAAA,EAAAC,iBAAA,EAAAC,kBAAA;MAC5B,MAAM7J,IAA6B,GAAGe,IAAI,CAACf,IAAI;MAC/C,MAAM8J,GAAG,GAAGpO,eAAe,CAACsE,IAAI,CAAC;;MAEjC;MACA,MAAM+J,QAAQ,GAAG/J,IAAI,KAAK,QAAQ,IAAAwJ,qBAAA,IAAAC,gBAAA,GAC9BtN,SAAS,CAACkE,KAAK,cAAAoJ,gBAAA,wBAAAC,iBAAA,GAAfD,gBAAA,CAAkB,CAAC,CAAC,cAAAC,iBAAA,uBAApBA,iBAAA,CAAsBzG,KAAK,cAAAuG,qBAAA,cAAAA,qBAAA,GAAI,EAAE,IAAAG,qBAAA,IAAAC,iBAAA,GACjCzN,SAAS,CAACkE,KAAK,cAAAuJ,iBAAA,wBAAAC,kBAAA,GAAfD,iBAAA,CAAkB,CAAC,CAAC,cAAAC,kBAAA,uBAApBA,kBAAA,CAAsB3G,MAAM,cAAAyG,qBAAA,cAAAA,qBAAA,GAAI,EAAE;MAEtC,IAAII,QAAQ,CAACxF,MAAM,IAAIuF,GAAG,EAAE;QAC1B;QACA1B,OAAO,CAACC,IAAI,CAAC,OAAOrI,IAAI,aAAa+J,QAAQ,CAACxF,MAAM,IAAIuF,GAAG,GAAG,CAAC;QAC/D;MACF;MAEAzN,WAAW,CAAC0E,IAAI,CAAC;MACjB;IACF;;IAEA;IACA1E,WAAW,CAAC0E,IAAI,CAAC;EACnB,CAAC,EAAE,CAAC5E,SAAS,EAAEE,WAAW,CAAC,CAAC;EAE5B,MAAM2N,WAAW,GAAG3O,WAAW,CAAEiN,CAAsC,IAAK;IAC1E,MAAMnD,MAAM,GAAG1I,SAAS,CAACoE,OAAO;IAChC,IAAI,CAACsE,MAAM,EAAE;IAEb,MAAM8E,IAAI,GAAG9E,MAAM,CAAC+E,qBAAqB,CAAC,CAAC;IAC3C,MAAM;MAAEtE,KAAK;MAAEC,OAAO;MAAEC;IAAQ,CAAC,GAAGrK,cAAc,CAAC0J,MAAM,CAACG,KAAK,EAAEH,MAAM,CAACI,MAAM,CAAC;IAC/E,MAAM4E,EAAE,GAAG,CAAC7B,CAAC,CAAC8B,OAAO,GAAGH,IAAI,CAACI,IAAI,GAAGxE,OAAO,IAAID,KAAK;IACpD,MAAM0E,EAAE,GAAG,CAAChC,CAAC,CAACiC,OAAO,GAAGN,IAAI,CAACO,GAAG,GAAG1E,OAAO,IAAIF,KAAK;IAEnD,MAAM6E,GAAG,GAAG/N,aAAa,CAACmE,OAAO,CAAC6J,IAAI,CAAC5D,CAAC,IAAIqD,EAAE,IAAIrD,CAAC,CAAC/J,CAAC,IAAIoN,EAAE,IAAIrD,CAAC,CAAC/J,CAAC,GAAG+J,CAAC,CAACtH,CAAC,IAAI8K,EAAE,IAAIxD,CAAC,CAAC9J,CAAC,IAAIsN,EAAE,IAAIxD,CAAC,CAAC9J,CAAC,GAAG8J,CAAC,CAACrH,CAAC,CAAC;IACzG,IAAIgL,GAAG,EAAExB,eAAe,CAACwB,GAAG,CAAC1J,IAAI,CAAC;EACpC,CAAC,EAAE,CAACkI,eAAe,CAAC,CAAC;EAErB,MAAM0B,eAAe,GAAGtP,WAAW,CAAEiN,CAAsC,IAAK;IAC9E,MAAMnD,MAAM,GAAG1I,SAAS,CAACoE,OAAO;IAChC,IAAI,CAACsE,MAAM,EAAE;IAEb,MAAM8E,IAAI,GAAG9E,MAAM,CAAC+E,qBAAqB,CAAC,CAAC;IAC3C,MAAM;MAAEtE,KAAK;MAAEC,OAAO;MAAEC;IAAQ,CAAC,GAAGrK,cAAc,CAAC0J,MAAM,CAACG,KAAK,EAAEH,MAAM,CAACI,MAAM,CAAC;IAC/E,MAAM4E,EAAE,GAAG,CAAC7B,CAAC,CAAC8B,OAAO,GAAGH,IAAI,CAACI,IAAI,GAAGxE,OAAO,IAAID,KAAK;IACpD,MAAM0E,EAAE,GAAG,CAAChC,CAAC,CAACiC,OAAO,GAAGN,IAAI,CAACO,GAAG,GAAG1E,OAAO,IAAIF,KAAK;IAEnD,MAAM6E,GAAG,GAAG/N,aAAa,CAACmE,OAAO,CAAC6J,IAAI,CAAC5D,CAAC,IAAIqD,EAAE,IAAIrD,CAAC,CAAC/J,CAAC,IAAIoN,EAAE,IAAIrD,CAAC,CAAC/J,CAAC,GAAG+J,CAAC,CAACtH,CAAC,IAAI8K,EAAE,IAAIxD,CAAC,CAAC9J,CAAC,IAAIsN,EAAE,IAAIxD,CAAC,CAAC9J,CAAC,GAAG8J,CAAC,CAACrH,CAAC,CAAC;IACzG,IAAIgL,GAAG,EAAE;MACPnO,WAAW,CAAC;QAAE,GAAGmO,GAAG,CAAC1J,IAAI;QAAEhE,CAAC,EAAEuL,CAAC,CAAC8B,OAAO;QAAEpN,CAAC,EAAEsL,CAAC,CAACiC;MAAQ,CAAC,CAAC;IAC1D,CAAC,MAAM;MACLjO,WAAW,CAAC,IAAI,CAAC;IACnB;EACF,CAAC,EAAE,CAACA,WAAW,CAAC,CAAC;EAEjB,oBACEL,OAAA;IACE2O,GAAG,EAAEnO,SAAU;IACf6I,KAAK,EAAE,IAAK;IACZC,MAAM,EAAE,IAAK;IACbsF,KAAK,EAAE;MACLC,OAAO,EAAE,OAAO;MAChBxF,KAAK,EAAE,MAAM;MACbC,MAAM,EAAE,MAAM;MACdwF,cAAc,EAAE;IAClB,CAAE;IACFC,OAAO,EAAEhB,WAAY;IACrBiB,WAAW,EAAEN;EAAgB;IAAAO,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAC9B,CAAC;AAEN,CAAC;AAAC7O,EAAA,CA1yBWN,UAAqC;AAAAoP,EAAA,GAArCpP,UAAqC;AAAA,IAAAoP,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}